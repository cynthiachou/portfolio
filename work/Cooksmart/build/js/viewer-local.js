/*! jQuery v2.2.3 | (c) jQuery Foundation | jquery.org/license */
/**! Calculate the md5 hash of a string
 * +   original by: Webtoolkit.info (http://www.webtoolkit.info/)
 * + namespaced by: Michael White (http://crestidg.com)
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
**/
function md5(t){var e,i,n,s,r,a,o,l,c,h=function(t,e){return t<<e|t>>>32-e},d=function(t,e){var i,n,s,r,a;return s=2147483648&t,r=2147483648&e,i=1073741824&t,n=1073741824&e,a=(1073741823&t)+(1073741823&e),i&n?2147483648^a^s^r:i|n?1073741824&a?3221225472^a^s^r:1073741824^a^s^r:a^s^r},u=function(t,e,i){return t&e|~t&i},p=function(t,e,i){return t&i|e&~i},f=function(t,e,i){return t^e^i},g=function(t,e,i){return e^(t|~i)},m=function(t,e,i,n,s,r,a){return t=d(t,d(d(u(e,i,n),s),a)),d(h(t,r),e)},v=function(t,e,i,n,s,r,a){return t=d(t,d(d(p(e,i,n),s),a)),d(h(t,r),e)},_=function(t,e,i,n,s,r,a){return t=d(t,d(d(f(e,i,n),s),a)),d(h(t,r),e)},y=function(t,e,i,n,s,r,a){return t=d(t,d(d(g(e,i,n),s),a)),d(h(t,r),e)},w=function(t){for(var e,i=t.length,n=i+8,s=(n-n%64)/64,r=16*(s+1),a=Array(r-1),o=0,l=0;l<i;)e=(l-l%4)/4,o=l%4*8,a[e]=a[e]|t.charCodeAt(l)<<o,l++;return e=(l-l%4)/4,o=l%4*8,a[e]=a[e]|128<<o,a[r-2]=i<<3,a[r-1]=i>>>29,a},b=function(t){var e,i,n="",s="";for(i=0;i<=3;i++)e=t>>>8*i&255,s="0"+e.toString(16),n+=s.substr(s.length-2,2);return n},x=Array(),k=7,T=12,S=17,P=22,C=5,$=9,M=14,I=20,E=4,A=11,L=16,D=23,R=6,j=10,O=15,N=21;for(x=w(t),a=1732584193,o=4023233417,l=2562383102,c=271733878,e=0;e<x.length;e+=16)i=a,n=o,s=l,r=c,a=m(a,o,l,c,x[e+0],k,3614090360),c=m(c,a,o,l,x[e+1],T,3905402710),l=m(l,c,a,o,x[e+2],S,606105819),o=m(o,l,c,a,x[e+3],P,3250441966),a=m(a,o,l,c,x[e+4],k,4118548399),c=m(c,a,o,l,x[e+5],T,1200080426),l=m(l,c,a,o,x[e+6],S,2821735955),o=m(o,l,c,a,x[e+7],P,4249261313),a=m(a,o,l,c,x[e+8],k,1770035416),c=m(c,a,o,l,x[e+9],T,2336552879),l=m(l,c,a,o,x[e+10],S,4294925233),o=m(o,l,c,a,x[e+11],P,2304563134),a=m(a,o,l,c,x[e+12],k,1804603682),c=m(c,a,o,l,x[e+13],T,4254626195),l=m(l,c,a,o,x[e+14],S,2792965006),o=m(o,l,c,a,x[e+15],P,1236535329),a=v(a,o,l,c,x[e+1],C,4129170786),c=v(c,a,o,l,x[e+6],$,3225465664),l=v(l,c,a,o,x[e+11],M,643717713),o=v(o,l,c,a,x[e+0],I,3921069994),a=v(a,o,l,c,x[e+5],C,3593408605),c=v(c,a,o,l,x[e+10],$,38016083),l=v(l,c,a,o,x[e+15],M,3634488961),o=v(o,l,c,a,x[e+4],I,3889429448),a=v(a,o,l,c,x[e+9],C,568446438),c=v(c,a,o,l,x[e+14],$,3275163606),l=v(l,c,a,o,x[e+3],M,4107603335),o=v(o,l,c,a,x[e+8],I,1163531501),a=v(a,o,l,c,x[e+13],C,2850285829),c=v(c,a,o,l,x[e+2],$,4243563512),l=v(l,c,a,o,x[e+7],M,1735328473),o=v(o,l,c,a,x[e+12],I,2368359562),a=_(a,o,l,c,x[e+5],E,4294588738),c=_(c,a,o,l,x[e+8],A,2272392833),l=_(l,c,a,o,x[e+11],L,1839030562),o=_(o,l,c,a,x[e+14],D,4259657740),a=_(a,o,l,c,x[e+1],E,2763975236),c=_(c,a,o,l,x[e+4],A,1272893353),l=_(l,c,a,o,x[e+7],L,4139469664),o=_(o,l,c,a,x[e+10],D,3200236656),a=_(a,o,l,c,x[e+13],E,681279174),c=_(c,a,o,l,x[e+0],A,3936430074),l=_(l,c,a,o,x[e+3],L,3572445317),o=_(o,l,c,a,x[e+6],D,76029189),a=_(a,o,l,c,x[e+9],E,3654602809),c=_(c,a,o,l,x[e+12],A,3873151461),l=_(l,c,a,o,x[e+15],L,530742520),o=_(o,l,c,a,x[e+2],D,3299628645),a=y(a,o,l,c,x[e+0],R,4096336452),c=y(c,a,o,l,x[e+7],j,1126891415),l=y(l,c,a,o,x[e+14],O,2878612391),o=y(o,l,c,a,x[e+5],N,4237533241),a=y(a,o,l,c,x[e+12],R,1700485571),c=y(c,a,o,l,x[e+3],j,2399980690),l=y(l,c,a,o,x[e+10],O,4293915773),o=y(o,l,c,a,x[e+1],N,2240044497),a=y(a,o,l,c,x[e+8],R,1873313359),c=y(c,a,o,l,x[e+15],j,4264355552),l=y(l,c,a,o,x[e+6],O,2734768916),o=y(o,l,c,a,x[e+13],N,1309151649),a=y(a,o,l,c,x[e+4],R,4149444226),c=y(c,a,o,l,x[e+11],j,3174756917),l=y(l,c,a,o,x[e+2],O,718787259),o=y(o,l,c,a,x[e+9],N,3951481745),a=d(a,i),o=d(o,n),l=d(l,s),c=d(c,r);var z=b(a)+b(o)+b(l)+b(c);return z.toLowerCase()}!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e=!!t&&"length"in t&&t.length,i=rt.type(t);return"function"!==i&&!rt.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function n(t,e,i){if(rt.isFunction(e))return rt.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return rt.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(gt.test(e))return rt.filter(e,t,i);e=rt.filter(e,t)}return rt.grep(t,function(t){return Z.call(e,t)>-1!==i})}function s(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function r(t){var e={};return rt.each(t.match(bt)||[],function(t,i){e[i]=!0}),e}function a(){Y.removeEventListener("DOMContentLoaded",a),t.removeEventListener("load",a),rt.ready()}function o(){this.expando=rt.expando+o.uid++}function l(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace($t,"-$&").toLowerCase(),i=t.getAttribute(n),"string"==typeof i){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:Ct.test(i)?rt.parseJSON(i):i)}catch(t){}Pt.set(t,e,i)}else i=void 0;return i}function c(t,e,i,n){var s,r=1,a=20,o=n?function(){return n.cur()}:function(){return rt.css(t,e,"")},l=o(),c=i&&i[3]||(rt.cssNumber[e]?"":"px"),h=(rt.cssNumber[e]||"px"!==c&&+l)&&It.exec(rt.css(t,e));if(h&&h[3]!==c){c=c||h[3],i=i||[],h=+l||1;do r=r||".5",h/=r,rt.style(t,e,h+c);while(r!==(r=o()/l)&&1!==r&&--a)}return i&&(h=+h||+l||0,s=i[1]?h+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=h,n.end=s)),s}function h(t,e){var i="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&rt.nodeName(t,e)?rt.merge([t],i):i}function d(t,e){for(var i=0,n=t.length;n>i;i++)St.set(t[i],"globalEval",!e||St.get(e[i],"globalEval"))}function u(t,e,i,n,s){for(var r,a,o,l,c,u,p=e.createDocumentFragment(),f=[],g=0,m=t.length;m>g;g++)if(r=t[g],r||0===r)if("object"===rt.type(r))rt.merge(f,r.nodeType?[r]:r);else if(Ot.test(r)){for(a=a||p.appendChild(e.createElement("div")),o=(Dt.exec(r)||["",""])[1].toLowerCase(),l=jt[o]||jt._default,a.innerHTML=l[1]+rt.htmlPrefilter(r)+l[2],u=l[0];u--;)a=a.lastChild;rt.merge(f,a.childNodes),a=p.firstChild,a.textContent=""}else f.push(e.createTextNode(r));for(p.textContent="",g=0;r=f[g++];)if(n&&rt.inArray(r,n)>-1)s&&s.push(r);else if(c=rt.contains(r.ownerDocument,r),a=h(p.appendChild(r),"script"),c&&d(a),i)for(u=0;r=a[u++];)Rt.test(r.type||"")&&i.push(r);return p}function p(){return!0}function f(){return!1}function g(){try{return Y.activeElement}catch(t){}}function m(t,e,i,n,s,r){var a,o;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=void 0);for(o in e)m(t,o,i,n,e[o],r);return t}if(null==n&&null==s?(s=i,n=i=void 0):null==s&&("string"==typeof i?(s=n,n=void 0):(s=n,n=i,i=void 0)),s===!1)s=f;else if(!s)return t;return 1===r&&(a=s,s=function(t){return rt().off(t),a.apply(this,arguments)},s.guid=a.guid||(a.guid=rt.guid++)),t.each(function(){rt.event.add(this,e,s,n,i)})}function v(t,e){return rt.nodeName(t,"table")&&rt.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function _(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function y(t){var e=Ut.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function w(t,e){var i,n,s,r,a,o,l,c;if(1===e.nodeType){if(St.hasData(t)&&(r=St.access(t),a=St.set(e,r),c=r.events)){delete a.handle,a.events={};for(s in c)for(i=0,n=c[s].length;n>i;i++)rt.event.add(e,s,c[s][i])}Pt.hasData(t)&&(o=Pt.access(t),l=rt.extend({},o),Pt.set(e,l))}}function b(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Lt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function x(t,e,i,n){e=K.apply([],e);var s,r,a,o,l,c,d=0,p=t.length,f=p-1,g=e[0],m=rt.isFunction(g);if(m||p>1&&"string"==typeof g&&!nt.checkClone&&Bt.test(g))return t.each(function(s){var r=t.eq(s);m&&(e[0]=g.call(this,s,r.html())),x(r,e,i,n)});if(p&&(s=u(e,t[0].ownerDocument,!1,t,n),r=s.firstChild,1===s.childNodes.length&&(s=r),r||n)){for(a=rt.map(h(s,"script"),_),o=a.length;p>d;d++)l=s,d!==f&&(l=rt.clone(l,!0,!0),o&&rt.merge(a,h(l,"script"))),i.call(t[d],l,d);if(o)for(c=a[a.length-1].ownerDocument,rt.map(a,y),d=0;o>d;d++)l=a[d],Rt.test(l.type||"")&&!St.access(l,"globalEval")&&rt.contains(c,l)&&(l.src?rt._evalUrl&&rt._evalUrl(l.src):rt.globalEval(l.textContent.replace(Vt,"")))}return t}function k(t,e,i){for(var n,s=e?rt.filter(e,t):t,r=0;null!=(n=s[r]);r++)i||1!==n.nodeType||rt.cleanData(h(n)),n.parentNode&&(i&&rt.contains(n.ownerDocument,n)&&d(h(n,"script")),n.parentNode.removeChild(n));return t}function T(t,e){var i=rt(e.createElement(t)).appendTo(e.body),n=rt.css(i[0],"display");return i.detach(),n}function S(t){var e=Y,i=Gt[t];return i||(i=T(t,e),"none"!==i&&i||(qt=(qt||rt("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=qt[0].contentDocument,e.write(),e.close(),i=T(t,e),qt.detach()),Gt[t]=i),i}function P(t,e,i){var n,s,r,a,o=t.style;return i=i||Jt(t),a=i?i.getPropertyValue(e)||i[e]:void 0,""!==a&&void 0!==a||rt.contains(t.ownerDocument,t)||(a=rt.style(t,e)),i&&!nt.pixelMarginRight()&&Yt.test(a)&&Xt.test(e)&&(n=o.width,s=o.minWidth,r=o.maxWidth,o.minWidth=o.maxWidth=o.width=a,a=i.width,o.width=n,o.minWidth=s,o.maxWidth=r),void 0!==a?a+"":a}function C(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function $(t){if(t in ne)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=ie.length;i--;)if(t=ie[i]+e,t in ne)return t}function M(t,e,i){var n=It.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function I(t,e,i,n,s){for(var r=i===(n?"border":"content")?4:"width"===e?1:0,a=0;4>r;r+=2)"margin"===i&&(a+=rt.css(t,i+Et[r],!0,s)),n?("content"===i&&(a-=rt.css(t,"padding"+Et[r],!0,s)),"margin"!==i&&(a-=rt.css(t,"border"+Et[r]+"Width",!0,s))):(a+=rt.css(t,"padding"+Et[r],!0,s),"padding"!==i&&(a+=rt.css(t,"border"+Et[r]+"Width",!0,s)));return a}function E(e,i,n){var s=!0,r="width"===i?e.offsetWidth:e.offsetHeight,a=Jt(e),o="border-box"===rt.css(e,"boxSizing",!1,a);if(Y.msFullscreenElement&&t.top!==t&&e.getClientRects().length&&(r=Math.round(100*e.getBoundingClientRect()[i])),0>=r||null==r){if(r=P(e,i,a),(0>r||null==r)&&(r=e.style[i]),Yt.test(r))return r;s=o&&(nt.boxSizingReliable()||r===e.style[i]),r=parseFloat(r)||0}return r+I(e,i,n||(o?"border":"content"),s,a)+"px"}function A(t,e){for(var i,n,s,r=[],a=0,o=t.length;o>a;a++)n=t[a],n.style&&(r[a]=St.get(n,"olddisplay"),i=n.style.display,e?(r[a]||"none"!==i||(n.style.display=""),""===n.style.display&&At(n)&&(r[a]=St.access(n,"olddisplay",S(n.nodeName)))):(s=At(n),"none"===i&&s||St.set(n,"olddisplay",s?i:rt.css(n,"display"))));for(a=0;o>a;a++)n=t[a],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?r[a]||"":"none"));return t}function L(t,e,i,n,s){return new L.prototype.init(t,e,i,n,s)}function D(){return t.setTimeout(function(){se=void 0}),se=rt.now()}function R(t,e){var i,n=0,s={height:t};for(e=e?1:0;4>n;n+=2-e)i=Et[n],s["margin"+i]=s["padding"+i]=t;return e&&(s.opacity=s.width=t),s}function j(t,e,i){for(var n,s=(z.tweeners[e]||[]).concat(z.tweeners["*"]),r=0,a=s.length;a>r;r++)if(n=s[r].call(i,e,t))return n}function O(t,e,i){var n,s,r,a,o,l,c,h,d=this,u={},p=t.style,f=t.nodeType&&At(t),g=St.get(t,"fxshow");i.queue||(o=rt._queueHooks(t,"fx"),null==o.unqueued&&(o.unqueued=0,l=o.empty.fire,o.empty.fire=function(){o.unqueued||l()}),o.unqueued++,d.always(function(){d.always(function(){o.unqueued--,rt.queue(t,"fx").length||o.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],c=rt.css(t,"display"),h="none"===c?St.get(t,"olddisplay")||S(t.nodeName):c,"inline"===h&&"none"===rt.css(t,"float")&&(p.display="inline-block")),i.overflow&&(p.overflow="hidden",d.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}));for(n in e)if(s=e[n],ae.exec(s)){if(delete e[n],r=r||"toggle"===s,s===(f?"hide":"show")){if("show"!==s||!g||void 0===g[n])continue;f=!0}u[n]=g&&g[n]||rt.style(t,n)}else c=void 0;if(rt.isEmptyObject(u))"inline"===("none"===c?S(t.nodeName):c)&&(p.display=c);else{g?"hidden"in g&&(f=g.hidden):g=St.access(t,"fxshow",{}),r&&(g.hidden=!f),f?rt(t).show():d.done(function(){rt(t).hide()}),d.done(function(){var e;St.remove(t,"fxshow");for(e in u)rt.style(t,e,u[e])});for(n in u)a=j(f?g[n]:0,n,d),n in g||(g[n]=a.start,f&&(a.end=a.start,a.start="width"===n||"height"===n?1:0))}}function N(t,e){var i,n,s,r,a;for(i in t)if(n=rt.camelCase(i),s=e[n],r=t[i],rt.isArray(r)&&(s=r[1],r=t[i]=r[0]),i!==n&&(t[n]=r,delete t[i]),a=rt.cssHooks[n],a&&"expand"in a){r=a.expand(r),delete t[n];for(i in r)i in t||(t[i]=r[i],e[i]=s)}else e[n]=s}function z(t,e,i){var n,s,r=0,a=z.prefilters.length,o=rt.Deferred().always(function(){delete l.elem}),l=function(){if(s)return!1;for(var e=se||D(),i=Math.max(0,c.startTime+c.duration-e),n=i/c.duration||0,r=1-n,a=0,l=c.tweens.length;l>a;a++)c.tweens[a].run(r);return o.notifyWith(t,[c,r,i]),1>r&&l?i:(o.resolveWith(t,[c]),!1)},c=o.promise({elem:t,props:rt.extend({},e),opts:rt.extend(!0,{specialEasing:{},easing:rt.easing._default},i),originalProperties:e,originalOptions:i,startTime:se||D(),duration:i.duration,tweens:[],createTween:function(e,i){var n=rt.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(n),n},stop:function(e){var i=0,n=e?c.tweens.length:0;if(s)return this;for(s=!0;n>i;i++)c.tweens[i].run(1);return e?(o.notifyWith(t,[c,1,0]),o.resolveWith(t,[c,e])):o.rejectWith(t,[c,e]),this}}),h=c.props;for(N(h,c.opts.specialEasing);a>r;r++)if(n=z.prefilters[r].call(c,t,h,c.opts))return rt.isFunction(n.stop)&&(rt._queueHooks(c.elem,c.opts.queue).stop=rt.proxy(n.stop,n)),n;return rt.map(h,j,c),rt.isFunction(c.opts.start)&&c.opts.start.call(t,c),rt.fx.timer(rt.extend(l,{elem:t,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function W(t){return t.getAttribute&&t.getAttribute("class")||""}function F(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,s=0,r=e.toLowerCase().match(bt)||[];if(rt.isFunction(i))for(;n=r[s++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function H(t,e,i,n){function s(o){var l;return r[o]=!0,rt.each(t[o]||[],function(t,o){var c=o(e,i,n);return"string"!=typeof c||a||r[c]?a?!(l=c):void 0:(e.dataTypes.unshift(c),s(c),!1)}),l}var r={},a=t===Pe;return s(e.dataTypes[0])||!r["*"]&&s("*")}function B(t,e){var i,n,s=rt.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((s[i]?t:n||(n={}))[i]=e[i]);return n&&rt.extend(!0,t,n),t}function U(t,e,i){for(var n,s,r,a,o=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(s in o)if(o[s]&&o[s].test(n)){l.unshift(s);break}if(l[0]in i)r=l[0];else{for(s in i){if(!l[0]||t.converters[s+" "+l[0]]){r=s;break}a||(a=s)}r=r||a}return r?(r!==l[0]&&l.unshift(r),i[r]):void 0}function V(t,e,i,n){var s,r,a,o,l,c={},h=t.dataTypes.slice();if(h[1])for(a in t.converters)c[a.toLowerCase()]=t.converters[a];for(r=h.shift();r;)if(t.responseFields[r]&&(i[t.responseFields[r]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=r,r=h.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(a=c[l+" "+r]||c["* "+r],!a)for(s in c)if(o=s.split(" "),o[1]===r&&(a=c[l+" "+o[0]]||c["* "+o[0]])){a===!0?a=c[s]:c[s]!==!0&&(r=o[0],h.unshift(o[1]));break}if(a!==!0)if(a&&t.throws)e=a(e);else try{e=a(e)}catch(t){return{state:"parsererror",error:a?t:"No conversion from "+l+" to "+r}}}return{state:"success",data:e}}function q(t,e,i,n){var s;if(rt.isArray(e))rt.each(e,function(e,s){i||Ie.test(t)?n(t,s):q(t+"["+("object"==typeof s&&null!=s?e:"")+"]",s,i,n)});else if(i||"object"!==rt.type(e))n(t,e);else for(s in e)q(t+"["+s+"]",e[s],i,n)}function G(t){return rt.isWindow(t)?t:9===t.nodeType&&t.defaultView}var X=[],Y=t.document,J=X.slice,K=X.concat,Q=X.push,Z=X.indexOf,tt={},et=tt.toString,it=tt.hasOwnProperty,nt={},st="2.2.3",rt=function(t,e){return new rt.fn.init(t,e)},at=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ot=/^-ms-/,lt=/-([\da-z])/gi,ct=function(t,e){return e.toUpperCase()};rt.fn=rt.prototype={jquery:st,constructor:rt,selector:"",length:0,toArray:function(){return J.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:J.call(this)},pushStack:function(t){var e=rt.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return rt.each(this,t)},map:function(t){return this.pushStack(rt.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(J.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(0>t?e:0);return this.pushStack(i>=0&&e>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:Q,sort:X.sort,splice:X.splice},rt.extend=rt.fn.extend=function(){var t,e,i,n,s,r,a=arguments[0]||{},o=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[o]||{},o++),"object"==typeof a||rt.isFunction(a)||(a={}),o===l&&(a=this,o--);l>o;o++)if(null!=(t=arguments[o]))for(e in t)i=a[e],n=t[e],a!==n&&(c&&n&&(rt.isPlainObject(n)||(s=rt.isArray(n)))?(s?(s=!1,r=i&&rt.isArray(i)?i:[]):r=i&&rt.isPlainObject(i)?i:{},a[e]=rt.extend(c,r,n)):void 0!==n&&(a[e]=n));return a},rt.extend({expando:"jQuery"+(st+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===rt.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=t&&t.toString();return!rt.isArray(t)&&e-parseFloat(e)+1>=0},isPlainObject:function(t){var e;if("object"!==rt.type(t)||t.nodeType||rt.isWindow(t))return!1;if(t.constructor&&!it.call(t,"constructor")&&!it.call(t.constructor.prototype||{},"isPrototypeOf"))return!1;for(e in t);return void 0===e||it.call(t,e)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?tt[et.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;t=rt.trim(t),t&&(1===t.indexOf("use strict")?(e=Y.createElement("script"),e.text=t,Y.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(ot,"ms-").replace(lt,ct)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var n,s=0;if(i(t))for(n=t.length;n>s&&e.call(t[s],s,t[s])!==!1;s++);else for(s in t)if(e.call(t[s],s,t[s])===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(at,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?rt.merge(n,"string"==typeof t?[t]:t):Q.call(n,t)),n},inArray:function(t,e,i){return null==e?-1:Z.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,s=t.length;i>n;n++)t[s++]=e[n];return t.length=s,t},grep:function(t,e,i){for(var n,s=[],r=0,a=t.length,o=!i;a>r;r++)n=!e(t[r],r),n!==o&&s.push(t[r]);return s},map:function(t,e,n){var s,r,a=0,o=[];if(i(t))for(s=t.length;s>a;a++)r=e(t[a],a,n),null!=r&&o.push(r);else for(a in t)r=e(t[a],a,n),null!=r&&o.push(r);return K.apply([],o)},guid:1,proxy:function(t,e){var i,n,s;return"string"==typeof e&&(i=t[e],e=t,t=i),rt.isFunction(t)?(n=J.call(arguments,2),s=function(){return t.apply(e||this,n.concat(J.call(arguments)))},s.guid=t.guid=t.guid||rt.guid++,s):void 0},now:Date.now,support:nt}),"function"==typeof Symbol&&(rt.fn[Symbol.iterator]=X[Symbol.iterator]),rt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){tt["[object "+e+"]"]=e.toLowerCase()});var ht=function(t){function e(t,e,i,n){var s,r,a,o,l,c,d,p,f=e&&e.ownerDocument,g=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==g&&9!==g&&11!==g)return i;if(!n&&((e?e.ownerDocument||e:W)!==A&&E(e),e=e||A,D)){if(11!==g&&(c=vt.exec(t)))if(s=c[1]){if(9===g){if(!(a=e.getElementById(s)))return i;if(a.id===s)return i.push(a),i}else if(f&&(a=f.getElementById(s))&&N(e,a)&&a.id===s)return i.push(a),i}else{if(c[2])return Q.apply(i,e.getElementsByTagName(t)),i;if((s=c[3])&&b.getElementsByClassName&&e.getElementsByClassName)return Q.apply(i,e.getElementsByClassName(s)),i}if(b.qsa&&!V[t+" "]&&(!R||!R.test(t))){if(1!==g)f=e,p=t;else if("object"!==e.nodeName.toLowerCase()){for((o=e.getAttribute("id"))?o=o.replace(yt,"\\$&"):e.setAttribute("id",o=z),d=S(t),r=d.length,l=ut.test(o)?"#"+o:"[id='"+o+"']";r--;)d[r]=l+" "+u(d[r]);p=d.join(","),f=_t.test(t)&&h(e.parentNode)||e}if(p)try{return Q.apply(i,f.querySelectorAll(p)),i}catch(t){}finally{o===z&&e.removeAttribute("id")}}}return C(t.replace(ot,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>x.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[z]=!0,t}function s(t){var e=A.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function r(t,e){for(var i=t.split("|"),n=i.length;n--;)x.attrHandle[i[n]]=e}function a(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||G)-(~t.sourceIndex||G);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function o(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function c(t){return n(function(e){return e=+e,n(function(i,n){for(var s,r=t([],i.length,e),a=r.length;a--;)i[s=r[a]]&&(i[s]=!(n[s]=i[s]))})})}function h(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function d(){}function u(t){for(var e=0,i=t.length,n="";i>e;e++)n+=t[e].value;return n}function p(t,e,i){var n=e.dir,s=i&&"parentNode"===n,r=H++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||s)return t(e,i,r)}:function(e,i,a){var o,l,c,h=[F,r];if(a){for(;e=e[n];)if((1===e.nodeType||s)&&t(e,i,a))return!0}else for(;e=e[n];)if(1===e.nodeType||s){if(c=e[z]||(e[z]={}),l=c[e.uniqueID]||(c[e.uniqueID]={}),(o=l[n])&&o[0]===F&&o[1]===r)return h[2]=o[2];if(l[n]=h,h[2]=t(e,i,a))return!0}}}function f(t){return t.length>1?function(e,i,n){for(var s=t.length;s--;)if(!t[s](e,i,n))return!1;return!0}:t[0]}function g(t,i,n){for(var s=0,r=i.length;r>s;s++)e(t,i[s],n);return n}function m(t,e,i,n,s){for(var r,a=[],o=0,l=t.length,c=null!=e;l>o;o++)(r=t[o])&&(i&&!i(r,n,s)||(a.push(r),c&&e.push(o)));return a}function v(t,e,i,s,r,a){return s&&!s[z]&&(s=v(s)),r&&!r[z]&&(r=v(r,a)),n(function(n,a,o,l){var c,h,d,u=[],p=[],f=a.length,v=n||g(e||"*",o.nodeType?[o]:o,[]),_=!t||!n&&e?v:m(v,u,t,o,l),y=i?r||(n?t:f||s)?[]:a:_;if(i&&i(_,y,o,l),s)for(c=m(y,p),s(c,[],o,l),h=c.length;h--;)(d=c[h])&&(y[p[h]]=!(_[p[h]]=d));if(n){if(r||t){if(r){for(c=[],h=y.length;h--;)(d=y[h])&&c.push(_[h]=d);r(null,y=[],c,l)}for(h=y.length;h--;)(d=y[h])&&(c=r?tt(n,d):u[h])>-1&&(n[c]=!(a[c]=d))}}else y=m(y===a?y.splice(f,y.length):y),r?r(null,a,y,l):Q.apply(a,y)})}function _(t){for(var e,i,n,s=t.length,r=x.relative[t[0].type],a=r||x.relative[" "],o=r?1:0,l=p(function(t){return t===e},a,!0),c=p(function(t){return tt(e,t)>-1},a,!0),h=[function(t,i,n){var s=!r&&(n||i!==$)||((e=i).nodeType?l(t,i,n):c(t,i,n));return e=null,s}];s>o;o++)if(i=x.relative[t[o].type])h=[p(f(h),i)];else{if(i=x.filter[t[o].type].apply(null,t[o].matches),i[z]){for(n=++o;s>n&&!x.relative[t[n].type];n++);return v(o>1&&f(h),o>1&&u(t.slice(0,o-1).concat({value:" "===t[o-2].type?"*":""})).replace(ot,"$1"),i,n>o&&_(t.slice(o,n)),s>n&&_(t=t.slice(n)),s>n&&u(t))}h.push(i)}return f(h)}function y(t,i){var s=i.length>0,r=t.length>0,a=function(n,a,o,l,c){var h,d,u,p=0,f="0",g=n&&[],v=[],_=$,y=n||r&&x.find.TAG("*",c),w=F+=null==_?1:Math.random()||.1,b=y.length;for(c&&($=a===A||a||c);f!==b&&null!=(h=y[f]);f++){if(r&&h){for(d=0,a||h.ownerDocument===A||(E(h),o=!D);u=t[d++];)if(u(h,a||A,o)){l.push(h);break}c&&(F=w)}s&&((h=!u&&h)&&p--,n&&g.push(h))}if(p+=f,s&&f!==p){for(d=0;u=i[d++];)u(g,v,a,o);if(n){if(p>0)for(;f--;)g[f]||v[f]||(v[f]=J.call(l));v=m(v)}Q.apply(l,v),c&&!n&&v.length>0&&p+i.length>1&&e.uniqueSort(l)}return c&&(F=w,$=_),g};return s?n(a):a}var w,b,x,k,T,S,P,C,$,M,I,E,A,L,D,R,j,O,N,z="sizzle"+1*new Date,W=t.document,F=0,H=0,B=i(),U=i(),V=i(),q=function(t,e){return t===e&&(I=!0),0},G=1<<31,X={}.hasOwnProperty,Y=[],J=Y.pop,K=Y.push,Q=Y.push,Z=Y.slice,tt=function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",st="\\["+it+"*("+nt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+nt+"))|)"+it+"*\\]",rt=":("+nt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+st+")*)|.*)\\)|)",at=new RegExp(it+"+","g"),ot=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),lt=new RegExp("^"+it+"*,"+it+"*"),ct=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ht=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),dt=new RegExp(rt),ut=new RegExp("^"+nt+"$"),pt={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt+"|[*])"),ATTR:new RegExp("^"+st),PSEUDO:new RegExp("^"+rt),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},ft=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,mt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_t=/[+~]/,yt=/'|\\/g,wt=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),bt=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},xt=function(){E()};try{Q.apply(Y=Z.call(W.childNodes),W.childNodes),Y[W.childNodes.length].nodeType}catch(t){Q={apply:Y.length?function(t,e){K.apply(t,Z.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}b=e.support={},T=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},E=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:W;return n!==A&&9===n.nodeType&&n.documentElement?(A=n,L=A.documentElement,D=!T(A),(i=A.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",xt,!1):i.attachEvent&&i.attachEvent("onunload",xt)),b.attributes=s(function(t){return t.className="i",!t.getAttribute("className")}),b.getElementsByTagName=s(function(t){return t.appendChild(A.createComment("")),!t.getElementsByTagName("*").length}),b.getElementsByClassName=mt.test(A.getElementsByClassName),b.getById=s(function(t){return L.appendChild(t).id=z,!A.getElementsByName||!A.getElementsByName(z).length}),b.getById?(x.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&D){var i=e.getElementById(t);return i?[i]:[]}},x.filter.ID=function(t){var e=t.replace(wt,bt);return function(t){return t.getAttribute("id")===e}}):(delete x.find.ID,x.filter.ID=function(t){var e=t.replace(wt,bt);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),x.find.TAG=b.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):b.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],s=0,r=e.getElementsByTagName(t);if("*"===t){for(;i=r[s++];)1===i.nodeType&&n.push(i);return n}return r},x.find.CLASS=b.getElementsByClassName&&function(t,e){return"undefined"!=typeof e.getElementsByClassName&&D?e.getElementsByClassName(t):void 0},j=[],R=[],(b.qsa=mt.test(A.querySelectorAll))&&(s(function(t){L.appendChild(t).innerHTML="<a id='"+z+"'></a><select id='"+z+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&R.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||R.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+z+"-]").length||R.push("~="),t.querySelectorAll(":checked").length||R.push(":checked"),t.querySelectorAll("a#"+z+"+*").length||R.push(".#.+[+~]")}),s(function(t){var e=A.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&R.push("name"+it+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||R.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),R.push(",.*:")})),(b.matchesSelector=mt.test(O=L.matches||L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&s(function(t){b.disconnectedMatch=O.call(t,"div"),O.call(t,"[s!='']:x"),j.push("!=",rt)}),R=R.length&&new RegExp(R.join("|")),j=j.length&&new RegExp(j.join("|")),e=mt.test(L.compareDocumentPosition),N=e||mt.test(L.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},q=e?function(t,e){if(t===e)return I=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!b.sortDetached&&e.compareDocumentPosition(t)===i?t===A||t.ownerDocument===W&&N(W,t)?-1:e===A||e.ownerDocument===W&&N(W,e)?1:M?tt(M,t)-tt(M,e):0:4&i?-1:1)}:function(t,e){if(t===e)return I=!0,0;var i,n=0,s=t.parentNode,r=e.parentNode,o=[t],l=[e];if(!s||!r)return t===A?-1:e===A?1:s?-1:r?1:M?tt(M,t)-tt(M,e):0;if(s===r)return a(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;o[n]===l[n];)n++;return n?a(o[n],l[n]):o[n]===W?-1:l[n]===W?1:0},A):A},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==A&&E(t),i=i.replace(ht,"='$1']"),b.matchesSelector&&D&&!V[i+" "]&&(!j||!j.test(i))&&(!R||!R.test(i)))try{var n=O.call(t,i);if(n||b.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return e(i,A,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==A&&E(t),N(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==A&&E(t);var i=x.attrHandle[e.toLowerCase()],n=i&&X.call(x.attrHandle,e.toLowerCase())?i(t,e,!D):void 0;return void 0!==n?n:b.attributes||!D?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,s=0;if(I=!b.detectDuplicates,M=!b.sortStable&&t.slice(0),t.sort(q),I){for(;e=t[s++];)e===t[s]&&(n=i.push(s));for(;n--;)t.splice(i[n],1)}return M=null,t},k=e.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=k(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=k(e);return i},x=e.selectors={cacheLength:50,createPseudo:n,match:pt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(wt,bt),t[3]=(t[3]||t[4]||t[5]||"").replace(wt,bt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return pt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&dt.test(i)&&(e=S(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(wt,bt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=B[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&B(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"");
})},ATTR:function(t,i,n){return function(s){var r=e.attr(s,t);return null==r?"!="===i:!i||(r+="","="===i?r===n:"!="===i?r!==n:"^="===i?n&&0===r.indexOf(n):"*="===i?n&&r.indexOf(n)>-1:"$="===i?n&&r.slice(-n.length)===n:"~="===i?(" "+r.replace(at," ")+" ").indexOf(n)>-1:"|="===i&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,i,n,s){var r="nth"!==t.slice(0,3),a="last"!==t.slice(-4),o="of-type"===e;return 1===n&&0===s?function(t){return!!t.parentNode}:function(e,i,l){var c,h,d,u,p,f,g=r!==a?"nextSibling":"previousSibling",m=e.parentNode,v=o&&e.nodeName.toLowerCase(),_=!l&&!o,y=!1;if(m){if(r){for(;g;){for(u=e;u=u[g];)if(o?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[a?m.firstChild:m.lastChild],a&&_){for(u=m,d=u[z]||(u[z]={}),h=d[u.uniqueID]||(d[u.uniqueID]={}),c=h[t]||[],p=c[0]===F&&c[1],y=p&&c[2],u=p&&m.childNodes[p];u=++p&&u&&u[g]||(y=p=0)||f.pop();)if(1===u.nodeType&&++y&&u===e){h[t]=[F,p,y];break}}else if(_&&(u=e,d=u[z]||(u[z]={}),h=d[u.uniqueID]||(d[u.uniqueID]={}),c=h[t]||[],p=c[0]===F&&c[1],y=p),y===!1)for(;(u=++p&&u&&u[g]||(y=p=0)||f.pop())&&((o?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++y||(_&&(d=u[z]||(u[z]={}),h=d[u.uniqueID]||(d[u.uniqueID]={}),h[t]=[F,y]),u!==e)););return y-=s,y===n||y%n===0&&y/n>=0}}},PSEUDO:function(t,i){var s,r=x.pseudos[t]||x.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return r[z]?r(i):r.length>1?(s=[t,t,"",i],x.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,s=r(t,i),a=s.length;a--;)n=tt(t,s[a]),t[n]=!(e[n]=s[a])}):function(t){return r(t,0,s)}):r}},pseudos:{not:n(function(t){var e=[],i=[],s=P(t.replace(ot,"$1"));return s[z]?n(function(t,e,i,n){for(var r,a=s(t,null,n,[]),o=t.length;o--;)(r=a[o])&&(t[o]=!(e[o]=r))}):function(t,n,r){return e[0]=t,s(e,null,r,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return t=t.replace(wt,bt),function(e){return(e.textContent||e.innerText||k(e)).indexOf(t)>-1}}),lang:n(function(t){return ut.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(wt,bt).toLowerCase(),function(e){var i;do if(i=D?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===L},focus:function(t){return t===A.activeElement&&(!A.hasFocus||A.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!x.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return ft.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:c(function(){return[0]}),last:c(function(t,e){return[e-1]}),eq:c(function(t,e,i){return[0>i?i+e:i]}),even:c(function(t,e){for(var i=0;e>i;i+=2)t.push(i);return t}),odd:c(function(t,e){for(var i=1;e>i;i+=2)t.push(i);return t}),lt:c(function(t,e,i){for(var n=0>i?i+e:i;--n>=0;)t.push(n);return t}),gt:c(function(t,e,i){for(var n=0>i?i+e:i;++n<e;)t.push(n);return t})}},x.pseudos.nth=x.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[w]=o(w);for(w in{submit:!0,reset:!0})x.pseudos[w]=l(w);return d.prototype=x.filters=x.pseudos,x.setFilters=new d,S=e.tokenize=function(t,i){var n,s,r,a,o,l,c,h=U[t+" "];if(h)return i?0:h.slice(0);for(o=t,l=[],c=x.preFilter;o;){n&&!(s=lt.exec(o))||(s&&(o=o.slice(s[0].length)||o),l.push(r=[])),n=!1,(s=ct.exec(o))&&(n=s.shift(),r.push({value:n,type:s[0].replace(ot," ")}),o=o.slice(n.length));for(a in x.filter)!(s=pt[a].exec(o))||c[a]&&!(s=c[a](s))||(n=s.shift(),r.push({value:n,type:a,matches:s}),o=o.slice(n.length));if(!n)break}return i?o.length:o?e.error(t):U(t,l).slice(0)},P=e.compile=function(t,e){var i,n=[],s=[],r=V[t+" "];if(!r){for(e||(e=S(t)),i=e.length;i--;)r=_(e[i]),r[z]?n.push(r):s.push(r);r=V(t,y(s,n)),r.selector=t}return r},C=e.select=function(t,e,i,n){var s,r,a,o,l,c="function"==typeof t&&t,d=!n&&S(t=c.selector||t);if(i=i||[],1===d.length){if(r=d[0]=d[0].slice(0),r.length>2&&"ID"===(a=r[0]).type&&b.getById&&9===e.nodeType&&D&&x.relative[r[1].type]){if(e=(x.find.ID(a.matches[0].replace(wt,bt),e)||[])[0],!e)return i;c&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(s=pt.needsContext.test(t)?0:r.length;s--&&(a=r[s],!x.relative[o=a.type]);)if((l=x.find[o])&&(n=l(a.matches[0].replace(wt,bt),_t.test(r[0].type)&&h(e.parentNode)||e))){if(r.splice(s,1),t=n.length&&u(r),!t)return Q.apply(i,n),i;break}}return(c||P(t,d))(n,e,!D,i,!e||_t.test(t)&&h(e.parentNode)||e),i},b.sortStable=z.split("").sort(q).join("")===z,b.detectDuplicates=!!I,E(),b.sortDetached=s(function(t){return 1&t.compareDocumentPosition(A.createElement("div"))}),s(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||r("type|href|height|width",function(t,e,i){return i?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),b.attributes&&s(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||r("value",function(t,e,i){return i||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),s(function(t){return null==t.getAttribute("disabled")})||r(et,function(t,e,i){var n;return i?void 0:t[e]===!0?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);rt.find=ht,rt.expr=ht.selectors,rt.expr[":"]=rt.expr.pseudos,rt.uniqueSort=rt.unique=ht.uniqueSort,rt.text=ht.getText,rt.isXMLDoc=ht.isXML,rt.contains=ht.contains;var dt=function(t,e,i){for(var n=[],s=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(s&&rt(t).is(i))break;n.push(t)}return n},ut=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},pt=rt.expr.match.needsContext,ft=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,gt=/^.[^:#\[\.,]*$/;rt.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?rt.find.matchesSelector(n,t)?[n]:[]:rt.find.matches(t,rt.grep(e,function(t){return 1===t.nodeType}))},rt.fn.extend({find:function(t){var e,i=this.length,n=[],s=this;if("string"!=typeof t)return this.pushStack(rt(t).filter(function(){for(e=0;i>e;e++)if(rt.contains(s[e],this))return!0}));for(e=0;i>e;e++)rt.find(t,s[e],n);return n=this.pushStack(i>1?rt.unique(n):n),n.selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(n(this,t||[],!1))},not:function(t){return this.pushStack(n(this,t||[],!0))},is:function(t){return!!n(this,"string"==typeof t&&pt.test(t)?rt(t):t||[],!1).length}});var mt,vt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,_t=rt.fn.init=function(t,e,i){var n,s;if(!t)return this;if(i=i||mt,"string"==typeof t){if(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:vt.exec(t),!n||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof rt?e[0]:e,rt.merge(this,rt.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:Y,!0)),ft.test(n[1])&&rt.isPlainObject(e))for(n in e)rt.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return s=Y.getElementById(n[2]),s&&s.parentNode&&(this.length=1,this[0]=s),this.context=Y,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):rt.isFunction(t)?void 0!==i.ready?i.ready(t):t(rt):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),rt.makeArray(t,this))};_t.prototype=rt.fn,mt=rt(Y);var yt=/^(?:parents|prev(?:Until|All))/,wt={children:!0,contents:!0,next:!0,prev:!0};rt.fn.extend({has:function(t){var e=rt(t,this),i=e.length;return this.filter(function(){for(var t=0;i>t;t++)if(rt.contains(this,e[t]))return!0})},closest:function(t,e){for(var i,n=0,s=this.length,r=[],a=pt.test(t)||"string"!=typeof t?rt(t,e||this.context):0;s>n;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&rt.find.matchesSelector(i,t))){r.push(i);break}return this.pushStack(r.length>1?rt.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?Z.call(rt(t),this[0]):Z.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(rt.uniqueSort(rt.merge(this.get(),rt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),rt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return dt(t,"parentNode")},parentsUntil:function(t,e,i){return dt(t,"parentNode",i)},next:function(t){return s(t,"nextSibling")},prev:function(t){return s(t,"previousSibling")},nextAll:function(t){return dt(t,"nextSibling")},prevAll:function(t){return dt(t,"previousSibling")},nextUntil:function(t,e,i){return dt(t,"nextSibling",i)},prevUntil:function(t,e,i){return dt(t,"previousSibling",i)},siblings:function(t){return ut((t.parentNode||{}).firstChild,t)},children:function(t){return ut(t.firstChild)},contents:function(t){return t.contentDocument||rt.merge([],t.childNodes)}},function(t,e){rt.fn[t]=function(i,n){var s=rt.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(s=rt.filter(n,s)),this.length>1&&(wt[t]||rt.uniqueSort(s),yt.test(t)&&s.reverse()),this.pushStack(s)}});var bt=/\S+/g;rt.Callbacks=function(t){t="string"==typeof t?r(t):rt.extend({},t);var e,i,n,s,a=[],o=[],l=-1,c=function(){for(s=t.once,n=e=!0;o.length;l=-1)for(i=o.shift();++l<a.length;)a[l].apply(i[0],i[1])===!1&&t.stopOnFalse&&(l=a.length,i=!1);t.memory||(i=!1),e=!1,s&&(a=i?[]:"")},h={add:function(){return a&&(i&&!e&&(l=a.length-1,o.push(i)),function e(i){rt.each(i,function(i,n){rt.isFunction(n)?t.unique&&h.has(n)||a.push(n):n&&n.length&&"string"!==rt.type(n)&&e(n)})}(arguments),i&&!e&&c()),this},remove:function(){return rt.each(arguments,function(t,e){for(var i;(i=rt.inArray(e,a,i))>-1;)a.splice(i,1),l>=i&&l--}),this},has:function(t){return t?rt.inArray(t,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return s=o=[],a=i="",this},disabled:function(){return!a},lock:function(){return s=o=[],i||(a=i=""),this},locked:function(){return!!s},fireWith:function(t,i){return s||(i=i||[],i=[t,i.slice?i.slice():i],o.push(i),e||c()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!n}};return h},rt.extend({Deferred:function(t){var e=[["resolve","done",rt.Callbacks("once memory"),"resolved"],["reject","fail",rt.Callbacks("once memory"),"rejected"],["notify","progress",rt.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var t=arguments;return rt.Deferred(function(i){rt.each(e,function(e,r){var a=rt.isFunction(t[e])&&t[e];s[r[1]](function(){var t=a&&a.apply(this,arguments);t&&rt.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this===n?i.promise():this,a?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?rt.extend(t,n):n}},s={};return n.pipe=n.then,rt.each(e,function(t,r){var a=r[2],o=r[3];n[r[1]]=a.add,o&&a.add(function(){i=o},e[1^t][2].disable,e[2][2].lock),s[r[0]]=function(){return s[r[0]+"With"](this===s?n:this,arguments),this},s[r[0]+"With"]=a.fireWith}),n.promise(s),t&&t.call(s,s),s},when:function(t){var e,i,n,s=0,r=J.call(arguments),a=r.length,o=1!==a||t&&rt.isFunction(t.promise)?a:0,l=1===o?t:rt.Deferred(),c=function(t,i,n){return function(s){i[t]=this,n[t]=arguments.length>1?J.call(arguments):s,n===e?l.notifyWith(i,n):--o||l.resolveWith(i,n)}};if(a>1)for(e=new Array(a),i=new Array(a),n=new Array(a);a>s;s++)r[s]&&rt.isFunction(r[s].promise)?r[s].promise().progress(c(s,i,e)).done(c(s,n,r)).fail(l.reject):--o;return o||l.resolveWith(n,r),l.promise()}});var xt;rt.fn.ready=function(t){return rt.ready.promise().done(t),this},rt.extend({isReady:!1,readyWait:1,holdReady:function(t){t?rt.readyWait++:rt.ready(!0)},ready:function(t){(t===!0?--rt.readyWait:rt.isReady)||(rt.isReady=!0,t!==!0&&--rt.readyWait>0||(xt.resolveWith(Y,[rt]),rt.fn.triggerHandler&&(rt(Y).triggerHandler("ready"),rt(Y).off("ready"))))}}),rt.ready.promise=function(e){return xt||(xt=rt.Deferred(),"complete"===Y.readyState||"loading"!==Y.readyState&&!Y.documentElement.doScroll?t.setTimeout(rt.ready):(Y.addEventListener("DOMContentLoaded",a),t.addEventListener("load",a))),xt.promise(e)},rt.ready.promise();var kt=function(t,e,i,n,s,r,a){var o=0,l=t.length,c=null==i;if("object"===rt.type(i)){s=!0;for(o in i)kt(t,e,o,i[o],!0,r,a)}else if(void 0!==n&&(s=!0,rt.isFunction(n)||(a=!0),c&&(a?(e.call(t,n),e=null):(c=e,e=function(t,e,i){return c.call(rt(t),i)})),e))for(;l>o;o++)e(t[o],i,a?n:n.call(t[o],o,e(t[o],i)));return s?t:c?e.call(t):l?e(t[0],i):r},Tt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};o.uid=1,o.prototype={register:function(t,e){var i=e||{};return t.nodeType?t[this.expando]=i:Object.defineProperty(t,this.expando,{value:i,writable:!0,configurable:!0}),t[this.expando]},cache:function(t){if(!Tt(t))return{};var e=t[this.expando];return e||(e={},Tt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,s=this.cache(t);if("string"==typeof e)s[e]=i;else for(n in e)s[n]=e[n];return s},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][e]},access:function(t,e,i){var n;return void 0===e||e&&"string"==typeof e&&void 0===i?(n=this.get(t,e),void 0!==n?n:this.get(t,rt.camelCase(e))):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n,s,r=t[this.expando];if(void 0!==r){if(void 0===e)this.register(t);else{rt.isArray(e)?n=e.concat(e.map(rt.camelCase)):(s=rt.camelCase(e),e in r?n=[e,s]:(n=s,n=n in r?[n]:n.match(bt)||[])),i=n.length;for(;i--;)delete r[n[i]]}(void 0===e||rt.isEmptyObject(r))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!rt.isEmptyObject(e)}};var St=new o,Pt=new o,Ct=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,$t=/[A-Z]/g;rt.extend({hasData:function(t){return Pt.hasData(t)||St.hasData(t)},data:function(t,e,i){return Pt.access(t,e,i)},removeData:function(t,e){Pt.remove(t,e)},_data:function(t,e,i){return St.access(t,e,i)},_removeData:function(t,e){St.remove(t,e)}}),rt.fn.extend({data:function(t,e){var i,n,s,r=this[0],a=r&&r.attributes;if(void 0===t){if(this.length&&(s=Pt.get(r),1===r.nodeType&&!St.get(r,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&(n=a[i].name,0===n.indexOf("data-")&&(n=rt.camelCase(n.slice(5)),l(r,n,s[n])));St.set(r,"hasDataAttrs",!0)}return s}return"object"==typeof t?this.each(function(){Pt.set(this,t)}):kt(this,function(e){var i,n;if(r&&void 0===e){if(i=Pt.get(r,t)||Pt.get(r,t.replace($t,"-$&").toLowerCase()),void 0!==i)return i;if(n=rt.camelCase(t),i=Pt.get(r,n),void 0!==i)return i;if(i=l(r,n,void 0),void 0!==i)return i}else n=rt.camelCase(t),this.each(function(){var i=Pt.get(this,n);Pt.set(this,n,e),t.indexOf("-")>-1&&void 0!==i&&Pt.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Pt.remove(this,t)})}}),rt.extend({queue:function(t,e,i){var n;return t?(e=(e||"fx")+"queue",n=St.get(t,e),i&&(!n||rt.isArray(i)?n=St.access(t,e,rt.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(t,e){e=e||"fx";var i=rt.queue(t,e),n=i.length,s=i.shift(),r=rt._queueHooks(t,e),a=function(){rt.dequeue(t,e)};"inprogress"===s&&(s=i.shift(),n--),s&&("fx"===e&&i.unshift("inprogress"),delete r.stop,s.call(t,a,r)),!n&&r&&r.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return St.get(t,i)||St.access(t,i,{empty:rt.Callbacks("once memory").add(function(){St.remove(t,[e+"queue",i])})})}}),rt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?rt.queue(this[0],t):void 0===e?this:this.each(function(){var i=rt.queue(this,t,e);rt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&rt.dequeue(this,t)})},dequeue:function(t){return this.each(function(){rt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,s=rt.Deferred(),r=this,a=this.length,o=function(){--n||s.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)i=St.get(r[a],t+"queueHooks"),i&&i.empty&&(n++,i.empty.add(o));return o(),s.promise(e)}});var Mt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,It=new RegExp("^(?:([+-])=|)("+Mt+")([a-z%]*)$","i"),Et=["Top","Right","Bottom","Left"],At=function(t,e){return t=e||t,"none"===rt.css(t,"display")||!rt.contains(t.ownerDocument,t)},Lt=/^(?:checkbox|radio)$/i,Dt=/<([\w:-]+)/,Rt=/^$|\/(?:java|ecma)script/i,jt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};jt.optgroup=jt.option,jt.tbody=jt.tfoot=jt.colgroup=jt.caption=jt.thead,jt.th=jt.td;var Ot=/<|&#?\w+;/;!function(){var t=Y.createDocumentFragment(),e=t.appendChild(Y.createElement("div")),i=Y.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),nt.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",nt.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var Nt=/^key/,zt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Wt=/^([^.]*)(?:\.(.+)|)/;rt.event={global:{},add:function(t,e,i,n,s){var r,a,o,l,c,h,d,u,p,f,g,m=St.get(t);if(m)for(i.handler&&(r=i,i=r.handler,s=r.selector),i.guid||(i.guid=rt.guid++),(l=m.events)||(l=m.events={}),(a=m.handle)||(a=m.handle=function(e){return"undefined"!=typeof rt&&rt.event.triggered!==e.type?rt.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(bt)||[""],c=e.length;c--;)o=Wt.exec(e[c])||[],p=g=o[1],f=(o[2]||"").split(".").sort(),p&&(d=rt.event.special[p]||{},p=(s?d.delegateType:d.bindType)||p,d=rt.event.special[p]||{},h=rt.extend({type:p,origType:g,data:n,handler:i,guid:i.guid,selector:s,needsContext:s&&rt.expr.match.needsContext.test(s),namespace:f.join(".")},r),(u=l[p])||(u=l[p]=[],u.delegateCount=0,d.setup&&d.setup.call(t,n,f,a)!==!1||t.addEventListener&&t.addEventListener(p,a)),d.add&&(d.add.call(t,h),h.handler.guid||(h.handler.guid=i.guid)),s?u.splice(u.delegateCount++,0,h):u.push(h),rt.event.global[p]=!0)},remove:function(t,e,i,n,s){var r,a,o,l,c,h,d,u,p,f,g,m=St.hasData(t)&&St.get(t);if(m&&(l=m.events)){for(e=(e||"").match(bt)||[""],c=e.length;c--;)if(o=Wt.exec(e[c])||[],p=g=o[1],f=(o[2]||"").split(".").sort(),p){for(d=rt.event.special[p]||{},p=(n?d.delegateType:d.bindType)||p,u=l[p]||[],o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=r=u.length;r--;)h=u[r],!s&&g!==h.origType||i&&i.guid!==h.guid||o&&!o.test(h.namespace)||n&&n!==h.selector&&("**"!==n||!h.selector)||(u.splice(r,1),h.selector&&u.delegateCount--,d.remove&&d.remove.call(t,h));a&&!u.length&&(d.teardown&&d.teardown.call(t,f,m.handle)!==!1||rt.removeEvent(t,p,m.handle),delete l[p])}else for(p in l)rt.event.remove(t,p+e[c],i,n,!0);rt.isEmptyObject(l)&&St.remove(t,"handle events")}},dispatch:function(t){t=rt.event.fix(t);var e,i,n,s,r,a=[],o=J.call(arguments),l=(St.get(this,"events")||{})[t.type]||[],c=rt.event.special[t.type]||{};if(o[0]=t,t.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,t)!==!1){for(a=rt.event.handlers.call(this,t,l),e=0;(s=a[e++])&&!t.isPropagationStopped();)for(t.currentTarget=s.elem,i=0;(r=s.handlers[i++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(r.namespace)||(t.handleObj=r,t.data=r.data,n=((rt.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,o),void 0!==n&&(t.result=n)===!1&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,s,r,a=[],o=e.delegateCount,l=t.target;if(o&&l.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==t.type)){for(n=[],i=0;o>i;i++)r=e[i],s=r.selector+" ",void 0===n[s]&&(n[s]=r.needsContext?rt(s,this).index(l)>-1:rt.find(s,this,null,[l]).length),n[s]&&n.push(r);n.length&&a.push({elem:l,handlers:n})}return o<e.length&&a.push({elem:this,handlers:e.slice(o)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,s,r=e.button;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||Y,n=i.documentElement,s=i.body,t.pageX=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0),t.pageY=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0)),t.which||void 0===r||(t.which=1&r?1:2&r?3:4&r?2:0),t}},fix:function(t){if(t[rt.expando])return t;var e,i,n,s=t.type,r=t,a=this.fixHooks[s];for(a||(this.fixHooks[s]=a=zt.test(s)?this.mouseHooks:Nt.test(s)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,t=new rt.Event(r),e=n.length;e--;)i=n[e],t[i]=r[i];return t.target||(t.target=Y),3===t.target.nodeType&&(t.target=t.target.parentNode),a.filter?a.filter(t,r):t},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==g()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===g()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&rt.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(t){return rt.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},rt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},rt.Event=function(t,e){return this instanceof rt.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?p:f):this.type=t,e&&rt.extend(this,e),this.timeStamp=t&&t.timeStamp||rt.now(),void(this[rt.expando]=!0)):new rt.Event(t,e)},rt.Event.prototype={constructor:rt.Event,isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=p,t&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=p,t&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=p,t&&t.stopImmediatePropagation(),this.stopPropagation()}},rt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){rt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,s=t.relatedTarget,r=t.handleObj;return s&&(s===n||rt.contains(n,s))||(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}}),rt.fn.extend({on:function(t,e,i,n){return m(this,t,e,i,n)},one:function(t,e,i,n){return m(this,t,e,i,n,1)},off:function(t,e,i){var n,s;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,rt(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(s in t)this.off(s,e,t[s]);return this}return e!==!1&&"function"!=typeof e||(i=e,e=void 0),i===!1&&(i=f),this.each(function(){rt.event.remove(this,t,i,e)})}});var Ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,Ht=/<script|<style|<link/i,Bt=/checked\s*(?:[^=]|=\s*.checked.)/i,Ut=/^true\/(.*)/,Vt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;rt.extend({htmlPrefilter:function(t){return t.replace(Ft,"<$1></$2>")},clone:function(t,e,i){var n,s,r,a,o=t.cloneNode(!0),l=rt.contains(t.ownerDocument,t);if(!(nt.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||rt.isXMLDoc(t)))for(a=h(o),r=h(t),n=0,s=r.length;s>n;n++)b(r[n],a[n]);if(e)if(i)for(r=r||h(t),a=a||h(o),n=0,s=r.length;s>n;n++)w(r[n],a[n]);else w(t,o);return a=h(o,"script"),a.length>0&&d(a,!l&&h(t,"script")),o},cleanData:function(t){for(var e,i,n,s=rt.event.special,r=0;void 0!==(i=t[r]);r++)if(Tt(i)){if(e=i[St.expando]){if(e.events)for(n in e.events)s[n]?rt.event.remove(i,n):rt.removeEvent(i,n,e.handle);i[St.expando]=void 0}i[Pt.expando]&&(i[Pt.expando]=void 0)}}}),rt.fn.extend({domManip:x,detach:function(t){return k(this,t,!0)},remove:function(t){return k(this,t)},text:function(t){return kt(this,function(t){return void 0===t?rt.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return x(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.appendChild(t)}})},prepend:function(){return x(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return x(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return x(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(rt.cleanData(h(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return rt.clone(this,t,e)})},html:function(t){return kt(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Ht.test(t)&&!jt[(Dt.exec(t)||["",""])[1].toLowerCase()]){t=rt.htmlPrefilter(t);try{for(;n>i;i++)e=this[i]||{},1===e.nodeType&&(rt.cleanData(h(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return x(this,arguments,function(e){var i=this.parentNode;rt.inArray(this,t)<0&&(rt.cleanData(h(this)),i&&i.replaceChild(e,this))},t)}}),rt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){rt.fn[t]=function(t){for(var i,n=[],s=rt(t),r=s.length-1,a=0;r>=a;a++)i=a===r?this:this.clone(!0),rt(s[a])[e](i),Q.apply(n,i.get());return this.pushStack(n)}});var qt,Gt={HTML:"block",BODY:"block"},Xt=/^margin/,Yt=new RegExp("^("+Mt+")(?!px)[a-z%]+$","i"),Jt=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Kt=function(t,e,i,n){var s,r,a={};for(r in e)a[r]=t.style[r],t.style[r]=e[r];s=i.apply(t,n||[]);for(r in e)t.style[r]=a[r];return s},Qt=Y.documentElement;!function(){function e(){o.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",o.innerHTML="",Qt.appendChild(a);var e=t.getComputedStyle(o);i="1%"!==e.top,r="2px"===e.marginLeft,n="4px"===e.width,o.style.marginRight="50%",s="4px"===e.marginRight,Qt.removeChild(a)}var i,n,s,r,a=Y.createElement("div"),o=Y.createElement("div");o.style&&(o.style.backgroundClip="content-box",o.cloneNode(!0).style.backgroundClip="",nt.clearCloneStyle="content-box"===o.style.backgroundClip,a.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",a.appendChild(o),rt.extend(nt,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return null==n&&e(),n},pixelMarginRight:function(){return null==n&&e(),s},reliableMarginLeft:function(){return null==n&&e(),r},reliableMarginRight:function(){var e,i=o.appendChild(Y.createElement("div"));return i.style.cssText=o.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",o.style.width="1px",Qt.appendChild(a),e=!parseFloat(t.getComputedStyle(i).marginRight),Qt.removeChild(a),o.removeChild(i),e}}))}();var Zt=/^(none|table(?!-c[ea]).+)/,te={position:"absolute",visibility:"hidden",display:"block"},ee={letterSpacing:"0",fontWeight:"400"},ie=["Webkit","O","Moz","ms"],ne=Y.createElement("div").style;rt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=P(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,r,a,o=rt.camelCase(e),l=t.style;return e=rt.cssProps[o]||(rt.cssProps[o]=$(o)||o),a=rt.cssHooks[e]||rt.cssHooks[o],void 0===i?a&&"get"in a&&void 0!==(s=a.get(t,!1,n))?s:l[e]:(r=typeof i,"string"===r&&(s=It.exec(i))&&s[1]&&(i=c(t,e,s),r="number"),void(null!=i&&i===i&&("number"===r&&(i+=s&&s[3]||(rt.cssNumber[o]?"":"px")),nt.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),a&&"set"in a&&void 0===(i=a.set(t,i,n))||(l[e]=i))))}},css:function(t,e,i,n){var s,r,a,o=rt.camelCase(e);return e=rt.cssProps[o]||(rt.cssProps[o]=$(o)||o),a=rt.cssHooks[e]||rt.cssHooks[o],a&&"get"in a&&(s=a.get(t,!0,i)),void 0===s&&(s=P(t,e,n)),"normal"===s&&e in ee&&(s=ee[e]),""===i||i?(r=parseFloat(s),i===!0||isFinite(r)?r||0:s):s}}),rt.each(["height","width"],function(t,e){rt.cssHooks[e]={get:function(t,i,n){return i?Zt.test(rt.css(t,"display"))&&0===t.offsetWidth?Kt(t,te,function(){return E(t,e,n)}):E(t,e,n):void 0},set:function(t,i,n){var s,r=n&&Jt(t),a=n&&I(t,e,n,"border-box"===rt.css(t,"boxSizing",!1,r),r);return a&&(s=It.exec(i))&&"px"!==(s[3]||"px")&&(t.style[e]=i,i=rt.css(t,e)),M(t,i,a)}}}),rt.cssHooks.marginLeft=C(nt.reliableMarginLeft,function(t,e){return e?(parseFloat(P(t,"marginLeft"))||t.getBoundingClientRect().left-Kt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px":void 0}),rt.cssHooks.marginRight=C(nt.reliableMarginRight,function(t,e){return e?Kt(t,{display:"inline-block"},P,[t,"marginRight"]):void 0}),rt.each({margin:"",padding:"",border:"Width"},function(t,e){rt.cssHooks[t+e]={expand:function(i){for(var n=0,s={},r="string"==typeof i?i.split(" "):[i];4>n;n++)s[t+Et[n]+e]=r[n]||r[n-2]||r[0];return s}},Xt.test(t)||(rt.cssHooks[t+e].set=M)}),rt.fn.extend({css:function(t,e){return kt(this,function(t,e,i){var n,s,r={},a=0;if(rt.isArray(e)){for(n=Jt(t),s=e.length;s>a;a++)r[e[a]]=rt.css(t,e[a],!1,n);return r}return void 0!==i?rt.style(t,e,i):rt.css(t,e)},t,e,arguments.length>1)},show:function(){return A(this,!0)},hide:function(){return A(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){At(this)?rt(this).show():rt(this).hide()})}}),rt.Tween=L,L.prototype={constructor:L,init:function(t,e,i,n,s,r){this.elem=t,this.prop=i,this.easing=s||rt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=r||(rt.cssNumber[i]?"":"px")},cur:function(){var t=L.propHooks[this.prop];return t&&t.get?t.get(this):L.propHooks._default.get(this)},run:function(t){var e,i=L.propHooks[this.prop];return this.options.duration?this.pos=e=rt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,
this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):L.propHooks._default.set(this),this}},L.prototype.init.prototype=L.prototype,L.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=rt.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){rt.fx.step[t.prop]?rt.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[rt.cssProps[t.prop]]&&!rt.cssHooks[t.prop]?t.elem[t.prop]=t.now:rt.style(t.elem,t.prop,t.now+t.unit)}}},L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},rt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},rt.fx=L.prototype.init,rt.fx.step={};var se,re,ae=/^(?:toggle|show|hide)$/,oe=/queueHooks$/;rt.Animation=rt.extend(z,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return c(i.elem,t,It.exec(e),i),i}]},tweener:function(t,e){rt.isFunction(t)?(e=t,t=["*"]):t=t.match(bt);for(var i,n=0,s=t.length;s>n;n++)i=t[n],z.tweeners[i]=z.tweeners[i]||[],z.tweeners[i].unshift(e)},prefilters:[O],prefilter:function(t,e){e?z.prefilters.unshift(t):z.prefilters.push(t)}}),rt.speed=function(t,e,i){var n=t&&"object"==typeof t?rt.extend({},t):{complete:i||!i&&e||rt.isFunction(t)&&t,duration:t,easing:i&&e||e&&!rt.isFunction(e)&&e};return n.duration=rt.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in rt.fx.speeds?rt.fx.speeds[n.duration]:rt.fx.speeds._default,null!=n.queue&&n.queue!==!0||(n.queue="fx"),n.old=n.complete,n.complete=function(){rt.isFunction(n.old)&&n.old.call(this),n.queue&&rt.dequeue(this,n.queue)},n},rt.fn.extend({fadeTo:function(t,e,i,n){return this.filter(At).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var s=rt.isEmptyObject(t),r=rt.speed(e,i,n),a=function(){var e=z(this,rt.extend({},t),r);(s||St.get(this,"finish"))&&e.stop(!0)};return a.finish=a,s||r.queue===!1?this.each(a):this.queue(r.queue,a)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,s=null!=t&&t+"queueHooks",r=rt.timers,a=St.get(this);if(s)a[s]&&a[s].stop&&n(a[s]);else for(s in a)a[s]&&a[s].stop&&oe.test(s)&&n(a[s]);for(s=r.length;s--;)r[s].elem!==this||null!=t&&r[s].queue!==t||(r[s].anim.stop(i),e=!1,r.splice(s,1));!e&&i||rt.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=St.get(this),n=i[t+"queue"],s=i[t+"queueHooks"],r=rt.timers,a=n?n.length:0;for(i.finish=!0,rt.queue(this,t,[]),s&&s.stop&&s.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;a>e;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),rt.each(["toggle","show","hide"],function(t,e){var i=rt.fn[e];rt.fn[e]=function(t,n,s){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(R(e,!0),t,n,s)}}),rt.each({slideDown:R("show"),slideUp:R("hide"),slideToggle:R("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){rt.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),rt.timers=[],rt.fx.tick=function(){var t,e=0,i=rt.timers;for(se=rt.now();e<i.length;e++)t=i[e],t()||i[e]!==t||i.splice(e--,1);i.length||rt.fx.stop(),se=void 0},rt.fx.timer=function(t){rt.timers.push(t),t()?rt.fx.start():rt.timers.pop()},rt.fx.interval=13,rt.fx.start=function(){re||(re=t.setInterval(rt.fx.tick,rt.fx.interval))},rt.fx.stop=function(){t.clearInterval(re),re=null},rt.fx.speeds={slow:600,fast:200,_default:400},rt.fn.delay=function(e,i){return e=rt.fx?rt.fx.speeds[e]||e:e,i=i||"fx",this.queue(i,function(i,n){var s=t.setTimeout(i,e);n.stop=function(){t.clearTimeout(s)}})},function(){var t=Y.createElement("input"),e=Y.createElement("select"),i=e.appendChild(Y.createElement("option"));t.type="checkbox",nt.checkOn=""!==t.value,nt.optSelected=i.selected,e.disabled=!0,nt.optDisabled=!i.disabled,t=Y.createElement("input"),t.value="t",t.type="radio",nt.radioValue="t"===t.value}();var le,ce=rt.expr.attrHandle;rt.fn.extend({attr:function(t,e){return kt(this,rt.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){rt.removeAttr(this,t)})}}),rt.extend({attr:function(t,e,i){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return"undefined"==typeof t.getAttribute?rt.prop(t,e,i):(1===r&&rt.isXMLDoc(t)||(e=e.toLowerCase(),s=rt.attrHooks[e]||(rt.expr.match.bool.test(e)?le:void 0)),void 0!==i?null===i?void rt.removeAttr(t,e):s&&"set"in s&&void 0!==(n=s.set(t,i,e))?n:(t.setAttribute(e,i+""),i):s&&"get"in s&&null!==(n=s.get(t,e))?n:(n=rt.find.attr(t,e),null==n?void 0:n))},attrHooks:{type:{set:function(t,e){if(!nt.radioValue&&"radio"===e&&rt.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n,s=0,r=e&&e.match(bt);if(r&&1===t.nodeType)for(;i=r[s++];)n=rt.propFix[i]||i,rt.expr.match.bool.test(i)&&(t[n]=!1),t.removeAttribute(i)}}),le={set:function(t,e,i){return e===!1?rt.removeAttr(t,i):t.setAttribute(i,i),i}},rt.each(rt.expr.match.bool.source.match(/\w+/g),function(t,e){var i=ce[e]||rt.find.attr;ce[e]=function(t,e,n){var s,r;return n||(r=ce[e],ce[e]=s,s=null!=i(t,e,n)?e.toLowerCase():null,ce[e]=r),s}});var he=/^(?:input|select|textarea|button)$/i,de=/^(?:a|area)$/i;rt.fn.extend({prop:function(t,e){return kt(this,rt.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[rt.propFix[t]||t]})}}),rt.extend({prop:function(t,e,i){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&rt.isXMLDoc(t)||(e=rt.propFix[e]||e,s=rt.propHooks[e]),void 0!==i?s&&"set"in s&&void 0!==(n=s.set(t,i,e))?n:t[e]=i:s&&"get"in s&&null!==(n=s.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=rt.find.attr(t,"tabindex");return e?parseInt(e,10):he.test(t.nodeName)||de.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),nt.optSelected||(rt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),rt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){rt.propFix[this.toLowerCase()]=this});var ue=/[\t\r\n\f]/g;rt.fn.extend({addClass:function(t){var e,i,n,s,r,a,o,l=0;if(rt.isFunction(t))return this.each(function(e){rt(this).addClass(t.call(this,e,W(this)))});if("string"==typeof t&&t)for(e=t.match(bt)||[];i=this[l++];)if(s=W(i),n=1===i.nodeType&&(" "+s+" ").replace(ue," ")){for(a=0;r=e[a++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");o=rt.trim(n),s!==o&&i.setAttribute("class",o)}return this},removeClass:function(t){var e,i,n,s,r,a,o,l=0;if(rt.isFunction(t))return this.each(function(e){rt(this).removeClass(t.call(this,e,W(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(bt)||[];i=this[l++];)if(s=W(i),n=1===i.nodeType&&(" "+s+" ").replace(ue," ")){for(a=0;r=e[a++];)for(;n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");o=rt.trim(n),s!==o&&i.setAttribute("class",o)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):rt.isFunction(t)?this.each(function(i){rt(this).toggleClass(t.call(this,i,W(this),e),e)}):this.each(function(){var e,n,s,r;if("string"===i)for(n=0,s=rt(this),r=t.match(bt)||[];e=r[n++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else void 0!==t&&"boolean"!==i||(e=W(this),e&&St.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||t===!1?"":St.get(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+W(i)+" ").replace(ue," ").indexOf(e)>-1)return!0;return!1}});var pe=/\r/g,fe=/[\x20\t\r\n\f]+/g;rt.fn.extend({val:function(t){var e,i,n,s=this[0];return arguments.length?(n=rt.isFunction(t),this.each(function(i){var s;1===this.nodeType&&(s=n?t.call(this,i,rt(this).val()):t,null==s?s="":"number"==typeof s?s+="":rt.isArray(s)&&(s=rt.map(s,function(t){return null==t?"":t+""})),e=rt.valHooks[this.type]||rt.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,s,"value")||(this.value=s))})):s?(e=rt.valHooks[s.type]||rt.valHooks[s.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(s,"value"))?i:(i=s.value,"string"==typeof i?i.replace(pe,""):null==i?"":i)):void 0}}),rt.extend({valHooks:{option:{get:function(t){var e=rt.find.attr(t,"value");return null!=e?e:rt.trim(rt.text(t)).replace(fe," ")}},select:{get:function(t){for(var e,i,n=t.options,s=t.selectedIndex,r="select-one"===t.type||0>s,a=r?null:[],o=r?s+1:n.length,l=0>s?o:r?s:0;o>l;l++)if(i=n[l],(i.selected||l===s)&&(nt.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!rt.nodeName(i.parentNode,"optgroup"))){if(e=rt(i).val(),r)return e;a.push(e)}return a},set:function(t,e){for(var i,n,s=t.options,r=rt.makeArray(e),a=s.length;a--;)n=s[a],(n.selected=rt.inArray(rt.valHooks.option.get(n),r)>-1)&&(i=!0);return i||(t.selectedIndex=-1),r}}}}),rt.each(["radio","checkbox"],function(){rt.valHooks[this]={set:function(t,e){return rt.isArray(e)?t.checked=rt.inArray(rt(t).val(),e)>-1:void 0}},nt.checkOn||(rt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var ge=/^(?:focusinfocus|focusoutblur)$/;rt.extend(rt.event,{trigger:function(e,i,n,s){var r,a,o,l,c,h,d,u=[n||Y],p=it.call(e,"type")?e.type:e,f=it.call(e,"namespace")?e.namespace.split("."):[];if(a=o=n=n||Y,3!==n.nodeType&&8!==n.nodeType&&!ge.test(p+rt.event.triggered)&&(p.indexOf(".")>-1&&(f=p.split("."),p=f.shift(),f.sort()),c=p.indexOf(":")<0&&"on"+p,e=e[rt.expando]?e:new rt.Event(p,"object"==typeof e&&e),e.isTrigger=s?2:3,e.namespace=f.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:rt.makeArray(i,[e]),d=rt.event.special[p]||{},s||!d.trigger||d.trigger.apply(n,i)!==!1)){if(!s&&!d.noBubble&&!rt.isWindow(n)){for(l=d.delegateType||p,ge.test(l+p)||(a=a.parentNode);a;a=a.parentNode)u.push(a),o=a;o===(n.ownerDocument||Y)&&u.push(o.defaultView||o.parentWindow||t)}for(r=0;(a=u[r++])&&!e.isPropagationStopped();)e.type=r>1?l:d.bindType||p,h=(St.get(a,"events")||{})[e.type]&&St.get(a,"handle"),h&&h.apply(a,i),h=c&&a[c],h&&h.apply&&Tt(a)&&(e.result=h.apply(a,i),e.result===!1&&e.preventDefault());return e.type=p,s||e.isDefaultPrevented()||d._default&&d._default.apply(u.pop(),i)!==!1||!Tt(n)||c&&rt.isFunction(n[p])&&!rt.isWindow(n)&&(o=n[c],o&&(n[c]=null),rt.event.triggered=p,n[p](),rt.event.triggered=void 0,o&&(n[c]=o)),e.result}},simulate:function(t,e,i){var n=rt.extend(new rt.Event,i,{type:t,isSimulated:!0});rt.event.trigger(n,null,e),n.isDefaultPrevented()&&i.preventDefault()}}),rt.fn.extend({trigger:function(t,e){return this.each(function(){rt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];return i?rt.event.trigger(t,e,i,!0):void 0}}),rt.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){rt.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),rt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),nt.focusin="onfocusin"in t,nt.focusin||rt.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){rt.event.simulate(e,t.target,rt.event.fix(t))};rt.event.special[e]={setup:function(){var n=this.ownerDocument||this,s=St.access(n,e);s||n.addEventListener(t,i,!0),St.access(n,e,(s||0)+1)},teardown:function(){var n=this.ownerDocument||this,s=St.access(n,e)-1;s?St.access(n,e,s):(n.removeEventListener(t,i,!0),St.remove(n,e))}}});var me=t.location,ve=rt.now(),_e=/\?/;rt.parseJSON=function(t){return JSON.parse(t+"")},rt.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||rt.error("Invalid XML: "+e),i};var ye=/#.*$/,we=/([?&])_=[^&]*/,be=/^(.*?):[ \t]*([^\r\n]*)$/gm,xe=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ke=/^(?:GET|HEAD)$/,Te=/^\/\//,Se={},Pe={},Ce="*/".concat("*"),$e=Y.createElement("a");$e.href=me.href,rt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:me.href,type:"GET",isLocal:xe.test(me.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ce,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":rt.parseJSON,"text xml":rt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?B(B(t,rt.ajaxSettings),e):B(rt.ajaxSettings,t)},ajaxPrefilter:F(Se),ajaxTransport:F(Pe),ajax:function(e,i){function n(e,i,n,o){var c,d,_,y,b,k=i;2!==w&&(w=2,l&&t.clearTimeout(l),s=void 0,a=o||"",x.readyState=e>0?4:0,c=e>=200&&300>e||304===e,n&&(y=U(u,x,n)),y=V(u,y,x,c),c?(u.ifModified&&(b=x.getResponseHeader("Last-Modified"),b&&(rt.lastModified[r]=b),b=x.getResponseHeader("etag"),b&&(rt.etag[r]=b)),204===e||"HEAD"===u.type?k="nocontent":304===e?k="notmodified":(k=y.state,d=y.data,_=y.error,c=!_)):(_=k,!e&&k||(k="error",0>e&&(e=0))),x.status=e,x.statusText=(i||k)+"",c?g.resolveWith(p,[d,k,x]):g.rejectWith(p,[x,k,_]),x.statusCode(v),v=void 0,h&&f.trigger(c?"ajaxSuccess":"ajaxError",[x,u,c?d:_]),m.fireWith(p,[x,k]),h&&(f.trigger("ajaxComplete",[x,u]),--rt.active||rt.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=void 0),i=i||{};var s,r,a,o,l,c,h,d,u=rt.ajaxSetup({},i),p=u.context||u,f=u.context&&(p.nodeType||p.jquery)?rt(p):rt.event,g=rt.Deferred(),m=rt.Callbacks("once memory"),v=u.statusCode||{},_={},y={},w=0,b="canceled",x={readyState:0,getResponseHeader:function(t){var e;if(2===w){if(!o)for(o={};e=be.exec(a);)o[e[1].toLowerCase()]=e[2];e=o[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===w?a:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return w||(t=y[i]=y[i]||t,_[t]=e),this},overrideMimeType:function(t){return w||(u.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>w)for(e in t)v[e]=[v[e],t[e]];else x.always(t[x.status]);return this},abort:function(t){var e=t||b;return s&&s.abort(e),n(0,e),this}};if(g.promise(x).complete=m.add,x.success=x.done,x.error=x.fail,u.url=((e||u.url||me.href)+"").replace(ye,"").replace(Te,me.protocol+"//"),u.type=i.method||i.type||u.method||u.type,u.dataTypes=rt.trim(u.dataType||"*").toLowerCase().match(bt)||[""],null==u.crossDomain){c=Y.createElement("a");try{c.href=u.url,c.href=c.href,u.crossDomain=$e.protocol+"//"+$e.host!=c.protocol+"//"+c.host}catch(t){u.crossDomain=!0}}if(u.data&&u.processData&&"string"!=typeof u.data&&(u.data=rt.param(u.data,u.traditional)),H(Se,u,i,x),2===w)return x;h=rt.event&&u.global,h&&0===rt.active++&&rt.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!ke.test(u.type),r=u.url,u.hasContent||(u.data&&(r=u.url+=(_e.test(r)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=we.test(r)?r.replace(we,"$1_="+ve++):r+(_e.test(r)?"&":"?")+"_="+ve++)),u.ifModified&&(rt.lastModified[r]&&x.setRequestHeader("If-Modified-Since",rt.lastModified[r]),rt.etag[r]&&x.setRequestHeader("If-None-Match",rt.etag[r])),(u.data&&u.hasContent&&u.contentType!==!1||i.contentType)&&x.setRequestHeader("Content-Type",u.contentType),x.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+Ce+"; q=0.01":""):u.accepts["*"]);for(d in u.headers)x.setRequestHeader(d,u.headers[d]);if(u.beforeSend&&(u.beforeSend.call(p,x,u)===!1||2===w))return x.abort();b="abort";for(d in{success:1,error:1,complete:1})x[d](u[d]);if(s=H(Pe,u,i,x)){if(x.readyState=1,h&&f.trigger("ajaxSend",[x,u]),2===w)return x;u.async&&u.timeout>0&&(l=t.setTimeout(function(){x.abort("timeout")},u.timeout));try{w=1,s.send(_,n)}catch(t){if(!(2>w))throw t;n(-1,t)}}else n(-1,"No Transport");return x},getJSON:function(t,e,i){return rt.get(t,e,i,"json")},getScript:function(t,e){return rt.get(t,void 0,e,"script")}}),rt.each(["get","post"],function(t,e){rt[e]=function(t,i,n,s){return rt.isFunction(i)&&(s=s||n,n=i,i=void 0),rt.ajax(rt.extend({url:t,type:e,dataType:s,data:i,success:n},rt.isPlainObject(t)&&t))}}),rt._evalUrl=function(t){return rt.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},rt.fn.extend({wrapAll:function(t){var e;return rt.isFunction(t)?this.each(function(e){rt(this).wrapAll(t.call(this,e))}):(this[0]&&(e=rt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return rt.isFunction(t)?this.each(function(e){rt(this).wrapInner(t.call(this,e))}):this.each(function(){var e=rt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=rt.isFunction(t);return this.each(function(i){rt(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){rt.nodeName(this,"body")||rt(this).replaceWith(this.childNodes)}).end()}}),rt.expr.filters.hidden=function(t){return!rt.expr.filters.visible(t)},rt.expr.filters.visible=function(t){return t.offsetWidth>0||t.offsetHeight>0||t.getClientRects().length>0};var Me=/%20/g,Ie=/\[\]$/,Ee=/\r?\n/g,Ae=/^(?:submit|button|image|reset|file)$/i,Le=/^(?:input|select|textarea|keygen)/i;rt.param=function(t,e){var i,n=[],s=function(t,e){e=rt.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=rt.ajaxSettings&&rt.ajaxSettings.traditional),rt.isArray(t)||t.jquery&&!rt.isPlainObject(t))rt.each(t,function(){s(this.name,this.value)});else for(i in t)q(i,t[i],e,s);return n.join("&").replace(Me,"+")},rt.fn.extend({serialize:function(){return rt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=rt.prop(this,"elements");return t?rt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!rt(this).is(":disabled")&&Le.test(this.nodeName)&&!Ae.test(t)&&(this.checked||!Lt.test(t))}).map(function(t,e){var i=rt(this).val();return null==i?null:rt.isArray(i)?rt.map(i,function(t){return{name:e.name,value:t.replace(Ee,"\r\n")}}):{name:e.name,value:i.replace(Ee,"\r\n")}}).get()}}),rt.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var De={0:200,1223:204},Re=rt.ajaxSettings.xhr();nt.cors=!!Re&&"withCredentials"in Re,nt.ajax=Re=!!Re,rt.ajaxTransport(function(e){var i,n;return nt.cors||Re&&!e.crossDomain?{send:function(s,r){var a,o=e.xhr();if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)o[a]=e.xhrFields[a];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest");for(a in s)o.setRequestHeader(a,s[a]);i=function(t){return function(){i&&(i=n=o.onload=o.onerror=o.onabort=o.onreadystatechange=null,"abort"===t?o.abort():"error"===t?"number"!=typeof o.status?r(0,"error"):r(o.status,o.statusText):r(De[o.status]||o.status,o.statusText,"text"!==(o.responseType||"text")||"string"!=typeof o.responseText?{binary:o.response}:{text:o.responseText},o.getAllResponseHeaders()))}},o.onload=i(),n=o.onerror=i("error"),void 0!==o.onabort?o.onabort=n:o.onreadystatechange=function(){4===o.readyState&&t.setTimeout(function(){i&&n()})},i=i("abort");try{o.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}:void 0}),rt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return rt.globalEval(t),t}}}),rt.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),rt.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(n,s){e=rt("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&s("error"===t.type?404:200,t.type)}),Y.head.appendChild(e[0])},abort:function(){i&&i()}}}});var je=[],Oe=/(=)\?(?=&|$)|\?\?/;rt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=je.pop()||rt.expando+"_"+ve++;return this[t]=!0,t}}),rt.ajaxPrefilter("json jsonp",function(e,i,n){var s,r,a,o=e.jsonp!==!1&&(Oe.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Oe.test(e.data)&&"data");return o||"jsonp"===e.dataTypes[0]?(s=e.jsonpCallback=rt.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(Oe,"$1"+s):e.jsonp!==!1&&(e.url+=(_e.test(e.url)?"&":"?")+e.jsonp+"="+s),e.converters["script json"]=function(){return a||rt.error(s+" was not called"),a[0]},e.dataTypes[0]="json",r=t[s],t[s]=function(){a=arguments},n.always(function(){void 0===r?rt(t).removeProp(s):t[s]=r,e[s]&&(e.jsonpCallback=i.jsonpCallback,je.push(s)),a&&rt.isFunction(r)&&r(a[0]),a=r=void 0}),"script"):void 0}),rt.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||Y;var n=ft.exec(t),s=!i&&[];return n?[e.createElement(n[1])]:(n=u([t],e,s),s&&s.length&&rt(s).remove(),rt.merge([],n.childNodes))};var Ne=rt.fn.load;rt.fn.load=function(t,e,i){if("string"!=typeof t&&Ne)return Ne.apply(this,arguments);var n,s,r,a=this,o=t.indexOf(" ");return o>-1&&(n=rt.trim(t.slice(o)),t=t.slice(0,o)),rt.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(s="POST"),a.length>0&&rt.ajax({url:t,type:s||"GET",dataType:"html",data:e}).done(function(t){r=arguments,a.html(n?rt("<div>").append(rt.parseHTML(t)).find(n):t)}).always(i&&function(t,e){a.each(function(){i.apply(this,r||[t.responseText,e,t])})}),this},rt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){rt.fn[e]=function(t){return this.on(e,t)}}),rt.expr.filters.animated=function(t){return rt.grep(rt.timers,function(e){return t===e.elem}).length},rt.offset={setOffset:function(t,e,i){var n,s,r,a,o,l,c,h=rt.css(t,"position"),d=rt(t),u={};"static"===h&&(t.style.position="relative"),o=d.offset(),r=rt.css(t,"top"),l=rt.css(t,"left"),c=("absolute"===h||"fixed"===h)&&(r+l).indexOf("auto")>-1,c?(n=d.position(),a=n.top,s=n.left):(a=parseFloat(r)||0,s=parseFloat(l)||0),rt.isFunction(e)&&(e=e.call(t,i,rt.extend({},o))),null!=e.top&&(u.top=e.top-o.top+a),null!=e.left&&(u.left=e.left-o.left+s),"using"in e?e.using.call(t,u):d.css(u)}},rt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){rt.offset.setOffset(this,t,e)});var e,i,n=this[0],s={top:0,left:0},r=n&&n.ownerDocument;return r?(e=r.documentElement,rt.contains(e,n)?(s=n.getBoundingClientRect(),i=G(r),{top:s.top+i.pageYOffset-e.clientTop,left:s.left+i.pageXOffset-e.clientLeft}):s):void 0},position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===rt.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),rt.nodeName(t[0],"html")||(n=t.offset()),n.top+=rt.css(t[0],"borderTopWidth",!0),n.left+=rt.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-rt.css(i,"marginTop",!0),left:e.left-n.left-rt.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===rt.css(t,"position");)t=t.offsetParent;return t||Qt})}}),rt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;rt.fn[t]=function(n){return kt(this,function(t,n,s){var r=G(t);return void 0===s?r?r[e]:t[n]:void(r?r.scrollTo(i?r.pageXOffset:s,i?s:r.pageYOffset):t[n]=s)},t,n,arguments.length)}}),rt.each(["top","left"],function(t,e){rt.cssHooks[e]=C(nt.pixelPosition,function(t,i){return i?(i=P(t,e),Yt.test(i)?rt(t).position()[e]+"px":i):void 0})}),rt.each({Height:"height",Width:"width"},function(t,e){rt.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){rt.fn[n]=function(n,s){var r=arguments.length&&(i||"boolean"!=typeof n),a=i||(n===!0||s===!0?"margin":"border");return kt(this,function(e,i,n){var s;return rt.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===n?rt.css(e,i,a):rt.style(e,i,n,a)},e,r?n:void 0,r,null)}})}),rt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},size:function(){return this.length}}),rt.fn.andSelf=rt.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return rt});var ze=t.jQuery,We=t.$;return rt.noConflict=function(e){return t.$===rt&&(t.$=We),e&&t.jQuery===rt&&(t.jQuery=ze),rt},e||(t.jQuery=t.$=rt),rt}),
//     Underscore may be freely distributed under the MIT license.
function(){function t(t){function e(e,i,n,s,r,a){for(;r>=0&&r<a;r+=t){var o=s?s[r]:r;n=i(n,e[o],o,e)}return n}return function(i,n,s,r){n=y(n,r,4);var a=!P(i)&&_.keys(i),o=(a||i).length,l=t>0?0:o-1;return arguments.length<3&&(s=i[a?a[l]:l],l+=t),e(i,n,s,a,l,o)}}function e(t){return function(e,i,n){i=w(i,n);for(var s=S(e),r=t>0?0:s-1;r>=0&&r<s;r+=t)if(i(e[r],r,e))return r;return-1}}function i(t,e,i){return function(n,s,r){var a=0,o=S(n);if("number"==typeof r)t>0?a=r>=0?r:Math.max(r+o,a):o=r>=0?Math.min(r+1,o):r+o+1;else if(i&&r&&o)return r=i(n,s),n[r]===s?r:-1;if(s!==s)return r=e(h.call(n,a,o),_.isNaN),r>=0?r+a:-1;for(r=t>0?a:o-1;r>=0&&r<o;r+=t)if(n[r]===s)return r;return-1}}function n(t,e){var i=E.length,n=t.constructor,s=_.isFunction(n)&&n.prototype||o,r="constructor";for(_.has(t,r)&&!_.contains(e,r)&&e.push(r);i--;)r=E[i],r in t&&t[r]!==s[r]&&!_.contains(e,r)&&e.push(r)}var s=this,r=s._,a=Array.prototype,o=Object.prototype,l=Function.prototype,c=a.push,h=a.slice,d=o.toString,u=o.hasOwnProperty,p=Array.isArray,f=Object.keys,g=l.bind,m=Object.create,v=function(){},_=function(t){return t instanceof _?t:this instanceof _?void(this._wrapped=t):new _(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):s._=_,_.VERSION="1.8.3";var y=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,s){return t.call(e,i,n,s)};case 4:return function(i,n,s,r){return t.call(e,i,n,s,r)}}return function(){return t.apply(e,arguments)}},w=function(t,e,i){return null==t?_.identity:_.isFunction(t)?y(t,e,i):_.isObject(t)?_.matcher(t):_.property(t)};_.iteratee=function(t,e){return w(t,e,1/0)};var b=function(t,e){return function(i){var n=arguments.length;if(n<2||null==i)return i;for(var s=1;s<n;s++)for(var r=arguments[s],a=t(r),o=a.length,l=0;l<o;l++){var c=a[l];e&&void 0!==i[c]||(i[c]=r[c])}return i}},x=function(t){if(!_.isObject(t))return{};if(m)return m(t);v.prototype=t;var e=new v;return v.prototype=null,e},k=function(t){return function(e){return null==e?void 0:e[t]}},T=Math.pow(2,53)-1,S=k("length"),P=function(t){var e=S(t);return"number"==typeof e&&e>=0&&e<=T};_.each=_.forEach=function(t,e,i){e=y(e,i);var n,s;if(P(t))for(n=0,s=t.length;n<s;n++)e(t[n],n,t);else{var r=_.keys(t);for(n=0,s=r.length;n<s;n++)e(t[r[n]],r[n],t)}return t},_.map=_.collect=function(t,e,i){e=w(e,i);for(var n=!P(t)&&_.keys(t),s=(n||t).length,r=Array(s),a=0;a<s;a++){var o=n?n[a]:a;r[a]=e(t[o],o,t)}return r},_.reduce=_.foldl=_.inject=t(1),_.reduceRight=_.foldr=t(-1),_.find=_.detect=function(t,e,i){var n;if(n=P(t)?_.findIndex(t,e,i):_.findKey(t,e,i),void 0!==n&&n!==-1)return t[n]},_.filter=_.select=function(t,e,i){var n=[];return e=w(e,i),_.each(t,function(t,i,s){e(t,i,s)&&n.push(t)}),n},_.reject=function(t,e,i){return _.filter(t,_.negate(w(e)),i)},_.every=_.all=function(t,e,i){e=w(e,i);for(var n=!P(t)&&_.keys(t),s=(n||t).length,r=0;r<s;r++){var a=n?n[r]:r;if(!e(t[a],a,t))return!1}return!0},_.some=_.any=function(t,e,i){e=w(e,i);for(var n=!P(t)&&_.keys(t),s=(n||t).length,r=0;r<s;r++){var a=n?n[r]:r;if(e(t[a],a,t))return!0}return!1},_.contains=_.includes=_.include=function(t,e,i,n){return P(t)||(t=_.values(t)),("number"!=typeof i||n)&&(i=0),_.indexOf(t,e,i)>=0},_.invoke=function(t,e){var i=h.call(arguments,2),n=_.isFunction(e);return _.map(t,function(t){var s=n?e:t[e];return null==s?s:s.apply(t,i)})},_.pluck=function(t,e){return _.map(t,_.property(e))},_.where=function(t,e){return _.filter(t,_.matcher(e))},_.findWhere=function(t,e){return _.find(t,_.matcher(e))},_.max=function(t,e,i){var n,s,r=-(1/0),a=-(1/0);if(null==e&&null!=t){t=P(t)?t:_.values(t);for(var o=0,l=t.length;o<l;o++)n=t[o],n>r&&(r=n)}else e=w(e,i),_.each(t,function(t,i,n){s=e(t,i,n),(s>a||s===-(1/0)&&r===-(1/0))&&(r=t,a=s)});return r},_.min=function(t,e,i){var n,s,r=1/0,a=1/0;if(null==e&&null!=t){t=P(t)?t:_.values(t);for(var o=0,l=t.length;o<l;o++)n=t[o],n<r&&(r=n)}else e=w(e,i),_.each(t,function(t,i,n){s=e(t,i,n),(s<a||s===1/0&&r===1/0)&&(r=t,a=s)});return r},_.shuffle=function(t){for(var e,i=P(t)?t:_.values(t),n=i.length,s=Array(n),r=0;r<n;r++)e=_.random(0,r),e!==r&&(s[r]=s[e]),s[e]=i[r];return s},_.sample=function(t,e,i){return null==e||i?(P(t)||(t=_.values(t)),t[_.random(t.length-1)]):_.shuffle(t).slice(0,Math.max(0,e))},_.sortBy=function(t,e,i){return e=w(e,i),_.pluck(_.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var C=function(t){return function(e,i,n){var s={};return i=w(i,n),_.each(e,function(n,r){var a=i(n,r,e);t(s,n,a)}),s}};_.groupBy=C(function(t,e,i){_.has(t,i)?t[i].push(e):t[i]=[e]}),_.indexBy=C(function(t,e,i){t[i]=e}),_.countBy=C(function(t,e,i){_.has(t,i)?t[i]++:t[i]=1}),_.toArray=function(t){return t?_.isArray(t)?h.call(t):P(t)?_.map(t,_.identity):_.values(t):[]},_.size=function(t){return null==t?0:P(t)?t.length:_.keys(t).length},_.partition=function(t,e,i){e=w(e,i);var n=[],s=[];return _.each(t,function(t,i,r){(e(t,i,r)?n:s).push(t)}),[n,s]},_.first=_.head=_.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:_.initial(t,t.length-e)},_.initial=function(t,e,i){return h.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},_.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:_.rest(t,Math.max(0,t.length-e))},_.rest=_.tail=_.drop=function(t,e,i){return h.call(t,null==e||i?1:e)},_.compact=function(t){return _.filter(t,_.identity)};var $=function(t,e,i,n){for(var s=[],r=0,a=n||0,o=S(t);a<o;a++){var l=t[a];if(P(l)&&(_.isArray(l)||_.isArguments(l))){e||(l=$(l,e,i));var c=0,h=l.length;for(s.length+=h;c<h;)s[r++]=l[c++]}else i||(s[r++]=l)}return s};_.flatten=function(t,e){return $(t,e,!1)},_.without=function(t){return _.difference(t,h.call(arguments,1))},_.uniq=_.unique=function(t,e,i,n){_.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=w(i,n));for(var s=[],r=[],a=0,o=S(t);a<o;a++){var l=t[a],c=i?i(l,a,t):l;e?(a&&r===c||s.push(l),r=c):i?_.contains(r,c)||(r.push(c),s.push(l)):_.contains(s,l)||s.push(l)}return s},_.union=function(){return _.uniq($(arguments,!0,!0))},_.intersection=function(t){for(var e=[],i=arguments.length,n=0,s=S(t);n<s;n++){var r=t[n];if(!_.contains(e,r)){for(var a=1;a<i&&_.contains(arguments[a],r);a++);a===i&&e.push(r)}}return e},_.difference=function(t){var e=$(arguments,!0,!0,1);return _.filter(t,function(t){return!_.contains(e,t)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(t){for(var e=t&&_.max(t,S).length||0,i=Array(e),n=0;n<e;n++)i[n]=_.pluck(t,n);return i},_.object=function(t,e){for(var i={},n=0,s=S(t);n<s;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},_.findIndex=e(1),_.findLastIndex=e(-1),_.sortedIndex=function(t,e,i,n){i=w(i,n,1);for(var s=i(e),r=0,a=S(t);r<a;){var o=Math.floor((r+a)/2);i(t[o])<s?r=o+1:a=o}return r},_.indexOf=i(1,_.findIndex,_.sortedIndex),_.lastIndexOf=i(-1,_.findLastIndex),_.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),s=Array(n),r=0;r<n;r++,t+=i)s[r]=t;return s};var M=function(t,e,i,n,s){if(!(n instanceof e))return t.apply(i,s);var r=x(t.prototype),a=t.apply(r,s);return _.isObject(a)?a:r};_.bind=function(t,e){if(g&&t.bind===g)return g.apply(t,h.call(arguments,1));if(!_.isFunction(t))throw new TypeError("Bind must be called on a function");var i=h.call(arguments,2),n=function(){return M(t,n,e,this,i.concat(h.call(arguments)))};return n},_.partial=function(t){var e=h.call(arguments,1),i=function(){for(var n=0,s=e.length,r=Array(s),a=0;a<s;a++)r[a]=e[a]===_?arguments[n++]:e[a];for(;n<arguments.length;)r.push(arguments[n++]);return M(t,i,this,this,r)};return i},_.bindAll=function(t){var e,i,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(e=1;e<n;e++)i=arguments[e],t[i]=_.bind(t[i],t);return t},_.memoize=function(t,e){var i=function(n){var s=i.cache,r=""+(e?e.apply(this,arguments):n);return _.has(s,r)||(s[r]=t.apply(this,arguments)),s[r]};return i.cache={},i},_.delay=function(t,e){var i=h.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},_.defer=_.partial(_.delay,_,1),_.throttle=function(t,e,i){var n,s,r,a=null,o=0;i||(i={});var l=function(){o=i.leading===!1?0:_.now(),a=null,r=t.apply(n,s),a||(n=s=null)};return function(){var c=_.now();o||i.leading!==!1||(o=c);var h=e-(c-o);return n=this,s=arguments,h<=0||h>e?(a&&(clearTimeout(a),a=null),o=c,r=t.apply(n,s),a||(n=s=null)):a||i.trailing===!1||(a=setTimeout(l,h)),r}},_.debounce=function(t,e,i){var n,s,r,a,o,l=function(){var c=_.now()-a;c<e&&c>=0?n=setTimeout(l,e-c):(n=null,i||(o=t.apply(r,s),n||(r=s=null)))};return function(){r=this,s=arguments,a=_.now();var c=i&&!n;return n||(n=setTimeout(l,e)),c&&(o=t.apply(r,s),r=s=null),o}},_.wrap=function(t,e){return _.partial(e,t)},_.negate=function(t){return function(){return!t.apply(this,arguments)}},_.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},_.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},_.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},_.once=_.partial(_.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),E=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(t){if(!_.isObject(t))return[];if(f)return f(t);var e=[];for(var i in t)_.has(t,i)&&e.push(i);return I&&n(t,e),e},_.allKeys=function(t){if(!_.isObject(t))return[];var e=[];for(var i in t)e.push(i);return I&&n(t,e),e},_.values=function(t){for(var e=_.keys(t),i=e.length,n=Array(i),s=0;s<i;s++)n[s]=t[e[s]];return n},_.mapObject=function(t,e,i){e=w(e,i);for(var n,s=_.keys(t),r=s.length,a={},o=0;o<r;o++)n=s[o],a[n]=e(t[n],n,t);return a},_.pairs=function(t){for(var e=_.keys(t),i=e.length,n=Array(i),s=0;s<i;s++)n[s]=[e[s],t[e[s]]];return n},_.invert=function(t){for(var e={},i=_.keys(t),n=0,s=i.length;n<s;n++)e[t[i[n]]]=i[n];return e},_.functions=_.methods=function(t){var e=[];for(var i in t)_.isFunction(t[i])&&e.push(i);return e.sort()},_.extend=b(_.allKeys),_.extendOwn=_.assign=b(_.keys),_.findKey=function(t,e,i){e=w(e,i);for(var n,s=_.keys(t),r=0,a=s.length;r<a;r++)if(n=s[r],e(t[n],n,t))return n},_.pick=function(t,e,i){var n,s,r={},a=t;if(null==a)return r;_.isFunction(e)?(s=_.allKeys(a),n=y(e,i)):(s=$(arguments,!1,!1,1),n=function(t,e,i){return e in i},a=Object(a));for(var o=0,l=s.length;o<l;o++){var c=s[o],h=a[c];n(h,c,a)&&(r[c]=h)}return r},_.omit=function(t,e,i){if(_.isFunction(e))e=_.negate(e);else{var n=_.map($(arguments,!1,!1,1),String);e=function(t,e){return!_.contains(n,e)}}return _.pick(t,e,i)},_.defaults=b(_.allKeys,!0),_.create=function(t,e){var i=x(t);return e&&_.extendOwn(i,e),i},_.clone=function(t){return _.isObject(t)?_.isArray(t)?t.slice():_.extend({},t):t},_.tap=function(t,e){return e(t),t},_.isMatch=function(t,e){var i=_.keys(e),n=i.length;if(null==t)return!n;for(var s=Object(t),r=0;r<n;r++){var a=i[r];if(e[a]!==s[a]||!(a in s))return!1}return!0};var A=function(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof _&&(t=t._wrapped),e instanceof _&&(e=e._wrapped);var s=d.call(t);if(s!==d.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var r="[object Array]"===s;if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,o=e.constructor;if(a!==o&&!(_.isFunction(a)&&a instanceof a&&_.isFunction(o)&&o instanceof o)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===t)return n[l]===e;if(i.push(t),n.push(e),r){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!A(t[l],e[l],i,n))return!1}else{var c,h=_.keys(t);if(l=h.length,_.keys(e).length!==l)return!1;for(;l--;)if(c=h[l],!_.has(e,c)||!A(t[c],e[c],i,n))return!1}return i.pop(),n.pop(),!0};_.isEqual=function(t,e){return A(t,e)},_.isEmpty=function(t){return null==t||(P(t)&&(_.isArray(t)||_.isString(t)||_.isArguments(t))?0===t.length:0===_.keys(t).length)},_.isElement=function(t){return!(!t||1!==t.nodeType)},_.isArray=p||function(t){return"[object Array]"===d.call(t)},_.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){_["is"+t]=function(e){return d.call(e)==="[object "+t+"]"}}),_.isArguments(arguments)||(_.isArguments=function(t){return _.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(t){return"function"==typeof t||!1}),_.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},_.isNaN=function(t){return _.isNumber(t)&&t!==+t},_.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===d.call(t)},_.isNull=function(t){return null===t},_.isUndefined=function(t){return void 0===t},_.has=function(t,e){return null!=t&&u.call(t,e)},_.noConflict=function(){return s._=r,this},_.identity=function(t){return t},_.constant=function(t){return function(){return t}},_.noop=function(){},_.property=k,_.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},_.matcher=_.matches=function(t){return t=_.extendOwn({},t),function(e){return _.isMatch(e,t)}},_.times=function(t,e,i){var n=Array(Math.max(0,t));e=y(e,i,1);for(var s=0;s<t;s++)n[s]=e(s);return n},_.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},_.now=Date.now||function(){return(new Date).getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},D=_.invert(L),R=function(t){var e=function(e){return t[e]},i="(?:"+_.keys(t).join("|")+")",n=RegExp(i),s=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(s,e):t}};_.escape=R(L),_.unescape=R(D),_.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),_.isFunction(n)?n.call(t):n};var j=0;_.uniqueId=function(t){var e=++j+"";return t?t+e:e},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\u2028|\u2029/g,W=function(t){return"\\"+N[t]};_.template=function(t,e,i){!e&&i&&(e=i),e=_.defaults({},e,_.templateSettings);var n=RegExp([(e.escape||O).source,(e.interpolate||O).source,(e.evaluate||O).source].join("|")+"|$","g"),s=0,r="__p+='";t.replace(n,function(e,i,n,a,o){return r+=t.slice(s,o).replace(z,W),s=o+e.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),e}),r+="';\n",e.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var a=new Function(e.variable||"obj","_",r)}catch(t){throw t.source=r,t}var o=function(t){return a.call(this,t,_)},l=e.variable||"obj";return o.source="function("+l+"){\n"+r+"}",o},_.chain=function(t){var e=_(t);return e._chain=!0,e};var F=function(t,e){return t._chain?_(e).chain():e};_.mixin=function(t){_.each(_.functions(t),function(e){var i=_[e]=t[e];_.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),F(this,i.apply(_,t))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];_.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],F(this,i)}}),_.each(["concat","join","slice"],function(t){var e=a[t];_.prototype[t]=function(){return F(this,e.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),
//     Backbone may be freely distributed under the MIT license.
function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,n,s){e.Backbone=t(e,s,i,n)});else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(t){}t(e,exports,n,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(t,e,i,n){var s=t.Backbone,r=Array.prototype.slice;e.VERSION="1.3.3",e.$=n,e.noConflict=function(){return t.Backbone=s,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=function(t,e,n){switch(t){case 1:return function(){return i[e](this[n])};case 2:return function(t){return i[e](this[n],t)};case 3:return function(t,s){return i[e](this[n],l(t,this),s)};case 4:return function(t,s,r){return i[e](this[n],l(t,this),s,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[n]),i[e].apply(i,t)}}},o=function(t,e,n){i.each(e,function(e,s){i[s]&&(t.prototype[s]=a(e,s,n))})},l=function(t,e){return i.isFunction(t)?t:i.isObject(t)&&!e._isModel(t)?c(t):i.isString(t)?function(e){return e.get(t)}:t},c=function(t){var e=i.matches(t);return function(t){return e(t.attributes)}},h=e.Events={},d=/\s+/,u=function(t,e,n,s,r){var a,o=0;if(n&&"object"==typeof n){void 0!==s&&"context"in r&&void 0===r.context&&(r.context=s);for(a=i.keys(n);o<a.length;o++)e=u(t,e,a[o],n[a[o]],r)}else if(n&&d.test(n))for(a=n.split(d);o<a.length;o++)e=t(e,a[o],s,r);else e=t(e,n,s,r);return e};h.on=function(t,e,i){return p(this,t,e,i)};var p=function(t,e,i,n,s){if(t._events=u(f,t._events||{},e,i,{context:n,ctx:t,listening:s}),s){var r=t._listeners||(t._listeners={});r[s.id]=s}return t};h.listenTo=function(t,e,n){if(!t)return this;var s=t._listenId||(t._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),a=r[s];if(!a){var o=this._listenId||(this._listenId=i.uniqueId("l"));a=r[s]={obj:t,objId:s,id:o,listeningTo:r,count:0}}return p(t,e,n,this,a),this};var f=function(t,e,i,n){if(i){var s=t[e]||(t[e]=[]),r=n.context,a=n.ctx,o=n.listening;o&&o.count++,s.push({callback:i,context:r,ctx:r||a,listening:o})}return t};h.off=function(t,e,i){return this._events?(this._events=u(g,this._events,t,e,{context:i,listeners:this._listeners}),this):this},h.stopListening=function(t,e,n){var s=this._listeningTo;if(!s)return this;for(var r=t?[t._listenId]:i.keys(s),a=0;a<r.length;a++){var o=s[r[a]];if(!o)break;o.obj.off(e,n,this)}return this};var g=function(t,e,n,s){if(t){var r,a=0,o=s.context,l=s.listeners;if(e||n||o){for(var c=e?[e]:i.keys(t);a<c.length;a++){e=c[a];var h=t[e];if(!h)break;for(var d=[],u=0;u<h.length;u++){var p=h[u];n&&n!==p.callback&&n!==p.callback._callback||o&&o!==p.context?d.push(p):(r=p.listening,r&&0===--r.count&&(delete l[r.id],delete r.listeningTo[r.objId]))}d.length?t[e]=d:delete t[e]}return t}for(var f=i.keys(l);a<f.length;a++)r=l[f[a]],delete l[r.id],delete r.listeningTo[r.objId]}};h.once=function(t,e,n){var s=u(m,{},t,e,i.bind(this.off,this));return"string"==typeof t&&null==n&&(e=void 0),this.on(s,e,n)},h.listenToOnce=function(t,e,n){var s=u(m,{},e,n,i.bind(this.stopListening,this,t));return this.listenTo(t,s)};var m=function(t,e,n,s){if(n){var r=t[e]=i.once(function(){s(e,r),n.apply(this,arguments)});r._callback=n}return t};h.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return u(v,this._events,t,void 0,i),this};var v=function(t,e,i,n){if(t){var s=t[e],r=t.all;s&&r&&(r=r.slice()),s&&_(s,n),r&&_(r,[e].concat(n))}return t},_=function(t,e){var i,n=-1,s=t.length,r=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++n<s;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r);return;case 2:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r,a);return;case 3:for(;++n<s;)(i=t[n]).callback.call(i.ctx,r,a,o);return;default:for(;++n<s;)(i=t[n]).callback.apply(i.ctx,e);return}};h.bind=h.on,h.unbind=h.off,i.extend(e,h);var y=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var s=i.result(this,"defaults");n=i.defaults(i.extend({},s,n),s),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(y.prototype,h,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,n){if(null==t)return this;var s;if("object"==typeof t?(s=t,n=e):(s={})[t]=e,n||(n={}),!this._validate(s,n))return!1;var r=n.unset,a=n.silent,o=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,h=this.changed,d=this._previousAttributes;for(var u in s)e=s[u],i.isEqual(c[u],e)||o.push(u),i.isEqual(d[u],e)?delete h[u]:h[u]=e,r?delete c[u]:c[u]=e;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!a){o.length&&(this._pending=n);for(var p=0;p<o.length;p++)this.trigger("change:"+o[p],this,c[o[p]],n)}if(l)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var s in t){var r=t[s];i.isEqual(e[s],r)||(n[s]=r)}return!!i.size(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=i.extend({parse:!0},t);var e=this,n=t.success;return t.success=function(i){var s=t.parse?e.parse(i,t):i;return!!e.set(s,t)&&(n&&n.call(t.context,e,i,t),void e.trigger("sync",e,i,t))},F(this,t),this.sync("read",this,t)},save:function(t,e,n){var s;null==t||"object"==typeof t?(s=t,n=e):(s={})[t]=e,n=i.extend({validate:!0,parse:!0},n);var r=n.wait;if(s&&!r){if(!this.set(s,n))return!1}else if(!this._validate(s,n))return!1;var a=this,o=n.success,l=this.attributes;n.success=function(t){a.attributes=l;var e=n.parse?a.parse(t,n):t;return r&&(e=i.extend({},s,e)),!(e&&!a.set(e,n))&&(o&&o.call(n.context,a,t,n),void a.trigger("sync",a,t,n))},F(this,n),s&&r&&(this.attributes=i.extend({},l,s));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=s);var h=this.sync(c,this,n);return this.attributes=l,h},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,s=t.wait,r=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){s&&r(),n&&n.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var a=!1;return this.isNew()?i.defer(t.success):(F(this,t),a=this.sync("delete",this,t)),s||r(),a},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||W();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1)}});var w={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};o(y,w,"attributes");var b=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},x={add:!0,remove:!0,merge:!0},k={add:!0,remove:!1},T=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var n,s=Array(t.length-i),r=e.length;for(n=0;n<s.length;n++)s[n]=t[n+i];for(n=0;n<r;n++)t[n+i]=e[n];for(n=0;n<s.length;n++)t[n+r+i]=s[n]};i.extend(b.prototype,h,{model:y,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,k))},remove:function(t,e){e=i.extend({},e);var n=!i.isArray(t);t=n?[t]:t.slice();var s=this._removeModels(t,e);return!e.silent&&s.length&&(e.changes={added:[],merged:[],removed:s},this.trigger("update",this,e)),n?s[0]:s},set:function(t,e){if(null!=t){e=i.extend({},x,e),e.parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var n=!i.isArray(t);t=n?[t]:t.slice();var s=e.at;null!=s&&(s=+s),s>this.length&&(s=this.length),s<0&&(s+=this.length+1);var r,a,o=[],l=[],c=[],h=[],d={},u=e.add,p=e.merge,f=e.remove,g=!1,m=this.comparator&&null==s&&e.sort!==!1,v=i.isString(this.comparator)?this.comparator:null;for(a=0;a<t.length;a++){r=t[a];var _=this.get(r);if(_){if(p&&r!==_){var y=this._isModel(r)?r.attributes:r;e.parse&&(y=_.parse(y,e)),_.set(y,e),c.push(_),m&&!g&&(g=_.hasChanged(v))}d[_.cid]||(d[_.cid]=!0,o.push(_)),t[a]=_}else u&&(r=t[a]=this._prepareModel(r,e),r&&(l.push(r),this._addReference(r,e),d[r.cid]=!0,o.push(r)))}if(f){for(a=0;a<this.length;a++)r=this.models[a],d[r.cid]||h.push(r);h.length&&this._removeModels(h,e)}var w=!1,b=!m&&u&&f;if(o.length&&b?(w=this.length!==o.length||i.some(this.models,function(t,e){return t!==o[e]}),this.models.length=0,T(this.models,o,0),this.length=this.models.length):l.length&&(m&&(g=!0),T(this.models,l,null==s?this.length:s),this.length=this.models.length),g&&this.sort({silent:!0}),!e.silent){for(a=0;a<l.length;a++)null!=s&&(e.index=s+a),r=l[a],r.trigger("add",r,this,e);(g||w)&&this.trigger("sort",this,e),(l.length||h.length||c.length)&&(e.changes={added:l,removed:h,merged:c},this.trigger("update",this,e))}return n?t[0]:t}},reset:function(t,e){e=e?i.clone(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;return i.isFunction(e)&&(e=i.bind(e,this)),1===n||i.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){t=i.extend({parse:!0},t);var e=t.success,n=this;return t.success=function(i){var s=t.reset?"reset":"set";n[s](i,t),e&&e.call(t.context,n,i,t),n.trigger("sync",n,i,t)},F(this,t),this.sync("read",this,t)},create:function(t,e){e=e?i.clone(e):{};var n=e.wait;if(t=this._prepareModel(t,e),!t)return!1;n||this.add(t,e);var s=this,r=e.success;return e.success=function(t,e,i){n&&s.add(t,i),r&&r.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var s=this.get(t[n]);if(s){var r=this.indexOf(s);this.models.splice(r,1),this.length--,delete this._byId[s.cid];var a=this.modelId(s.attributes);null!=a&&delete this._byId[a],e.silent||(e.index=r,s.trigger("remove",s,this,e)),i.push(s),this._removeReference(s,e)}}return i},_isModel:function(t){return t instanceof y},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if(("add"===t||"remove"===t)&&i!==this)return;if("destroy"===t&&this.remove(e,n),"change"===t){var s=this.modelId(e.previousAttributes()),r=this.modelId(e.attributes);s!==r&&(null!=s&&delete this._byId[s],null!=r&&(this._byId[r]=e))}}this.trigger.apply(this,arguments)}});var S={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};o(b,S,"models");var P=e.View=function(t){this.cid=i.uniqueId("view"),i.extend(this,i.pick(t,$)),this._ensureElement(),this.initialize.apply(this,arguments)},C=/^(\S+)\s*(.*)$/,$=["model","collection","el","id","attributes","className","tagName","events"];i.extend(P.prototype,h,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=i.result(this,"events")),!t)return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[n]),n){var s=e.match(C);this.delegate(s[1],s[2],i.bind(n,this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,n,s){var r=M[t];i.defaults(s||(s={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:r,dataType:"json"};if(s.url||(a.url=i.result(n,"url")||W()),null!=s.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(s.attrs||n.toJSON(s))),s.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),s.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",s.emulateJSON&&(a.data._method=r);var o=s.beforeSend;s.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",r),o)return o.apply(this,arguments)}}"GET"===a.type||s.emulateJSON||(a.processData=!1);var l=s.error;s.error=function(t,e,i){s.textStatus=e,s.errorThrown=i,l&&l.call(s.context,t,e,i)};var c=s.xhr=e.ajax(i.extend(a,s));return n.trigger("request",n,c,s),c};var M={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var I=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,L=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(I.prototype,h,{initialize:function(){},route:function(t,n,s){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(s=n,n=""),s||(s=this[n]);var r=this;return e.history.route(t,function(i){var a=r._extractParameters(t,i);r.execute(s,a,n)!==!1&&(r.trigger.apply(r,["route:"+n].concat(a)),r.trigger("route",n,a),e.history.trigger("route",r,n,a))}),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(D,"\\$&").replace(E,"(?:$1)?").replace(A,function(t,e){return e?t:"([^/?]+)"}).replace(L,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var R=e.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},j=/^[#\/]|\s+$/g,O=/^\/+|\/+$/g,N=/#.*$/;R.started=!1,i.extend(R.prototype,h,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(j,"")},start:function(t){if(R.started)throw new Error("Backbone.history has already been started");if(R.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(O,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,s=n.insertBefore(this.iframe,n.firstChild).contentWindow;s.document.open(),s.document.close(),s.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),R.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e!==this.fragment&&(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),i.some(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!R.started)return!1;e&&e!==!0||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;if(t=this.decodeFragment(t.replace(N,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;e.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new R;var z=function(t,e){var n,s=this;return n=t&&i.has(t,"constructor")?t.constructor:function(){return s.apply(this,arguments)},i.extend(n,s,e),n.prototype=i.create(s.prototype,t),n.prototype.constructor=n,n.__super__=s.prototype,n};y.extend=b.extend=I.extend=P.extend=R.extend=z;var W=function(){throw new Error('A "url" property or function must be specified')},F=function(t,e){var i=e.error;e.error=function(n){i&&i.call(e.context,t,n,e),t.trigger("error",t,n,e)}};return e}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(e,n){var s,r,a,o=e.nodeName.toLowerCase();return"area"===o?(s=e.parentNode,r=s.name,!(!e.href||!r||"map"!==s.nodeName.toLowerCase())&&(a=t("img[usemap='#"+r+"']")[0],!!a&&i(a))):(/^(input|select|textarea|button|object)$/.test(o)?!e.disabled:"a"===o?e.href||n:n)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}t.ui=t.ui||{},t.extend(t.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({scrollParent:function(e){var i=this.css("position"),n="absolute"===i,s=e?/(auto|scroll|hidden)/:/(auto|scroll)/,r=this.parents().filter(function(){var e=t(this);return(!n||"static"!==e.css("position"))&&s.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&r.length?r:t(this[0].ownerDocument||document)},uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,n){return!!t.data(e,n[3])},focusable:function(i){return e(i,!isNaN(t.attr(i,"tabindex")))},tabbable:function(i){var n=t.attr(i,"tabindex"),s=isNaN(n);return(s||n>=0)&&e(i,!s)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(e,i){function n(e,i,n,r){return t.each(s,function(){i-=parseFloat(t.css(e,"padding"+this))||0,n&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),r&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var s="Width"===i?["Left","Right"]:["Top","Bottom"],r=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(r,n(this,e)+"px")})},t.fn["outer"+i]=function(e,s){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(r,n(this,e,!0,s)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.fn.extend({focus:function(e){return function(i,n){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),n&&n.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var i,n,s=t(this[0]);s.length&&s[0]!==document;){if(i=s.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(n=parseInt(s.css("zIndex"),10),!isNaN(n)&&0!==n))return n;s=s.parent()}return 0}}),t.ui.plugin={add:function(e,i,n){var s,r=t.ui[e].prototype;for(s in n)r.plugins[s]=r.plugins[s]||[],r.plugins[s].push([i,n[s]])},call:function(t,e,i,n){var s,r=t.plugins[e];if(r&&(n||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(s=0;r.length>s;s++)t.options[r[s][0]]&&r[s][1].apply(t.element,i)}};var n=0,s=Array.prototype.slice;t.cleanData=function(e){return function(i){var n,s,r;for(r=0;null!=(s=i[r]);r++)try{n=t._data(s,"events"),n&&n.remove&&t(s).triggerHandler("remove")}catch(t){}e(i)}}(t.cleanData),t.widget=function(e,i,n){var s,r,a,o,l={},c=e.split(".")[0];return e=e.split(".")[1],s=c+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][s.toLowerCase()]=function(e){return!!t.data(e,s)},t[c]=t[c]||{},r=t[c][e],a=t[c][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new a(t,e)},t.extend(a,r,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),o=new i,o.options=t.widget.extend({},o.options),t.each(n,function(e,n){return t.isFunction(n)?void(l[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},s=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,r=this._superApply;return this._super=t,this._superApply=s,e=n.apply(this,arguments),this._super=i,this._superApply=r,e}}()):void(l[e]=n)}),a.prototype=t.widget.extend(o,{widgetEventPrefix:r?o.widgetEventPrefix||e:e},l,{constructor:a,namespace:c,widgetName:e,widgetFullName:s}),r?(t.each(r._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,a,i._proto)}),delete r._childConstructors):i._childConstructors.push(a),t.widget.bridge(e,a),a},t.widget.extend=function(e){for(var i,n,r=s.call(arguments,1),a=0,o=r.length;o>a;a++)for(i in r[a])n=r[a][i],r[a].hasOwnProperty(i)&&void 0!==n&&(e[i]=t.isPlainObject(n)?t.isPlainObject(e[i])?t.widget.extend({},e[i],n):t.widget.extend({},n):n);return e},t.widget.bridge=function(e,i){var n=i.prototype.widgetFullName||e;t.fn[e]=function(r){var a="string"==typeof r,o=s.call(arguments,1),l=this;return a?this.each(function(){var i,s=t.data(this,n);return"instance"===r?(l=s,!1):s?t.isFunction(s[r])&&"_"!==r.charAt(0)?(i=s[r].apply(s,o),i!==s&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+r+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+r+"'")}):(o.length&&(r=t.widget.extend.apply(null,[r].concat(o))),this.each(function(){var e=t.data(this,n);e?(e.option(r||{}),e._init&&e._init()):t.data(this,n,new i(r,this))})),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var n,s,r,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},n=e.split("."),e=n.shift(),n.length){for(s=a[e]=t.widget.extend({},this.options[e]),r=0;n.length-1>r;r++)s[n[r]]=s[n[r]]||{},s=s[n[r]];if(e=n.pop(),1===arguments.length)return void 0===s[e]?null:s[e];s[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,n){var s,r=this;"boolean"!=typeof e&&(n=i,i=e,e=!1),n?(i=s=t(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,s=this.widget()),t.each(n,function(n,a){function o(){return e||r.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?r[a]:a).apply(r,arguments):void 0}"string"!=typeof a&&(o.guid=a.guid=a.guid||o.guid||t.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+r.eventNamespace,h=l[2];h?s.delegate(h,c,o):i.bind(c,o)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(i).undelegate(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus");
}})},_trigger:function(e,i,n){var s,r,a=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(s in r)s in i||(i[s]=r[s]);return this.element.trigger(i,n),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,s,r){"string"==typeof s&&(s={effect:s});var a,o=s?s===!0||"number"==typeof s?i:s.effect||i:e;s=s||{},"number"==typeof s&&(s={duration:s}),a=!t.isEmptyObject(s),s.complete=r,s.delay&&n.delay(s.delay),a&&t.effects&&t.effects.effect[o]?n[e](s):o!==e&&n[o]?n[o](s.duration,s.easing,r):n.queue(function(i){t(this)[e](),r&&r.call(n[0]),i()})}}),t.widget;var r=!1;t(document).mouseup(function(){r=!1}),t.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!r){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,n=1===e.which,s=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(n&&!s&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),r=!0,!0))}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),r=!1,!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function e(t,e,i){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var s,r,a=Math.max,o=Math.abs,l=Math.round,c=/left|center|right/,h=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==s)return s;var e,i,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),r=n.children()[0];return t("body").append(n),e=r.offsetWidth,n.css("overflow","scroll"),i=r.offsetWidth,e===i&&(i=n[0].clientWidth),n.remove(),s=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),n=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),s="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,r="scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight;return{width:r?t.position.scrollbarWidth():0,height:s?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),n=t.isWindow(i[0]),s=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:s,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n||s?i.width():i.outerWidth(),height:n||s?i.height():i.outerHeight()}}},t.fn.position=function(s){if(!s||!s.of)return f.apply(this,arguments);s=t.extend({},s);var p,g,m,v,_,y,w=t(s.of),b=t.position.getWithinInfo(s.within),x=t.position.getScrollInfo(b),k=(s.collision||"flip").split(" "),T={};return y=n(w),w[0].preventDefault&&(s.at="left top"),g=y.width,m=y.height,v=y.offset,_=t.extend({},v),t.each(["my","at"],function(){var t,e,i=(s[this]||"").split(" ");1===i.length&&(i=c.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=c.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=d.exec(i[0]),e=d.exec(i[1]),T[this]=[t?t[0]:0,e?e[0]:0],s[this]=[u.exec(i[0])[0],u.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===s.at[0]?_.left+=g:"center"===s.at[0]&&(_.left+=g/2),"bottom"===s.at[1]?_.top+=m:"center"===s.at[1]&&(_.top+=m/2),p=e(T.at,g,m),_.left+=p[0],_.top+=p[1],this.each(function(){var n,c,h=t(this),d=h.outerWidth(),u=h.outerHeight(),f=i(this,"marginLeft"),y=i(this,"marginTop"),S=d+f+i(this,"marginRight")+x.width,P=u+y+i(this,"marginBottom")+x.height,C=t.extend({},_),$=e(T.my,h.outerWidth(),h.outerHeight());"right"===s.my[0]?C.left-=d:"center"===s.my[0]&&(C.left-=d/2),"bottom"===s.my[1]?C.top-=u:"center"===s.my[1]&&(C.top-=u/2),C.left+=$[0],C.top+=$[1],r||(C.left=l(C.left),C.top=l(C.top)),n={marginLeft:f,marginTop:y},t.each(["left","top"],function(e,i){t.ui.position[k[e]]&&t.ui.position[k[e]][i](C,{targetWidth:g,targetHeight:m,elemWidth:d,elemHeight:u,collisionPosition:n,collisionWidth:S,collisionHeight:P,offset:[p[0]+$[0],p[1]+$[1]],my:s.my,at:s.at,within:b,elem:h})}),s.using&&(c=function(t){var e=v.left-C.left,i=e+g-d,n=v.top-C.top,r=n+m-u,l={target:{element:w,left:v.left,top:v.top,width:g,height:m},element:{element:h,left:C.left,top:C.top,width:d,height:u},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":n>0?"bottom":"middle"};d>g&&g>o(e+i)&&(l.horizontal="center"),u>m&&m>o(n+r)&&(l.vertical="middle"),l.important=a(o(e),o(i))>a(o(n),o(r))?"horizontal":"vertical",s.using.call(this,t,l)}),h.offset(t.extend(C,{using:c}))})},t.ui.position={fit:{left:function(t,e){var i,n=e.within,s=n.isWindow?n.scrollLeft:n.offset.left,r=n.width,o=t.left-e.collisionPosition.marginLeft,l=s-o,c=o+e.collisionWidth-r-s;e.collisionWidth>r?l>0&&0>=c?(i=t.left+l+e.collisionWidth-r-s,t.left+=l-i):t.left=c>0&&0>=l?s:l>c?s+r-e.collisionWidth:s:l>0?t.left+=l:c>0?t.left-=c:t.left=a(t.left-o,t.left)},top:function(t,e){var i,n=e.within,s=n.isWindow?n.scrollTop:n.offset.top,r=e.within.height,o=t.top-e.collisionPosition.marginTop,l=s-o,c=o+e.collisionHeight-r-s;e.collisionHeight>r?l>0&&0>=c?(i=t.top+l+e.collisionHeight-r-s,t.top+=l-i):t.top=c>0&&0>=l?s:l>c?s+r-e.collisionHeight:s:l>0?t.top+=l:c>0?t.top-=c:t.top=a(t.top-o,t.top)}},flip:{left:function(t,e){var i,n,s=e.within,r=s.offset.left+s.scrollLeft,a=s.width,l=s.isWindow?s.scrollLeft:s.offset.left,c=t.left-e.collisionPosition.marginLeft,h=c-l,d=c+e.collisionWidth-a-l,u="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>h?(i=t.left+u+p+f+e.collisionWidth-a-r,(0>i||o(h)>i)&&(t.left+=u+p+f)):d>0&&(n=t.left-e.collisionPosition.marginLeft+u+p+f-l,(n>0||d>o(n))&&(t.left+=u+p+f))},top:function(t,e){var i,n,s=e.within,r=s.offset.top+s.scrollTop,a=s.height,l=s.isWindow?s.scrollTop:s.offset.top,c=t.top-e.collisionPosition.marginTop,h=c-l,d=c+e.collisionHeight-a-l,u="top"===e.my[1],p=u?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>h?(n=t.top+p+f+g+e.collisionHeight-a-r,(0>n||o(h)>n)&&(t.top+=p+f+g)):d>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,(i>0||d>o(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,n,s,a,o=document.getElementsByTagName("body")[0],l=document.createElement("div");e=document.createElement(o?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&t.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(a in n)e.style[a]=n[a];e.appendChild(l),i=o||document.documentElement,i.insertBefore(e,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",s=t(l).offset().left,r=s>10&&11>s,e.innerHTML="",i.removeChild(e)}()}(),t.ui.position,t.widget("ui.sortable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),t.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var n=null,s=!1,r=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,r.widgetName+"-item")===r?(n=t(this),!1):void 0}),t.data(e.target,r.widgetName+"-item")===r&&(n=t(e.target)),!!n&&(!(this.options.handle&&!i&&(t(this.options.handle,n).find("*").addBack().each(function(){this===e.target&&(s=!0)}),!s))&&(this.currentItem=n,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,n){var s,r,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(r=this.document.find("body"),this.storedCursor=r.css("cursor"),r.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(r)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,n,s,r,a=this.options,o=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?o=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(o=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?o=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(o=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),o!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],s=n.item[0],r=this._intersectsWithPointer(n),r&&n.instance===this.currentContainer&&s!==this.currentItem[0]&&this.placeholder[1===r?"next":"prev"]()[0]!==s&&!t.contains(this.placeholder[0],s)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],s))){if(this.direction=1===r?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,s=this.placeholder.offset(),r=this.options.axis,a={};r&&"x"!==r||(a.left=s.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),r&&"y"!==r||(a.top=s.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){n._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each(function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,s=n+this.helperProportions.height,r=t.left,a=r+t.width,o=t.top,l=o+t.height,c=this.offset.click.top,h=this.offset.click.left,d="x"===this.options.axis||n+c>o&&l>n+c,u="y"===this.options.axis||e+h>r&&a>e+h,p=d&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>r&&a>i-this.helperProportions.width/2&&n+this.helperProportions.height/2>o&&l>s-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=e&&i,s=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return!!n&&(this.floating?r&&"right"===r||"down"===s?2:1:s&&("down"===s?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?"right"===s&&i||"left"===s&&!i:n&&("down"===n&&e||"up"===n&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){o.push(this)}var n,s,r,a,o=[],l=[],c=this._connectWith();if(c&&e)for(n=c.length-1;n>=0;n--)for(r=t(c[n],this.document[0]),s=r.length-1;s>=0;s--)a=t.data(r[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=l.length-1;n>=0;n--)l[n][0].each(i);return t(o)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,n,s,r,a,o,l,c,h=this.items,d=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(s=t(u[i],this.document[0]),n=s.length-1;n>=0;n--)r=t.data(s[n],this.widgetFullName),r&&r!==this&&!r.options.disabled&&(d.push([t.isFunction(r.options.items)?r.options.items.call(r.element[0],e,{item:this.currentItem}):t(r.options.items,r.element),r]),this.containers.push(r));for(i=d.length-1;i>=0;i--)for(a=d[i][1],o=d[i][0],n=0,c=o.length;c>n;n++)l=t(o[n]),l.data(this.widgetName+"-item",a),h.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,s,r;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(s=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item,e||(n.width=s.outerWidth(),n.height=s.outerHeight()),r=s.offset(),n.left=r.left,n.top=r.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)r=this.containers[i].element.offset(),this.containers[i].containerCache.left=r.left,this.containers[i].containerCache.top=r.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,n=e.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=e.currentItem[0].nodeName.toLowerCase(),s=t("<"+n+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===n?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(s)):"tr"===n?e._createTrPlaceholder(e.currentItem,s):"img"===n&&s.attr("src",e.currentItem.attr("src")),i||s.css("visibility","hidden"),s},update:function(t,s){(!i||n.forcePlaceholderSize)&&(s.height()||s.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),s.width()||s.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(n.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),n.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var n=this;e.children().each(function(){t("<td>&#160;</td>",n.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,n,s,r,a,o,l,c,h,d,u=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&t.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(s=1e4,r=null,h=u.floating||this._isFloating(this.currentItem),a=h?"left":"top",o=h?"width":"height",d=h?"clientX":"clientY",n=this.items.length-1;n>=0;n--)t.contains(this.containers[p].element[0],this.items[n].item[0])&&this.items[n].item[0]!==this.currentItem[0]&&(l=this.items[n].item.offset()[a],c=!1,e[d]-l>this.items[n][o]/2&&(c=!0),s>Math.abs(e[d]-l)&&(s=Math.abs(e[d]-l),r=this.items[n],this.direction=c?"up":"down"));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));r?this._rearrange(e,r,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,s=this.options;"parent"===s.containment&&(s.containment=this.helper[0].parentNode),("document"===s.containment||"window"===s.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===s.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===s.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(s.containment)||(e=t(s.containment)[0],i=t(s.containment).offset(),n="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:s.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:s.scrollLeft())*n}},_generatePosition:function(e){var i,n,s=this.options,r=e.pageX,a=e.pageY,o="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(o[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),s.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/s.grid[1])*s.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-s.grid[1]:i+s.grid[1]:i,n=this.originalPageX+Math.round((r-this.originalPageX)/s.grid[0])*s.grid[0],r=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-s.grid[0]:n+s.grid[0]:n)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:o.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:o.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var s=this.counter;this._delay(function(){s===this.counter&&this.refreshPositions(!n);
})},_clear:function(t,e){function i(t,e,i){return function(n){i._trigger(t,n,e._uiHash(e))}}this.reverting=!1;var n,s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&s.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||s.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(s.push(function(t){this._trigger("remove",t,this._uiHash())}),s.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)e||s.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(s.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(n=0;s.length>n;n++)s[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.slider",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,n=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),r="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",a=[];for(i=n.values&&n.values.length||1,s.length>i&&(s.slice(i).remove(),s=s.slice(0,i)),e=s.length;i>e;e++)a.push(r);this.handles=s.add(t(a.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,n,s,r,a,o,l,c,h=this,d=this.options;return!d.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(i),s=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(n-h.values(e));(s>i||s===i&&(e===h._lastChangedValue||h.values(e)===d.min))&&(s=i,r=t(this),a=e)}),o=this._start(e,a),o!==!1&&(this._mouseSliding=!0,this._handleIndex=a,r.addClass("ui-state-active").focus(),l=r.offset(),c=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:e.pageX-l.left-r.width()/2,top:e.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,n,s,r;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/e,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),s=this._valueMax()-this._valueMin(),r=this._valueMin()+n*s,this._trimAlignValue(r)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var n,s,r;this.options.values&&this.options.values.length?(n=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>n||1===e&&n>i)&&(i=n),i!==this.values(e)&&(s=this.values(),s[e]=i,r=this._trigger("slide",t,{handle:this.handles[e],value:i,values:s}),n=this.values(e?0:1),r!==!1&&this.values(e,i))):i!==this.value()&&(r=this._trigger("slide",t,{handle:this.handles[e],value:i}),r!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var n,s,r;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(n=this.options.values,s=arguments[0],r=0;n.length>r;r+=1)n[r]=this._trimAlignValue(s[r]),this._change(null,r);this._refreshValue()},_setOption:function(e,i){var n,s=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(s=this.options.values.length),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!i),this._super(e,i),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;s>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,n;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),n=0;i.length>n;n+=1)i[n]=this._trimAlignValue(i[n]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,n=t-i;return 2*Math.abs(i)>=e&&(n+=i>0?e:-e),parseFloat(n.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,n=Math.floor(+(t-e).toFixed(this._precision())/i)*i;t=n+e,this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var e,i,n,s,r,a=this.options.range,o=this.options,l=this,c=!this._animateOff&&o.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=100*((l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())),h["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[c?"animate":"css"](h,o.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[c?"animate":"css"]({left:i+"%"},o.animate),1===n&&l.range[c?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:o.animate})):(0===n&&l.range.stop(1,1)[c?"animate":"css"]({bottom:i+"%"},o.animate),1===n&&l.range[c?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:o.animate}))),e=i}):(n=this.value(),s=this._valueMin(),r=this._valueMax(),i=r!==s?100*((n-s)/(r-s)):0,h["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[c?"animate":"css"](h,o.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:i+"%"},o.animate),"max"===a&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:i+"%"},o.animate),"max"===a&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))},_handleEvents:{keydown:function(e){var i,n,s,r,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(e.target).addClass("ui-state-active"),i=this._start(e,a),i===!1))return}switch(r=this.options.step,n=s=this.options.values&&this.options.values.length?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:s=this._valueMin();break;case t.ui.keyCode.END:s=this._valueMax();break;case t.ui.keyCode.PAGE_UP:s=this._trimAlignValue(n+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(n-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(n===this._valueMax())return;s=this._trimAlignValue(n+r);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n===this._valueMin())return;s=this._trimAlignValue(n-r)}this._slide(e,a,s)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}});var a="ui-effects-",o=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var n=d[e.type]||{};return null==t?i||!e.def?null:e.def:(t=n.floor?~~t:parseFloat(t),isNaN(t)?e.def:n.mod?(t+n.mod)%n.mod:0>t?0:t>n.max?n.max:t)}function n(i){var n=c(),s=n._rgba=[];return i=i.toLowerCase(),f(l,function(t,r){var a,o=r.re.exec(i),l=o&&r.parse(o),c=r.space||"rgba";return l?(a=n[c](l),n[h[c].cache]=a[h[c].cache],s=n._rgba=a._rgba,!1):e}),s.length?("0,0,0,0"===s.join()&&t.extend(s,r.transparent),n):r[i]}function s(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var r,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",o=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],c=t.Color=function(e,i,n,s){return new t.Color.fn.parse(e,i,n,s)},h={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},u=c.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",u.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(h,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),c.fn=t.extend(c.prototype,{parse:function(s,a,o,l){if(s===e)return this._rgba=[null,null,null,null],this;(s.jquery||s.nodeType)&&(s=t(s).css(a),a=e);var d=this,u=t.type(s),p=this._rgba=[];return a!==e&&(s=[s,a,o,l],u="array"),"string"===u?this.parse(n(s)||r._default):"array"===u?(f(h.rgba.props,function(t,e){p[e.idx]=i(s[e.idx],e)}),this):"object"===u?(s instanceof c?f(h,function(t,e){s[e.cache]&&(d[e.cache]=s[e.cache].slice())}):f(h,function(e,n){var r=n.cache;f(n.props,function(t,e){if(!d[r]&&n.to){if("alpha"===t||null==s[t])return;d[r]=n.to(d._rgba)}d[r][e.idx]=i(s[t],e,!0)}),d[r]&&0>t.inArray(null,d[r].slice(0,3))&&(d[r][3]=1,n.from&&(d._rgba=n.from(d[r])))}),this):e},is:function(t){var i=c(t),n=!0,s=this;return f(h,function(t,r){var a,o=i[r.cache];return o&&(a=s[r.cache]||r.to&&r.to(s._rgba)||[],f(r.props,function(t,i){return null!=o[i.idx]?n=o[i.idx]===a[i.idx]:e})),n}),n},_space:function(){var t=[],e=this;return f(h,function(i,n){e[n.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var n=c(t),s=n._space(),r=h[s],a=0===this.alpha()?c("transparent"):this,o=a[r.cache]||r.to(a._rgba),l=o.slice();return n=n[r.cache],f(r.props,function(t,s){var r=s.idx,a=o[r],c=n[r],h=d[s.type]||{};null!==c&&(null===a?l[r]=c:(h.mod&&(c-a>h.mod/2?a+=h.mod:a-c>h.mod/2&&(a-=h.mod)),l[r]=i((c-a)*e+a,s)))}),this[s](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),s=c(e)._rgba;return c(t.map(i,function(t,e){return(1-n)*s[e]+n*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),n=i.pop();return e&&i.push(~~(255*n)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),c.fn.parse.prototype=c.fn,h.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,n=t[0]/255,s=t[1]/255,r=t[2]/255,a=t[3],o=Math.max(n,s,r),l=Math.min(n,s,r),c=o-l,h=o+l,d=.5*h;return e=l===o?0:n===o?60*(s-r)/c+360:s===o?60*(r-n)/c+120:60*(n-s)/c+240,i=0===c?0:.5>=d?c/h:c/(2-h),[Math.round(e)%360,i,d,null==a?1:a]},h.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],n=t[2],r=t[3],a=.5>=n?n*(1+i):n+i-n*i,o=2*n-a;return[Math.round(255*s(o,a,e+1/3)),Math.round(255*s(o,a,e)),Math.round(255*s(o,a,e-1/3)),r]},f(h,function(n,s){var r=s.props,a=s.cache,l=s.to,h=s.from;c.fn[n]=function(n){if(l&&!this[a]&&(this[a]=l(this._rgba)),n===e)return this[a].slice();var s,o=t.type(n),d="array"===o||"object"===o?n:arguments,u=this[a].slice();return f(r,function(t,e){var n=d["object"===o?t:e.idx];null==n&&(n=u[e.idx]),u[e.idx]=i(n,e)}),h?(s=c(h(u)),s[a]=u,s):c(u)},f(r,function(e,i){c.fn[e]||(c.fn[e]=function(s){var r,a=t.type(s),l="alpha"===e?this._hsla?"hsla":"rgba":n,c=this[l](),h=c[i.idx];return"undefined"===a?h:("function"===a&&(s=s.call(this,h),a=t.type(s)),null==s&&i.empty?this:("string"===a&&(r=o.exec(s),r&&(s=h+parseFloat(r[2])*("+"===r[1]?1:-1))),c[i.idx]=s,this[l](c)))})})}),c.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,s){var r,a,o="";if("transparent"!==s&&("string"!==t.type(s)||(r=n(s)))){if(s=c(r||s),!u.rgba&&1!==s._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===o||"transparent"===o)&&a&&a.style;)try{o=t.css(a,"backgroundColor"),a=a.parentNode}catch(t){}s=s.blend(o&&"transparent"!==o?o:"_default")}s=s.toRgbaString()}try{e.style[i]=s}catch(t){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=c(e.elem,i),e.end=c(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},c.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,n){e["border"+n+"Color"]=t}),e}},r=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(o),function(){function e(e){var i,n,s=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,r={};if(s&&s.length&&s[0]&&s[s[0]])for(n=s.length;n--;)i=s[n],"string"==typeof s[i]&&(r[t.camelCase(i)]=s[i]);else for(i in s)"string"==typeof s[i]&&(r[i]=s[i]);return r}function i(e,i){var n,r,a={};for(n in i)r=i[n],e[n]!==r&&(s[n]||(t.fx.step[n]||!isNaN(parseFloat(r)))&&(a[n]=r));return a}var n=["add","remove","toggle"],s={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(o.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(s,r,a,o){var l=t.speed(r,a,o);return this.queue(function(){var r,a=t(this),o=a.attr("class")||"",c=l.children?a.find("*").addBack():a;c=c.map(function(){var i=t(this);return{el:i,start:e(this)}}),r=function(){t.each(n,function(t,e){s[e]&&a[e+"Class"](s[e])})},r(),c=c.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",o),c=c.map(function(){var e=this,i=t.Deferred(),n=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,n),i.promise()}),t.when.apply(t,c.get()).done(function(){r(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,n,s,r){return n?t.effects.animateClass.call(this,{add:i},n,s,r):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,n,s,r){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},n,s,r):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,n,s,r,a){return"boolean"==typeof n||void 0===n?s?t.effects.animateClass.call(this,n?{add:i}:{remove:i},s,r,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},n,s,r)}}(t.fn.toggleClass),switchClass:function(e,i,n,s,r){return t.effects.animateClass.call(this,{add:i,remove:e},n,s,r)}})}(),function(){function e(e,i,n,s){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(s=i,n=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(s=n,n=i,i={}),t.isFunction(n)&&(s=n,n=null),i&&t.extend(e,i),n=n||i.duration,e.duration=t.fx.off?0:"number"==typeof n?n:n in t.fx.speeds?t.fx.speeds[n]:t.fx.speeds._default,e.complete=s||i.complete,e}function i(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||("string"==typeof e&&!t.effects.effect[e]||(!!t.isFunction(e)||"object"==typeof e&&!e.effect))}t.extend(t.effects,{version:"1.11.4",save:function(t,e){for(var i=0;e.length>i;i++)null!==e[i]&&t.data(a+e[i],t[0].style[e[i]])},restore:function(t,e){var i,n;for(n=0;e.length>n;n++)null!==e[n]&&(i=t.data(a+e[n]),void 0===i&&(i=""),t.css(e[n],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,n;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=t[1]/e.width}return{x:n,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},n=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),s={width:e.width(),height:e.height()},r=document.activeElement;try{r.id}catch(t){r=document.body}return e.wrap(n),(e[0]===r||t.contains(e[0],r))&&t(r).focus(),n=e.parent(),"static"===e.css("position")?(n.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,n){i[n]=e.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(s),n.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,n,s){return s=s||{},t.each(i,function(t,i){var r=e.cssUnit(i);r[0]>0&&(s[i]=r[0]*n+r[1])}),s}}),t.fn.extend({effect:function(){function i(e){function i(){t.isFunction(r)&&r.call(s[0]),t.isFunction(e)&&e()}var s=t(this),r=n.complete,o=n.mode;(s.is(":hidden")?"hide"===o:"show"===o)?(s[o](),i()):a.call(s[0],n,i)}var n=e.apply(this,arguments),s=n.mode,r=n.queue,a=t.effects.effect[n.effect];return t.fx.off||!a?s?this[s](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):r===!1?this.each(i):this.queue(r||"fx",i)},show:function(t){return function(n){if(i(n))return t.apply(this,arguments);var s=e.apply(this,arguments);return s.mode="show",this.effect.call(this,s)}}(t.fn.show),hide:function(t){return function(n){if(i(n))return t.apply(this,arguments);var s=e.apply(this,arguments);return s.mode="hide",this.effect.call(this,s)}}(t.fn.hide),toggle:function(t){return function(n){if(i(n)||"boolean"==typeof n)return t.apply(this,arguments);var s=e.apply(this,arguments);return s.mode="toggle",this.effect.call(this,s)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),n=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(n=[parseFloat(i),e])}),n}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}(),t.effects,t.effects.effect.blind=function(e,i){var n,s,r,a=t(this),o=/up|down|vertical/,l=/up|left|vertical|horizontal/,c=["position","top","bottom","left","right","height","width"],h=t.effects.setMode(a,e.mode||"hide"),d=e.direction||"up",u=o.test(d),p=u?"height":"width",f=u?"top":"left",g=l.test(d),m={},v="show"===h;a.parent().is(".ui-effects-wrapper")?t.effects.save(a.parent(),c):t.effects.save(a,c),a.show(),n=t.effects.createWrapper(a).css({overflow:"hidden"}),s=n[p](),r=parseFloat(n.css(f))||0,m[p]=v?s:0,g||(a.css(u?"bottom":"right",0).css(u?"top":"left","auto").css({position:"absolute"}),m[f]=v?r:s+r),v&&(n.css(p,0),g||n.css(f,r+s)),n.animate(m,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){"hide"===h&&a.hide(),t.effects.restore(a,c),t.effects.removeWrapper(a),i()}})},t.effects.effect.bounce=function(e,i){var n,s,r,a=t(this),o=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(a,e.mode||"effect"),c="hide"===l,h="show"===l,d=e.direction||"up",u=e.distance,p=e.times||5,f=2*p+(h||c?1:0),g=e.duration/f,m=e.easing,v="up"===d||"down"===d?"top":"left",_="up"===d||"left"===d,y=a.queue(),w=y.length;for((h||c)&&o.push("opacity"),t.effects.save(a,o),a.show(),t.effects.createWrapper(a),u||(u=a["top"===v?"outerHeight":"outerWidth"]()/3),h&&(r={opacity:1},r[v]=0,a.css("opacity",0).css(v,_?2*-u:2*u).animate(r,g,m)),c&&(u/=Math.pow(2,p-1)),r={},r[v]=0,n=0;p>n;n++)s={},s[v]=(_?"-=":"+=")+u,a.animate(s,g,m).animate(r,g,m),u=c?2*u:u/2;c&&(s={opacity:0},s[v]=(_?"-=":"+=")+u,a.animate(s,g,m)),a.queue(function(){c&&a.hide(),t.effects.restore(a,o),t.effects.removeWrapper(a),i()}),w>1&&y.splice.apply(y,[1,0].concat(y.splice(w,f+1))),a.dequeue()},t.effects.effect.clip=function(e,i){var n,s,r,a=t(this),o=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(a,e.mode||"hide"),c="show"===l,h=e.direction||"vertical",d="vertical"===h,u=d?"height":"width",p=d?"top":"left",f={};t.effects.save(a,o),a.show(),n=t.effects.createWrapper(a).css({overflow:"hidden"}),s="IMG"===a[0].tagName?n:a,r=s[u](),c&&(s.css(u,0),s.css(p,r/2)),f[u]=c?r:0,f[p]=c?0:r/2,s.animate(f,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){c||a.hide(),t.effects.restore(a,o),t.effects.removeWrapper(a),i()}})},t.effects.effect.drop=function(e,i){var n,s=t(this),r=["position","top","bottom","left","right","opacity","height","width"],a=t.effects.setMode(s,e.mode||"hide"),o="show"===a,l=e.direction||"left",c="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l?"pos":"neg",d={opacity:o?1:0};t.effects.save(s,r),s.show(),t.effects.createWrapper(s),n=e.distance||s["top"===c?"outerHeight":"outerWidth"](!0)/2,o&&s.css("opacity",0).css(c,"pos"===h?-n:n),d[c]=(o?"pos"===h?"+=":"-=":"pos"===h?"-=":"+=")+n,s.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&s.hide(),t.effects.restore(s,r),t.effects.removeWrapper(s),i()}})},t.effects.effect.explode=function(e,i){function n(){y.push(this),y.length===d*u&&s()}function s(){p.css({visibility:"visible"}),t(y).remove(),g||p.hide(),i()}var r,a,o,l,c,h,d=e.pieces?Math.round(Math.sqrt(e.pieces)):3,u=d,p=t(this),f=t.effects.setMode(p,e.mode||"hide"),g="show"===f,m=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/u),_=Math.ceil(p.outerHeight()/d),y=[];for(r=0;d>r;r++)for(l=m.top+r*_,h=r-(d-1)/2,a=0;u>a;a++)o=m.left+a*v,c=a-(u-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*v,top:-r*_}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:_,left:o+(g?c*v:0),top:l+(g?h*_:0),opacity:g?0:1}).animate({left:o+(g?0:c*v),top:l+(g?0:h*_),opacity:g?1:0},e.duration||500,e.easing,n)},t.effects.effect.fade=function(e,i){var n=t(this),s=t.effects.setMode(n,e.mode||"toggle");n.animate({opacity:s},{queue:!1,duration:e.duration,easing:e.easing,complete:i})},t.effects.effect.fold=function(e,i){var n,s,r=t(this),a=["position","top","bottom","left","right","height","width"],o=t.effects.setMode(r,e.mode||"hide"),l="show"===o,c="hide"===o,h=e.size||15,d=/([0-9]+)%/.exec(h),u=!!e.horizFirst,p=l!==u,f=p?["width","height"]:["height","width"],g=e.duration/2,m={},v={};t.effects.save(r,a),r.show(),n=t.effects.createWrapper(r).css({overflow:"hidden"}),s=p?[n.width(),n.height()]:[n.height(),n.width()],d&&(h=parseInt(d[1],10)/100*s[c?0:1]),l&&n.css(u?{height:0,width:h}:{height:h,width:0}),m[f[0]]=l?s[0]:h,v[f[1]]=l?s[1]:0,n.animate(m,g,e.easing).animate(v,g,e.easing,function(){c&&r.hide(),t.effects.restore(r,a),t.effects.removeWrapper(r),i()})},t.effects.effect.highlight=function(e,i){var n=t(this),s=["backgroundImage","backgroundColor","opacity"],r=t.effects.setMode(n,e.mode||"show"),a={backgroundColor:n.css("backgroundColor")};"hide"===r&&(a.opacity=0),t.effects.save(n,s),n.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===r&&n.hide(),t.effects.restore(n,s),i()}})},t.effects.effect.size=function(e,i){var n,s,r,a=t(this),o=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],c=["width","height","overflow"],h=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],u=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=t.effects.setMode(a,e.mode||"effect"),f=e.restore||"effect"!==p,g=e.scale||"both",m=e.origin||["middle","center"],v=a.css("position"),_=f?o:l,y={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&a.show(),n={height:a.height(),width:a.width(),outerHeight:a.outerHeight(),outerWidth:a.outerWidth()},"toggle"===e.mode&&"show"===p?(a.from=e.to||y,a.to=e.from||n):(a.from=e.from||("show"===p?y:n),a.to=e.to||("hide"===p?y:n)),r={from:{y:a.from.height/n.height,x:a.from.width/n.width},to:{y:a.to.height/n.height,x:a.to.width/n.width}},("box"===g||"both"===g)&&(r.from.y!==r.to.y&&(_=_.concat(d),a.from=t.effects.setTransition(a,d,r.from.y,a.from),a.to=t.effects.setTransition(a,d,r.to.y,a.to)),r.from.x!==r.to.x&&(_=_.concat(u),a.from=t.effects.setTransition(a,u,r.from.x,a.from),a.to=t.effects.setTransition(a,u,r.to.x,a.to))),
("content"===g||"both"===g)&&r.from.y!==r.to.y&&(_=_.concat(h).concat(c),a.from=t.effects.setTransition(a,h,r.from.y,a.from),a.to=t.effects.setTransition(a,h,r.to.y,a.to)),t.effects.save(a,_),a.show(),t.effects.createWrapper(a),a.css("overflow","hidden").css(a.from),m&&(s=t.effects.getBaseline(m,n),a.from.top=(n.outerHeight-a.outerHeight())*s.y,a.from.left=(n.outerWidth-a.outerWidth())*s.x,a.to.top=(n.outerHeight-a.to.outerHeight)*s.y,a.to.left=(n.outerWidth-a.to.outerWidth)*s.x),a.css(a.from),("content"===g||"both"===g)&&(d=d.concat(["marginTop","marginBottom"]).concat(h),u=u.concat(["marginLeft","marginRight"]),c=o.concat(d).concat(u),a.find("*[width]").each(function(){var i=t(this),n={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&t.effects.save(i,c),i.from={height:n.height*r.from.y,width:n.width*r.from.x,outerHeight:n.outerHeight*r.from.y,outerWidth:n.outerWidth*r.from.x},i.to={height:n.height*r.to.y,width:n.width*r.to.x,outerHeight:n.height*r.to.y,outerWidth:n.width*r.to.x},r.from.y!==r.to.y&&(i.from=t.effects.setTransition(i,d,r.from.y,i.from),i.to=t.effects.setTransition(i,d,r.to.y,i.to)),r.from.x!==r.to.x&&(i.from=t.effects.setTransition(i,u,r.from.x,i.from),i.to=t.effects.setTransition(i,u,r.to.x,i.to)),i.css(i.from),i.animate(i.to,e.duration,e.easing,function(){f&&t.effects.restore(i,c)})})),a.animate(a.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===a.to.opacity&&a.css("opacity",a.from.opacity),"hide"===p&&a.hide(),t.effects.restore(a,_),f||("static"===v?a.css({position:"relative",top:a.to.top,left:a.to.left}):t.each(["top","left"],function(t,e){a.css(e,function(e,i){var n=parseInt(i,10),s=t?a.to.left:a.to.top;return"auto"===i?s+"px":n+s+"px"})})),t.effects.removeWrapper(a),i()}})},t.effects.effect.scale=function(e,i){var n=t(this),s=t.extend(!0,{},e),r=t.effects.setMode(n,e.mode||"effect"),a=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===r?0:100),o=e.direction||"both",l=e.origin,c={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()},h={y:"horizontal"!==o?a/100:1,x:"vertical"!==o?a/100:1};s.effect="size",s.queue=!1,s.complete=i,"effect"!==r&&(s.origin=l||["middle","center"],s.restore=!0),s.from=e.from||("show"===r?{height:0,width:0,outerHeight:0,outerWidth:0}:c),s.to={height:c.height*h.y,width:c.width*h.x,outerHeight:c.outerHeight*h.y,outerWidth:c.outerWidth*h.x},s.fade&&("show"===r&&(s.from.opacity=0,s.to.opacity=1),"hide"===r&&(s.from.opacity=1,s.to.opacity=0)),n.effect(s)},t.effects.effect.puff=function(e,i){var n=t(this),s=t.effects.setMode(n,e.mode||"hide"),r="hide"===s,a=parseInt(e.percent,10)||150,o=a/100,l={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:s,complete:i,percent:r?a:100,from:r?l:{height:l.height*o,width:l.width*o,outerHeight:l.outerHeight*o,outerWidth:l.outerWidth*o}}),n.effect(e)},t.effects.effect.pulsate=function(e,i){var n,s=t(this),r=t.effects.setMode(s,e.mode||"show"),a="show"===r,o="hide"===r,l=a||"hide"===r,c=2*(e.times||5)+(l?1:0),h=e.duration/c,d=0,u=s.queue(),p=u.length;for((a||!s.is(":visible"))&&(s.css("opacity",0).show(),d=1),n=1;c>n;n++)s.animate({opacity:d},h,e.easing),d=1-d;s.animate({opacity:d},h,e.easing),s.queue(function(){o&&s.hide(),i()}),p>1&&u.splice.apply(u,[1,0].concat(u.splice(p,c+1))),s.dequeue()},t.effects.effect.shake=function(e,i){var n,s=t(this),r=["position","top","bottom","left","right","height","width"],a=t.effects.setMode(s,e.mode||"effect"),o=e.direction||"left",l=e.distance||20,c=e.times||3,h=2*c+1,d=Math.round(e.duration/h),u="up"===o||"down"===o?"top":"left",p="up"===o||"left"===o,f={},g={},m={},v=s.queue(),_=v.length;for(t.effects.save(s,r),s.show(),t.effects.createWrapper(s),f[u]=(p?"-=":"+=")+l,g[u]=(p?"+=":"-=")+2*l,m[u]=(p?"-=":"+=")+2*l,s.animate(f,d,e.easing),n=1;c>n;n++)s.animate(g,d,e.easing).animate(m,d,e.easing);s.animate(g,d,e.easing).animate(f,d/2,e.easing).queue(function(){"hide"===a&&s.hide(),t.effects.restore(s,r),t.effects.removeWrapper(s),i()}),_>1&&v.splice.apply(v,[1,0].concat(v.splice(_,h+1))),s.dequeue()},t.effects.effect.slide=function(e,i){var n,s=t(this),r=["position","top","bottom","left","right","width","height"],a=t.effects.setMode(s,e.mode||"show"),o="show"===a,l=e.direction||"left",c="up"===l||"down"===l?"top":"left",h="up"===l||"left"===l,d={};t.effects.save(s,r),s.show(),n=e.distance||s["top"===c?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(s).css({overflow:"hidden"}),o&&s.css(c,h?isNaN(n)?"-"+n:-n:n),d[c]=(o?h?"+=":"-=":h?"-=":"+=")+n,s.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&s.hide(),t.effects.restore(s,r),t.effects.removeWrapper(s),i()}})},t.effects.effect.transfer=function(e,i){var n=t(this),s=t(e.to),r="fixed"===s.css("position"),a=t("body"),o=r?a.scrollTop():0,l=r?a.scrollLeft():0,c=s.offset(),h={top:c.top-o,left:c.left-l,height:s.innerHeight(),width:s.innerWidth()},d=n.offset(),u=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:d.top-o,left:d.left-l,height:n.innerHeight(),width:n.innerWidth(),position:r?"fixed":"absolute"}).animate(h,e.duration,e.easing,function(){u.remove(),i()})}}),/*!
 * Modernizr v2.8.3
 * www.modernizr.com
 *
 * Copyright (c) Faruk Ates, Paul Irish, Alex Sexton
 * Available under the BSD and MIT licenses: www.modernizr.com/license/
 */
window.Modernizr=function(t,e,i){function n(t){y.cssText=t}function s(t,e){return n(k.join(t+";")+(e||""))}function r(t,e){return typeof t===e}function a(t,e){return!!~(""+t).indexOf(e)}function o(t,e){for(var n in t){var s=t[n];if(!a(s,"-")&&y[s]!==i)return"pfx"!=e||s}return!1}function l(t,e,n){for(var s in t){var a=e[t[s]];if(a!==i)return n===!1?t[s]:r(a,"function")?a.bind(n||e):a}return!1}function c(t,e,i){var n=t.charAt(0).toUpperCase()+t.slice(1),s=(t+" "+S.join(n+" ")+n).split(" ");return r(e,"string")||r(e,"undefined")?o(s,e):(s=(t+" "+P.join(n+" ")+n).split(" "),l(s,e,i))}function h(){f.input=function(i){for(var n=0,s=i.length;n<s;n++)I[i[n]]=!!(i[n]in w);return I.list&&(I.list=!(!e.createElement("datalist")||!t.HTMLDataListElement)),I}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),f.inputtypes=function(t){for(var n,s,r,a=0,o=t.length;a<o;a++)w.setAttribute("type",s=t[a]),n="text"!==w.type,n&&(w.value=b,w.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(s)&&w.style.WebkitAppearance!==i?(m.appendChild(w),r=e.defaultView,n=r.getComputedStyle&&"textfield"!==r.getComputedStyle(w,null).WebkitAppearance&&0!==w.offsetHeight,m.removeChild(w)):/^(search|tel)$/.test(s)||(n=/^(url|email)$/.test(s)?w.checkValidity&&w.checkValidity()===!1:w.value!=b)),M[t[a]]=!!n;return M}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d,u,p="2.8.3",f={},g=!0,m=e.documentElement,v="modernizr",_=e.createElement(v),y=_.style,w=e.createElement("input"),b=":)",x={}.toString,k=" -webkit- -moz- -o- -ms- ".split(" "),T="Webkit Moz O ms",S=T.split(" "),P=T.toLowerCase().split(" "),C={svg:"http://www.w3.org/2000/svg"},$={},M={},I={},E=[],A=E.slice,L=function(t,i,n,s){var r,a,o,l,c=e.createElement("div"),h=e.body,d=h||e.createElement("body");if(parseInt(n,10))for(;n--;)o=e.createElement("div"),o.id=s?s[n]:v+(n+1),c.appendChild(o);return r=["&#173;",'<style id="s',v,'">',t,"</style>"].join(""),c.id=v,(h?c:d).innerHTML+=r,d.appendChild(c),h||(d.style.background="",d.style.overflow="hidden",l=m.style.overflow,m.style.overflow="hidden",m.appendChild(d)),a=i(c,t),h?c.parentNode.removeChild(c):(d.parentNode.removeChild(d),m.style.overflow=l),!!a},D=function(e){var i=t.matchMedia||t.msMatchMedia;if(i)return i(e)&&i(e).matches||!1;var n;return L("@media "+e+" { #"+v+" { position: absolute; } }",function(e){n="absolute"==(t.getComputedStyle?getComputedStyle(e,null):e.currentStyle).position}),n},R=function(){function t(t,s){s=s||e.createElement(n[t]||"div"),t="on"+t;var a=t in s;return a||(s.setAttribute||(s=e.createElement("div")),s.setAttribute&&s.removeAttribute&&(s.setAttribute(t,""),a=r(s[t],"function"),r(s[t],"undefined")||(s[t]=i),s.removeAttribute(t))),s=null,a}var n={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t}(),j={}.hasOwnProperty;u=r(j,"undefined")||r(j.call,"undefined")?function(t,e){return e in t&&r(t.constructor.prototype[e],"undefined")}:function(t,e){return j.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var i=A.call(arguments,1),n=function(){if(this instanceof n){var s=function(){};s.prototype=e.prototype;var r=new s,a=e.apply(r,i.concat(A.call(arguments)));return Object(a)===a?a:r}return e.apply(t,i.concat(A.call(arguments)))};return n}),$.flexbox=function(){return c("flexWrap")},$.flexboxlegacy=function(){return c("boxDirection")},$.canvas=function(){var t=e.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},$.canvastext=function(){return!(!f.canvas||!r(e.createElement("canvas").getContext("2d").fillText,"function"))},$.webgl=function(){return!!t.WebGLRenderingContext},$.touch=function(){var i;return"ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch?i=!0:L(["@media (",k.join("touch-enabled),("),v,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){i=9===t.offsetTop}),i},$.geolocation=function(){return"geolocation"in navigator},$.postmessage=function(){return!!t.postMessage},$.websqldatabase=function(){return!!t.openDatabase},$.indexedDB=function(){return!!c("indexedDB",t)},$.hashchange=function(){return R("hashchange",t)&&(e.documentMode===i||e.documentMode>7)},$.history=function(){return!(!t.history||!history.pushState)},$.draganddrop=function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t},$.websockets=function(){return"WebSocket"in t||"MozWebSocket"in t},$.rgba=function(){return n("background-color:rgba(150,255,150,.5)"),a(y.backgroundColor,"rgba")},$.hsla=function(){return n("background-color:hsla(120,40%,100%,.5)"),a(y.backgroundColor,"rgba")||a(y.backgroundColor,"hsla")},$.multiplebgs=function(){return n("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(y.background)},$.backgroundsize=function(){return c("backgroundSize")},$.borderimage=function(){return c("borderImage")},$.borderradius=function(){return c("borderRadius")},$.boxshadow=function(){return c("boxShadow")},$.textshadow=function(){return""===e.createElement("div").style.textShadow},$.opacity=function(){return s("opacity:.55"),/^0.55$/.test(y.opacity)},$.cssanimations=function(){return c("animationName")},$.csscolumns=function(){return c("columnCount")},$.cssgradients=function(){var t="background-image:",e="gradient(linear,left top,right bottom,from(#9f9),to(white));",i="linear-gradient(left top,#9f9, white);";return n((t+"-webkit- ".split(" ").join(e+t)+k.join(i+t)).slice(0,-t.length)),a(y.backgroundImage,"gradient")},$.cssreflections=function(){return c("boxReflect")},$.csstransforms=function(){return!!c("transform")},$.csstransforms3d=function(){var t=!!c("perspective");return t&&"webkitPerspective"in m.style&&L("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(e,i){t=9===e.offsetLeft&&3===e.offsetHeight}),t},$.csstransitions=function(){return c("transition")},$.fontface=function(){var t;return L('@font-face {font-family:"font";src:url("https://")}',function(i,n){var s=e.getElementById("smodernizr"),r=s.sheet||s.styleSheet,a=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"";t=/src/i.test(a)&&0===a.indexOf(n.split(" ")[0])}),t},$.generatedcontent=function(){var t;return L(["#",v,"{font:0/0 a}#",v,':after{content:"',b,'";visibility:hidden;font:3px/1 a}'].join(""),function(e){t=e.offsetHeight>=3}),t},$.video=function(){var t=e.createElement("video"),i=!1;try{(i=!!t.canPlayType)&&(i=new Boolean(i),i.ogg=t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),i.h264=t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),i.webm=t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(t){}return i},$.audio=function(){var t=e.createElement("audio"),i=!1;try{(i=!!t.canPlayType)&&(i=new Boolean(i),i.ogg=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),i.mp3=t.canPlayType("audio/mpeg;").replace(/^no$/,""),i.wav=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),i.m4a=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(t){}return i},$.localstorage=function(){try{return localStorage.setItem(v,v),localStorage.removeItem(v),!0}catch(t){return!1}},$.sessionstorage=function(){try{return sessionStorage.setItem(v,v),sessionStorage.removeItem(v),!0}catch(t){return!1}},$.webworkers=function(){return!!t.Worker},$.applicationcache=function(){return!!t.applicationCache},$.svg=function(){return!!e.createElementNS&&!!e.createElementNS(C.svg,"svg").createSVGRect},$.inlinesvg=function(){var t=e.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==C.svg},$.smil=function(){return!!e.createElementNS&&/SVGAnimate/.test(x.call(e.createElementNS(C.svg,"animate")))},$.svgclippaths=function(){return!!e.createElementNS&&/SVGClipPath/.test(x.call(e.createElementNS(C.svg,"clipPath")))};for(var O in $)u($,O)&&(d=O.toLowerCase(),f[d]=$[O](),E.push((f[d]?"":"no-")+d));return f.input||h(),f.addTest=function(t,e){if("object"==typeof t)for(var n in t)u(t,n)&&f.addTest(n,t[n]);else{if(t=t.toLowerCase(),f[t]!==i)return f;e="function"==typeof e?e():e,"undefined"!=typeof g&&g&&(m.className+=" "+(e?"":"no-")+t),f[t]=e}return f},n(""),_=w=null,function(t,e){function i(t,e){var i=t.createElement("p"),n=t.getElementsByTagName("head")[0]||t.documentElement;return i.innerHTML="x<style>"+e+"</style>",n.insertBefore(i.lastChild,n.firstChild)}function n(){var t=_.elements;return"string"==typeof t?t.split(" "):t}function s(t){var e=v[t[g]];return e||(e={},m++,t[g]=m,v[m]=e),e}function r(t,i,n){if(i||(i=e),h)return i.createElement(t);n||(n=s(i));var r;return r=n.cache[t]?n.cache[t].cloneNode():f.test(t)?(n.cache[t]=n.createElem(t)).cloneNode():n.createElem(t),!r.canHaveChildren||p.test(t)||r.tagUrn?r:n.frag.appendChild(r)}function a(t,i){if(t||(t=e),h)return t.createDocumentFragment();i=i||s(t);for(var r=i.frag.cloneNode(),a=0,o=n(),l=o.length;a<l;a++)r.createElement(o[a]);return r}function o(t,e){e.cache||(e.cache={},e.createElem=t.createElement,e.createFrag=t.createDocumentFragment,e.frag=e.createFrag()),t.createElement=function(i){return _.shivMethods?r(i,t,e):e.createElem(i)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+n().join().replace(/[\w\-]+/g,function(t){return e.createElem(t),e.frag.createElement(t),'c("'+t+'")'})+");return n}")(_,e.frag)}function l(t){t||(t=e);var n=s(t);return!_.shivCSS||c||n.hasCSS||(n.hasCSS=!!i(t,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),h||o(t,n),t}var c,h,d="3.7.0",u=t.html5||{},p=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g="_html5shiv",m=0,v={};!function(){try{var t=e.createElement("a");t.innerHTML="<xyz></xyz>",c="hidden"in t,h=1==t.childNodes.length||function(){e.createElement("a");var t=e.createDocumentFragment();return"undefined"==typeof t.cloneNode||"undefined"==typeof t.createDocumentFragment||"undefined"==typeof t.createElement}()}catch(t){c=!0,h=!0}}();var _={elements:u.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:d,shivCSS:u.shivCSS!==!1,supportsUnknownElements:h,shivMethods:u.shivMethods!==!1,type:"default",shivDocument:l,createElement:r,createDocumentFragment:a};t.html5=_,l(e)}(this,e),f._version=p,f._prefixes=k,f._domPrefixes=P,f._cssomPrefixes=S,f.mq=D,f.hasEvent=R,f.testProp=function(t){return o([t])},f.testAllProps=c,f.testStyles=L,f.prefixed=function(t,e,i){return e?c(t,e,i):c(t,"pfx")},m.className=m.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(g?" js "+E.join(" "):""),f}(this,this.document);var Froogaloop=function(){function t(e){return new t.fn.init(e)}function e(t,e,i){if(!i.contentWindow.postMessage)return!1;var n=JSON.stringify({method:t,value:e});i.contentWindow.postMessage(n,c)}function i(t){var e,i;try{e=JSON.parse(t.data),i=e.event||e.method}catch(t){}if("ready"!=i||l||(l=!0),!/^https?:\/\/player.vimeo.com/.test(t.origin))return!1;var n=e.value,r=e.data,a=""===a?null:e.player_id,o=s(i,a),c=[];return!!o&&(void 0!==n&&c.push(n),r&&c.push(r),a&&c.push(a),c.length>0?o.apply(null,c):o.call())}function n(t,e,i){i?(o[i]||(o[i]={}),o[i][t]=e):o[t]=e}function s(t,e){return e?o[e]&&o[e][t]:o[t]}function r(t,e){if(e&&o[e]){if(!o[e][t])return!1;o[e][t]=null}else{if(!o[t])return!1;o[t]=null}return!0}function a(t){return!!(t&&t.constructor&&t.call&&t.apply)}var o={},l=!1,c=(Array.prototype.slice,"*");return t.fn=t.prototype={element:null,init:function(t){return"string"==typeof t&&(t=document.getElementById(t)),this.element=t,this.element?this:null},api:function(t,i){if(!this.element||!t)return!1;var s=this,r=s.element,o=""!==r.id?r.id:null,l=a(i)?null:i,c=a(i)?i:null;return c&&n(t,c,o),e(t,l,r),s},addEvent:function(t,i){if(!this.element)return!1;var s=this,r=s.element,a=""!==r.id?r.id:null;return n(t,i,a),"ready"!=t?e("addEventListener",t,r):"ready"==t&&l&&i.call(null,a),s},removeEvent:function(t){if(!this.element)return!1;var i=this,n=i.element,s=""!==n.id?n.id:null,a=r(t,s);"ready"!=t&&a&&e("removeEventListener",t,n)}},t.fn.init.prototype=t.fn,window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent("onmessage",i),window.Froogaloop=window.$f=t}();/*
 *	jQuery dotdotdot 1.8.1
 *
 *	Copyright (c) Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Licensed under the MIT license.
 *	http://en.wikipedia.org/wiki/MIT_License
 */
!function(t,e){function i(t,e,i){var n=t.children(),s=!1;t.empty();for(var a=0,o=n.length;a<o;a++){var l=n.eq(a);if(t.append(l),i&&t.append(i),r(t,e)){l.remove(),s=!0;break}i&&i.detach()}return s}function n(e,i,a,o,l){var c=!1,h="a, table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",d="script, .dotdotdot-keep";return e.contents().detach().each(function(){var u=this,p=t(u);if("undefined"==typeof u)return!0;if(p.is(d))e.append(p);else{if(c)return!0;e.append(p),!l||p.is(o.after)||p.find(o.after).length||e[e.is(h)?"after":"append"](l),r(a,o)&&(c=3==u.nodeType?s(p,i,a,o,l):n(p,i,a,o,l)),c||l&&l.detach()}}),i.addClass("is-truncated"),c}function s(e,i,n,s,o){var h=e[0];if(!h)return!1;var u=c(h),p=u.indexOf(" ")!==-1?" ":"　",f="letter"==s.wrap?"":p,g=u.split(f),m=-1,v=-1,_=0,y=g.length-1;for(s.fallbackToLetter&&0==_&&0==y&&(f="",g=u.split(f),y=g.length-1);_<=y&&(0!=_||0!=y);){var w=Math.floor((_+y)/2);if(w==v)break;v=w,l(h,g.slice(0,v+1).join(f)+s.ellipsis),n.children().each(function(){t(this).toggle().toggle()}),r(n,s)?(y=v,s.fallbackToLetter&&0==_&&0==y&&(f="",g=g[0].split(f),m=-1,v=-1,_=0,y=g.length-1)):(m=v,_=v)}if(m==-1||1==g.length&&0==g[0].length){var b=e.parent();e.detach();var x=o&&o.closest(b).length?o.length:0;b.contents().length>x?h=d(b.contents().eq(-1-x),i):(h=d(b,i,!0),x||b.detach()),h&&(u=a(c(h),s),l(h,u),x&&o&&t(h).parent().append(o))}else u=a(g.slice(0,m+1).join(f),s),l(h,u);return!0}function r(t,e){return t.innerHeight()>e.maxHeight}function a(e,i){for(;t.inArray(e.slice(-1),i.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),i.lastCharacter.noEllipsis)<0&&(e+=i.ellipsis),e}function o(t){return{width:t.innerWidth(),height:t.innerHeight()}}function l(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function c(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function h(t){do t=t.previousSibling;while(t&&1!==t.nodeType&&3!==t.nodeType);return t}function d(e,i,n){var s,r=e&&e[0];if(r){if(!n){if(3===r.nodeType)return r;if(t.trim(e.text()))return d(e.contents().last(),i)}for(s=h(r);!s;){if(e=e.parent(),e.is(i)||!e.length)return!1;s=h(e[0])}if(s)return d(t(s),i)}return!1}function u(e,i){return!!e&&("string"==typeof e?(e=t(e,i),!!e.length&&e):!!e.jquery&&e)}function p(t){for(var e=t.innerHeight(),i=["paddingTop","paddingBottom"],n=0,s=i.length;n<s;n++){var r=parseInt(t.css(i[n]),10);isNaN(r)&&(r=0),e-=r}return e}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(e){if(0==this.length)return t.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(e)});var s=this,a=s.contents();s.data("dotdotdot")&&s.trigger("destroy.dot"),s.data("dotdotdot-style",s.attr("style")||""),s.css("word-wrap","break-word"),"nowrap"===s.css("white-space")&&s.css("white-space","normal"),s.bind_events=function(){return s.bind("update.dot",function(e,o){switch(s.removeClass("is-truncated"),e.preventDefault(),e.stopPropagation(),typeof l.height){case"number":l.maxHeight=l.height;break;case"function":l.maxHeight=l.height.call(s[0]);break;default:l.maxHeight=p(s)}l.maxHeight+=l.tolerance,"undefined"!=typeof o&&(("string"==typeof o||"nodeType"in o&&1===o.nodeType)&&(o=t("<div />").append(o).contents()),o instanceof t&&(a=o)),g=s.wrapInner('<div class="dotdotdot" />').children(),g.contents().detach().end().append(a.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var h=!1,d=!1;return c.afterElement&&(h=c.afterElement.clone(!0),h.show(),c.afterElement.detach()),r(g,l)&&(d="children"==l.wrap?i(g,l,h):n(g,s,g,l,h)),g.replaceWith(g.contents()),g=null,t.isFunction(l.callback)&&l.callback.call(s[0],d,a),c.isTruncated=d,d}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(s[0],c.isTruncated),c.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(s[0],a),a}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),s.unwatch().unbind_events().contents().detach().end().append(a).attr("style",s.data("dotdotdot-style")||"").removeClass("is-truncated").data("dotdotdot",!1)}),s},s.unbind_events=function(){return s.unbind(".dot"),s},s.watch=function(){if(s.unwatch(),"window"==l.watch){var e=t(window),i=e.width(),n=e.height();e.bind("resize.dot"+c.dotId,function(){i==e.width()&&n==e.height()&&l.windowResizeFix||(i=e.width(),n=e.height(),d&&clearInterval(d),d=setTimeout(function(){s.trigger("update.dot")},100))})}else h=o(s),d=setInterval(function(){if(s.is(":visible")){var t=o(s);h.width==t.width&&h.height==t.height||(s.trigger("update.dot"),h=t)}},500);return s},s.unwatch=function(){return t(window).unbind("resize.dot"+c.dotId),d&&clearInterval(d),s};var l=t.extend(!0,{},t.fn.dotdotdot.defaults,e),c={},h={},d=null,g=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),c.afterElement=u(l.after,s),c.isTruncated=!1,c.dotId=f++,s.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&s.watch(),s},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}},t.fn.dotdotdot.debug=function(t){};var f=1,g=t.fn.html;t.fn.html=function(i){return i!=e&&!t.isFunction(i)&&this.data("dotdotdot")?this.trigger("update",[i]):g.apply(this,arguments)};var m=t.fn.text;t.fn.text=function(i){return i!=e&&!t.isFunction(i)&&this.data("dotdotdot")?(i=t("<div />").text(i).html(),this.trigger("update",[i])):m.apply(this,arguments)}}}(jQuery),jQuery(document).ready(function(t){t(".dot-ellipsis").each(function(){var e=t(this).hasClass("dot-resize-update"),i=t(this).hasClass("dot-timer-update"),n=0,s=t(this).attr("class").split(/\s+/);t.each(s,function(t,e){var i=e.match(/^dot-height-(\d+)$/);null!==i&&(n=Number(i[1]))});var r=new Object;i&&(r.watch=!0),e&&(r.watch="window"),n>0&&(r.height=n),t(this).dotdotdot(r)})}),jQuery(window).load(function(){jQuery(".dot-ellipsis.dot-load-update").trigger("update.dot")});/*
 * Date Format 1.2.3
 * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
 * MIT license
 *
 * Includes enhancements by Scott Trenda <scott.trenda.net>
 * and Kris Kowal <cixar.com/~kris.kowal/>
 *
 * Accepts a date, a mask, or a date and a mask.
 * Returns a formatted version of the given date.
 * The date defaults to the current date/time.
 * The mask defaults to dateFormat.masks.default.
 */
var dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,n=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(s,r,a){var o=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(r=s,s=void 0),s=s?new Date(s):new Date,isNaN(s))throw SyntaxError("invalid date");r=String(o.masks[r]||r||o.masks.default),"UTC:"==r.slice(0,4)&&(r=r.slice(4),a=!0);var l=a?"getUTC":"get",c=s[l+"Date"](),h=s[l+"Day"](),d=s[l+"Month"](),u=s[l+"FullYear"](),p=s[l+"Hours"](),f=s[l+"Minutes"](),g=s[l+"Seconds"](),m=s[l+"Milliseconds"](),v=a?0:s.getTimezoneOffset(),_={d:c,dd:n(c),ddd:o.i18n.dayNames[h],dddd:o.i18n.dayNames[h+7],m:d+1,mm:n(d+1),mmm:o.i18n.monthNames[d],mmmm:o.i18n.monthNames[d+12],yy:String(u).slice(2),yyyy:u,h:p%12||12,hh:n(p%12||12),H:p,HH:n(p),M:f,MM:n(f),s:g,ss:n(g),l:n(m,3),L:n(m>99?Math.round(m/10):m),t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:a?"UTC":(String(s).match(e)||[""]).pop().replace(i,""),o:(v>0?"-":"+")+n(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return r.replace(t,function(t){return t in _?_[t]:t.slice(1,t.length-1)})}}();dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(t,e){return dateFormat(this,t,e)},/*
*   JavaScript interface for the SoundCloud Player widget
*   Author: Matas Petrikas, matas@soundcloud.com
*   Copyright (c) 2009  SoundCloud Ltd.
*   Licensed under the MIT license:
*   http://www.opensource.org/licenses/mit-license.php
*/
function(){var t=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent);window.soundcloud={version:"0.1",debug:!1,_listeners:[],_redispatch:function(t,e,i){var n,s=this._listeners[t]||[],r="soundcloud:"+t;try{n=this.getPlayer(e)}catch(n){return void(this.debug&&window.console&&console.error("unable to dispatch widget event "+t+" for the widget id "+e,i,n))}window.jQuery?jQuery(n).trigger(r,[i]):window.Prototype&&$(n).fire(r,i);for(var a=0,o=s.length;a<o;a+=1)s[a].apply(n,[n,i]);this.debug&&window.console&&console.log(r,t,e,i)},addEventListener:function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)},removeEventListener:function(t,e){for(var i=this._listeners[t]||[],n=0,s=i.length;n<s;n+=1)i[n]===e&&i.splice(n,1)},getPlayer:function(e){var i;try{if(!e)throw"The SoundCloud Widget DOM object needs an id atribute, please refer to SoundCloud Widget API documentation.";if(i=t?window[e]:document[e]){if(i.api_getFlashId)return i;throw"The SoundCloud Widget External Interface is not accessible. Check that allowscriptaccess is set to 'always' in embed code"}throw"The SoundCloud Widget with an id "+e+" couldn't be found"}catch(t){throw console&&console.error&&console.error(t),t}},onPlayerReady:function(t,e){this._redispatch("onPlayerReady",t,e)},onMediaStart:function(t,e){this._redispatch("onMediaStart",t,e)},onMediaEnd:function(t,e){this._redispatch("onMediaEnd",t,e)},onMediaPlay:function(t,e){this._redispatch("onMediaPlay",t,e)},onMediaPause:function(t,e){this._redispatch("onMediaPause",t,e)},onMediaBuffering:function(t,e){this._redispatch("onMediaBuffering",t,e)},onMediaSeek:function(t,e){this._redispatch("onMediaSeek",t,e)},onMediaDoneBuffering:function(t,e){this._redispatch("onMediaDoneBuffering",t,e)},onPlayerError:function(t,e){this._redispatch("onPlayerError",t,e)}}}(),/*
* RetargetMouseScroll JavaScript Library v0.0.2
* 2009-07-30
* By Eli Grey, http://eligrey.com
*
* http://github.com/eligrey/RetargetMouseScroll/tree/master
*
* Licensed under the X11/MIT License
*   See LICENSE.md or http://eligrey.com/blog/about/license
*/
"function"!=typeof this.RetargetMouseScroll&&function(){function t(t,e,i,n){i&&(t.preventDefault?t.preventDefault():event.returnValue=!1);var s=t.detail||-t.wheelDelta/40;s*=19,"number"!=typeof n||isNaN(n)||(s*=n),e.scrollBy?e.scrollBy(0,s):e.scrollTop+=s}var e=["DOMMouseScroll","mousewheel"];this.RetargetMouseScroll=function(i,n,s,r){i||(i=document),n||(n=window),"boolean"!=typeof s&&(s=!0);var a,o,l,c=function(e){e=e||window.event,t(e,n,s,r)};return(a=i.addEventListener)?(a.call(i,e[0],c,!1),a.call(i,e[1],c,!1)):(a=i.attachEvent)&&a.call(i,"on"+e[1],c),(o=i.removeEventListener)?l=function(){o.call(i,e[0],c,!1),o.call(i,e[1],c,!1)}:(o=i.detachEvent)&&(l=function(){o.call(i,"on"+e[1],c)}),{restore:l}}}.call(this),/*!
 * Copyright (c) 2010 Chris O'Hara <cohara87@gmail.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
function(t,e){"function"==typeof define&&define.amd?define(["exports"],e):e("object"==typeof exports?exports:t)}(this,function(t){function e(t){for(var e in p)t=t.replace(p[e],"");return t}function i(){return"!*$^#(@*#&"}function n(t){return t.replace(">","&gt;").replace("<","&lt;").replace("\\","\\\\")}function s(t){var e=/\/\*.*?\*\//g;return t.replace(/\s*[a-z-]+\s*=\s*'[^']*'/gi,function(t){return t.replace(e,"")}).replace(/\s*[a-z-]+\s*=\s*"[^"]*"/gi,function(t){return t.replace(e,"")}).replace(/\s*[a-z-]+\s*=\s*[^\s]+/gi,function(t){return t.replace(e,"")})}function r(t){if(/^(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)$/.test(t)){var e=t.split(".").sort();return!(e[3]>255)}return!1}function a(t){return!!/^::|^::1|^([a-fA-F0-9]{1,4}::?){1,7}([a-fA-F0-9]{1,4})$/.test(t)}function o(t){if(t instanceof Date)return t;var e=Date.parse(t);return isNaN(e)?null:new Date(e)}var l={"&nbsp;":" ","&iexcl;":"¡","&cent;":"¢","&pound;":"£","&curren;":"€","&yen;":"¥","&brvbar;":"Š","&sect;":"§","&uml;":"š","&copy;":"©","&ordf;":"ª","&laquo;":"«","&not;":"¬","&shy;":"­","&reg;":"®","&macr;":"¯","&deg;":"°","&plusmn;":"±","&sup2;":"²","&sup3;":"³","&acute;":"Ž","&micro;":"µ","&para;":"¶","&middot;":"·","&cedil;":"ž","&sup1;":"¹","&ordm;":"º","&raquo;":"»","&frac14;":"Œ","&frac12;":"œ","&frac34;":"Ÿ","&iquest;":"¿","&Agrave;":"À","&Aacute;":"Á","&Acirc;":"Â","&Atilde;":"Ã","&Auml;":"Ä","&Aring;":"Å","&AElig;":"Æ","&Ccedil;":"Ç","&Egrave;":"È","&Eacute;":"É","&Ecirc;":"Ê","&Euml;":"Ë","&Igrave;":"Ì","&Iacute;":"Í","&Icirc;":"Î","&Iuml;":"Ï","&ETH;":"Ð","&Ntilde;":"Ñ","&Ograve;":"Ò","&Oacute;":"Ó","&Ocirc;":"Ô","&Otilde;":"Õ","&Ouml;":"Ö","&times;":"×","&Oslash;":"Ø","&Ugrave;":"Ù","&Uacute;":"Ú","&Ucirc;":"Û","&Uuml;":"Ü","&Yacute;":"Ý","&THORN;":"Þ","&szlig;":"ß","&agrave;":"à","&aacute;":"á","&acirc;":"â","&atilde;":"ã","&auml;":"ä","&aring;":"å","&aelig;":"æ","&ccedil;":"ç","&egrave;":"è","&eacute;":"é","&ecirc;":"ê","&euml;":"ë","&igrave;":"ì","&iacute;":"í","&icirc;":"î","&iuml;":"ï","&eth;":"ð","&ntilde;":"ñ","&ograve;":"ò","&oacute;":"ó","&ocirc;":"ô","&otilde;":"õ","&ouml;":"ö","&divide;":"÷","&oslash;":"ø","&ugrave;":"ù","&uacute;":"ú","&ucirc;":"û","&uuml;":"ü","&yacute;":"ý","&thorn;":"þ","&yuml;":"ÿ","&quot;":'"',"&lt;":"<","&gt;":">","&apos;":"'","&minus;":"−","&circ;":"ˆ","&tilde;":"˜","&Scaron;":"Š","&lsaquo;":"‹","&OElig;":"Œ","&lsquo;":"‘","&rsquo;":"’","&ldquo;":"“","&rdquo;":"”","&bull;":"•","&ndash;":"–","&mdash;":"—","&trade;":"™","&scaron;":"š","&rsaquo;":"›","&oelig;":"œ","&Yuml;":"Ÿ","&fnof;":"ƒ","&Alpha;":"Α","&Beta;":"Β","&Gamma;":"Γ","&Delta;":"Δ","&Epsilon;":"Ε","&Zeta;":"Ζ","&Eta;":"Η","&Theta;":"Θ","&Iota;":"Ι","&Kappa;":"Κ","&Lambda;":"Λ","&Mu;":"Μ","&Nu;":"Ν","&Xi;":"Ξ","&Omicron;":"Ο","&Pi;":"Π","&Rho;":"Ρ","&Sigma;":"Σ","&Tau;":"Τ","&Upsilon;":"Υ","&Phi;":"Φ","&Chi;":"Χ","&Psi;":"Ψ","&Omega;":"Ω","&alpha;":"α","&beta;":"β","&gamma;":"γ","&delta;":"δ","&epsilon;":"ε","&zeta;":"ζ","&eta;":"η","&theta;":"θ","&iota;":"ι","&kappa;":"κ","&lambda;":"λ","&mu;":"μ","&nu;":"ν","&xi;":"ξ","&omicron;":"ο","&pi;":"π","&rho;":"ρ","&sigmaf;":"ς","&sigma;":"σ","&tau;":"τ","&upsilon;":"υ","&phi;":"φ","&chi;":"χ","&psi;":"ψ","&omega;":"ω","&thetasym;":"ϑ","&upsih;":"ϒ","&piv;":"ϖ","&ensp;":" ","&emsp;":" ","&thinsp;":" ","&zwnj;":"‌","&zwj;":"‍","&lrm;":"‎","&rlm;":"‏","&sbquo;":"‚","&bdquo;":"„","&dagger;":"†","&Dagger;":"‡","&hellip;":"…","&permil;":"‰","&prime;":"′","&Prime;":"″","&oline;":"‾","&frasl;":"⁄","&euro;":"€","&image;":"ℑ","&weierp;":"℘","&real;":"ℜ","&alefsym;":"ℵ","&larr;":"←","&uarr;":"↑","&rarr;":"→","&darr;":"↓","&harr;":"↔","&crarr;":"↵","&lArr;":"⇐","&uArr;":"⇑","&rArr;":"⇒","&dArr;":"⇓","&hArr;":"⇔","&forall;":"∀","&part;":"∂","&exist;":"∃","&empty;":"∅","&nabla;":"∇","&isin;":"∈","&notin;":"∉","&ni;":"∋","&prod;":"∏","&sum;":"∑","&lowast;":"∗","&radic;":"√","&prop;":"∝","&infin;":"∞","&ang;":"∠","&and;":"∧","&or;":"∨","&cap;":"∩","&cup;":"∪","&int;":"∫","&there4;":"∴","&sim;":"∼","&cong;":"≅","&asymp;":"≈","&ne;":"≠","&equiv;":"≡","&le;":"≤","&ge;":"≥","&sub;":"⊂","&sup;":"⊃","&nsub;":"⊄","&sube;":"⊆","&supe;":"⊇","&oplus;":"⊕","&otimes;":"⊗","&perp;":"⊥","&sdot;":"⋅","&lceil;":"⌈","&rceil;":"⌉","&lfloor;":"⌊","&rfloor;":"⌋","&lang;":"〈","&rang;":"〉","&loz;":"◊","&spades;":"♠","&clubs;":"♣","&hearts;":"♥","&diams;":"♦"},c=function(t){if(!~t.indexOf("&"))return t;for(var e in l)t=t.replace(new RegExp(e,"g"),l[e]);return t=t.replace(/&#x(0*[0-9a-f]{2,5});?/gi,function(t,e){return String.fromCharCode(parseInt(+e,16))}),t=t.replace(/&#([0-9]{2,4});?/gi,function(t,e){return String.fromCharCode(+e)}),t=t.replace(/&amp;/g,"&")},h=function(t){t=t.replace(/&/g,"&amp;"),t=t.replace(/'/g,"&#39;");for(var e in l)t=t.replace(new RegExp(l[e],"g"),e);return t};t.entities={encode:h,decode:c};
//The license is available at http://codeigniter.com/
var d={"document.cookie":"","document.write":"",".parentNode":"",".innerHTML":"","window.location":"","-moz-binding":"","<!--":"&lt;!--","-->":"--&gt;","<![CDATA[":"&lt;![CDATA["},u={"javascript\\s*:":"","expression\\s*(\\(|&\\#40;)":"","vbscript\\s*:":"","Redirect\\s+302":""},p=[/%0[0-8bcef]/g,/%1[0-9a-f]/g,/[\x00-\x08]/g,/\x0b/g,/\x0c/g,/[\x0e-\x1f]/g],f=["javascript","expression","vbscript","script","applet","alert","document","write","cookie","window"];t.xssClean=function(r,a){if("object"==typeof r){for(var o in r)r[o]=t.xssClean(r[o]);return r}r=e(r),r=r.replace(/\&([a-z\_0-9]+)\=([a-z\_0-9]+)/i,i()+"$1=$2"),r=r.replace(/(&\#?[0-9a-z]{2,})([\x00-\x20])*;?/i,"$1;$2"),r=r.replace(/(&\#x?)([0-9A-F]+);?/i,"$1;$2"),r=r.replace(i(),"&");try{r=decodeURIComponent(r)}catch(t){}r=r.replace(/[a-z]+=([\'\"]).*?\1/gi,function(t,e){return t.replace(e,n(e))}),r=e(r),r=r.replace("\t"," ");var l=r;for(var o in d)r=r.replace(o,d[o]);for(var o in u)r=r.replace(new RegExp(o,"i"),u[o]);for(var o in f){var c=f[o].split("").join("\\s*")+"\\s*";r=r.replace(new RegExp("("+c+")(\\W)","ig"),function(t,e,i){return e.replace(/\s+/g,"")+i})}do{var h=r;r.match(/<a/i)&&(r=r.replace(/<a\s+([^>]*?)(>|$)/gi,function(t,e,i){return e=s(e.replace("<","").replace(">","")),t.replace(e,e.replace(/href=.*?(alert\(|alert&\#40;|javascript\:|charset\=|window\.|document\.|\.cookie|<script|<xss|base64\s*,)/gi,""))})),r.match(/<img/i)&&(r=r.replace(/<img\s+([^>]*?)(\s?\/?>|$)/gi,function(t,e,i){return e=s(e.replace("<","").replace(">","")),t.replace(e,e.replace(/src=.*?(alert\(|alert&\#40;|javascript\:|charset\=|window\.|document\.|\.cookie|<script|<xss|base64\s*,)/gi,""))})),(r.match(/script/i)||r.match(/xss/i))&&(r=r.replace(/<(\/*)(script|xss)(.*?)\>/gi,""))}while(h!=r);event_handlers=["[^a-z_-]on\\w*"],a||event_handlers.push("xmlns"),r=r.replace(new RegExp("<([^><]+?)("+event_handlers.join("|")+")(\\s*=\\s*[^><]*)([><]*)","i"),"<$1$4"),naughty="alert|applet|audio|basefont|base|behavior|bgsound|blink|body|embed|expression|form|frameset|frame|head|html|ilayer|iframe|input|isindex|layer|link|meta|object|plaintext|style|script|textarea|title|video|xml|xss",r=r.replace(new RegExp("<(/*\\s*)("+naughty+")([^><]*)([><]*)","gi"),function(t,e,i,n,s){return"&lt;"+e+i+n+s.replace(">","&gt;").replace("<","&lt;")}),r=r.replace(/(alert|cmd|passthru|eval|exec|expression|system|fopen|fsockopen|file|file_get_contents|readfile|unlink)(\s*)\((.*?)\)/gi,"$1$2&#40;$3&#41;");for(var o in d)r=r.replace(o,d[o]);for(var o in u)r=r.replace(new RegExp(o,"i"),u[o]);if(a&&r!==l)throw new Error("Image may contain XSS");return r};var g=t.Validator=function(){};g.prototype.check=function(t,e){return this.str="undefined"==typeof t||null===t||isNaN(t)&&void 0===t.length?"":t+"",this.msg=e,this._errors=this._errors||[],this},g.prototype.validate=g.prototype.check,g.prototype.assert=g.prototype.check,g.prototype.error=function(t){throw new Error(t)},g.prototype.isAfter=function(t){t=t||new Date;var e=o(this.str),i=o(t);return e&&i&&e>=i?this:this.error(this.msg||"Invalid date")},g.prototype.isBefore=function(t){t=t||new Date;var e=o(this.str),i=o(t);return e&&i&&e<=i?this:this.error(this.msg||"Invalid date")},g.prototype.isEmail=function(){return this.str.match(/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/)?this:this.error(this.msg||"Invalid email")},g.prototype.isCreditCard=function(){if(this.str=this.str.replace(/[^0-9]+/g,""),!this.str.match(/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/))return this.error(this.msg||"Invalid credit card");for(var t,e,i=0,n=!1,s=this.length-1;s>=0;s--)t=this.substring(s,s+1),e=parseInt(t,10),n?(e*=2,i+=e>=10?e%10+1:e):i+=e,n=!n;return i%10!==0?this.error(this.msg||"Invalid credit card"):this},g.prototype.isUrl=function(){return!this.str.match(/^(?!mailto:)(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?:(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))|localhost)(?::\d{2,5})?(?:\/[^\s]*)?$/i)||this.str.length>2083?this.error(this.msg||"Invalid URL"):this},g.prototype.isIPv4=function(){return r(this.str)?this:this.error(this.msg||"Invalid IP")},g.prototype.isIPv6=function(){return a(this.str)?this:this.error(this.msg||"Invalid IP")},g.prototype.isIP=function(){return r(this.str)||a(this.str)?this:this.error(this.msg||"Invalid IP")},g.prototype.isAlpha=function(){return this.str.match(/^[a-zA-Z]+$/)?this:this.error(this.msg||"Invalid characters")},g.prototype.isAlphanumeric=function(){return this.str.match(/^[a-zA-Z0-9]+$/)?this:this.error(this.msg||"Invalid characters")},g.prototype.isNumeric=function(){return this.str.match(/^-?[0-9]+$/)?this:this.error(this.msg||"Invalid number")},g.prototype.isHexadecimal=function(){return this.str.match(/^[0-9a-fA-F]+$/)?this:this.error(this.msg||"Invalid hexadecimal")},g.prototype.isHexColor=function(){return this.str.match(/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/)?this:this.error(this.msg||"Invalid hexcolor")},g.prototype.isLowercase=function(){return this.str!==this.str.toLowerCase()?this.error(this.msg||"Invalid characters"):this},g.prototype.isUppercase=function(){return this.str!==this.str.toUpperCase()?this.error(this.msg||"Invalid characters"):this},g.prototype.isInt=function(){return this.str.match(/^(?:-?(?:0|[1-9][0-9]*))$/)?this:this.error(this.msg||"Invalid integer")},g.prototype.isDecimal=function(){return this.str.match(/^(?:-?(?:0|[1-9][0-9]*))?(?:\.[0-9]*)?$/)?this:this.error(this.msg||"Invalid decimal")},g.prototype.isDivisibleBy=function(t){return parseFloat(this.str)%parseInt(t,10)===0},g.prototype.isFloat=function(){return this.isDecimal()},g.prototype.notNull=function(){return""===this.str?this.error(this.msg||"String is empty"):this},g.prototype.isNull=function(){return""!==this.str?this.error(this.msg||"String is not empty"):this},g.prototype.notEmpty=function(){return this.str.match(/^[\s\t\r\n]*$/)?this.error(this.msg||"String is whitespace"):this},g.prototype.equals=function(t){return this.str!=t?this.error(this.msg||"Not equal"):this},g.prototype.contains=function(t){return this.str.indexOf(t)!==-1&&t?this:this.error(this.msg||"Invalid characters")},g.prototype.notContains=function(t){return this.str.indexOf(t)>=0?this.error(this.msg||"Invalid characters"):this},g.prototype.regex=g.prototype.is=function(t,e){return"RegExp"!==Object.prototype.toString.call(t).slice(8,-1)&&(t=new RegExp(t,e)),this.str.match(t)?this:this.error(this.msg||"Invalid characters")},g.prototype.notRegex=g.prototype.not=function(t,e){return"RegExp"!==Object.prototype.toString.call(t).slice(8,-1)&&(t=new RegExp(t,e)),this.str.match(t)&&this.error(this.msg||"Invalid characters"),this},g.prototype.len=function(t,e){return this.str.length<t?this.error(this.msg||"String is too small"):void 0!==typeof e&&this.str.length>e?this.error(this.msg||"String is too large"):this},g.prototype.isUUID=function(t){var e;return e=3==t||"v3"==t?/[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i:4==t||"v4"==t?/[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i:5==t||"v5"==t?/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i:/[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,this.str.match(e)?this:this.error(this.msg||"Not a UUID")},g.prototype.isUUIDv3=function(){return this.isUUID(3)},g.prototype.isUUIDv4=function(){return this.isUUID(4)},g.prototype.isUUIDv5=function(){return this.isUUID(5)},g.prototype.isDate=function(){var t=Date.parse(this.str);return isNaN(t)?this.error(this.msg||"Not a date"):this},g.prototype.isIn=function(t){return t&&"function"==typeof t.indexOf?~t.indexOf(this.str)?this:this.error(this.msg||"Unexpected value"):this.error(this.msg||"Invalid in() argument")},g.prototype.notIn=function(t){return t&&"function"==typeof t.indexOf?t.indexOf(this.str)!==-1?this.error(this.msg||"Unexpected value"):this:this.error(this.msg||"Invalid notIn() argument")},g.prototype.min=function(t){var e=parseFloat(this.str);return!isNaN(e)&&e<t?this.error(this.msg||"Invalid number"):this},g.prototype.max=function(t){var e=parseFloat(this.str);return!isNaN(e)&&e>t?this.error(this.msg||"Invalid number"):this};var m=t.Filter=function(){},v="\\r\\n\\t\\s";return m.prototype.modify=function(t){this.str=t},m.prototype.convert=m.prototype.sanitize=function(t){return this.str=null==t?"":t+"",this},m.prototype.xss=function(e){return this.modify(t.xssClean(this.str,e)),this.str},m.prototype.entityDecode=function(){return this.modify(c(this.str)),this.str},m.prototype.entityEncode=function(){return this.modify(h(this.str)),this.str},m.prototype.escape=function(){return this.modify(this.str.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),this.str},m.prototype.ltrim=function(t){return t=t||v,this.modify(this.str.replace(new RegExp("^["+t+"]+","g"),"")),this.str},m.prototype.rtrim=function(t){return t=t||v,this.modify(this.str.replace(new RegExp("["+t+"]+$","g"),"")),this.str},m.prototype.trim=function(t){return t=t||v,this.modify(this.str.replace(new RegExp("^["+t+"]+|["+t+"]+$","g"),"")),this.str},m.prototype.ifNull=function(t){return this.str&&""!==this.str||this.modify(t),this.str},m.prototype.toFloat=function(){return this.modify(parseFloat(this.str)),this.str},m.prototype.toInt=function(t){return t=t||10,this.modify(parseInt(this.str,t)),this.str},m.prototype.toBoolean=function(){return this.str&&"0"!=this.str&&"false"!=this.str&&""!=this.str?this.modify(!0):this.modify(!1),this.str},m.prototype.toBooleanStrict=function(){return"1"==this.str||"true"==this.str?this.modify(!0):this.modify(!1),this.str},t.sanitize=t.convert=function(e){var i=new t.Filter;return i.sanitize(e)},t.check=t.validate=t.assert=function(e,i){var n=new t.Validator;return n.check(e,i)},t}),function(t,e){"use strict";var i="0.7.10",n="",s="?",r="function",a="undefined",o="object",l="string",c="major",h="model",d="name",u="type",p="vendor",f="version",g="architecture",m="console",v="mobile",_="tablet",y="smarttv",w="wearable",b="embedded",x={extend:function(t,e){var i={};for(var n in t)e[n]&&e[n].length%2===0?i[n]=e[n].concat(t[n]):i[n]=t[n];return i},has:function(t,e){return"string"==typeof t&&e.toLowerCase().indexOf(t.toLowerCase())!==-1},lowerize:function(t){return t.toLowerCase()},major:function(t){return typeof t===l?t.split(".")[0]:e}},k={rgx:function(){for(var t,i,n,s,l,c,h,d=0,u=arguments;d<u.length&&!c;){var p=u[d],f=u[d+1];if(typeof t===a){t={};for(s in f)f.hasOwnProperty(s)&&(l=f[s],typeof l===o?t[l[0]]=e:t[l]=e)}for(i=n=0;i<p.length&&!c;)if(c=p[i++].exec(this.getUA()))for(s=0;s<f.length;s++)h=c[++n],l=f[s],typeof l===o&&l.length>0?2==l.length?typeof l[1]==r?t[l[0]]=l[1].call(this,h):t[l[0]]=l[1]:3==l.length?typeof l[1]!==r||l[1].exec&&l[1].test?t[l[0]]=h?h.replace(l[1],l[2]):e:t[l[0]]=h?l[1].call(this,h,l[2]):e:4==l.length&&(t[l[0]]=h?l[3].call(this,h.replace(l[1],l[2])):e):t[l]=h?h:e;d+=2}return t},str:function(t,i){for(var n in i)if(typeof i[n]===o&&i[n].length>0){for(var r=0;r<i[n].length;r++)if(x.has(i[n][r],t))return n===s?e:n}else if(x.has(i[n],t))return n===s?e:n;return t}},T={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},S={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[d,f],[/(OPiOS)[\/\s]+([\w\.]+)/i],[[d,"Opera Mini"],f],[/\s(opr)\/([\w\.]+)/i],[[d,"Opera"],f],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[d,f],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[d,"IE"],f],[/(edge)\/((\d+)?[\w\.]+)/i],[d,f],[/(yabrowser)\/([\w\.]+)/i],[[d,"Yandex"],f],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],f],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[d,f],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/JUC.+(ucweb)[\/\s]?([\w\.]+)/i],[[d,"UCBrowser"],f],[/(dolfin)\/([\w\.]+)/i],[[d,"Dolphin"],f],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[d,"Chrome"],f],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[f,[d,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[f,[d,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[f,[d,"Facebook"]],[/fxios\/([\w\.-]+)/i],[f,[d,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[f,[d,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[f,d],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[d,[f,k.str,T.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[d,f],[/(navigator|netscape)\/([\w\.-]+)/i],[[d,"Netscape"],f],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[d,f]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,x.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[g,/ower/,"",x.lowerize]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[g,x.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[h,p,[u,_]],[/applecoremedia\/[\w\.]+ \((ipad)/],[h,[p,"Apple"],[u,_]],[/(apple\s{0,1}tv)/i],[[h,"Apple TV"],[p,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[p,h,[u,_]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[h,[p,"Amazon"],[u,_]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[h,k.str,T.device.amazon.model],[p,"Amazon"],[u,v]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[h,p,[u,v]],[/\((ip[honed|\s\w*]+);/i],[h,[p,"Apple"],[u,v]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[p,h,[u,v]],[/\(bb10;\s(\w+)/i],[h,[p,"BlackBerry"],[u,v]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[h,[p,"Asus"],[u,_]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[p,"Sony"],[h,"Xperia Tablet"],[u,_]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[p,"Sony"],[h,"Xperia Phone"],[u,v]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[p,h,[u,m]],[/android.+;\s(shield)\sbuild/i],[h,[p,"Nvidia"],[u,m]],[/(playstation\s[34portablevi]+)/i],[h,[p,"Sony"],[u,m]],[/(sprint\s(\w+))/i],[[p,k.str,T.device.sprint.vendor],[h,k.str,T.device.sprint.model],[u,v]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[p,h,[u,_]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[p,[h,/_/g," "],[u,v]],[/(nexus\s9)/i],[h,[p,"HTC"],[u,_]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[h,[p,"Microsoft"],[u,m]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[p,"Microsoft"],[u,v]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s[6])/i],[h,[p,"Motorola"],[u,v]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[h,[p,"Motorola"],[u,_]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[p,"Samsung"],h,[u,_]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[p,"Samsung"],h,[u,v]],[/(samsung);smarttv/i],[p,h,[u,y]],[/\(dtv[\);].+(aquos)/i],[h,[p,"Sharp"],[u,y]],[/sie-(\w+)*/i],[h,[p,"Siemens"],[u,v]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[p,"Nokia"],h,[u,v]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[h,[p,"Acer"],[u,_]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[p,"LG"],h,[u,_]],[/(lg) netcast\.tv/i],[p,h,[u,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[h,[p,"LG"],[u,v]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[h,[p,"Lenovo"],[u,_]],[/linux;.+((jolla));/i],[p,h,[u,v]],[/((pebble))app\/[\d\.]+\s/i],[p,h,[u,w]],[/android.+;\s(glass)\s\d/i],[h,[p,"Google"],[u,w]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[h,/_/g," "],[p,"Xiaomi"],[u,v]],[/\s(tablet)[;\/\s]/i,/\s(mobile)[;\/\s]/i],[[u,x.lowerize],p,h]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[f,[d,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[d,f],[/rv\:([\w\.]+).*(gecko)/i],[f,d]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[d,f],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[d,[f,k.str,T.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[d,"Windows"],[f,k.str,T.os.windows.version]],[/\((bb)(10);/i],[[d,"BlackBerry"],f],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[d,f],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[d,"Symbian"],f],[/\((series40);/i],[d],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[d,"Firefox OS"],f],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[d,f],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[d,"Chromium OS"],f],[/(sunos)\s?([\w\.]+\d)*/i],[[d,"Solaris"],f],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[d,f],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[d,"iOS"],[f,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[d,"Mac OS"],[f,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[d,f]]},P=function(e,i){if(!(this instanceof P))return new P(e,i).getResult();var s=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:n),r=i?x.extend(S,i):S;return this.getBrowser=function(){var t=k.rgx.apply(this,r.browser);return t.major=x.major(t.version),t},this.getCPU=function(){return k.rgx.apply(this,r.cpu)},this.getDevice=function(){return k.rgx.apply(this,r.device)},this.getEngine=function(){return k.rgx.apply(this,r.engine)},this.getOS=function(){return k.rgx.apply(this,r.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return s},this.setUA=function(t){return s=t,this},this};P.VERSION=i,P.BROWSER={NAME:d,MAJOR:c,VERSION:f},P.CPU={ARCHITECTURE:g},P.DEVICE={MODEL:h,VENDOR:p,TYPE:u,CONSOLE:m,MOBILE:v,SMARTTV:y,TABLET:_,WEARABLE:w,EMBEDDED:b},P.ENGINE={NAME:d,VERSION:f},P.OS={NAME:d,VERSION:f},typeof exports!==a?(typeof module!==a&&module.exports&&(exports=module.exports=P),exports.UAParser=P):typeof define===r&&define.amd?define("ua-parser-js",[],function(){return P}):t.UAParser=P;var C=t.jQuery||t.Zepto;if(typeof C!==a){var $=new P;C.ua=$.getResult(),C.ua.get=function(){return $.getUA()},C.ua.set=function(t){$.setUA(t);var e=$.getResult();for(var i in e)C.ua[i]=e[i]}}}("object"==typeof window?window:this),function(){function t(t,o){t=t||"",o=o||{};for(var l in e)e.hasOwnProperty(l)&&(o.autoFix&&(o["fix_"+l]=!0),o.fix=o.fix||o["fix_"+l]);var c=[],h=document.createElement("div"),d=function(t){return"string"==typeof t&&t.indexOf("&")!==-1?(h.innerHTML=t,h.textContent||h.innerText||t):t},u=function(e){t+=e},p=function(e){t=e+t},f={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},g={comment:function(){var e=t.indexOf("-->");if(e>=0)return{content:t.substr(4,e-1),length:e+3}},endTag:function(){var e=t.match(n);if(e)return{tagName:e[1],length:e[0].length}},atomicTag:function(){var e=g.startTag();if(e){var i=t.slice(e.length);if(i.match(new RegExp("</\\s*"+e.tagName+"\\s*>","i"))){var n=i.match(new RegExp("([\\s\\S]*?)</\\s*"+e.tagName+"\\s*>","i"));if(n)return{tagName:e.tagName,attrs:e.attrs,content:n[1],length:n[0].length+e.length}}}},startTag:function(){var e=t.indexOf(">");if(e===-1)return null;var n=t.match(i);if(n){var a={},o={},l=n[2];return n[2].replace(s,function(t,e){if(arguments[2]||arguments[3]||arguments[4]||arguments[5])if(arguments[5])a[arguments[5]]="",o[e]=!0;else{var i=arguments[2]||arguments[3]||arguments[4]||r.test(e)&&e||"";a[e]=d(i)}else a[e]=null;l=l.replace(t,"")}),{tagName:n[1],attrs:a,booleanAttrs:o,rest:l,unary:!!n[3],length:n[0].length}}},chars:function(){var e=t.indexOf("<");return{length:e>=0?e:t.length}}},m=function(){for(var e in f)if(f[e].test(t)){a&&console.log("suspected "+e);var i=g[e]();return i?(a&&console.log("parsed "+e,i),i.type=i.type||e,i.text=t.substr(0,i.length),t=t.slice(i.length),i):null}},v=function(t){for(var e;e=m();)if(t[e.type]&&t[e.type](e)===!1)return},_=function(){var e=t;return t="",e},y=function(){return t};return o.fix&&!function(){var e=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,i=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i,n=[];n.last=function(){return this[this.length-1]},n.lastTagNameEq=function(t){var e=this.last();return e&&e.tagName&&e.tagName.toUpperCase()===t.toUpperCase()},n.containsTagName=function(t){for(var e,i=0;e=this[i];i++)if(e.tagName===t)return!0;return!1};var s=function(t){return t&&"startTag"===t.type&&(t.unary=e.test(t.tagName)||t.unary,t.html5Unary=!/\/>$/.test(t.text)),t},r=m,a=function(){var e=t,i=s(r());return t=e,i},l=function(){var t=n.pop();p("</"+t.tagName+">")},c={startTag:function(t){var e=t.tagName;"TR"===e.toUpperCase()&&n.lastTagNameEq("TABLE")?(p("<TBODY>"),d()):o.fix_selfClose&&i.test(e)&&n.containsTagName(e)?n.lastTagNameEq(e)?l():(p("</"+t.tagName+">"),d()):t.unary||n.push(t)},endTag:function(t){var e=n.last();e?o.fix_tagSoup&&!n.lastTagNameEq(t.tagName)?l():n.pop():o.fix_tagSoup&&h()}},h=function(){r(),d()},d=function(){var t=a();t&&c[t.type]&&c[t.type](t)};m=function(){return d(),s(r())}}(),{append:u,readToken:m,readTokens:v,clear:_,rest:y,stack:c}}var e=function(){var t,e={},i=this.document.createElement("div");return t="<P><I></P></I>",i.innerHTML=t,e.tagSoup=i.innerHTML!==t,i.innerHTML="<P><i><P></P></i></P>",e.selfClose=2===i.childNodes.length,e}(),i=/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,n=/^<\/([\-A-Za-z0-9_]+)[^>]*>/,s=/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,r=/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i,a=!1;t.supports=e,t.tokenToString=function(t){var e={comment:function(t){return"<!--"+t.content},endTag:function(t){return"</"+t.tagName+">"},atomicTag:function(t){return a&&console.log(t),e.startTag(t)+t.content+e.endTag(t)},startTag:function(t){var e="<"+t.tagName;for(var i in t.attrs){e+=" "+i;var n=t.attrs[i];"undefined"!=typeof t.booleanAttrs&&"undefined"!=typeof t.booleanAttrs[i]||(e+='="'+(n?n.replace(/(^|[^\\])"/g,'$1\\"'):"")+'"')}return t.rest&&(e+=t.rest),e+(t.unary&&!t.html5Unary?"/>":">")},chars:function(t){return t.text}};return e[t.type](t)},t.escapeAttributes=function(t){var e={};for(var i in t){var n=t[i];e[i]=n&&n.replace(/(^|[^\\])"/g,'$1\\"')}return e};for(var o in e)t.browserHasFlaw=t.browserHasFlaw||!e[o]&&o;this.htmlParser=t}(),
//     postscribe is freely distributable under the MIT license.
function(){function t(){}function e(t){return t!==u&&null!==t}function i(t){return"function"==typeof t}function n(t,e,i){var n,s=t&&t.length||0;for(n=0;n<s;n++)e.call(i,t[n],n)}function s(t,e,i){var n;for(n in t)t.hasOwnProperty(n)&&e.call(i,n,t[n])}function r(t,e){return s(e,function(e,i){t[e]=i}),t}function a(t,i){return t=t||{},s(i,function(i,n){e(t[i])||(t[i]=n)}),t}function o(t){try{return f.call(t)}catch(i){var e=[];return n(t,function(t){e.push(t)}),e}}function l(t){return!!(t&&"tagName"in t)&&!!~t.tagName.toLowerCase().indexOf("script")}function c(t){return!!(t&&"tagName"in t)&&!!~t.tagName.toLowerCase().indexOf("style")}var h={afterAsync:t,afterDequeue:t,afterStreamStart:t,afterWrite:t,autoFix:!0,beforeEnqueue:t,beforeWriteToken:function(t){return t},beforeWrite:function(t){return t},done:t,error:function(t){throw t},releaseAsync:!1},d=this,u=void 0;if(!d.postscribe){var p=!1,f=Array.prototype.slice,g=function(t){return t[t.length-1]},m=function(){function t(t,i,n){var s=h+i;if(2===arguments.length){var r=t.getAttribute(s);return e(r)?String(r):r}e(n)&&""!==n?t.setAttribute(s,n):t.removeAttribute(s)}function a(e,i){var n=e.ownerDocument;r(this,{root:e,options:i,win:n.defaultView||n.parentWindow,doc:n,parser:htmlParser("",{autoFix:i.autoFix}),actuals:[e],proxyHistory:"",proxyRoot:n.createElement(e.nodeName),scriptStack:[],writeQueue:[]}),t(this.proxyRoot,"proxyof",0)}var h="data-ps-";return a.prototype.write=function(){[].push.apply(this.writeQueue,arguments);for(var t;!this.deferredRemote&&this.writeQueue.length;)t=this.writeQueue.shift(),i(t)?this.callFunction(t):this.writeImpl(t)},a.prototype.callFunction=function(t){var e={type:"function",value:t.name||t.toString()};this.onScriptStart(e),t.call(this.win,this.doc),this.onScriptDone(e)},a.prototype.writeImpl=function(t){this.parser.append(t);for(var e,i,n,s=[];(e=this.parser.readToken())&&!(i=l(e))&&!(n=c(e));)e=this.options.beforeWriteToken(e),e&&s.push(e);this.writeStaticTokens(s),i&&this.handleScriptToken(e),n&&this.handleStyleToken(e)},a.prototype.writeStaticTokens=function(t){var e=this.buildChunk(t);if(e.actual)return e.html=this.proxyHistory+e.actual,this.proxyHistory+=e.proxy,this.proxyRoot.innerHTML=e.html,p&&(e.proxyInnerHTML=this.proxyRoot.innerHTML),this.walkChunk(),p&&(e.actualInnerHTML=this.root.innerHTML),e},a.prototype.buildChunk=function(t){var e=this.actuals.length,i=[],s=[],r=[];return n(t,function(t){var n=htmlParser.tokenToString(t);if(i.push(n),t.attrs){if(!/^noscript$/i.test(t.tagName)){var a=e++;s.push(n.replace(/(\/?>)/," "+h+"id="+a+" $1")),"ps-script"!==t.attrs.id&&"ps-style"!==t.attrs.id&&r.push("atomicTag"===t.type?"":"<"+t.tagName+" "+h+"proxyof="+a+(t.unary?" />":">"))}}else s.push(n),r.push("endTag"===t.type?n:"")}),{tokens:t,raw:i.join(""),actual:s.join(""),proxy:r.join("")}},a.prototype.walkChunk=function(){for(var i,n=[this.proxyRoot];e(i=n.shift());){var s=1===i.nodeType,r=s&&t(i,"proxyof");if(!r){s&&(this.actuals[t(i,"id")]=i,t(i,"id",null));var a=i.parentNode&&t(i.parentNode,"proxyof");a&&this.actuals[a].appendChild(i)}n.unshift.apply(n,o(i.childNodes))}},a.prototype.handleScriptToken=function(t){var e=this.parser.clear();if(e&&this.writeQueue.unshift(e),t.src=t.attrs.src||t.attrs.SRC,t=this.options.beforeWriteToken(t)){t.src&&this.scriptStack.length?this.deferredRemote=t:this.onScriptStart(t);var i=this;this.writeScriptToken(t,function(){i.onScriptDone(t)})}},a.prototype.handleStyleToken=function(t){var e=this.parser.clear();e&&this.writeQueue.unshift(e),t.type=t.attrs.type||t.attrs.TYPE||"text/css",t=this.options.beforeWriteToken(t),t&&this.writeStyleToken(t),e&&this.write()},a.prototype.writeStyleToken=function(t){var e=this.buildStyle(t);this.insertStyle(e),t.content&&(e.styleSheet&&!e.sheet?e.styleSheet.cssText=t.content:e.appendChild(this.doc.createTextNode(t.content)))},a.prototype.buildStyle=function(t){var e=this.doc.createElement(t.tagName);return e.setAttribute("type",t.type),s(t.attrs,function(t,i){e.setAttribute(t,i)}),e},a.prototype.insertStyle=function(t){this.writeImpl('<span id="ps-style"/>');var e=this.doc.getElementById("ps-style");e.parentNode.replaceChild(t,e)},a.prototype.onScriptStart=function(t){t.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(t)},a.prototype.onScriptDone=function(t){return t!==this.scriptStack[0]?void this.options.error({message:"Bad script nesting or script finished twice"}):(this.scriptStack.shift(),this.write.apply(this,t.outerWrites),void(!this.scriptStack.length&&this.deferredRemote&&(this.onScriptStart(this.deferredRemote),this.deferredRemote=null)))},a.prototype.writeScriptToken=function(t,e){var i=this.buildScript(t),n=this.shouldRelease(i),s=this.options.afterAsync;t.src&&(i.src=t.src,this.scriptLoadHandler(i,n?s:function(){e(),s()}));try{this.insertScript(i),t.src&&!n||e()}catch(t){this.options.error(t),e()}},a.prototype.buildScript=function(t){var e=this.doc.createElement(t.tagName);return s(t.attrs,function(t,i){e.setAttribute(t,i)}),t.content&&(e.text=t.content),e},a.prototype.insertScript=function(t){this.writeImpl('<span id="ps-script"/>');var e=this.doc.getElementById("ps-script");e.parentNode.replaceChild(t,e)},a.prototype.scriptLoadHandler=function(t,e){function i(){t=t.onload=t.onreadystatechange=t.onerror=null}function n(){i(),e()}function s(t){i(),a(t),e()}var a=this.options.error;r(t,{onload:function(){n()},onreadystatechange:function(){/^(loaded|complete)$/.test(t.readyState)&&n()},onerror:function(){s({message:"remote script failed "+t.src})}})},a.prototype.shouldRelease=function(t){var e=/^script$/i.test(t.nodeName);return!e||!!(this.options.releaseAsync&&t.src&&t.hasAttribute("async"))},a}();d.postscribe=function(){function e(){var t,e=c.shift();e&&(t=g(e),t.afterDequeue(),e.stream=n.apply(null,e),t.afterStreamStart())}function n(i,n,a){function c(t){t=a.beforeWrite(t),u.write(t),a.afterWrite(t)}u=new m(i,a),u.id=l++,u.name=a.name||u.id,s.streams[u.name]=u;var h=i.ownerDocument,d={close:h.close,open:h.open,write:h.write,writeln:h.writeln};r(h,{close:t,open:t,write:function(){return c(o(arguments).join(""))},writeln:function(){return c(o(arguments).join("")+"\n")}});var p=u.win.onerror||t;return u.win.onerror=function(t,e,i){a.error({msg:t+" - "+e+":"+i}),p.apply(u.win,arguments)},u.write(n,function(){r(h,d),u.win.onerror=p,a.done(),u=null,e()}),u}function s(n,s,r){i(r)&&(r={done:r}),r=a(r,h),n=/^#/.test(n)?d.document.getElementById(n.substr(1)):n.jquery?n[0]:n;var o=[n,s,r];return n.postscribe={cancel:function(){o.stream?o.stream.abort():o[1]=t}},r.beforeEnqueue(o),c.push(o),u||e(),n.postscribe}var l=0,c=[],u=null;return r(s,{streams:{},queue:c,WriteStream:m})}()}}(),function(){Modernizr.addTest("retina",function(){return window.devicePixelRatio>1}),Modernizr.addTest("android",function(){return window.navigator.userAgent.toLowerCase().match(/Android/i)}),Modernizr.addTest("amazonsilk",function(){return/\bSilk\b/.test(navigator.userAgent)}),Modernizr.addTest("Mac",function(){return window.navigator.userAgent.indexOf("Mac")!=-1}),Modernizr.addTest("webkit",function(){return window.navigator.userAgent.indexOf("AppleWebKit")!=-1}),Modernizr.addTest("opera",function(){return!(!window.opera||!window.opera.buildNumber)}),Modernizr.addTest("msie",function(){return!!Function("/*@cc_on return document.documentMode===10@*/")()}),Modernizr.addTest("msie11",function(){return navigator.userAgent.indexOf("Trident/")!=-1&&(navigator.userAgent.indexOf("rv:")!=-1||navigator.appName.indexOf("Netscape")!=-1)}),Modernizr.addTest("winphone8",function(){return navigator.userAgent.indexOf("Trident/")!=-1&&(navigator.userAgent.indexOf("Phone")!=-1||navigator.userAgent.indexOf("IEMobile/")!=-1)}),Modernizr.addTest("safari",function(){return navigator.userAgent.indexOf("Safari")!=-1&&(navigator.userAgent.indexOf("Mac")!=-1||navigator.userAgent.indexOf("Windows"))&&navigator.userAgent.indexOf("Chrome")==-1}),Modernizr.addTest("safari5",function(){return!!navigator.userAgent.match(" Safari/")&&!navigator.userAgent.match(" Chrom")&&!!navigator.userAgent.match(" Version/5.")}),Modernizr.addTest("isboxversion",function(){return 1==window.isboxversion}),Modernizr.addTest("isdesktop",function(){return 1==window.isdesktop}),Modernizr.addTest("istablet",function(){return 1==window.istablet}),Modernizr.addTest("isphone",function(){return 1==window.isphone}),Modernizr.addTest("firefox",function(){return window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}),Modernizr.addTest("csspositionsticky",function(){var t="position:",e="sticky",i=document.createElement("modernizr"),n=i.style;return n.cssText=t+Modernizr._prefixes.join(e+";"+t).slice(0,-t.length),n.position.indexOf(e)!==-1})}(),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var i=e||window.event,n=[].slice.call(arguments,1),l=0,c=0,h=0;e=t.event.fix(i),e.type="mousewheel",i.detail&&(l=i.detail*-1),i.wheelDelta&&(l=i.wheelDelta),i.deltaY&&(h=i.deltaY*-1,l=h),i.deltaX&&(c=i.deltaX*-1,l=c),void 0!==i.wheelDeltaY&&(h=i.wheelDeltaY),void 0!==i.wheelDeltaX&&(c=i.wheelDeltaX);var d=1;return r&&a&&Math.abs(l-Math.round(l))>1e-7&&(d*=120),s&&a&&(d*=40),r&&o&&(d/=15),l*=d,c*=d,h*=d,n.unshift(e,l,c,h),(t.event.dispatch||t.event.handle).apply(this,n)}var i=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],n="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=navigator.platform.toUpperCase().indexOf("WIN")>=0,r=navigator.platform.toUpperCase().indexOf("MAC")>=0,a=navigator.userAgent.toUpperCase().indexOf("FIREFOX")>=0,o=navigator.userAgent.toUpperCase().indexOf("OPERA")>=0;if(t.event.fixHooks)for(var l=i.length;l;)t.event.fixHooks[i[--l]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=n.length;t;)this.addEventListener(n[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=n.length;t;)this.removeEventListener(n[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function(t,e){t.fn.RMDrag=function(i){function n(e){o(e),window._moveInProcess||(l={startX:e.pageX,startY:e.pageY,deltaX:0,deltaY:0,velocityX:0,velocityY:0,moved:!1,startTime:Number(new Date),duration:0},a(e),t(document).on(c.move,s).on(c.end,r),"function"==typeof i.start&&i.start.call(d,e),i.dragClass&&"string"==typeof i.dragClass&&u.addClass(i.dragClass))}function s(t){o(t),l.moved=!0;var e=t.pageX-l.startX,n=t.pageY-l.startY,s=e-l.deltaX||e,r=n-l.deltaY||n;Math.abs(s)>h.X&&(s=l.velocityX),Math.abs(r)>h.Y&&(r=l.velocityY),l.deltaX=e,l.deltaY=n,l.velocityX=s,l.velocityY=r,a(t),"function"==typeof i.move&&i.move.call(d,t),window._moveInProcess=!0}function r(e){o(e),l.duration=Number(new Date)-l.startTime,l.moved&&(window.suppressClick=100+ +new Date),a(e),t(document).off(c.move,s).off(c.end,r),"function"==typeof i.stop&&i.stop.call(d,e),window._moveInProcess=!1,i.dragClass&&"string"==typeof i.dragClass&&u.removeClass(i.dragClass)}function a(t){for(prop in l)t[prop]=l[prop]}function o(t){t&&(i.preventDefault&&t.preventDefault(),i.silent&&t.stopPropagation())}if(!i)return this;"function"==typeof i&&(i={start:arguments[0],move:arguments[1],stop:arguments[2]}),i.start=i.start||i.begin||i.down,i.stop=i.stop||i.end||i.up,i.move=i.move||i.drag,i.silent=i.silent===e||i.silent;var l,c={start:"mousedown",move:"mousemove",end:"mouseup"},h={X:200,Y:200},d=this[0],u=t(d);return this.on(c.start,n),this}}(jQuery),function(t){t.fn.RMAltText=function(e){return this.each(function(){function i(e){var i=t(e.currentTarget);if(clearTimeout(h),clearInterval(d),!(i.hasClass("rmalttext-disable")||i.hasClass("active")||i.hasClass("disabled")||i.hasClass("no-hover"))){var n=1e3,o=200;window.rmalt_current_shown&&window.rmalt_current_shown!==i&&(window.rmalt_current_shown.trigger("rmalt-hide"),n=0,o=0),h=setTimeout(function(){if(!c){c=t(u).appendTo("body"),c.find(".rmalttext-content").text(i.attr("data-alt")),i.attr("data-alt-style")&&c.addClass(i.attr("data-alt-style"));var e,n,l=i.attr("data-alt-pos"),h=i.attr("data-alt-offset")-0,p=c.outerWidth(!1),f=c.outerHeight(!1),g=i.outerWidth(!1),m=i.outerHeight(!1),v=i.offset().left,_=i.offset().top;"top"==l&&(e=v+(g-p)/2,n=_-h-f,c.addClass("rmalttext-top")),"bottom"==l&&(e=v+(g-p)/2,n=_+m+h,c.addClass("rmalttext-bottom")),"left"==l&&(e=v-h-p,n=_+(m-f)/2,c.addClass("rmalttext-left")),"right"==l&&(e=v+g+h,n=_+(m-f)/2,c.addClass("rmalttext-right")),c.css({display:"none",left:Math.floor(e),top:Math.floor(n)})}c.fadeIn(o),window.rmalt_current_shown=i,d=setInterval(function(){a instanceof jQuery&&r(a)||s()}.bind(a),200)},n)}}function n(){clearTimeout(h),clearInterval(d),h=setTimeout(function(){window.rmalt_current_shown=null,c&&c.fadeOut(150,function(){c.remove(),c=void 0})},400)}function s(){clearTimeout(h),clearInterval(d),window.rmalt_current_shown=null,c&&c.remove(),c=void 0}function r(t){t instanceof jQuery&&(t=t.get(0));var e=t.getBoundingClientRect();return e.width>0&&e.height>0}var a=t(this);if(!a.hasClass("rmalttext")&&Modernizr.isdesktop){a.addClass("rmalttext");var o=a.attr("data-alt");if(o){var l={};e&&t.extend(l,e);var c,h,d,u='<div class="rmalttext-wrapper">\t\t\t\t\t\t\t<div class="rmalttext-content">'+o+'</div>\t\t\t\t\t\t\t<div class="rmalttext-corner-wrapper"><div class="rmalttext-corner"></div></div>\t\t\t\t\t\t</div>';a.on("mouseenter",i).on("mouseleave",n).on("click",s).on("rmalt-hide",s).on("DOMNodeRemovedFromDocument",s)}}}),this}}(jQuery),function(t){t.keycodes={enter:13,esc:27,tab:9,alt:18,shift:16,pgUp:33,pgDn:34,left:37,right:39,up:38,down:40,del:46,backspace:8,e:69,f:70,comma:188,g:71,h:72,s:83,w:87,v:86,m:77}}(jQuery),function(t,e){function i(t){var i={r:0,g:0,b:0,a:1};if(e.defaultView&&e.defaultView.getComputedStyle){var n=e.defaultView.getComputedStyle(t,null);if(n){var s=n.getPropertyValue("color").toLowerCase(),r=/\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*/,a=/\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d+|\d*\.\d+)\s*\)\s*/,o=s.match(r)||s.match(a);o?i={r:o[1]-0,g:o[2]-0,b:o[3]-0,a:void 0!==o[4]?o[4]-0:1}:(s=s.replace("#",""),i={r:parseInt(s.substring(0,2),16),g:parseInt(s.substring(2,4),16),b:parseInt(s.substring(4,6),16),a:1})}}return i}function n(t,e){for(var i=t.split("."),n=e.split("."),s=0;s<Math.min(i.length,n.length);s++){var r=parseInt(i[s]),a=parseInt(n[s]),o=r-a;if(o)return o}return i.length-n.length}function s(i,s){var r,a,o=t.Popcorn;if(y="loading",!o||n(i,o.version)>0||s(o,y="loaded")){var l=e.createElement("script");l.type="text/javascript",l.src="/js/libs/popcorn.min.js",l.onload=l.onreadystatechange=function(){"loading"!=y||(r=this.readyState)&&"loaded"!=r&&"complete"!=r||(a=t.Popcorn,o&&(t.Popcorn=o),s(a,y="loaded"),m.removeChild(l))},m.appendChild(l)}}function r(i,s){var r,a=t.SC;if(_="loading",!a||!a.Dialog||n(i,a._version)>0||s(a,_="loaded")){var o=e.createElement("script");o.type="text/javascript",o.src="//connect.soundcloud.com/sdk-2.0.0.js",o.onload=o.onreadystatechange=function(){"loading"!=_||(r=this.readyState)&&"loaded"!=r&&"complete"!=r||(s(t.SC,_="loaded"),m.removeChild(o))},m.appendChild(o)}}function a(t,e){for(var i=t.className,n=0,s=e.match(/\S+/g);n<s.length;n++)i=i.replace(new RegExp("(?:^|\\s)"+s[n]+"(?!\\S)"),"");t.className=i}function o(t,e){for(var i=t.className,n=0,s=e.match(/\S+/g);n<s.length;n++)i.match(new RegExp("(?:^|\\s)"+s[n]+"(?!\\S)"))||(i+=" "+s[n]);t.className=i}function l(t){for(var e=0;e<v.length;e++)v[e].playing&&(t&&t.el===v[e].el||v[e].pause())}function c(t){this.el=t,this.start=t.hasAttribute("data-start")?t.getAttribute("data-start"):0,this.end=t.hasAttribute("data-end")?t.getAttribute("data-end"):null,this.plays=t.hasAttribute("data-plays")?parseInt(t.getAttribute("data-plays")):1,this.plays_left=this.plays,this.playing=!1,this.sound=null,this.click_handler_binded=x(this.click_handler,this),v.push(this)}function h(t){c.apply(this,Array.prototype.slice.call(arguments)),this.id=t.getAttribute("data-id"),"initialized"!==_&&(f.initialize({client_id:"5ba7fd66044a60db41a97cb9d924996a"}),_="initialized"),f.stream(this.id,x(function(t){return this.destroyed?void(t._player.kill&&t._player.kill()):(this.sound=t,this.sound._player.on("positionChange",x(function(t){this.track_progress(),this.playing&&(t<this.start&&this.sound.seek(this.start),t>=this.end&&(this.plays?(this.plays_left--,this.plays_left>0?this.play():this.stop()):this.play(),this.track_progress()),this.prevPos=t)},this)),null===this.end&&(this.end=this.sound.getDuration()),void this.sound_loaded())},this))}function d(t){c.apply(this,Array.prototype.slice.call(arguments)),this.id="soundcite-audio-"+this.generateUUID(),this.url=t.getAttribute("data-url"),this.start=Math.floor(this.start/1e3),null!==this.end&&(this.end=Math.floor(this.end/1e3)),"initialized"!=y&&(soundcite.audio_container=e.createElement("div"),o(soundcite.audio_container,"soundcite-audio"),e.getElementsByTagName("body")[0].appendChild(soundcite.audio_container),y="initialized"),this.audio=e.createElement("audio"),this.audio.id=this.id,this.audio.setAttribute("src",this.url),this.audio.setAttribute("preload","none"),soundcite.mobile=!0,soundcite.audio_container.appendChild(this.audio),this.sound=g("#"+this.id,{frameAnimation:!0}),this.sound.on("loadeddata",x(function(){null===this.end&&(this.end=this.sound.duration()),soundcite.mobile||this.sound_loaded()},this)),soundcite.mobile?this.sound_loaded():this.sound.readyState()>1&&this.sound_loaded()}var u={update_playing_element:function(t,e,i){var n="rgba("+i.r+", "+i.g+", "+i.b+", "+.2*i.a+")",s="rgba("+i.r+", "+i.g+", "+i.b+", "+.1*i.a+")";t.style.cssText+="background: -webkit-linear-gradient(left, "+n+e+"%, "+s+(e+.1)+"%);background: linear-gradient(to right, "+n+e+"%, "+s+(e+.1)+"%);"}};for(var p in t.SOUNDCITE_CONFIG)u[p]=t.SOUNDCITE_CONFIG[p];t.soundcite={},/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?soundcite.mobile=!0:soundcite.mobile=!1;var f,g,m=e.head||e.getElementsByTagName("head").item(0)||e.documentElement.childNodes[0],v=[],_="none",y="none",w=[],b=[],x=function(t,e){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}};c.prototype.generateUUID=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e},c.prototype.sound_loaded=function(){this.el.addEventListener("click",this.click_handler_binded),a(this.el,"soundcite-initializing"),this.el.style.display="none",this.el.offsetHeight,this.el.style.display="",o(this.el,"soundcite-loaded soundcite-play")},c.prototype.pause=function(){a(this.el,"soundcite-pause"),o(this.el,"soundcite-play"),this.playing=!1,this.pause_sound()},c.prototype.stop=function(){a(this.el,"soundcite-pause"),o(this.el,"soundcite-play"),this.playing=!1,this.plays_left=this.plays,this.stop_sound()},c.prototype.track_progress=function(){var t=this.end-this.start,e=this.sound_position(),n=e-this.start,s=100*n/t;this.color||(this.color=i(this.el)),u.update_playing_element(this.el,s,this.color)},c.prototype.click_handler=function(t){t.preventDefault(),l(this),this.playing?this.pause():this.play()},c.prototype.destroy=function(t){this.destroyed=!0,this.playing&&this.pause(),this.el&&a(this.el,"soundcite-loaded soundcite-initializing soundcite-loading soundcite-play soundcite-pause"),this.el&&this.el.removeEventListener("click",this.click_handler_binded)},h.prototype=Object.create(c.prototype),h.prototype.sound_position=function(){return this.sound.getCurrentPosition()},h.prototype.pause_sound=function(){this.sound.pause()},h.prototype.stop_sound=function(){this.sound.stop()},h.prototype.play=function(){var t=this.sound_position();(t<this.start||t>=this.end)&&this.sound.seek(this.start),a(this.el,"soundcite-play"),o(this.el,"soundcite-pause"),this.sound.play(),this.playing=!0,this.prevPos=-1},h.prototype.destroy=function(){this.sound&&this.sound._player.kill&&this.sound._player.kill(),c.prototype.destroy.apply(this,arguments)},d.prototype=Object.create(c.prototype),d.prototype.sound_position=function(){return this.sound.currentTime()},d.prototype.pause_sound=function(){this.sound.pause(),this.sound.off("timeupdate")},d.prototype.stop_sound=function(){this.sound.off("timeupdate"),this.sound.pause()},d.prototype._play_sound=function(){a(this.el,"soundcite-loading soundcite-play"),o(this.el,"soundcite-pause"),this.sound.play(),this.playing=!0,this.sound.on("timeupdate",x(function(){this.track_progress(),this.playing&&this.sound.currentTime()>=this.end&&(this.plays?(this.plays_left--,this.plays_left>0?this.play_sound():this.stop()):this.play_sound(),this.track_progress())},this))},d.prototype.play_sound=function(){var t=this.sound.currentTime();t<this.start||t>=this.end?(this.sound.on("seeked",x(function(){this.sound.off("seeked"),this._play_sound()},this)),this.sound.currentTime(this.start)):this._play_sound()},d.prototype.play=function(){/soundcite\-loading/.test(this.el.className)||(soundcite.mobile?(a(this.el,"soundcite-play"),o(this.el,"soundcite-loading"),this.startedLoading?this.play_sound():(this.sound.on("canplaythrough",x(function(){this.play_sound()},this)),e.getElementById(this.id).load()),this.startedLoading=!0):this.play_sound())},d.prototype.destroy=function(){this.sound&&g.destroy(this.sound),this.audio&&soundcite.audio_container.removeChild(this.audio),c.prototype.destroy.apply(this,arguments)},soundcite.createPlayer=function(t){o(t,"soundcite-initializing"),o(t,"soundcite-force-bg-color"),u.update_playing_element(t,0,i(t)),t.getAttribute("data-url")&&("none"==y?(b.push(t),s("1.5.6",function(t){g=t;for(var e=0;e<b.length;e++)new d(b[e])})):"loading"==y?b.push(t):new d(t)),t.getAttribute("data-id")&&("none"==_?(w.push(t),r("2.0.0",function(t){f=t;for(var e=0;e<w.length;e++)new h(w[e])})):"loading"==_?w.push(t):new h(t))},soundcite.destroyPlayer=function(t){for(var e=v.length-1;e>=0;e--)v[e].el==t&&(v[e].destroy(),v.splice(e,1));for(var e=b.length-1;e>=0;e--)b[e]==t&&b.splice(e,1);for(var e=w.length-1;e>=0;e--)w[e]==t&&w.splice(e,1)},soundcite.pausePlayer=function(t){for(var e=0;e<v.length;e++)t==v[e].el&&v[e].playing&&v[e].pause()},soundcite.setElementsColor=function(t){u.update_playing_element(t,0,i(t))}}(window,document),function(t,e){t.fn.RMScroll=function(i){var n=function(t,e){this.options=_.clone(t),this.$scroll=e,this.incDelta=0,this.mouseWheelProceedThrottled=_.throttle(this.mouseWheelProceed,50),_.defaults(this.options,{gap_start:0,gap_end:0,$gutter:null,tp:"vertical",wheelScrollSpeed:1,scrollStep:1,maxHandleSize:9999,dragScroll:!1,systemScroll:!1,needRecalc:!0})};n.prototype={initialize:function(){_.bindAll(this),this.options.$container.bind("scroll",this.onScroll),this.options.systemScroll||this.options.$container.bind("mousewheel",this.onMouseWheel),this.options.$handle.RMDrag({start:this.startScrollDrag,move:this.moveScrollDrag,end:this.stopScrollDrag,silent:!0,preventDefault:!0}),this.options.dragScroll&&this.options.$content.RMDrag({start:this.startContentDrag,move:this.moveContentDrag,end:this.stopContentDrag,silent:!0,preventDefault:!0}),this.data={handle_pos:0,handle_size:0,container_size:0,content_size:0,scroll_pos:0,scroll_percent:0},this.options.needRecalc&&this.recalc()},onMouseWheel:function(t,e,i,n){t.preventDefault(),(i||n)&&("vertical"==this.options.tp?e=n:(e=i||n,t.stopPropagation()));var s=-Math.ceil(e*this.options.wheelScrollSpeed);this.incDelta+=s,this.mouseWheelProceedThrottled(this.incDelta)},mouseWheelProceed:function(t){if(t>0&&t<this.options.scrollStep&&(t=this.options.scrollStep),t<0&&t>-this.options.scrollStep&&(t=-this.options.scrollStep),"vertical"==this.options.tp){var e=t+this.options.$container.scrollTop();e-=e%this.options.scrollStep,this.options.$container.scrollTop(e)}else{var e=t+this.options.$container.scrollLeft();e-=e%this.options.scrollStep,this.options.$container.scrollLeft(e)}this.incDelta=0},changeGaps:function(t){t=t||{},t.gap_start!=e&&(this.options.gap_start=t.gap_start),t.gap_end!=e&&(this.options.gap_end=t.gap_end),this.recalc()},recalc:function(){this.data.container_size="vertical"==this.options.tp?this.options.$container.height():this.options.$container.width(),this.data.container_size_with_gaps=this.data.container_size-this.options.gap_start-this.options.gap_end,this.data.content_size="vertical"==this.options.tp?this.options.$content.outerHeight(!0):this.options.$content.outerWidth(!0),this.data.handle_size=this.data.container_size_with_gaps/this.data.content_size,this.data.handle_size=Math.max(Math.min(this.data.handle_size,1),0),this.data.handle_size=Math.sqrt(this.data.handle_size),this.data.handle_size=Math.ceil(this.data.handle_size*this.data.container_size_with_gaps),this.data.handle_size=Math.min(this.data.handle_size,this.options.maxHandleSize),this.data.container_size>=this.data.content_size?(this.options.$handle.css("display","none"),this.options.$gutter&&this.options.$gutter.css("display","none")):(this.options.$handle.css("display","block"),this.options.$gutter&&this.options.$gutter.css("display","block")),this.options.$handle.css("vertical"==this.options.tp?"height":"width",this.data.handle_size),this.onScroll()},onScroll:function(t){this.data.scroll_pos="vertical"==this.options.tp?this.options.$container.scrollTop():this.options.$container.scrollLeft();var e=this.data.content_size-this.data.container_size;this.data.scroll_pos>e&&(this.data.scroll_pos=e),e>0?this.data.scroll_percent=this.data.scroll_pos/e:this.data.scroll_percent=0,this.data.handle_pos=this.options.gap_start+Math.ceil(this.data.scroll_percent*(this.data.container_size_with_gaps-this.data.handle_size)),this.options.$handle.css("vertical"==this.options.tp?"top":"left",this.data.handle_pos),this.data.scroll_event=t,"function"==typeof this.options.onScroll&&this.options.onScroll(this.data)},startScrollDrag:function(t){this.options.$handle.addClass("dragging"),this.oldHandlePos=this.data.handle_pos},moveScrollDrag:function(t){var e="vertical"==this.options.tp?t.deltaY:t.deltaX,i=this.oldHandlePos+e-this.options.gap_start,n=i/(this.data.container_size_with_gaps-this.data.handle_size);n=Math.min(Math.max(n,0),1);var s=n*(this.data.content_size-this.data.container_size);"vertical"==this.options.tp?this.options.$container.scrollTop(s):this.options.$container.scrollLeft(s)},stopScrollDrag:function(t){this.options.$handle.removeClass("dragging")},startContentDrag:function(t){"vertical"==this.options.tp?this.oldDragPos=this.options.$container.scrollTop():this.oldDragPos=this.options.$container.scrollLeft(),this.maxDragShift=0,this.wasContentDrag=!1},moveContentDrag:function(t){var e="vertical"==this.options.tp?t.deltaY:t.deltaX;this.maxDragShift=Math.max(this.maxDragShift,Math.abs(e));var i=this.oldDragPos-e;i=Math.min(Math.max(i,0),this.data.content_size-this.data.container_size),"vertical"==this.options.tp?this.options.$container.scrollTop(i):this.options.$container.scrollLeft(i)},stopContentDrag:function(t){this.wasContentDrag=this.maxDragShift>5},destroy:function(){}};var s=t(this),r=new n(i,s);return r.initialize(),s.data("scroll",r),this}}(jQuery),window.RM={models:{},collections:{},classes:{},blocks:{},controls:{},panels:{},widgets:{},views:{},data:{},common:{disableShortcuts:{}},templates:{}},RM.templates["template-common-alert"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var categories={"type-duplicate":"category-upgrade","type-create":"category-upgrade","type-export-pdf":"category-upgrade","type-export-code":"category-upgrade","type-more-pages":"category-upgrade","type-upload-fonts":"category-upgrade","type-custom-seo":"category-upgrade","type-custom-sharing":"category-upgrade","type-code-injection":"category-upgrade","type-publish":"category-confirm-email","type-switch-desktop-create":"category-mobile","type-switch-desktop-continue":"category-mobile","type-browsers":"category-browsers","type-shared-failed":"category-shared-failed","type-shared-unlock-page":"category-shared-unlock-page"},headers={"category-upgrade":"Push the Limits","category-upgrade-skip":"Push the Limits","category-browsers":"Browser Support","category-shared-failed":"Sorry, something<br/>went wrong.","category-confirm-email":"Account Activation"},texts={"type-duplicate":'To duplicate this project you need to upgrade your account. You can find out more about our subscription plans <a href="/pricing" class="learn-more">here</a>.',"type-create":'To create more projects you need to upgrade your account. You can find out more about our subscription plans <a href="/pricing" class="learn-more">here</a>.',"type-publish":"Please verify your email address<br />to publish this project.","type-export-pdf":'Please upgrade your account<br/>to export the project to PDF.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-export-code":'Please upgrade your account<br/>in order to export the source<br/>code of your projects.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-more-pages":'Please upgrade your account<br/>to create more pages.<br><a href="/pricing" class="learn-more">See the pricing</a>.',"type-custom-seo":'Please upgrade your account<br/> to customize SEO parameters.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-custom-sharing":'Please upgrade your account<br/>to customize social sharing info.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-code-injection":'Please upgrade your account to<br/>make custom code work after<br/>you publish the project.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-browsers":"Sorry, our Editor doesn’t support Internet Explorer. This may change in the future, but for now please use Chrome, Firefox or Safari.","type-switch-desktop-create":"To create a project, please use your laptop or desktop computer.","type-switch-desktop-continue":"To continue, please use your laptop or desktop computer.","type-shared-failed":'Please contact <a href="mailto:support@readymag.com" class="learn-more">support</a>.',"type-upload-fonts":'Please upgrade your account<br/>to upload your own fonts.<br/><a href="/pricing" class="learn-more">See the pricing</a>.'},buttons={"category-upgrade":'<a href="/settings/subscription/update" class="button main upgrade">Upgrade</a><div class="cancel-wrapper">or '+("type-code-injection"==opts.type?'<span class="button cancel" data-type="skip">Skip</span>':'<span class="button cancel">Cancel</span>')+"</div>","category-browsers":'<div class="button main ok">Okay</div>',"category-mobile":'<div class="button main ok">Okay</div>',"category-shared-failed":'<div class="button close">Close</div>',"category-shared-unlock-page":'<div class="button ok">Ok</div>',"category-confirm-email":'<div  class="button main resend">Resend</div><div class="cancel-wrapper">or <span class="button cancel">Cancel</span></div>'},category=categories[opts.type],header=headers[category],text=texts[opts.type]||opts.text,button=buttons[category];opts.is_contributor&&(text="Please upgrade owner’s account<br/>to be able to use this feature.",button='<a href="mailto:'+opts.owner_email+'" class="contact-link">Contact owner</a><div class="cancel-wrapper">'+("type-code-injection"==opts.type?'or <span class="button cancel" data-type="skip">Skip</span>':'<span class="button cancel">Cancel</span>')+"</div>"),__p+='\n\n\t<div class="alert-popup '+(null==(__t=category)?"":__t)+'">\n\t\t<div class="panel-wrapper">\n\t\t\t<div class="center-table">\n\t\t\t\t<div class="center-cell">\n\t\t\t\t\t<div class="panel">\n\n\t\t\t\t\t\t'+(null==(__t=header?'<div class="header">'+header+"</div>":"")?"":__t)+'\n\n\t\t\t\t\t\t<div class="icon" '+(null==(__t=opts.icon?'style="background-image:url('+opts.icon+')"':"")?"":__t)+"></div>\n\n\t\t\t\t\t\t"+(null==(__t=text?'<div class="text">'+text+"</div>":"")?"":__t)+"\n\n\t\t\t\t\t\t"+(null==(__t=button?'<div class="buttons">'+button+"</div>":"")?"":__t)+"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n";
}return __p}.apply(this,arguments))},RM.templates["template-common-audio-player-standard"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<iframe class="common-audio-player standard" width="100%" height="100%" scrolling="no" frameborder="no" src="'+(null==(__t=src)?"":_.escape(__t))+'"></iframe>\n';return __p}.apply(this,arguments))},RM.templates["template-common-audio-player-minimal"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player minimal loading">\n\n\t\t<div class="sc-artwork-list">\n\t\t\t<div class="sc-loaded-artwork"></div>\n\t\t\t<div class="sc-artworks-overlay"></div>\n\t\t</div>\n\n\t\t<div class="sc-info">\n\t\t\t<h3></h3>\n\t\t\t<h4></h4>\n\t\t</div>\n\n\t\t<div class="sc-scrubber no-rmswipe">\n\t\t\t<div class="sc-hover-indicator"></div>\n\t\t\t<div class="sc-time-span">\n\t\t\t\t<div class="sc-buffer"></div>\n\t\t\t\t<div class="sc-played"></div>\n\t\t\t\t<div class="sc-button-wrapper">\n\t\t\t\t\t<div class="sc-button">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="12" height="12"><path d="M0 0 L12 6 L0 12  Z " style="fill:#1d1a1b; stroke:none; stroke-width:0"></path></svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="sc-time-indicators">\n\t\t\t\t<span class="sc-left"></span>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-audio-player-engine-html5"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<audio preload="auto"></audio>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-audio-player-engine-flash"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<object height="100%" width="100%" id="'+(null==(__t=id)?"":_.escape(__t))+'">\n\t\t\t<embed allowscriptaccess="always" height="100%" width="100%" src="'+(null==(__t=swf)?"":__t)+'" type="application/x-shockwave-flash" name="'+(null==(__t=id)?"":_.escape(__t))+'" />\n\t    </object>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-audio-player-engine-flash-ie"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<object height="100%" width="100%" id="'+(null==(__t=id)?"":_.escape(__t))+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" data="'+(null==(__t=swf)?"":_.escape(__t))+'">\n\t\t\t<param name="movie" value="'+(null==(__t=swf)?"":_.escape(__t))+'" />\n\t\t\t<param name="allowscriptaccess" value="always" />\n\t\t</object>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-button-widget"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="common-button" data-id="'+(null==(__t=data._id)?"":_.escape(__t))+'">\n\n        <div class="icon"></div>\n\n    </div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-common-export-code"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="export-code-popup">\n\t\t<div class="panel-wrapper">\n\t\t\t<div class="close"></div>\n\n\t\t\t<div class="panel">\n\t\t\t\t<div class="header">Export code</div>\n\n\t\t\t\t<!--__magterm-->\n\t\t\t\t<div class="message">Please provide a domain name if the project</br>will be hosted on another server. Typekit</br>fonts will only work on this domain.</div>\n\n\t\t\t\t<input class="domain-input" type="text" placeholder="yourdomain.com"/>\n\n\t\t\t\t<a href="" class="download">\n\t\t\t\t\t<span>Download</span>\n\t\t\t\t\t<div class="rmpreloader">\n\t\t\t\t\t    <div class="arc"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\n\t\t\t\t<ul class="alerts">\n\t\t\t\t\t<li class="alert-item alert-forms">\n\t\t\t\t\t\t<div class="alert-item-icon">\n\t\t\t\t\t\t\t<span class="notification-sign">!</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="alert-text">\n\t\t\t\t\t\t\tForms will not send submitted data to emails, Google Docs, or Mailchimp.<br>Only URL option will work.\n\t\t\t\t\t\t\t<a href="http://help.readymag.com/form/" class="alert-learn-more" target="_blank">Learn more</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-export-pdf"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="export-pdf-popup">\n\t\t<div class="panel-wrapper">\n\t\t\t<div class="close"></div>\n\n\t\t\t<div class="panel">\n\t\t\t\t<div class="header">Export to PDF<span>β</span></div>\n\n\t\t\t\t<div class="initial-block">\n\t\t\t\t\t<div class="radio-group">\n\t\t\t\t\t\t<div class="input-wrapper">\n\t\t\t\t\t\t\t<input type="radio" id="export-pdf-all" name="export-pdf-type" value="all" checked><label for="export-pdf-all" class="caption">All Pages</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="input-wrapper">\n\t\t\t\t\t\t\t<input type="radio" id="export-pdf-custom" name="export-pdf-type" value="custom"><label for="export-pdf-custom" class="caption"><input type="text" required="required" placeholder="e.g. 1-8, 11"></label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="errors"></div>\n\n\t\t\t\t\t<div class="create-pdf">Create PDF</div>\n\n\t\t\t\t\t<!--__magterm-->\n\t\t\t\t\t<div class="typekit-issue">Please note that if your projects contains Typekit web fonts they will be replaced by alternatives due to license restrictions.</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="done-block">\n\t\t\t\t\t<!--__magterm-->\n\t\t\t\t\t<div class="message">Your project is being converted.<br/>We will send you the download link to '+(null==(__t=email)?"":_.escape(__t))+' when it’s ready.</div>\n\n\t\t\t\t\t<div class="done">Done</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-form-button"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="button">\n\t\t<div class="caption"></div>\n\t\t<svg class="error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M17 19.8c-1.4 0-2.6 1.1-2.6 2.6s1.1 2.6 2.6 2.6c1.4 0 2.6-1.1 2.6-2.6S18.4 19.8 17 19.8zM19 0.4h-4L15 17.4h4L19 0.4z"/></svg>\n\t\t<svg class="submitted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M31.4 3C30.6 2.3 29.4 2.3 28.6 3l0 0L13.1 18.6l-7.8-7.8 0 0c-0.8-0.7-2-0.7-2.7 0 -0.8 0.8-0.8 2 0 2.7l0 0L13.1 24.1l0.4-0.4h0L31.4 5.8l0 0C32.1 5 32.1 3.8 31.4 3z"/></svg>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-gift"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="wrapper">\n\t\t<div class="form-wrapper">\n\t\t\t<div class="clearfix">\n\t\t\t\t<div class="left-column">\n\t\t\t\t\t<div class="choose-gift">CHOOSE GIFT</div>\n\t\t\t\t\t<div class="period-selector">\n\t\t\t\t\t\t<div class="period month active" data-plan="creator_monthly">\n\t\t\t\t\t\t\t<div class="caption">1 Month of<br>Creator plan</div>\n\t\t\t\t\t\t\t<div class="price">$'+(null==(__t=month_price)?"":__t)+'</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="period year" data-plan="creator_yearly">\n\t\t\t\t\t\t\t<div class="caption">1 Year of<br>Creator plan</div>\n\t\t\t\t\t\t\t<div class="price">$'+(null==(__t=year_price)?"":__t)+'</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="field-wrapper email">\n\t\t\t\t\t\t<div class="caption">EMAIL TO</div>\n\t\t\t\t\t\t<input autocapitalize="off" autocorrect="off" type="email" spellcheck="false" value="" placeholder="@" />\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="field-wrapper from">\n\t\t\t\t\t\t<div class="caption">FROM</div>\n\t\t\t\t\t\t<input autocapitalize="on" autocorrect="off" maxlength="56" type="text" spellcheck="false" value="" placeholder="Name" />\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="field-wrapper message">\n\t\t\t\t\t\t<div class="caption">MESSAGE</div>\n\t\t\t\t\t\t<textarea maxlength="200" placeholder="Optional"></textarea>\n\t\t\t\t\t\t<div class="counter"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="field-wrapper send">\n\t\t\t\t\t\t<div class="caption">SEND</div>\n\t\t\t\t\t\t<input readonly type="text"/>\n\t\t\t\t\t\t<div class="formated-date"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div class="right-column">\n\t\t\t\t\t<div class="how-it-looks">HOW IT LOOKS</div>\n\n\t\t\t\t\t<div class="card-cover"></div>\n\n\t\t\t\t\t<div class="card-wrapper new-card clearfix '+(null==(__t=_.isEmpty(existing_card)?"":"hidden")?"":__t)+'">\n\t\t\t\t\t\t',_.isEmpty(existing_card)||(__p+='\n\t\t\t\t\t\t\t<div class="card-switcher" data-value="existing-card">Use existing card</div>\n\t\t\t\t\t\t'),__p+='\n\n\t\t\t\t\t\t<div class="field-wrapper card-name">\n\t\t\t\t\t\t\t<div class="caption">NAME ON CARD</div>\n\t\t\t\t\t\t\t<input type="text" placeholder="Maggie Ready"/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="field-wrapper card-number">\n\t\t\t\t\t\t\t<div class="caption">CARD NUMBER</div>\n\t\t\t\t\t\t\t<input type="text" maxlength="19" placeholder="●●●● ●●●● ●●●● ●●●●"/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="field-wrapper card-date">\n\t\t\t\t\t\t\t<div class="caption">DATE</div>\n\t\t\t\t\t\t\t<input type="text" maxlength="5" placeholder="MM/YY"/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="field-wrapper card-cvc">\n\t\t\t\t\t\t\t<div class="caption">CVC</div>\n\t\t\t\t\t\t\t<input type="text" maxlength="4" placeholder="000"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t',_.isEmpty(existing_card)||(__p+='\n\t\t\t\t\t\t<div class="card-wrapper existing-card clearfix">\n\t\t\t\t\t\t\t<div class="card-switcher" data-value="new-card">Use new card</div>\n\n\t\t\t\t\t\t\t<div class="field-wrapper card-name">\n\t\t\t\t\t\t\t\t<div class="caption">NAME ON CARD</div>\n\t\t\t\t\t\t\t\t<input type="text" readonly value="'+(null==(__t=existing_card.name)?"":__t)+'"/>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="field-wrapper card-number">\n\t\t\t\t\t\t\t\t<div class="caption">CARD NUMBER</div>\n\t\t\t\t\t\t\t\t<input type="text" readonly value="●●●● ●●●● ●●●● '+(null==(__t=existing_card.last4)?"":__t)+'"/>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="field-wrapper card-type">\n\t\t\t\t\t\t\t\t<div class="caption">&nbsp;</div>\n\t\t\t\t\t\t\t\t<input type="text" readonly value="'+(null==(__t=existing_card.brand)?"":__t)+'"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),__p+='\n\n\t\t\t\t\t<div class="secured"><span>Secured by</span><a href="https://stripe.com/" target="_blank"></a></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="bottom-block inactive">\n\t\t\t\t<div class="send-button">Send Gift<div class="rmpreloader"><div class="arc"></div></div></div>\n\t\t\t\t<div class="charge-sum">YOU WILL BE<br/>CHARGED<br/><span>$'+(null==(__t=month_price)?"":__t)+'</span></div>\n\t\t\t\t<div class="error"></div>\n\t\t\t</div>\n\n\t\t\t<div class="charging-overlay"></div>\n\t\t</div>\n\n\t\t<div class="congrats-wrapper invisible">\n\t\t\t<div class="subscription">\n\t\t\t\t<div class="caption"></div>\n\t\t\t\t<div class="price"></div>\n\t\t\t</div>\n\n\t\t\t<div class="awesome"></div>\n\n\t\t\t<div class="order-info"><span class="info-email"></span><br/>will get the email with your gift<br/>on <span class="info-date"></span>.<br/><br/>Just in case, the gift code is:<br/><span class="info-code">adf</span></div>\n\n\t\t\t<div class="back-button">Send Another Gift</div>\n\n\t\t</div>\n\t</div>\n\n\n';return __p}.apply(this,arguments))},RM.templates["template-common-hotspot-widget"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="common-hotspot">\n\n\t    <div class="pin"></div>\n\n    </div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-common-hotspot-widget-mobile-wrapper"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="hotspot-fullscreen-wrapper invisible">\n        <div class="center-table">\n            <div class="center-cell">\n\n            </div>\n        </div>\n    </div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-common-login"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="login-popup hidden">\n\n\t\t<div class="login-popup-wrapper">\n\t\t\t<div class="login ljr-panel hidden">\n\t\t\t\t',__p+=Modernizr.isboxversion?'\n\t\t\t\t\t<div class="header"><span>Log in</span></div>\n\t\t\t\t':'\n\t\t\t\t\t<div class="header"><span>Log in</span> or <a href="/join/" class="link">Join</a></div>\n\t\t\t\t',__p+='\n\t\t\t\t<form method="post" action="/api/redirect" id="login_form">\n\t\t\t\t\t<input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="Email"/>\n\t\t\t\t\t<input name="password" autocapitalize="off" autocorrect="off" required="required" class="password-input input-template" autocomplete="on"  type="password" spellcheck="false" value=""  placeholder="Password" />\n\t\t\t\t\t<input name="url" type="hidden" value="" />\n\t\t\t\t\t<div class="go">Log in</div>\n\t\t\t\t</form>\n\t\t\t\t',Modernizr.isboxversion||(__p+='\n\t\t\t\t\t<div class="social-caption">Log in with</div>\n\t\t\t\t\t<div class="social-auth" data-provider=\'facebook\'>Facebook</div><div class="social-auth" data-provider=\'google\'>Google</div>\n\t\t\t\t'),__p+='\n\t\t\t\t<a href="/recover/" class="link forgot">Forgot password?</a>\n\t\t\t\t<div class="error">Invalid email or password</div>\n\t\t\t</div>\n\n\n\t\t\t',Modernizr.isboxversion||(__p+='\n\t\t\t\t<div class="join ljr-panel hidden">\n\t\t\t\t\t<div class="header"><a href="/login/" class="link">Log in</a> or <span>Join</span></div>\n\t\t\t\t\t<input autocapitalize="on"  autocorrect="off" required="required" class="fullname-input input-template"  maxlength="24" type="text"     spellcheck="false" value="" placeholder="Name" />\n\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"     type="email"    spellcheck="false" value="" placeholder="Email" />\n\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="password-input input-template"  type="password" spellcheck="false" value="" placeholder="Password" />\n\t\t\t\t\t<div class="go">Join</div>\n\n\t\t\t\t\t<div class="social-caption">Sign up with</div>\n\t\t\t\t\t<div class="social-auth" data-provider=\'facebook\'>Facebook</div><div class="social-auth" data-provider=\'google\'>Google</div>\n\n\t\t\t\t\t<div class="info">By creating an account, I accept Readymag\'s  <a href="https://readymag.com/readymag/terms-and-privacy/" target="_blank">Terms of Service</a> and <a href="https://readymag.com/readymag/terms-and-privacy/2/" target="_blank">Privacy Policy</a>.</div>\n\t\t\t\t\t<div class="error"></div>\n\t\t\t\t</div>\n\t\t\t'),__p+='\n\n\t\t\t<div class="recover ljr-panel hidden">\n\t\t\t\t<div class="header"><span>Reset Password</span></div>\n\t\t\t\t<div class="wrapper">\n\t\t\t\t\t<div class="info">Please enter your email address and we\'ll send you instructions:</div>\n\t\t\t\t\t<input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="Email"/>\n\t\t\t\t\t<div class="go">Submit</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="send-message">Done! You should receive an email shortly.</div>\n\t\t\t\t<div class="go-back">Go Back</div>\n\t\t\t</div>\n\n\t\t\t<div class="reset ljr-panel hidden">\n\t\t\t\t<div class="header"><span>Reset Password</span></div>\n\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="new-password-input input-template"  type="password" spellcheck="false" value="" placeholder="New Password" />\n\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="verify-password-input input-template"  type="password" spellcheck="false" value="" placeholder="Verify Password" />\n\t\t\t\t<div class="go">Save</div>\n\t\t\t\t<div class="error"></div>\n\t\t\t</div>\n\n\t\t\t',Modernizr.isboxversion||(__p+='\n\t\t\t\t<div class="close-popup"></div>\n\t\t\t\t<a href="/" class="link go-main"></a>\n\t\t\t'),__p+="\n\t\t</div>\n\t</div>\n\n";return __p}.apply(this,arguments))},RM.templates["template-common-login-preloader"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rmpreloader button">\n        <div class="arc"></div>\n    </div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-pages-panel-settings-domain"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="header-message section">'+(null==(__t="mag"==type?"Сustom domain name":"Custom domain for profile page")?"":__t)+'</div>\n\n\t<div class="initial-preloader rmpreloader section invisible">\n\t\t<div class="shadow"></div>\n\t\t<div class="arc"></div>\n\t</div>\n\n\t<div class="register-switcher section"><span class="registered item active">Use registered</span><span class="dot">•</span><span class="item new">Register new</span></div>\n\n\t<div class="unmap-message section"><span class="unmap-button">Unmap</span> this domain name</div>\n\n\t<div class="test-block section">\n\t\t<input class="domain-input" type="text" spellcheck="false" value="" placeholder="yourdomain.com" />\n\t\t<div class="test-button common-button disabled">Test<div class="rmpreloader"><div class="arc"></div></div></div>\n\t</div>\n\n\t<div class="invalid-domain-message section"><span class="red">Domain name may contain only alphanumeric characters. No directories are allowed.</span><br/><br/><span class="bold">Examples:</span><br/><span class="grey">mydomain.com<br/>www.mydomain.com<br/>readymag.mydomain.com</span></div>\n\n\t<div class="notfound-domain-message section">Domain’s info is not available. Please check if the name is correct. Note, that sometimes it may take few hours for subdomain to be created.</div>\n\n\t<div class="other-user-domain-message section">This domain is already used by <a class="user-button" href="TEMP" target="_blank">TEMP</a>.</div>\n\n\t<!--__magterm-->\n\t<div class="same-user-domain-message section">\n\t\t<span class="red">This domain is already mapped to <span class="entity-type"></span><a class="mag-button" href="TEMP" target="_blank">TEMP</a>. Do you want to switch it to '+(null==(__t="mag"==type?"the current project":"your profile")?"":__t)+'?</span>\n\t\t<div class="switch-button common-button">Yes<div class="rmpreloader"><div class="arc"></div></div></div>\n\t\t<div class="switch-cancel-button">Cancel</div>\n\t</div>\n\n\t<div class="dns-domain-message section">\n\t\t<span class="red">This domain’s <span class="domain-record-type">TEMP</span><span class="domain-set-phrase"> is currently set to </span><span class="domain-set-phrase-unknown invisible"> is not currently set</span><span class="domain-current-value">TEMP</span>. Please change your <span class="domain-record-type">TEMP</span> to <span class="domain-needed-value">TEMP</span> at your registrar settings.</span><br/><br/><span class="grey">After changing the <span class="domain-record-type">TEMP</span> it may take up to 72 hours to update. Please return to these settings after 72 hours and hit “Map Now”.</span>\n\t\t<div class="map-fake-button common-button disabled">Map Now</div>\n\t</div>\n\n\t<!--__magterm-->\n\t<div class="ok-domain-message section">\n\t\t<!--<span class="green">Your domain is pointing to Readymag and can be mapped to this project.</span>-->\n\t\t<span class="green">Your domain is pointing to Readymag and can be mapped to '+(null==(__t="mag"==type?"this project":"your profile")?"":__t)+'.</span>\n\t\t<div class="map-button common-button">Map Now <div class="rmpreloader"><div class="arc"></div></div></div>\n\t\t<div class="map-cancel-button">Cancel</div>\n\t</div>\n\n\t<div class="domain-readonly-block section">\n\t\t<input class="domain-readonly-input" readonly type="text" spellcheck="false" value="" placeholder="yourdomain.com" />\n\t</div>\n\n\n\t<div class="domain-setting favicon section">\n\t\t<div class="caption">\n\t\t\t<span>Favicon</span>\n\t\t</div>\n\t\t<div class="upload-button">\n\t\t\t<span>Clear</span>\n\t\t\t<input class="favicon-uploader" type="file" name="upload" data-url="/api/upload"/>\n\t\t\t<div class="favicon-preloader">\n\t\t\t\t<div class="rmpreloader">\n\t\t\t\t\t<div class="arc"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t\t<div class="description">Recommended size 256px</div>\n\t</div>\n\n\t<div class="domain-register-block section">\n\t\t<input class="domain-input" type="text" spellcheck="false" value="" placeholder="iwantmyname.com" />\n\t\t<a class="go-button common-button disabled" href="https://iwantmyname.com" target="_blank">Go</a>\n\t\t<div class="register-message">\n\t\tIf you don’t have a domain name, you can<br/>\n\t\teasly purchase one via our official partner<br/>\n\t\tiwantmyname.com using the search field above<br/>\n\t\tand have it automatically set up to work<br/>\n\t\twith Readymag.</div>\n\t</div>\n\n\t<div class="domain-set-bad-message section">Seems like your DNS settings have been changed. This domain’s <span class="domain-record-type">TEMP</span><span class="domain-set-phrase"> is currently set to </span><span class="domain-set-phrase-unknown invisible"> is not currently set</span><span class="domain-current-value">TEMP</span>. Please change the <span class="domain-record-type">TEMP</span> to: <span class="domain-needed-value">TEMP</span></div>\n\n\t<div class="domain-set-notfound-message section">Domain’s info is not available. Please check if the name is correct. Note, that sometimes it may take few hours for subdomain to be created.</div>\n\n\n\t',__p+=is_contributor?'\n\t<div class="expired-subscription-message section">Please upgrade owner’s account to map a custom domain.\n\t<div><a class="pricing-link" href="mailto:'+(null==(__t=owner_email)?"":__t)+'">Contact owner</a></div>\n\t</div>\n\t':'\n\t<div class="expired-subscription-message section">Please <a class="link" href="/settings/subscription/update">upgrade</a> your account<br/>to map a custom domain.\n\t<div><a class="pricing-link" href="/pricing" target="_blank">See the pricing</a></div>\n\t</div>\n\t',__p+='\n\n\t<!--__magterm-->\n\t<div class="unpublished-message section">In order to use custom domain mapping, you need to publish this project first.</div>\n\n\t<div class="confirm-message section">\n\t\t<span class="black">Are you sure you want<br/>to unmap '+(null==(__t="mag"==type?"this project":"your profile")?"":__t)+' from<br/><span class="domain-name">TEMP</span>?</span>\n\t\t<div class="confirm-unmap-button common-button">Yes<div class="rmpreloader"><div class="arc"></div></div></div>\n\t</div>\n\n\n\t<div class="error-message error-block section">\n\t\t<span class="black">Something went wrong.<br/>Please try again later.</span>\n\t\t<div class="try-again-button common-button">Ok</div>\n\t</div>\n\n\t<div class="dns-not-updated-yet error-block section">\n\t\t<span class="black">Seems like some DNS servers have not been updated yet.<br/>Please try again later.</span>\n\t\t<div class="try-again-button common-button">Ok</div>\n\t</div>\n\n\t<div class="wait-our-dns-server error-block section">\n\t\t<span class="black">Your domain settings are correct, but it seems like our DNS servers have not been updated yet.<br/>Please try again later.</span>\n\t\t<div class="try-again-button common-button">Ok</div>\n\t</div>\n\n\t<!--__magterm-->\n\t<div class="bottom">\n\n\t\t',"mag"==type&&(__p+='\n\t\t\t<div class="bottom-ga-gtm-active section">\n\t\t\t\t<div class="input-wrapper ga-block">\n\t\t\t\t\t<div class="caption">Google Analytics</div>\n\t\t\t\t\t<a class="info" target="_blank" href="http://help.readymag.com/ga/"></a>\n\t\t\t\t\t<input autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" type="text" name="ga_id" id="ga_id" placeholder="UA-XXXXXXX-Y">\n\t\t\t\t</div>\n\t\t\t\t<div class="input-wrapper gtm-block">\n\t\t\t\t\t<div class="caption">Google Tag Manager</div>\n\t\t\t\t\t<a class="info" target="_blank" href="http://help.readymag.com/gtm/"></a>\n\t\t\t\t\t<input autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" type="text" name="gtm_id" id="gtm_id" placeholder="GTM-XXXXXX">\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="bottom-ga-gtm-inactive section">\n\t\t\t\t<div class="input-wrapper ga-block">\n\t\t\t\t\t<div class="caption">Google Analytics</div>\n\t\t\t\t\t<a class="info" target="_blank" href="http://help.readymag.com/ga/"></a>\n\t\t\t\t\t<input disabled readonly type="text" name="ga_id" id="ga_id" placeholder="UA-XXXXXXX-Y">\n\t\t\t\t</div>\n\t\t\t\t<div class="input-wrapper gtm-block">\n\t\t\t\t\t<div class="caption">Google Tag Manager</div>\n\t\t\t\t\t<a class="info" target="_blank" href="http://help.readymag.com/gtm/"></a>\n\t\t\t\t\t<input disabled readonly type="text" name="gtm_id" id="gtm_id" placeholder="GTM-XXXXXX">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'),__p+='\n\n\n\t\t<div class="bottom-72-message section">If you don’t see '+(null==(__t="mag"==type?"your project":"your profile")?"":__t)+' or Readymag page when you visit <a class="your-site-button" href="" target="_blank">your website</a>, the DNS record might need more time to update. This can take up to 72 hours.</div>\n\n\t\t<a class="bottom-help-button section" target="_blank" href="http://help.readymag.com/domains/">Need help?</a>\n\n\t\t<div class="bottom-cancel-button section">Cancel</div>\n\n\t\t<a class="bottom-support-button section" href="mailto:'+(null==(__t=RM.constants.SUPPORT_MAIL)?"":__t)+'">Support</a>\n\n\t\t<div class="bottom-unmap-message section">Your domain name <span class="domain-name">TEMP</span> is currently using for '+(null==(__t="mag"==type?"this project":"your profile")?"":__t)+'. <div class="unmap-button">Unmap it?</div></div>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-404"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div id="page404">\n        <table>\n            <tr>\n                <td>\n                    <div class="caption">Page Not Found.</div>\n                    <div class="message">Sorry, there’s nothing here.<br/>Visit our <a class="front-page-link" href="/">front page</a>.</div>\n                </td>\n            </tr>\n        </table>\n    </div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-mag-suspended"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="magsuspended-container">\n\t\t<div class="img-preloader"></div>\n\t\t<div class="center-table">\n\t\t\t<div class="center-cell">\n\t\t\t\t<div class="center-content">\n\t\t\t\t\t<div class="caption">Suspended</div>\n\t\t\t\t\t<!--__magterm-->\n\t\t\t\t\t<div class="text">Sorry, this project has been suspended due to violation of Readymag’s <a class="link guides-link nowrap" href="https://readymag.com/readymag/terms-and-privacy/">content guidelines</a>.</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<a class="link contact" href="mailto:'+(null==(__t=RM.constants.SUPPORT_MAIL)?"":__t)+'">Contact us</a>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-user-suspended"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="usersuspended-container">\n\t\t<div class="img-preloader"></div>\n\t\t<div class="center-table">\n\t\t\t<div class="center-cell">\n\t\t\t\t<div class="center-content">\n\t\t\t\t\t<div class="caption">Suspended</div>\n\t\t\t\t\t<!--__magterm-->\n\t\t\t\t\t<div class="text">Sorry, this account has been suspended due to violation of Readymag’s <a class="link guides-link nowrap" href="https://readymag.com/readymag/terms-and-privacy/">content guidelines</a>.</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<a class="link contact" href="mailto:'+(null==(__t=RM.constants.SUPPORT_MAIL)?"":__t)+'">Contact us</a>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-common-domain-errors"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="domain-errors">\n\t\t<div class="message">\n\t\t\t',(state.magNotFound||state.domainNotFound)&&(__p+='\n\t\t\t<div class="message-caption">Website is almost here</div>\n\t\t\t<!--__magterm-->\n\t\t\t<div class="message-text">To complete the setup, please hit <br class="br-phone"/>the “Map Now” <br class="br-desktop"/>button in your <br class="br-phone"/>projects’s settings.</div>\n\t\t\t<a class="help-phone" href="http://help.readymag.com/domains/">Need Help?</a>\n\t\t\t'),__p+="\n\t\t\t",state.magNotPublished&&(__p+='\n\t\t\t<div class="message-caption">Website is Offline</div>\n\t\t\t<!--__magterm-->\n\t\t\t<div class="message-text">This project has been unpublished.</div>\n\t\t\t'),__p+="\n\t\t\t",state.subscriptionExpired&&(__p+='\n\t\t\t<div class="message-caption">Website is Offline</div>\n\t\t\t<div class="message-text"><a href="'+(null==(__t=RM.constants.readymag_auth_host)?"":__t)+'/settings/subscription/">Log in</a> to manage your subscription.</div>\n\t\t\t'),__p+='\n\t\t</div>\n\n\t\t<a class="logo" href="'+(null==(__t=RM.constants.readymag_host)?"":__t)+'"></a>\n\n\t\t',(state.magNotFound||state.domainNotFound)&&(__p+='\n\t\t<a class="help" href="http://help.readymag.com/domains/">Need Help?</a>\n\t\t'),__p+="\n\t</div>\n\n";return __p}.apply(this,arguments))},RM.templates["template-common-slideshow-player"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-slideshow environment-'+(null==(__t=tp)?"":_.escape(__t))+'">\n\t\t<div class="images no-rmswipe">\n\t\t\t<div class="images-wrapper">\n\t\t\t</div>\n\t\t\t<div class="fullscreen">\n\t\t\t\t<svg class="fullscreen-off" xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24">\n\t\t\t\t\t<path class="fullscreen-path-1" d="M4 14 L4 20 L10 20  Z M14 4 L20 4 L20 10  Z " style="fill:#ffffff; stroke:none; stroke-width:0"></path>\n\t\t\t\t\t<path class="fullscreen-path-2" d="M10 14 L5 19 M14 10 L19 5" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:2px"></path>\n\t\t\t\t</svg>\n\t\t\t\t<svg class="fullscreen-on" xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24">\n\t\t\t\t\t<path class="fullscreen-path-1" d="M5 13 L11 13 L11 19  Z M13 5 L19 11 L13 11  Z " style="fill:#ffffff; stroke:none; stroke-width:0"></path>\n\t\t\t\t\t<path class="fullscreen-path-2" d="M10 14 L5 19 M14 10 L19 5" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:2px"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="bottom-arrows">\n\t\t\t\t<div class="prev-picture-arrow-bottom">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t\t<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="next-picture-arrow-bottom">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t\t<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="counters-text">\n\t\t\t\t\t<span class="counters-text-current">1</span>/<span class="counters-text-total">2</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\t\t\t<div class="prev-picture-arrow-middle">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\n\t\t\t<div class="next-picture-arrow-middle">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\n\t\t</div>\n\n\t\t<div class="thumbnails no-rmswipe">\n\t\t\t<div class="scroll-wrapper">\n\t\t\t\t<div class="items-wrapper has-horizontal-scroll">\n\t\t\t\t\t<div class="items">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="counters no-rmswipe">\n\t\t\t<div class="scroll-wrapper">\n\t\t\t\t<div class="items-wrapper has-horizontal-scroll">\n\t\t\t\t\t<div class="items">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="captions">\n\t\t\t',
"constructor"==tp&&(__p+='\n\t\t\t\t<textarea class="caption" maxlength="9999" placeholder="Type image caption here"></textarea>\n\t\t\t'),__p+="\n\t\t</div>\n\t</div>\n\n";return __p}.apply(this,arguments))},RM.templates["template-common-user-menu"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='\n\t<div class="collector-menu '+(null==(__t=showUpgradeButton?"show-upgrade-button":"")?"":__t)+'" id="global-menu">\n\t\t';var innerLink="link",outerLink="",meLink=me.getLink();"homepage"==tp&&(innerLink="",outerLink="link",meLink=RM.constants.readymag_auth_host+me.getLink()),__p+='\n\n\t\t<a href="/" class="logo '+(null==(__t=outerLink)?"":_.escape(__t))+'"></a>\n\n\t\t<div class="separator"></div>\n\n\t\t<a class="upgrade-button '+(null==(__t=innerLink)?"":_.escape(__t))+'" href="/settings/subscription/update"><div class="icon"></div>Upgrade</a>\n\n\t\t<div class="create-button"><div class="icon"></div>Create</div>\n\n\t\t<div class="user-button">\n\t\t\t<a class="userpic '+(null==(__t=innerLink)?"":_.escape(__t))+'" href="'+(null==(__t=meLink)?"":_.escape(__t))+'" style="background-image:url(\''+(null==(__t=me.getUserpic(48))?"":_.escape(__t))+'\')"></a>\n\t\t\t<div class="arrow"><div class="icon"></div></div>\n\t\t\t',me.get("email_confirmation_date")||(__p+=' <div class="notification-icon">1</div> '),__p+='\n\t\t</div>\n\n\t\t<div class="user-popup">\n\t\t\t<a class="user-block '+(null==(__t=innerLink)?"":_.escape(__t))+'" href="'+(null==(__t=meLink)?"":_.escape(__t))+'">\n\t\t\t\t<div class="username-wrapper-outer">\n\t\t\t\t\t<div class="username-wrapper">\n\t\t\t\t\t\t<div class="username">'+(null==(__t=me.get("name"))?"":_.escape(__t))+'</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\n\t\t\t<div class="popup-separator"></div>\n\n\t\t\t<a class="settings '+(null==(__t=innerLink)?"":_.escape(__t))+'" href="/settings"><div class="icon"></div>Settings</a>\n\n\t\t\t<div class="create-warning">\n\t\t\t\t<div class="icon"></div>\n\t\t\t\t<!--__magterm-->\n\t\t\t\t<div class="message">To create a project please switch to your laptop or desktop computer</div>\n\t\t\t</div>\n\n\t\t\t<div class="popup-separator"></div>\n\n\t\t\t<a class="logout" href="/logout/"><div class="icon"></div>Logout</a>\n\n\t\t\t<div class="popup-separator"></div>\n\n\t\t\t',me.get("email_confirmation_date")||(__p+='\n\t\t\t\t<div class="notifications-wrapper">\n\t\t\t\t\t<div class="verify-email">Please verify your email. <span>Resend</span>.</div>\n\t\t\t\t</div>\n\t\t\t '),__p+='\n\n\t\t\t<div class="popup-footer">\n\t\t\t\t<a href="https://readymag.com/readymag/terms-and-privacy/" class="'+(null==(__t=Modernizr.isboxversion?"disabled":"")?"":__t)+'" target="_blank">Privacy & Terms</a><span></span><a class="from-user-menu mailto-support" href="https://help.readymag.com" target="_blank">Support</a><span></span><a href="https://readymag.com/readymag/newsletter/" target="_blank">R/m Newsletter</a>\n\t\t\t</div>\n\n\t\t\t<div class="corner-wrapper">\n\t\t\t\t<div class="corner"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n'}return __p}.apply(this,arguments))},RM.templates["template-common-user-menu-unlogged"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t\t";var innerLink="link",outerLink="";"homepage"==tp&&(innerLink="",outerLink="link"),__p+='\n\n\t<a class="collector-menu-unlogged '+(null==(__t=outerLink)?"":_.escape(__t))+'" id="global-menu" href="/"></a>\n'}return __p}.apply(this,arguments))},RM.templates["template-common-whats-new"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="whats-new">\n\t\t<div class="panel-wrapper">\n\t\t\t<div class="panel">\n\t\t\t\t<div class="content">\n\t\t\t\t\t<div class="wn-page" data-date="2013-11-19">\n\t\t\t\t\t\t<div class="caption">What\'s new</div>\n\t\t\t\t\t\t<div class="date">November 19<span>th</span></div>\n\t\t\t\t\t\t<div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing Domain Mapping<br/>and New Price.</div>\n\t\t\t\t\t\t<a class="learn-more" href="https://readymag.com/p43952/" target="blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2013-12-16">\n\t\t\t\t\t\t<div class="caption">What\'s new</div>\n\t\t\t\t\t\t<div class="date">December 16<span>th</span></div>\n\t\t\t\t\t\t<div class="picture"></div>\n\t\t\t\t\t\t<!--__magterm-->\n\t\t\t\t\t\t<div class="text">Duplicating projects, Instagram<br/>and SVG support.</div>\n\t\t\t\t\t\t<a class="learn-more" href="https://readymag.com/p53035/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2014-01-20">\n\t\t\t\t\t\t<div class="caption">What\'s new</div>\n\t\t\t\t\t\t<div class="date">January 20<span>th</span></div>\n\t\t\t\t\t\t<div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Rotation tool.<br/>Grouping widgets.<br/>Faster background images loading.<br/>Bug fixes.</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2014-02-03">\n\t\t\t\t\t\t<div class="caption">What\'s new</div>\n\t\t\t\t\t\t<div class="date">February 4<span>th</span></div>\n\t\t\t\t\t\t<div class="picture">\n\t\t\t\t\t\t\t<div class="line"></div>\n\t\t\t\t\t\t\t<div class="line"></div>\n\t\t\t\t\t\t\t<div class="line"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>Viewer 1.0</div>\n\t\t\t\t\t\t<a class="learn-more" href="https://readymag.com/p67765/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2014-03-04">\n\t\t\t\t\t\t<div class="caption">What\'s new</div>\n\t\t\t\t\t\t<div class="date">March 4<span>th</span></div>\n\t\t\t\t\t\t<div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Custom Templates<br/>and iFrame</div>\n\t\t\t\t\t\t<a class="learn-more" href="https://readymag.com/p85654/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2014-03-19">\n\t\t\t\t\t\t<div class="caption">What\'s new</div>\n\t\t\t\t\t\t<div class="date">March 19<span>th</span></div>\n\t\t\t\t\t\t<div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Track your audience with<br/>Google Analytics</div>\n\t\t\t\t\t\t<a class="learn-more" href="http://help.readymag.com/ga/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n                    <div class="wn-page" data-date="2014-04-14">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">April 14<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing<br/>Viewport & Mobile Viewer</div>\n                        <a class="learn-more" href="https://readymag.com/p100897/" target="_blank">Learn More</a>\n                    </div>\n                    <div class="wn-page" data-date="2014-06-24">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">June 24<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing<br/>Font Explorer</div>\n                        <a class="learn-more" href="https://readymag.com/p151687/" target="_blank">Learn More</a>\n                    </div>\n                    <div class="wn-page" data-date="2014-08-04">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">August 4<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing New<br/>Webfonts</div>\n                        <a class="learn-more" href="https://readymag.com/p156787/" target="_blank">Learn More</a>\n                    </div>\n                    <div class="wn-page" data-date="2014-09-04">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">September 4<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing<br/>Template Center</div>\n                        <a class="learn-more" href="https://readymag.com/p172473/" target="_blank">Learn More</a>\n                    </div>\n                    <div class="wn-page" data-date="2014-09-30">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">September 30<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing<br/>PDF Export</div>\n                        <a class="learn-more" href="https://readymag.com/p185021/" target="_blank">Learn More</a>\n                    </div>\n                    <div class="wn-page" data-date="2014-11-05">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">November 5<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing<br/>100,000 icons</div>\n                        <a class="learn-more" href="https://readymag.com/p220371/" target="_blank">Learn More</a>\n                    </div>\n                    <div class="wn-page" data-date="2014-12-09">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">December 9<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing<br/>Link Styles & Fix Position</div>\n                        <a class="learn-more" href="https://readymag.com/p243325/" target="_blank">Learn More</a>\n                    </div>\n                    <div class="wn-page" data-date="2015-01-29">\n                        <div class="caption">What\'s new</div>\n                        <div class="date">January 29<span>th</span></div>\n                        <div class="picture"></div>\n                        <div class="text">Introducing<br/>New Embeds</div>\n                        <a class="learn-more" href="https://readymag.com/p288252/" target="_blank">Learn More</a>\n                    </div>\n\t\t\t\t\t<div class="wn-page" data-date="2015-02-10">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">February 10<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t    <div class="text">2 Little Things:<br/>Trash & Pages URLs</div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p304538/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2015-03-04">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">March 4<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>Viewer 2.0</div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p325057/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2015-04-14">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">April 14<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>Scroll Navigation</div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p360474/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2015-05-14">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">May 14<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>Buttons, Anchors &amp; Full Width</div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p430667/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Special terms agree message. For next terms change just increase version number in backend config and set new data-date to show. This block position inside template does not matter -->\n\t\t\t\t\t<div class="wn-page agree-terms" data-version="'+(null==(__t=RM.constants.CURRENT_TERMS_VERSION)?"":__t)+'" data-date="2015-09-02">\n\t\t\t\t\t    <div class="caption">UPDATE</div>\n\t\t\t\t\t    <div class="date">Terms of Service</div>\n\t\t\t\t\t\t<div class="text">Hey!<br/>We’ve recently slightly updated our <a href="https://readymag.com/readymag/terms-and-privacy/" target="_blank">Terms of Service</a> due to launching the new Teamwork feature. Please review the changes, as by continuing to use Readymag you automatically accept them. Have a great day!</div>\n\t\t\t\t\t    <div class="learn-more agree-terms-button">I agree</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<!-- Special terms agree message end -->\n\n\t\t\t\t\t<div class="wn-page" data-date="2015-09-03">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">Sep 3<span>rd</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>Teamwork</div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p683180/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="wn-page" data-date="2015-10-09">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">Oct 9<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>Hotspot</div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p921047/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="wn-page" data-date="2015-11-18">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">Nov 18<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>5 Tiny Features</div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p1016246/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2016-01-20">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">Jan 19<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t\t<div class="text">Introducing<br/>Animations</div>\n\t\t\t\t\t    <a class="learn-more" href="http://animations.readymag.com/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2016-04-12">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">Apr 12<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p1351980/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2016-08-04">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">Aug 4<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p1617587/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wn-page" data-date="2016-09-29">\n\t\t\t\t\t    <div class="caption">What\'s new</div>\n\t\t\t\t\t    <div class="date">Sep 29<span>th</span></div>\n\t\t\t\t\t    <div class="picture"></div>\n\t\t\t\t\t    <a class="learn-more" href="https://readymag.com/p1730817/" target="_blank">Learn More</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="close"></div>\n\t\t\t\t<div class="arrow up disabled"></div>\n\t\t\t\t<div class="arrow down"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-branding"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rm-branding offscreen-initially">\n\t<a class="rm-branding-button" href="https://readymag.com" target="_blank"></a>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-final-page"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){if(__p+='\r\n\r\n\t<div class="final-page offscreen hidden '+(null==(__t=isStickyVerticalViewer?"":"has-vertical-scroll")?"":__t)+'">\r\n\t\t<div class="final-page-wrapper tp-'+(null==(__t=tp)?"":_.escape(__t))+'">\r\n\t\t\t<div class="final-page-container">\r\n\r\n\t\t\t\t<div class="main-container">\r\n\t\t\t\t\t<div class="social-wrapper">\r\n\r\n\t\t\t\t\t\t<a href="'+(null==(__t=mag.model.user.getLink())?"":_.escape(__t))+'" class="link userpic '+(null==(__t=RM.common.isDownloadedSource?"inactive-link":"")?"":__t)+'" style="background-image:url(\''+(null==(__t=mag.model.user.getUserpic(128))?"":__t)+'\')"></a>\r\n\r\n\t\t\t\t\t\t<div class="mag-title selectable">'+(null==(__t=mag.title)?"":_.escape(__t))+'</div>\r\n\r\n\t\t\t\t\t\t<div class="user-name selectable">by <a href="'+(null==(__t=mag.model.user.getLink())?"":_.escape(__t))+'" class="full-name link '+(null==(__t=RM.common.isDownloadedSource?"inactive-link":"")?"":__t)+'">'+(null==(__t=mag.user.name)?"":_.escape(__t))+'</a></div>\r\n\r\n\t\t\t\t\t\t<div class="share-wrapper">\r\n\t\t\t\t\t\t\t<div class="share-caption">Share</div>\r\n\t\t\t\t\t\t\t<div class="like-tweet '+(null==(__t=disableSocials?"disabled":"")?"":__t)+'">\r\n\t\t\t\t\t\t\t\t<div id="fb-root"></div>\r\n\t\t\t\t\t\t\t\t<div class="fb-like" data-href="'+(null==(__t=magLink)?"":_.escape(__t))+'" data-layout="box_count" data-action="like" data-show-faces="false" data-share="false"></div>\r\n\t\t\t\t\t\t\t\t<div class="spacer"></div>\r\n\t\t\t\t\t\t\t\t<a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" data-url="'+(null==(__t=magLink)?"":_.escape(__t))+'" data-text="'+(null==(__t=tweetText)?"":_.escape(__t))+'">Tweet</a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class="share-facebook sprite '+(null==(__t=disableSocials?"disabled":"")?"":__t)+' share-button" data-tp="facebook"></div>\r\n\t\t\t\t\t\t\t<div class="share-twitter sprite '+(null==(__t=disableSocials?"disabled":"")?"":__t)+' share-button" data-tp="twitter"></div>\r\n\t\t\t\t\t\t\t<div class="share-pinterest sprite '+(null==(__t=disableSocials?"disabled":"")?"":__t)+' share-button" data-tp="pinterest"></div>\r\n\t\t\t\t\t\t\t<div class="share-gplus sprite '+(null==(__t=disableSocials?"disabled":"")?"":__t)+' share-button" data-tp="gplus"></div>\r\n\t\t\t\t\t\t\t<div class="share-mail sprite '+(null==(__t=disableSocials?"disabled":"")?"":__t)+' share-button" data-tp="email"></div>\r\n\r\n\t\t\t\t\t\t\t',Modernizr.isboxversion||RM.common.isDownloadedSource||(__p+='\r\n\t\t\t\t\t\t\t\t<div class="share-embed '+(null==(__t=disableSocials?"disabled":"")?"":__t)+'">Embed</div>\r\n\t\t\t\t\t\t\t\t<div class="share-report sprite '+(null==(__t=disableSocials?"disabled":"")?"":__t)+' share-button" data-tp="report"></div>\r\n\t\t\t\t\t\t\t'),__p+='\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class="embed-wrapper hidden">\r\n\t\t\t\t\t\t<div class="caption">Embed</div>\r\n\r\n\t\t\t\t\t\t<div class="size-selector" data-selected="responsive">\r\n\t\t\t\t\t\t\t<div class="size responsive" data-size="responsive">Responsive</div>\r\n\t\t\t\t\t\t\t<div class="size big" data-size="big">512×383</div>\r\n\t\t\t\t\t\t\t<div class="size small" data-size="small">288×236</div>\r\n\t\t\t\t\t\t\t<div class="arrow sprite"></div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class="code-block">\r\n\t\t\t\t\t\t\t<img class="thumb-pic" src="" alt=""/>\r\n\r\n\t\t\t\t\t\t\t',__p+=Modernizr.isphone?'\r\n\t\t\t\t\t\t\t<input type="text" class="embed-code">\r\n\t\t\t\t\t\t\t':'\r\n\t\t\t\t\t\t\t<textarea class="embed-code" wrap="off"></textarea>\r\n\t\t\t\t\t\t\t',__p+='\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class="embed-close">Close</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t',"recent"==tp){if(__p+='\r\n\t\t\t\t\t<div class="dop-container-recent">\r\n\t\t\t\t\t\t<div class="caption">More from</div>\r\n\t\t\t\t\t\t<div class="sub-caption"><a href="'+(null==(__t=mag.model.user.getLink())?"":_.escape(__t))+'" class="link" '+(null==(__t=RM.common.embedMode?'target="_blank"':"")?"":__t)+">"+(null==(__t=mag.user.name)?"":_.escape(__t))+"</a></div>\r\n\t\t\t\t\t\t",specialRecentView){var mag=recentMags.models[0];__p+='\r\n\t\t\t\t\t\t\t<div class="recent-mag-special">\r\n\t\t\t\t\t\t\t\t<a class="overlay related-link" href="'+(null==(__t=mag.getLink())?"":_.escape(__t))+'" '+(null==(__t=RM.common.embedMode?'target="_blank"':"")?"":__t)+'>\r\n\t\t\t\t\t\t\t\t\t<div class="mag-cover" style="background-image:url(\''+(null==(__t=mag.getPageScreenshot(304,{cover:!0}))?"":__t)+'\')"></div><br/>\r\n\t\t\t\t\t\t\t\t\t<div class="mag-title">'+(null==(__t=mag.get("title"))?"":_.escape(__t))+'</div><br/>\r\n\t\t\t\t\t\t\t\t\t<div class="mag-pages">'+(null==(__t=mag.getPagesCount())?"":__t)+" "+(null==(__t=RM.utils.declination("pages","page","pages",mag.getPagesCount()))?"":__t)+"</div>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t"}else recentMags.each(function(t){__p+='<div class="recent-mag">\r\n\t\t\t\t\t\t\t\t<div class="cover" style="background-image:url(\''+(null==(__t=t.getPageScreenshot(144,{cover:!0}))?"":__t)+'\')"></div>\r\n\t\t\t\t\t\t\t\t<a class="overlay related-link" href="'+(null==(__t=t.getLink())?"":_.escape(__t))+'" '+(null==(__t=RM.common.embedMode?'target="_blank"':"")?"":__t)+'>\r\n\t\t\t\t\t\t\t\t\t<div class="overlay-wrapper">\r\n\t\t\t\t\t\t\t\t\t\t<div class="overflow-block">'+(null==(__t=t.get("title"))?"":_.escape(__t))+"</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</div>"});__p+="\r\n\t\t\t\t\t</div>\r\n\t\t\t\t"}__p+="\r\n\r\n\r\n\t\t\t\t","join"==tp&&(__p+='\r\n\t\t\t\t\t<div class="dop-container-join">\r\n\t\t\t\t\t\t<a class="made-with" href="'+(null==(__t=RM.constants.readymag_host)?"":__t)+'">Made with<div class="icon sprite"></div></a>\r\n\r\n\t\t\t\t\t\t<div class="join ljr-panel">\r\n\t\t\t\t\t\t\t<div class="buttons-panel">\r\n\t\t\t\t\t\t\t\t<div class="panel-caption">Create your own <br/>web publications!</div>\r\n\t\t\t\t\t\t\t\t<div class="social-auth" data-provider=\'facebook\'><div class="icon sprite"></div>Sign up with Facebook</div>\r\n\t\t\t\t\t\t\t\t<div class="social-auth" data-provider=\'google\'><div class="icon sprite"></div>Continue with Google</div>\r\n\t\t\t\t\t\t\t\t<div class="use-email" data-provider=\'native\'><div class="icon sprite"></div>Use your Email</div>\r\n\t\t\t\t\t\t\t\t<a class="learn-more" href="'+(null==(__t=RM.constants.readymag_host)?"":__t)+'">Learn More</a>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class="native-join">\r\n\t\t\t\t\t\t\t\t<input autocapitalize="on"  autocorrect="off" required="required" class="fullname-input input-template"  maxlength="24" type="text"     spellcheck="false" value="" placeholder="Name" />\r\n\t\t\t\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"     type="email"    spellcheck="false" value="" placeholder="Email" />\r\n\t\t\t\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="password-input input-template"  type="password" spellcheck="false" value="" placeholder="Password" />\r\n\t\t\t\t\t\t\t\t<div class="go">Join</div>\r\n\r\n\t\t\t\t\t\t\t\t<div class="cancel">Cancel</div>\r\n\t\t\t\t\t\t\t\t<div class="error"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t'),__p+="\r\n\r\n\r\n\t\t\t\t","join"!=tp&&(__p+='\r\n\t\t\t\t\t<a class="logo" href="'+(null==(__t=RM.constants.readymag_host)?"":__t)+'">Powered by<div class="icon sprite"></div></a>\r\n\t\t\t\t'),__p+="\r\n\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n"}return __p}.apply(this,arguments))},RM.templates["template-viewer-mag-menu"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\r\n\r\n\t<div class="mag-menu '+(null==(__t=hasProjectInfo?"":"no-project-info")?"":__t)+'">\r\n\t\t<div class="menu-wrapper">\r\n\r\n\t\t\t',hasProjectInfo&&(__p+='\r\n\t\t\t\t<div class="menu-info">\r\n\r\n\t\t\t\t\t<a class="link '+(null==(__t=RM.common.isDownloadedSource?"inactive-link":"")?"":__t)+'" href="'+(null==(__t=mag.model.user.getLink())?"":_.escape(__t))+'">\r\n\t\t\t\t\t\t<div class="userpic" style="background-image:url(\''+(null==(__t=mag.model.user.getUserpic(64))?"":__t)+'\')"></div>\r\n\t\t\t\t\t\t<div class="username">'+(null==(__t=mag.user.name)?"":_.escape(__t))+'</div>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t\t<div class="published-by" data_caption="published by" data_date="'+(null==(__t=publishDate)?"":__t)+'"></div>\r\n\t\t\t\t\t<div class="mag-title">'+(null==(__t=mag.title)?"":_.escape(__t))+"</div>\r\n\t\t\t\t</div>\r\n\t\t\t"),__p+='\r\n\r\n\t\t\t<div class="scroll-wrapper">\r\n\r\n\t\t\t\t',RM.common.isDomainViewer||Modernizr.android||(__p+='\r\n\t\t\t\t\t<a class="logo-wrapper" href="/">\r\n\t\t\t\t\t\t<div class="made-with"> Made with</div>\r\n\t\t\t\t\t\t<div class="logo sprite"></div>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t'),__p+='\r\n\r\n\t\t\t\t<div class="pages-wrapper has-'+(null==(__t=viewerType)?"":__t)+'-scroll">\r\n\t\t\t\t\t<div class="pages">\r\n\r\n\t\t\t\t\t\t',_.each(pages,function(t,e){var i="horizontal"==viewerType?"left":"top",n=e*("horizontal"==viewerType?width:height);__p+='\r\n\t\t\t\t\t\t\t<div class="page" data-id="'+(null==(__t=t._id)?"":__t)+'" data-num="'+(null==(__t=t.num)?"":__t)+'" data-src="'+(null==(__t=mag.model.getPageScreenshot(width,{_id:t._id}))?"":__t)+'" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+"px;"+(null==(__t=i)?"":__t)+":"+(null==(__t=n)?"":__t)+'px">\r\n\t\t\t\t\t\t\t\t<img class="screenshot" src="'+(null==(__t=stub)?"":__t)+'" />\r\n\t\t\t\t\t\t\t\t<div class="num '+(null==(__t=t.num>99?"over99":"")?"":__t)+'">'+(null==(__t=t.num)?"":__t)+"</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t"}),__p+="\r\n\r\n\t\t\t\t\t\t",!RM.common.isDomainViewer&&Modernizr.android&&(__p+='\r\n\t\t\t\t\t\t\t<a class="logo-wrapper" href="/">\r\n\t\t\t\t\t\t\t\t<div class="made-with"> Made with</div>\r\n\t\t\t\t\t\t\t\t<div class="logo sprite"></div>\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t'),__p+='\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="scroll"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-mag-password"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="magpassword-container">\n\t\t<div class="img-preloader"></div>\n\t\t<div class="back invisible"></div>\n\t\t<div class="center-table">\n\t\t\t<div class="center-cell">\n\t\t\t\t<div class="center-content invisible">\n\t\t\t\t\t<!--__magterm-->\n\t\t\t\t\t<div class="caption-private">This is a private project.<br/><span class="nowrap">Enter the password:</span></div>\n\t\t\t\t\t<div class="password-wrapper">\n\t\t\t\t\t\t<div class="input-wrapper">\n\t\t\t\t\t\t\t<input type="password" class="password-input" id="magpassword-input" required>\n\t\t\t\t\t\t\t<div class="access disabled">Access</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t',user.get("permissions")&&user.get("permissions").white_label||(__p+='\n\t\t\t<div class="author invisible">\n\t\t\t\t<div class="userpic">\n\t\t\t\t\t<a href="'+(null==(__t=user.getLink())?"":_.escape(__t))+'"><img src="'+(null==(__t=user.getUserpic(128))?"":_.escape(__t))+'" alt=""></a>\n\t\t\t\t\t<a href="'+(null==(__t=user.getLink())?"":_.escape(__t))+'"><div class="username">'+(null==(__t=user.get("name"))?"":_.escape(__t))+'</div></a>\n\t\t\t\t</div>\n\t\t\t\t<div class="caption">Published by</div>\n\t\t\t</div>\n\t\t\t<div class="powered invisible">\n\t\t\t\t<div class="caption-powered">Made with</div>\n\t\t\t\t<a href="'+(null==(__t=RM.constants.readymag_host)?"":__t)+'"><div class="logo-powered"></div></a>\n\t\t\t</div>\n\t\t'),__p+="\n\t</div>\n";return __p}.apply(this,arguments))},RM.templates["template-viewer-mag"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="mag">\n\t\t<div class="mag-pages-container">\n\t\t\t<div class="container disable-transitions">\n\n\t\t\t\t<div class="blackout"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t',hasStandaloneBottomArrow&&(__p+='\n\t\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite"></div></div>\n\t\t'),__p+="\n\n\n\t\t",isPreview&&(__p+='\n\t\t\t<div class="mag-pages-viewport-device"></div>\n\t\t'),__p+="\n\t</div>\n\n";return __p}.apply(this,arguments))},RM.templates["template-viewer-navigation"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="navigation">\n\t\t<div class="navigation-arrow left offscreen"><div class="icon sprite"></div></div>\n\t\t<div class="navigation-arrow right offscreen"><div class="icon sprite"></div></div>\n\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite"></div></div>\n\t</div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-page"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="page hidden">\n\t\t<div class="page-fixed-bg-container"></div>\n\t\t<div class="fixed-position-container-top"></div>\n\t\t<div class="fixed-position-container"></div>\n\t\t<div class="content-scroll-wrapper '+(null==(__t=isStickyVerticalViewer?"":"has-vertical-scroll")?"":__t)+'">\n\t\t\t<div class="content-bounds">\n\t\t\t\t<div class="page-content-container" tabindex="-1"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-share"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\n\t",hasOverlay&&(__p+='\n\t\t<div class="share-popup-overlay hidden"></div>\n\t'),__p+='\n\n\t<div class="share-popup hidden">\n\t\t<div class="content-wrapper">\n\n\t\t\t<div class="share-wrapper">\n\t\t\t\t<div class="caption">Share</div>\n\n\t\t\t\t<div class="type-selector">\n\t\t\t\t\t<!--__magterm-->\n\t\t\t\t\t<div class="type-full">Project</div>\n\t\t\t\t\t<div class="type-page">Current Page</div>\n\t\t\t\t\t<div class="arrow sprite"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="buttons-wrapper">\n\t\t\t\t\t<div class="share-facebook button" data-tp="facebook"><div class="icon sprite"></div>Share</div>\n\t\t\t\t\t<div class="share-twitter button" data-tp="twitter"><div class="icon sprite"></div>Tweet</div>\n\t\t\t\t\t<div class="share-gplus button" data-tp="gplus"><div class="icon sprite"></div>Google+</div>\n\t\t\t\t\t<div class="share-pinterest button" data-tp="pinterest"><div class="icon sprite"></div>Pin</div>\n\t\t\t\t\t<div class="share-linkedin button" data-tp="linkedin"><div class="icon sprite"></div>Linkedin</div>\n\t\t\t\t\t<div class="share-mail button" data-tp="email"><div class="icon sprite"></div>Email</div>\n\t\t\t\t</div>\n\n\t\t\t\t',Modernizr.isboxversion||RM.common.isDownloadedSource||(__p+='\n\t\t\t\t\t<div class="open-embed"><div class="icon sprite"></div>Embed</div>\n\t\t\t\t\t<div class="close">Close</div>\n\t\t\t\t\t<div class="send-report" data-tp="report"><div class="icon sprite"></div>Report</div>\n\t\t\t\t'),__p+="\n\t\t\t</div>\n\n\t\t\t",Modernizr.isboxversion||RM.common.isDownloadedSource||(__p+='\n\t\t\t\t<div class="embed-wrapper">\n\t\t\t\t\t<div class="caption">Embed</div>\n\n\t\t\t\t\t<div class="size-selector" data-selected="responsive">\n\t\t\t\t\t\t<div class="size responsive" data-size="responsive">Responsive</div>\n\t\t\t\t\t\t<div class="size big" data-size="big">512×383</div>\n\t\t\t\t\t\t<div class="size small" data-size="small">288×236</div>\n\t\t\t\t\t\t<div class="arrow sprite"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="code-block">\n\t\t\t\t\t\t<div class="thumb">\n\t\t\t\t\t\t\t<img class="thumb-pic" src="" alt=""/>\n\t\t\t\t\t\t\t<div class="thumb-toolbar">\n\t\t\t\t\t\t\t\t<div class="icon arrows"></div>\n\t\t\t\t\t\t\t\t<div class="icon open"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<textarea class="embed-code"></textarea>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="back">Back</div>\n\t\t\t\t</div>\n\t\t\t'),
__p+='\n\t\t</div>\n\n\t\t<div class="corner-wrapper">\n\t\t\t<div class="corner"></div>\n\t\t</div>\n\t</div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-toolbar"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='\n\n\t<div class="toolbar for-viewer">\n\n\t\t';var offscreenClass=isPreview||RM.common.embedMode?"":"offscreen-initially";__p+="\n\n\t\t",hasPageCounter&&!pageCounterInsideMenu&&(__p+='\n\t\t\t<div class="page-counter-wrapper '+(null==(__t=offscreenClass)?"":__t)+'">\n\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total">'+(null==(__t=totalPages)?"":__t)+"</span></div>\n\t\t\t</div>\n\t\t"),__p+="\n\n\t\t",hasShare&&(__p+='\n\t\t\t<div class="share-button sprite '+(null==(__t=offscreenClass)?"":__t)+'" data-alt="Share" data-alt-pos="bottom" data-alt-offset="9"></div>\n\t\t'),__p+="\n\n\t\t",hasMenu&&(__p+='\n\t\t\t<div class="menu-button '+(null==(__t=offscreenClass)?"":__t)+'" data-alt="Menu (M)" data-alt-pos="bottom" data-alt-offset="9">\n\t\t\t\t',hasPageCounter&&pageCounterInsideMenu&&(__p+='\n\t\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total">'+(null==(__t=totalPages)?"":__t)+"</span></div>\n\t\t\t\t"),__p+='\n\t\t\t\t<div class="line-1"></div>\n\t\t\t\t<div class="line-2"></div>\n\t\t\t\t<div class="line-3"></div>\n\t\t\t\t<div class="page-preloader sprite"></div>\n\t\t\t</div>\n\t\t'),__p+="\n\n\t\t",RM.common.embedMode&&(__p+='\n\t\t\t<div class="embed-close-button '+(null==(__t=offscreenClass)?"":__t)+'">Close</div>\n\t\t'),__p+="\n\n\t</div>\n\n"}return __p}.apply(this,arguments))},RM.templates["template-viewer-widget"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rmwidget"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-widget-background"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rmwidget widget-background" style="background-color: #'+(null==(__t=data.color)?"":__t)+'">\n\n        ',"picture"==data.selectedType&&(__p+='\n            <div class="picture-background" style="opacity: '+(null==(__t=data.opacity||1)?"":__t)+';"></div>\n        '),__p+="\n\n        ","video"==data.selectedType&&(__p+='\n            <div class="video-background" style="opacity: '+(null==(__t=data.videoopacity||1)?"":__t)+';">\n                <div class="video-container"></div>\n                <div class="overlay"></div>\n            </div>\n        '),__p+="\n\t</div>\n";return __p}.apply(this,arguments))},RM.templates["template-viewer-widget-button"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <input class="text"\n           value="'+(null==(__t=data.text)?"":_.escape(__t))+'"\n           type="text"\n           disabled\n           readonly\n           autocapitalize="off"\n           autocorrect="off"\n           autocomplete="off"\n           spellcheck="false"\n           role="button"\n           name="'+(null==(__t=data.text)?"":_.escape(__t))+'"/>\n\n';return __p}.apply(this,arguments))},RM.templates["template-viewer-widget-text"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var cc=1==column_count?"auto":column_count;__p+='\n\t<div style=" -webkit-nbsp-mode:space; -webkit-line-break:after-white-space; column-count:'+(null==(__t=cc)?"":__t)+";-webkit-column-count:"+(null==(__t=cc)?"":__t)+" !important;-moz-column-count:"+(null==(__t=cc)?"":__t)+";column-gap:"+(null==(__t=column_gap)?"":__t)+"px;-webkit-column-gap:"+(null==(__t=column_gap)?"":__t)+"px !important;-moz-column-gap:"+(null==(__t=column_gap)?"":__t)+"px;background:"+(null==(__t=bg)?"":_.escape(__t))+'">'+(null==(__t=text)?"":__t)+"</div>\n"}return __p}.apply(this,arguments))},RM.templates["template-constructor-block-audio"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="player-wrapper"></div>\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-button"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <input class="text"\n           value="'+(null==(__t=data.text)?"":_.escape(__t))+'"\n           type="text"\n           autocapitalize="off"\n           autocorrect="off"\n           autocomplete="off"\n           spellcheck="false"/>\n\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-facebook-type_like_button"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-like fb" data-href="'+(null==(__t=data.url?data.url:"http://readymag.com")?"":_.escape(__t))+'" '+(null==(__t=data.share_button||data.send_button?'data-share="true"':"")?"":__t)+' data-width="'+(null==(__t=data.w)?"":__t)+'" data-show-faces="'+(null==(__t=data.show_faces)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'" data-layout="'+(null==(__t=data.layout)?"":__t)+'" data-type="data.type_like_button"></div>\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-facebook-type_page"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-page fb" data-href="'+(null==(__t=data.url?data.url:"https://www.facebook.com/readymag")?"":_.escape(__t))+'" data-width="'+(null==(__t=data.w)?"":__t)+'" data-height="'+(null==(__t=data.h)?"":__t)+'" data-show-facepile="'+(null==(__t=data.show_faces)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'" data-tabs="'+(null==(__t=data.show_stream?"timeline, events, messages":"")?"":__t)+'" data-show-border="true" data-small-header="'+(null==(__t=data.small_header)?"":__t)+'" data-adapt-container-width="true"></div>\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-facebook-type_comments"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-comments fb" data-href="'+(null==(__t=data.url?data.url:"http://readymag.com")?"":_.escape(__t))+'" data-width="'+(null==(__t=data.w)?"":__t)+'" data-num-posts="'+(null==(__t=data.num_posts)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'"></div>\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-gmaps"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rm-search-block">\n        <div class="map-container"></div>\n        <div class="map-overlay"></div>\n        <div class="message-overlay invisible"></div>\n    </div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-gmaps-search-control"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rm-search-block">\n        <input type="text" class="rm-search source">\n        <input type="text" class="rm-search destination">;\n    </div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-slideshow"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<input class="uploadInput" type="file" name="upload" multiple="multiple" data-url="/api/upload/" />\n\n\t<div class="drop-text"></div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-text"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="margins-wrapper">\n\t\t<div class="margins-wrapper-inner">\n\t\t</div>\n\t</div>\n\n\t<div class="columns-wrapper">\n\t\t<div class="columns-wrapper-inner">\n\t\t</div>\n\t</div>\n\n\t<textarea id="textarea_'+(null==(__t=_id)?"":__t)+'" style="display: none; width:'+(null==(__t=w)?"":__t)+"px;height:"+(null==(__t=h)?"":__t)+'px">'+(null==(__t=text)?"":_.escape(__t))+'</textarea>\n\t<div class="text-preview" style="-webkit-nbsp-mode:space; -webkit-line-break:after-white-space;">'+(null==(__t=text)?"":__t)+'</div>\n\t<div class="text-mask"></div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-text-margins"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="margin-handle hidden inactive">\n\t\t<div class="margin-handle-label-wrapper">\n\t\t\t<div class="margin-handle-label">\n\t\t\t\t<input class="margin-input" type="text"  spellcheck="false" value="0" data-mouseSpeed="2" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-text-bg"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="bg"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-twitter-type_tweet"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+(null==(__t=url)?"":_.escape(__t))+'" data-lang="en" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'" data-text="'+(null==(__t="undefined"!=typeof text?text:"")?"":_.escape(__t))+'">Tweet</a>\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-twitter-type_follow"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/'+(null==(__t=username?username:"Readymag")?"":_.escape(__t))+'" class="twitter-follow-button" data-show-count="false" data-show-screen-name="'+(null==(__t=show_name?"true":"false")?"":__t)+'" data-lang="en" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'">Follow @'+(null==(__t=username)?"":_.escape(__t))+'</a>\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-twitter-type_hashtag"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/intent/tweet?button_hashtag='+(null==(__t=hash)?"":_.escape(__t))+'" class="twitter-hashtag-button" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'">Tweet #'+(null==(__t=hash)?"":_.escape(__t))+'</a>\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-twitter-type_timeline"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t"+(null==(__t=code)?"":__t)+'\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},RM.templates["template-constructor-block-twitter-type_embed"]=function(){return $.trim(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t"+(null==(__t=code)?"":__t)+'\n\t<div class="overlay"></div>\n';return __p}.apply(this,arguments))},"undefined"==typeof RM&&(RM={}),function(t){t.constants=_.extend({UPLOAD_IMAGE_SIZE_LIMIT:6291456,MSG_UPLOAD_IMAGE_SIZE_ERROR:"File size should be less than 6 Mb.",MSG_UPLOAD_IMAGE_SUPPORTED_ERROR:"We support only JPG, GIF, PNG, SVG and BMP picture formats.",MSG_UPLOAD_ONLY_SINGLE_FILE:"We support only 1 file upload via drop on workspace",THUMB_SIZE:48,BG_EFFECT_THUMBSIZE:40,UPLOAD_IMAGE_FORMATS:"jpeg|jpg|png|gif|bmp|svg\\+xml",EMBED_SCRIPT_INIT:window.ServerData.config.readymag_host+"/specials/assets/embed_init.js",EMBED_SCRIPT_MAIN:window.ServerData.config.readymag_host+"/specials/assets/embed_main.js",IS_LIVE:!(!window.ServerData||!window.ServerData.stripe_live),IS_FILE_PROTOCOL:"file:"==window.location.protocol},window.ServerData.config),t.utils={picSizes:[256,304,512,608,1024],isPageNativelyScaled:function(){return window.innerWidth!=document.documentElement.clientWidth},declination:function(t,e,i,n,s){var r=[t,e,i],a=n%100;return a=a>=11&&a<=14?0:(a%=10)<5?a>2?2:a:0,s||(a=1==n?1:0),r[a]},queryUrlGetParam:function(t,e){try{q=e?e.split("?")[1]:location.search.substring(1),v=q.split("&");for(var i=0;i<v.length;i++)if(p=v[i].split("="),p[0]==t)return!(p.length>1)||decodeURIComponent(p[1])}catch(t){console.log(t)}},autoWindowScroll:function(e,i,n){this.autoWindowScrollClear();var s=10,r=0,a=100;windowH=$(window).height(),e.pageY<s&&(r=-Math.abs(Math.floor(3*(s-e.pageY)))),e.pageY>windowH-s&&(r=Math.abs(Math.floor(3*(s-(windowH-e.pageY))))),r=Math.max(Math.min(20,r),-20),0!=r&&(i.scrollTop(i.scrollTop()+r),t.common.autoWindowScrollTimeout=setTimeout(function(){n&&n()},a))},autoWindowScrollClear:function(){clearTimeout(t.common.autoWindowScrollTimeout)},isValidEmail:function(t,e){return e||(t=t.replace(/^\s+|\s+$/g,"")),/^([a-z0-9_\-]+[\.\+])*[a-z0-9_\-]+@([a-z0-9][a-z0-9\-]*[a-z0-9]\.)+[a-z]{2,}$/i.test(t)},isValidEmailLink:function(e){return t.utils.isValidEmail(e.split("?")[0])},getRGBA:function(t,e){var i="",n=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return i=e>.99?"rgb("+n[0]+","+n[1]+","+n[2]+")":"rgba("+n[0]+","+n[1]+","+n[2]+", "+e+")"},generateUUID:function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e},escapeSpecial:function(t,e){return t=(t+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1"),t&&e&&(t="'"+t+"'"),t},scanForURIs:function(t,e,i){function n(t,n,s,r,l,c){var h=t;void 0!=n&&""!=n||(h="http://"+h);var d=s;return void 0!=r&&""!=r&&(d+="."+r),o++,i||(d=h,d=d.replace(/^https?:\/\//,"")),a[o]="<a "+(e?'class = "'+e+'"':"")+' href="'+h+'" target="_blank" title="'+h+'">'+d+"</a>","INNER_TMP_BLOCK_"+o+"_INNER_TMP_BLOCK"}function s(t){return o++,a[o]="<a "+(e?'class = "'+e+'"':"")+' href="mailto:'+t+'">'+t+"</a>","INNER_TMP_BLOCK_"+o+"_INNER_TMP_BLOCK"}function r(t,e){return a[e]}var a=[],o=0;return t+=" ",t=t.replace(/\b([a-z0-9_\.-]+)@([\da-z\.-]+)\.(biz|com|edu|gov|net|org|us|ru|ua|uk|su|se|co|no|jp|it|in|il|gb|fr|fi|es|de|cz|ch|ca|by|at|au)/gim,s),t=t.replace(/\b(https?:\/\/)?([\da-z\.-]+)\.(biz|com|edu|gov|net|org|us|ru|ua|uk|su|se|co|no|jp|it|in|il|gb|fr|fi|es|de|cz|ch|ca|by|at|au)(\/[^\s\(\)\[\]\{\}\<\>]*)*/gim,n),t=t.replace(/INNER_TMP_BLOCK_([\d]+)_INNER_TMP_BLOCK/gim,r)},plainTextToHtml:function(e,i){return e=e||"",e=e.replace(/\&/gim,"&amp;"),e=e.replace(/\</gim,"&lt;"),e=e.replace(/\>/gim,"&gt;"),e=e.replace(/\n/gim,"<br/>"),e=e.replace(/\s\s/gim," &nbsp;"),i&&i.detectLinks&&(e=t.utils.scanForURIs(e)),e},screenshotSize:function(t){return Modernizr.retina&&(t*=2),this.picSizes.indexOf(t)==-1&&(t=_.filter(this.picSizes,function(e){return e>t})[0]),this.picSizes.indexOf(t)==-1?(console.error("screenshot size not found! size: "+t),512):t},addFilenameComponent:function(t,e){var i=t.split(".");return i.length>1?(i[i.length-2]+="_"+e,i.join(".")):t+="_"+e},URLParts:function(t){var e=/(.+:\/\/)?([^\/]+)(\/.*)*/i,i=e.exec(t);return i=i||[],{url:i[0]||"",protocol:i[1]||"",hostname:i[2]||"",path:i[3]||""}},filterNonAscii:function(t){if(t&&t.val){var e=t.val();return!!/[^\x00-\x7f]/.test(e)&&(e=e.replace(/[^\x00-\x7f]/g,""),t.val(e),!0)}},applyTransform:function(t,e){t.css({"-webkit-transform":e,transform:e})},getCurrentTranslate:function(t){var e=window.getComputedStyle(t,null),i=e.getPropertyValue("-webkit-transform")||e.getPropertyValue("transform");if(!i||"none"==i)return[0,0];var n=i.split("(")[1],n=n.split(")")[0],n=n.split(",");return[n[4]-0,n[5]-0]},applyTransition:function(t,e){t.css({"-webkit-transition":e.replace("transform","-webkit-transform"),transition:e})},waitForTransitionEnd:function(t,e,i,n){var s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},r=s[Modernizr.prefixed("transition")],a=function(e){if(e){var s=e.originalEvent.propertyName.toLowerCase();if(!$(e.target).is(t))return;if(s.indexOf(i)==-1)return}t.off(r,a),clearTimeout(l),n()},o=function(){t.off(r,a),clearTimeout(l)};t.on(r,a);var l=setTimeout(a,e);return o},getFixedPositionCSS:function(t,e,i){var n=e.left*i,s=e.top*i,r=e.width,a=e.height,o=r*(1-i)/2,l=a*(1-i)/2,c={left:"",top:"",bottom:"",right:"","margin-left":"","margin-top":""};return t?("c"!=t&&(t.indexOf("n")>-1&&(c.top=s-l),t.indexOf("w")>-1&&(c.left=n-o),t.indexOf("e")>-1&&(c.right=n-o),t.indexOf("s")>-1&&(c.bottom=s-l)),["n","c","s"].indexOf(t)>-1&&(c.left="50%",c["margin-left"]=-r/2+n),["w","c","e"].indexOf(t)>-1&&(c.top="50%",c["margin-top"]=-a/2+s),c):_.extend({},c,e)},decimals:function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},getFocusBack:function(){Modernizr.isdesktop&&$('<input style="position: absolute;left: -999px;" type="text"/>').appendTo("body").css({top:$(window).scrollTop()}).focus().remove()},hex2rgb:function(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]},loadLoggedUser:function(e){if(t.common.isDownloadedSource)return e&&e();$(window).on("message",_.bind(function(n){if(n=n.originalEvent||{},n.origin==t.constants.readymag_auth_host){var s=JSON.parse(decodeURIComponent(n.data));if("user"!=s.event)return;var r=s.message;window.ServerData&&(window.ServerData.me={user:r}),e&&e(r),i.remove()}},this));var i=$("<iframe>").attr("width","0").attr("height","0").css({position:"absolute",top:"-999px"}).on("load",function(){i[0].contentWindow.postMessage("GetLoggedUser","*")}).attr("src",t.constants.readymag_auth_host+"/get_user_cookies."+Date.now()).appendTo("body")},selectProtocol:function(e){return e&&e.length?(0==e.indexOf("//")&&t.constants.IS_FILE_PROTOCOL&&(e="http:"+e),e):e},_sendFBGraphRequest:function(t){$.ajax({type:"GET",url:"https://graph.facebook.com/?id="+encodeURIComponent(t)+"&scrape=true&method=post",success:function(t){}})},facebookGraphRefresh:function(e){var i,n,s,r,a=t.constants.readymag_host||window.location.origin;s=a+"/"+e.user_uri+"/"+e.mag_uri+"/",this._sendFBGraphRequest(s);var o=a+"/"+e.mag_numid+"/";this._sendFBGraphRequest(o),e.mag_domain?(i="http://"+e.mag_domain+"/",this._sendFBGraphRequest(i)):e.user_domain&&(n="http://"+e.user_domain+"/"+e.mag_uri+"/",this._sendFBGraphRequest(n));var l=e.pages;if(0!=l.length){r=i||n||a+"/";for(var c in l){c=l[c];var h=a+"p"+c.num_id+"/";this._sendFBGraphRequest(h)}}},simulateEvent:function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}var n,s={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},r={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0},a=i(r,arguments[2]||{}),o=null;for(var l in s)if(s[l].test(e)){o=l;break}if(!o)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");if(document.createEvent)n=document.createEvent(o),"HTMLEvents"==o?n.initEvent(e,a.bubbles,a.cancelable):n.initMouseEvent(e,a.bubbles,a.cancelable,document.defaultView,a.button,a.pointerX,a.pointerY,a.pointerX,a.pointerY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,t),t.dispatchEvent(n);else{a.clientX=a.pointerX,a.clientY=a.pointerY;var c=document.createEventObject();n=i(c,a),t.fireEvent("on"+e,n)}return t},getTestIndexes:function(){if(t.common.rm_test)return t.common.rm_test;var e,i,n=2,s=5,r={};for(e=n;e<=s;e++)r["_test_"+e]=-1;if(Modernizr.localstorage)for(e=n;e<=s;e++)i="_test_"+e,r[i]=localStorage.getItem("rm_test_"+e),(parseInt(r[i])!=r[i]||r[i]<0||r[i]>=e)&&(r[i]=Math.floor(Math.random()*e),localStorage.setItem("rm_test_"+e,r[i])),r[i]-=0;return t.common.rm_test=r,r},setInputSize:function(t,e){var i=$('<div style="position:absolute; left:-9999px; right:auto; margin:0; white-space:pre; width:auto"></div>').appendTo(t.parent());i[0].className=t[0].className,i.text(t.val());var n=i.width();n=2*Math.ceil(n/2)+2,e&&n>e&&(n=e),t.width(n),i.remove()},PageVisibilityManager:function(){var t,e;"undefined"!=typeof document.hidden?(t="hidden",e="visibilitychange"):"undefined"!=typeof document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(t="msHidden",e="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange");var i=function(i){return!!t&&void document.addEventListener(e,i)},n=function(i){return!!t&&void document.removeEventListener(e,i)},s=function(){return document[t]};return{addEventListener:i,removeEventListener:n,isPageHidden:s}}(),getCookie:function(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0},deleteCookie:function(t){this.createCookie(t,"")},createCookie:function(e,i,n){n=n||36500;var s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3);var r,a="; expires="+s.toGMTString();r=t.constants.readymag_host.replace(/https?:\/\//i,""),r=r.replace("/",""),document.cookie=e+"="+i+a+"; path=/; domain=."+r},isMongoObjectId:function(t){var e;return e=/^[0-9a-fA-F]{24}$/,e.test(t)}},$.expr[":"].icontains=function(t,e,i,n){var s=i[3]+"",r=t.textContent||t.innerText||jQuery(t).text()||"",a=new RegExp("("+s+")","i");return!!r.match(a)},$.expr[":"].econtains=function(t,e,i,n){var s=i[3]+"",r=t.textContent||t.innerText||jQuery(t).text()||"",a=new RegExp("(^"+s+"$)","");return!!r.match(a)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},_.bindAll=function(t){var e=Array.prototype.slice.call(arguments,1);return 0===e.length&&(e=_.functions(t)),_.each(e,function(e){t[e]=_.bind(t[e],t)}),t},_.mixin({cloneWithObjects:function(t){return t=_.clone(t),_.each(t,function(e,i){if(_.isArray(e)){for(var n=[],s=0;s<e.length;s++)n.push(_.clone(e[s]));t[i]=n}else _.isObject(e)&&!_.isFunction(e)?t[i]=_.clone(t[i]):_.isFunction(e)&&(t[i]=t[i])}),t},isContainsData:function(t,e){return _.all(e,function(e){return _.any(t,function(t){return _.isEqual(t,e)})})},objectDifference:function(t,e){var i={};return _.each(e,function(n,s){return _.isObject(n)&&!_.isArray(n)?(i[s]=_.objectDifference(t[s],e[s]),void(_.isEmpty(i[s])?delete i[s]:i[s]=e[s])):t&&e&&_.isEqual(t[s],e[s])?void 0:void(i[s]=e[s])}),i},deepExtend:function(t){var e,i=/#{\s*?_\s*?}/,n=function(t,e){return _.isUndefined(t)||_.isNull(t)||_.isFunction(t)||_.isNull(e)||_.isDate(e)},s=function(e,i,n){return t[n]=_.clone(i)},r=function(t,e){return _.isString(e)&&i.test(e)},a=function(e,n,s){return!_.isString(e),t[s]=n.replace(i,e)},o=function(t,e){return _.isArray(t)||_.isArray(e)},l=function(e,i,n){if(!_.isArray(e)||!_.isArray(i))throw new Error("Trying to combine an array with a non-array ("+n+")");var s=_.deepExtend(t[n],i);return t[n]=_.reject(s,_.isNull)},c=function(t,e){return _.isObject(t)||_.isObject(e)},h=function(e,i,n){if(!_.isObject(e)||!_.isObject(i))throw new Error("Trying to combine an object with a non-object ("+n+")");return t[n]=_.deepExtend(e,i)},d=function(i){var d=t[i],u=e[i];n(d,u)?s(d,u,i):r(d,u)?a(d,u,i):o(d,u)?l(d,u,i):c(d,u)?h(d,u,i):s(d,u,i)},u=function(t){e=t,Object.keys(e).forEach(d)};return _.each(Array.prototype.slice.call(arguments,1),u),t}});if(jQuery.fn.selectText=function(){var t,e,i=document,n=this[0];i.body.createTextRange?(t=document.body.createTextRange(),t.moveToElementText(n),t.select()):window.getSelection&&(e=window.getSelection(),t=document.createRange(),t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)),this.focus(),n.selectionStart=0,n.selectionEnd=1},String.prototype.toHttps=function(){return this.replace(/^http:\/\//i,"https://")},String.prototype.escapeRegExp=function(){var t=["$","^","*","(",")","+","[","]","{","}","\\","|",".","?","/"],e=new RegExp("(\\"+t.join("|\\")+")","g");return this.replace(e,"\\$1")},Number.prototype.formatWithDelimiters=function(t){return this.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)},Number.prototype.toFixedNonZero=function(t){return this%1?this.toFixed(t):this.toString()},$.fn.setCursorPos=function(t){var e,i;if(e=this.eq(0),e&&e.is("input"))if(i=e.get(0),i.setSelectionRange)i.focus(),i.setSelectionRange(t,t);else if(i.createTextRange){var n=i.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}},$.fn.getCursorPos=function(){var t,e;if(t=this.eq(0),t&&t.is("input")){if(e=t.get(0),e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var i=document.selection.createRange(),n=document.selection.createRange().text.length;return i.moveStart("character",-e.value.length),i.text.length-n}}},$.fn.flashClass=function(t,e){var i,n=this;return this.addClass(t),clearTimeout(this.data("timeout")),i=setTimeout(function(){"object"==typeof n&&n.length&&(n.removeClass(t),n.data("timeout",null))},e),this.data("timeout",i),this},$.fn.cardNumberFormatter=function(){this.on("input",function(){var t,e,i,n;n=this.getCursorPos(),/[^\d\s]/g.test(this.val())&&(this.val(this.val().replace(/[^\d\s]/g,"")),this.setCursorPos(n-1)),t=this.val().replace(/\s/g,""),this.data("prev_card_digits",this.data("prev_card_digits")||t),window.Stripe&&window.Stripe.card&&window.Stripe.card.cardType&&(e=Stripe.card.cardType(t)),i="American Express"==e?function(t){return t.replace(/^(\d{4})(\d{6})?/,"$1 $2 ").replace(/\s+/g," ")}:function(t){return $.trim(t.replace(/(\d{4})(\d{4})?(\d{4})?(\d{3,4})?/,"$1 $2 $3 $4").replace(/\s+/g," "))},(!this.data("prev_card_digits")||t.length>this.data("prev_card_digits").length&&t.length<17)&&(n=this.getCursorPos(),this.val(i(t)),n<$.trim(this.val()).length-1&&this.data("prev_card_digits")&&this.setCursorPos(n)),this.data("prev_card_digits",t)}.bind(this))},window.Backbone){_.extend(Backbone.History.prototype,{universalStart:function(t){if(Modernizr.history)Backbone.history.start(t);else{t.pushState=!1,t.silent=!0,t.hashChange=!0,Backbone.history.start(t);var e=Backbone.history.options.root.length,i=window.location.pathname.substr(e);Backbone.history.navigate(i,{trigger:!0})}}});var e=Backbone.Router.prototype.navigate;Backbone.Router.prototype.navigate=function(t,i){return t.indexOf("?")>-1||i&&i.skipQueryString?e.apply(this,arguments):(t+=window.location.search,e.call(this,t,i))},Backbone.Model.prototype.getResetAttrs=function(t,e){var i=t.toJSON();return _.each(i,function(t,n){_.isObject(i[n]&&_.isObject(e[n]))&&(e[n]=this.getResetAttrs(i[n],e[n])),_.has(i,n)&&!_.has(e,n)&&(e[n]=void 0)},this),e}}for(var i=0,n=["ms","moz","webkit","o"],s=0;s<n.length&&!window.requestAnimationFrame;++s)window.requestAnimationFrame=window[n[s]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[s]+"CancelAnimationFrame"]||window[n[s]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var n=(new Date).getTime(),s=Math.max(0,16-(n-i)),r=window.setTimeout(function(){t(n+s)},s);return i=n+s,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(RM),"undefined"==typeof RM&&(RM={}),function(t){t.mathutils={calcOrientedTriangleSquare:function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)},intersectsOnAxisProjection:function(t,e,i,n){var s;return t>e&&(s=t,t=e,e=s),i>n&&(s=i,i=n,n=s),t<i&&(t=i),e>n&&(e=n),t<=e},isLinesIntersects:function(e,i,n,s){return t.mathutils.intersectsOnAxisProjection(e.x,i.x,n.x,s.x)&&t.mathutils.intersectsOnAxisProjection(e.y,i.y,n.y,s.y)&&t.mathutils.calcOrientedTriangleSquare(e,i,n)*t.mathutils.calcOrientedTriangleSquare(e,i,s)<=0&&t.mathutils.calcOrientedTriangleSquare(n,s,e)*t.mathutils.calcOrientedTriangleSquare(n,s,i)<=0},isConvexPolygonContainsPoint:function(e,i){for(var n=0;n<e.length;n++){var s=(n+1)%e.length;if(t.mathutils.calcOrientedTriangleSquare(e[n],e[s],i)<0)return!1}return!0},isConvexPolygonsIntersects:function(e,i){var n,s,r,a;for(n=0;n<e.length;n++)if(t.mathutils.isConvexPolygonContainsPoint(i,e[n]))return!0;for(n=0;n<i.length;n++)if(t.mathutils.isConvexPolygonContainsPoint(e,i[n]))return!0;for(n=0;n<e.length;n++)for(s=(n+1)%e.length,r=0;r<i.length;r++)if(a=(r+1)%i.length,t.mathutils.isLinesIntersects(e[n],e[s],i[r],i[a]))return!0;return!1},calcBoundingBox:function(e,i){var n=t.mathutils.calcRotatedBox(e),s=_.pluck(n,"x"),r=_.pluck(n,"y"),a=Math.min.apply(null,s),o=Math.max.apply(null,s),l=Math.min.apply(null,r),c=Math.max.apply(null,r),h=a,d=l,u=o-a,p=c-l;return i&&(["n","c","s"].indexOf(i)>-1&&(h=e.left),["w","c","e"].indexOf(i)>-1&&(d=e.top)),{bb_width:u,bb_height:p,bb_left:h,bb_top:d}},calcRotatedBox:function(t){var e=[],i=[0,1,1,0],n=[0,0,1,1],s=t.left+t.width/2,r=t.top+t.height/2,a=t.sinAngle,o=t.cosAngle;return _.each(i,function(l,c){var h=t.left+t.width*i[c],d=t.top+t.height*n[c],u=h-s,p=r-d,h=s+o*u+a*p,d=r+a*u-o*p;e.push({x:h,y:d})}),e}}}(RM),function(t,e){"use strict";t.classes.Login=Backbone.View.extend({events:{"click .link":"link","click .close-popup":"closePopup","input .login.ljr-panel input.password-input":"onPasswordInput","keydown .login.ljr-panel input":"loginInputKey","click .login.ljr-panel .go":"tryLogin","submit .login.ljr-panel #login_form":"onLoginFormSubmit","click .login.ljr-panel .social-auth":"socialAuth","input .join.ljr-panel input.password-input":"onPasswordInput","keydown .join.ljr-panel input":"joinInputKey","click .join.ljr-panel .go":"createAccount","click .join.ljr-panel .social-auth":"socialAuth","click .recover.ljr-panel .go":"sendRecoverRequest","click .recover.ljr-panel .go-back":"backFromRecover","input .reset.ljr-panel input":"onPasswordInput","click .reset.ljr-panel .go":"resetPassword","click .login-popup-wrapper":"closeOutsideClick",touchstart:"onTouchStart",touchmove:"onTouchMove"},ERROR_MESSAGES:{invalid_email:"Not a valid email.",short_password:"Password must be at least 6 characters long.",password_dont_match:"Passwords don't match."},initialize:function(e){_.bindAll(this),_.extend(this,e),_.extend(this.ERROR_MESSAGES,this.errorMessages),this.template=t.templates["template-common-login"],this.template_button_preloader=t.templates["template-common-login-preloader"],this.logged=!1,this.animationSpeed=0,this.disableAnimations||_.delay(_.bind(function(){this.animationSpeed=300},this),100),this.enableCors(),$(window).on("message",this.processLoginMessages)},render:function(){this.setElement(this.$node||$(this.template({})).appendTo(this.$container)),this.disableScrollWatcher=!!this.$node,this.setElement(this.$el),this.rendered=!0;var e=t.utils.queryUrlGetParam("email");e&&this.$(".email-input").val(e)},link:function(t){if(t.stopPropagation(),2!=t.which&&!t.metaKey&&!t.ctrlKey){var e=$(t.currentTarget).attr("href");if(!e)return!1;if(!this.useNavigate)return/login/i.test(e)&&this.switchTo("login"),/join/i.test(e)&&this.switchTo("join"),/recover/i.test(e)&&this.switchTo("recover"),
!1;this.router.navigate(e,{trigger:!0}),t.preventDefault()}},closePopup:function(){Modernizr.isboxversion||(this.useNavigate&&(this.router.navigate(this.urlToBack||"/",{trigger:!1}),this.router.updateWindowCaptions()),this.hide(!0))},closeOutsideClick:function(t){Modernizr.isdesktop&&$(t.target).hasClass("login-popup-wrapper")&&this.closePopup()},show:function(t){this.shown||($("body").addClass("disable-scroll"),this.urlToBack=t,0==this.animationSpeed&&this.$el.flashClass("no-animation",15),this.$el.removeClass("hidden"),this.trigger("shown"),this.shown=!0,$("body").on("keyup",this.onBodyKeyUp),$(window).bind("resize",this.onResize))},hide:function(t){this.shown&&(this.$el.addClass("hidden"),_.delay(function(){$("body").removeClass("disable-scroll")},this.animationSpeed),this.trigger("hidden",t),this.shown=!1,$("body").off("keyup",this.onBodyKeyUp),$(window).unbind("resize",this.onResize))},onBodyKeyUp:function(t){27==t.keyCode&&this.closePopup()},switchTo:function(t){var e=this.$(".ljr-panel."+t),i=e.siblings(".ljr-panel");"recover"==t&&this.$(".recover.ljr-panel .email-input").val(this.$(".login.ljr-panel .email-input").val()),e.removeClass("hidden"),this.onResize(),Modernizr.isdesktop&&setTimeout(function(){e.find("input").eq(0).focus()},0),this.disableAnimations?i.addClass("hidden"):_.delay(function(){i.addClass("hidden")},this.animationSpeed/4)},onResize:function(){var t=this.$(".ljr-panel:not(.hidden)");$(window).width()>=768?this.$(".login-popup-wrapper").css("height",670):this.$(".login-popup-wrapper").css("height",t.outerHeight())},showButtonPreloader:function(t){var e,i,n,s=t.width(),r=t.height();e=$(this.template_button_preloader()),t.append(e),t.css({color:"transparent","background-image":"none"}),t.addClass("processing"),i=e.width(),n=e.height(),e.css({left:Math.floor((s-i)/2),top:Math.floor((r-n)/2)})},hideButtonPreloader:function(t){t.find(".rmpreloader").remove(),t.css({color:"","background-image":""}),t.removeClass("processing")},loginInputKey:function(t){13==t.keyCode&&this.tryLogin()},tryLogin:function(){var e=$.trim(this.$(".login.ljr-panel .email-input").val()),i=this.$(".login.ljr-panel .password-input").val(),n=this.$(".login.ljr-panel .go"),s=t.utils.queryUrlGetParam("redirect");n.hasClass("processing")||""!=e&&""!=i&&(this.showButtonPreloader(n),this.requestLogin(e,i,_.bind(function(e){if(e&&e.redirect)return window.location.href=e.redirect;if(e){if(s)return window.location.href=t.constants.readymag_auth_host+s;this.logged=!0;var i=Modernizr.sessionstorage&&window.sessionStorage.getItem("rm.loginReturnUrl",window.location.pathname);Modernizr.sessionstorage&&window.sessionStorage.removeItem("rm.loginReturnUrl"),this.$('.login.ljr-panel #login_form input[name="url"]').val(t.constants.readymag_auth_host+(i||"/"+e.uri)),this.$(".login.ljr-panel #login_form").submit()}else this.hideButtonPreloader(n),clearTimeout(this.wrongTimeout),this.$(".login.ljr-panel").addClass("wrong-login"),this.wrongTimeout=setTimeout(_.bind(function(){this.$(".login.ljr-panel").removeClass("wrong-login")},this),2e3),this.isdesktop||this.$el.scrollTop(9999)},this)))},requestLogin:function(e,i,n){var s={pass:md5(i)};return s[e.match(/@/)?"email":"uri"]=e,$.post(t.constants.readymag_auth_host+"/api/user/?timestamp="+(new Date).getTime(),s,function(t){n&&n(t)}).error(function(e){404==e.status?n&&n():alert("Login problem. Contact tech support, please: "+t.constants.SUPPORT_MAIL)}),!1},onLoginFormSubmit:function(){return this.logged},showErrors:function(t){clearTimeout(this.wrongTimeout),this.$(".join.ljr-panel").addClass("wrong-join"),this.$(".join.ljr-panel .error").html(t.join(" <br/>")),this.wrongTimeout=setTimeout(_.bind(function(){this.$(".join.ljr-panel").removeClass("wrong-join")},this),2e3)},createAccount:function(){var e,i=$.trim(this.$(".join.ljr-panel .fullname-input").val()),n=this.$(".join.ljr-panel .password-input").val(),s=this.$(".join.ljr-panel .email-input").val(),r=[],a=this.$(".join.ljr-panel .go"),o=t.utils.queryUrlGetParam("redirect");if(!a.hasClass("processing")){if(o&&(e=t.utils.queryUrlGetParam("giftCode",decodeURIComponent(o))),""==i||""==s||""==n)return void(this.router.analytics&&this.router.analytics.sendEvent("Join Button Click",{label:"native",value:1,_join_type:"native",_errors:"Some fields are empty"}));if(t.utils.isValidEmail(s)||r.push(this.ERROR_MESSAGES.invalid_email),n.length<6&&r.push(this.ERROR_MESSAGES.short_password),this.router.analytics&&this.router.analytics.sendEvent("Join Button Click",{label:"native",value:r.length,_join_type:"native",_errors:r.join(", ")}),r.length)return void this.showErrors(r);this.showButtonPreloader(a),$.ajax({type:"POST",data:{email:s,name:i,pass:md5(n),page:window.location.pathname,gift_code:e},url:t.constants.readymag_auth_host+"/api/register",success:_.bind(function(e){if(Modernizr.localstorage){if(this.putStorageData("native"),this.router&&this.router==t.viewerRouter){var n=encodeURIComponent(JSON.stringify(t.viewerRouter.getAnalyticsDimensions()));localStorage.setItem("mag_dimensions",n)}if(o)return window.location.href=o;this.redirectAfterJoin(e.uri,a)}else if(this.router.analytics)this.router.analytics.sendEvent("Joined",{label:"native",_join_type:"native",fullName:i,email:s,_user_id:e._id,_no_ls_flag:!0}),setTimeout(_.bind(function(){return o?window.location.href=o:void this.redirectAfterJoin(e.uri,a)},this),500);else{if(o)return window.location.href=o;this.redirectAfterJoin(e.uri,a)}},this),error:_.bind(function(e){return this.hideButtonPreloader(a),console.log(e),403==e.status?alert("User with email "+s+" exists. Forgot password?"):void alert("Registration problem. Contact tech support, please:"+t.constants.SUPPORT_MAIL)},this)})}},joinInputKey:function(t){13==t.keyCode&&this.createAccount()},sendRecoverRequest:function(){var e=this.$(".recover.ljr-panel .email-input").val(),i=this.$(".recover.ljr-panel .go");i.hasClass("processing")||t.utils.isValidEmail(e)&&(this.showButtonPreloader(i),this.requestRecover(e,_.bind(function(t){this.hideButtonPreloader(i),this.$(".recover.ljr-panel").addClass("request-sended")},this)))},requestRecover:function(e,i){$.post(t.constants.readymag_auth_host+"/api/recoverypass",{email:e},i).error(function(e){404==e.status?i&&i():alert("Recovery problem. Contact tech support, please:"+t.constants.SUPPORT_MAIL)})},backFromRecover:function(){this.useNavigate?this.router.navigate("login/",{trigger:!0}):this.switchTo("login")},resetPassword:function(){var e=$.trim(this.$(".reset.ljr-panel .new-password-input").val()),i=$.trim(this.$(".reset.ljr-panel .verify-password-input").val()),n=window.ServerData.recover,s=[],r=this.$(".reset.ljr-panel .go");if(!r.hasClass("processing")&&""!=e&&""!=i)return e!=i&&s.push(this.ERROR_MESSAGES.password_dont_match),(e.length<6||i.length<6)&&s.push(this.ERROR_MESSAGES.short_password),s.length?(clearTimeout(this.wrongTimeout),this.$(".reset.ljr-panel").addClass("wrong-reset"),this.$(".reset.ljr-panel .error").html(s.join(" <br/>")),void(this.wrongTimeout=setTimeout(_.bind(function(){this.$(".reset.ljr-panel").removeClass("wrong-reset")},this),2e3))):void(n&&n.recover_code&&n.email&&(this.showButtonPreloader(r),$.ajax({type:"POST",data:{email:n.email,pass:md5(e),code:n.recover_code},url:t.constants.readymag_auth_host+"/api/changepass",success:function(){window.location.href="/login/"},error:_.bind(function(){this.hideButtonPreloader(r),alert("Change password problem. Contact tech support, please:"+t.constants.SUPPORT_MAIL)},this)})))},onPasswordInput:function(e){var i=$(e.currentTarget);t.utils.filterNonAscii(i)&&(i.addClass("error-input"),_.defer(_.bind(function(){i.removeClass("error-input")},this)))},socialAuth:function(e){this.$button=$(e.currentTarget);var i=this.$button.attr("data-provider"),n=t.constants.readymag_auth_host+"/api/auth/"+i;if(!this.$button.hasClass("processing")){this.showButtonPreloader(this.$button),this.$button.closest(".join.ljr-panel").length&&this.router.analytics&&this.router.analytics.sendEvent("Join Button Click",{_join_type:i,label:i});var s=screen.width,r=screen.height,a=Math.min(1e3,s),o=Math.min(700,r-40),l=Math.ceil((s-a)/2),c=Math.ceil((r-o)/2);this.socialAuthWindow=window.open(n,"_blank",["toolbar=no","location="+(window.opera?"no":"yes"),"directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no","width="+a,"height="+o,"top="+c,"left="+l].join()),this.popupCheckInterval=setInterval(_.bind(function(){try{(null==this.socialAuthWindow||this.socialAuthWindow.closed)&&(clearInterval(this.popupCheckInterval),this.hideButtonPreloader(this.$button))}catch(t){}},this),100)}},handleSocialAuthResult:function(e){if(!e||e.error||!e.user||!e.user.uri)return this.hideButtonPreloader(this.$button),e.error&&this.showErrors([e.error.message]),void(e.user&&e.user.name&&(this.switchTo("join"),this.$(".join.ljr-panel .fullname-input").val(e.user.name),this.$(".join.ljr-panel .email-input").focus()));var i;if(e.user.createdViaFacebook&&(i="facebook"),e.user.createdViaGoogle&&(i="google"),i)if(Modernizr.localstorage){if(this.putStorageData(i),this.router&&this.router==t.viewerRouter){var n=encodeURIComponent(JSON.stringify(t.viewerRouter.getAnalyticsDimensions()));localStorage.setItem("mag_dimensions",n)}this.redirectAfterJoin(e.user.uri,this.$button)}else this.router.analytics?(this.router.analytics.sendEvent("Joined",{label:i,_join_type:i,fullName:e.user.name,email:e.user.email,_user_id:e.user._id,_no_ls_flag:!0}),setTimeout(_.bind(function(){this.redirectAfterJoin(e.user.uri,this.$button)},this),500)):this.redirectAfterJoin(e.user.uri,this.$button);else{var s=t.utils.queryUrlGetParam("redirect");if(s)return window.location.href=t.constants.readymag_auth_host+s;window.location.href=t.constants.readymag_auth_host+"/"+e.user.uri}},processLoginMessages:function(e){if(e=e.originalEvent||{},e.origin==t.constants.readymag_auth_host){var i=JSON.parse(decodeURIComponent(e.data));i&&"social-auth"==i.event&&(clearInterval(this.popupCheckInterval),this.socialAuthWindow&&this.socialAuthWindow.close(),this.handleSocialAuthResult(i.message))}},redirectAfterJoin:function(e){var i=_.isFunction(this.joinCallback)?500:0;_.isFunction(this.joinCallback)&&this.joinCallback();var n=t.utils.queryUrlGetParam("redirect");return n?window.location.href=t.constants.readymag_auth_host+n:void setTimeout(_.bind(function(){if(!Modernizr.isdesktop||Modernizr.msie||Modernizr.msie11)window.location.href=t.constants.readymag_auth_host+"/"+e+"/";else{var i=Modernizr.sessionstorage&&window.sessionStorage.getItem("rm.loginReturnUrl",window.location.pathname);if(Modernizr.sessionstorage&&window.sessionStorage.removeItem("rm.loginReturnUrl"),i)return window.location.href=t.constants.readymag_auth_host+i;var n=this.createMagParams,s=n&&n.templateID,r=n&&n.tp?n.tp+"-join-form":"join-form";new t.classes.CreateMag({router:this.router,me:{permissions:{can_create_mag:!0},uri:e},tp:r,templateID:s,noCreateRequestTracking:n&&n.noCreateRequestTracking,error:_.bind(function(){this.hideButtonPreloader(this.$button)},this)})}},this),i)},enableCors:function(){$.ajaxPrefilter(function(e,i,n){e.url.indexOf(t.constants.readymag_auth_host)!=-1&&(e.xhrFields={withCredentials:!0})})},onTouchStart:function(t){this.disableScrollWatcher||(this.scrollY=t.originalEvent.touches.item(0).clientY)},onTouchMove:function(t){if(!this.disableScrollWatcher){var e=$(t.currentTarget),i=this.scrollY-t.originalEvent.touches.item(0).clientY;(i<0&&e.scrollTop()<=0||i>0&&e.scrollTop()+e.height()>=e[0].scrollHeight)&&t.preventDefault(),this.scrollY=t.originalEvent.touches.item(0).clientY}},destroy:function(){this.hide(),$(window).off("message",this.processLoginMessages),setTimeout(_.bind(function(){this.$el.remove()},this),400)},putStorageData:function(e){var i={};i.type=e,i.utm_campaign=localStorage.getItem("utm_campaign"),i.utm_source=localStorage.getItem("utm_source"),i.utm_medium=localStorage.getItem("utm_medium"),i.rm_url=localStorage.getItem("rm_url"),i.rm_referrer=localStorage.getItem("rm_referrer"),i.mag_dimensions=localStorage.getItem("mag_dimensions");var n=btoa(JSON.stringify(i));t.utils.createCookie("send_join_event",n,10),localStorage.removeItem("utm_campaign"),localStorage.removeItem("utm_source"),localStorage.removeItem("utm_medium"),localStorage.removeItem("rm_url"),localStorage.removeItem("rm_referrer"),localStorage.removeItem("mag_dimensions")}})}(RM),"undefined"==typeof RM&&(RM={}),function(t){var e=100,i=1e4,n=3e3;t.textutils={STYLE_PREFIXES:{paragraph:{viewer:[".used-fonts-test p",".rmwidget.text div p"],editor:["p"],constructor:[".used-fonts-test p",".block.block-text .text-preview p",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},link:{viewer:[".rmwidget.text div a"],editor:["a"],constructor:[".block.block-text .text-preview a",".controls .control.text_link .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .link-style .style-caption"]}},generateStylesStr:function(e){function i(t){var e=o[h+t];return"inherit"==e&&h&&(e=o[t]),e}function n(t){return t+(/px/i.test(t)?"":"px")}var s,r,a="",o=e.style,l=e.indentation?"\t":"",c=";"+(e.lineBreaks?"\n":""),h=e.attrPrefix||"";return"paragraph"==e.tp&&(a+=l+"font-family: "+i("font-family")+c,a+=l+"font-style: "+i("font-style")+c,a+=l+"font-weight: "+i("font-weight")+c,a+=l+"font-size: "+n(i("font-size"))+c,a+=l+"letter-spacing: "+n(i("letter-spacing"))+c,a+=l+"line-height: "+n(i("line-height"))+c,a+=l+"text-align: "+i("text-align")+c,a+=l+"text-decoration: "+i("text-decoration")+c,a+=l+"text-transform: "+i("text-transform")+c,a+=l+"color: "+t.utils.getRGBA(i("color"),i("opacity")/100)+c,a+=l+"padding-top: "+n(i("padding-top"))+c,a+=l+"padding-right: "+n(i("padding-right"))+c,a+=l+"padding-bottom: "+n(i("padding-bottom"))+c,a+=l+"padding-left: "+n(i("padding-left"))+c),"link"==e.tp&&(a+=l+"text-decoration: none"+c,a+=l+"color: "+t.utils.getRGBA(i("color"),i("opacity")/100)+c,"none"!=i("u-style")?(s=t.utils.getRGBA(i("u-color"),i("u-opacity")/100),r=parseInt(i("u-size"),10),offset=parseInt(i("u-offset"),10)+r,a+=l+"padding-bottom: "+n(Math.max(offset,0))+c,"solid"==i("u-style")&&(a+=l+"background: linear-gradient(to right, "+s+" 0%, "+s+" 100%)"+c,a+=l+"background-size: 1px "+n(r)+c),"dotted"==i("u-style")&&(a+=l+"background: linear-gradient(to right, "+s+" 0%, "+s+" 50%, transparent 50%,transparent 100%)"+c,a+=l+"background-size: "+n(2*r)+" "+n(r)+c),"dashed"==i("u-style")&&(a+=l+"background: linear-gradient(to right, "+s+" 0%, "+s+" 66.6666%, transparent 66.6666%,transparent 100%)"+c,a+=l+"background-size: "+n(3*r)+" "+n(r)+c),a+=offset<0?l+"background-position: 0 "+(100+offset)+"%"+c:l+"background-position: 0 100%"+c,a+=l+"background-repeat: repeat-x"+c):a+=l+"background: none"+c),a},generateCSS:function(t,e,i,n,s){if(n){var r=this.STYLE_PREFIXES[t][e],s=s||{},a=this,o="";_.each(n,function(e){"paragraph"==t&&(o+=_.map(r,function(t){return t+"."+e._name}).join(",\n")+" {\n",o+=a.generateStylesStr({tp:t,style:e,indentation:!0,lineBreaks:!0}),o+="}\n\n"),"link"==t&&(s.forceHoverState&&s.forceHoverClass==e._name?(o+=_.map(r,function(t){return t+"."+e._name}).join(",\n")+" {\n",o+=a.generateStylesStr({tp:t,style:e,attrPrefix:"hover-",indentation:!0,lineBreaks:!0}),o+="}\n\n"):(o+=_.map(r,function(t){return t+"."+e._name}).join(",\n")+" {\n",o+=a.generateStylesStr({tp:t,style:e,indentation:!0,lineBreaks:!0}),o+="}\n\n",o+=_.map(r,function(t){return t+".hovered."+e._name}).join(",\n")+" {\n",o+=a.generateStylesStr({tp:t,style:e,attrPrefix:"hover-",indentation:!0,lineBreaks:!0}),o+="}\n\n"),o+=_.map(r,function(t){return t+"."+e._name+" *"}).join(",\n")+" {\n",o+="\tcolor: inherit !important;\n",o+="\ttext-decoration: none !important;\n",o+="}\n\n")}),i=i||document;var l="text_styles_"+t+"_"+e;$("#"+l,i).remove();var c=i.createElement("style");c.type="text/css",c.id=l,c.className="text_styles",c.appendChild(i.createTextNode(o)),i.getElementsByTagName("head")[0].appendChild(c)}},appendFontsCssToDocument:function(e,i){function n(t){var e=$("<link>").attr("type","text/css").attr("rel","stylesheet").attr("href",t);$("head").append(e)}!Modernizr.isboxversion&&window.TypekitPreview&&window.TypekitPreview.setup&&window.TypekitPreview.setup({auth_id:t.constants.TYPEKIT_ID,auth_token:t.constants.TYPEKIT_TOKEN,default_subset:"all"});var s=$("link.fonts, style.fonts"),r=[],a=[],o=[],l={};s.each(function(){var t=$(this),e=t.attr("data-provider"),i=t.attr("data-fonts-and-variations").split("||");_.each(i,function(t){r.push(e+"|"+t)})}),_.each(e.fonts,function(t){_.each(t.used_variations||t.variations,function(e){a.push(t.provider+"|"+t.css_name+"|"+e)})}),o=_.difference(a,r);var c={};_.each(o,function(t){var e=t.split("|"),i=e[0],n=e[1],s=e[2],r=i+"|"+n;c[r]=c[r]||[],c[r].push(s)});var h=[];_.each(c,function(t,e){var i=e.split("|"),n=i[0],s=i[1],r=t;h.push({provider:n,css_name:s,variations:r})}),_.each(h,function(t){var i,n=t.provider,s=t.css_name+"|"+t.variations.join("||"+t.css_name+"|");if(l[n]||(l[n]=[]),"google"==n){var r=$.map(t.variations,function(t){return 100*(t.substr(1,1)-0)+("n"==t.substr(0,1)?"":"italic")});i={fontAndVariations:s,data:t.css_name.split(" ").join("+")+":"+r.join(",")}}if("webtype"==n&&(i={fontAndVariations:s,data:t.css_name+":"+t.variations.join(",")}),"custom"==n){var a=_.findWhere(e.fonts,{provider:"custom",css_name:t.css_name});a&&a.css_url&&(i={fontAndVariations:s,data:{css_name:t.css_name,css_url:a.css_url,signed_css_url:a.signed_css_url}})}"typekit"==n&&(i={fontAndVariations:s,data:{id:t.css_name,variations:t.variations}}),i&&l[n].push(i)});var d=t.screenshot&&"true"==t.utils.queryUrlGetParam("pdf");d&&this.loadTypekitSubstitutionFonts(l.typekit);var u=_.has(l,"custom");_.each(l,function(s,r){function a(e){e.addClass("fonts").attr("data-id",t.utils.generateUUID()).attr("data-provider",r).attr("data-fonts-and-variations",fontsAndVariations.join("||"))}var o,l,c,h,u,p="custom"==r?1:"google"==r?22:s.length,f=Math.ceil(s.length/p),g=0;for(o=0;o<f;o++){if(l=o*p,c=Math.min((o+1)*p,s.length),h=s.slice(l,c),u=_.pluck(h,"data"),fontsAndVariations=_.pluck(h,"fontAndVariations"),$("link, style").addClass("existing"),"google"==r){var m=(t.constants.IS_FILE_PROTOCOL?"http://":"//")+"fonts.googleapis.com/css?family=",v=u.join("%7C"),y="&subset=latin,vietnamese,khmer,cyrillic-ext,greek-ext,greek,devanagari,latin-ext,cyrillic";n(m+v+y)}if("typekit"==r&&!Modernizr.isboxversion){if("edit"==e.version&&!d)try{window.TypekitPreview&&window.TypekitPreview.load(u)}catch(t){}"published"==e.version&&e.typekit_url&&(Typekit=void 0,$("style.typekit-kit").remove(),$.getScript(e.typekit_url,function(t,e,i){try{Typekit.load({active:function(){var t=$("style").filter(function(t,e){return/typekit/i.test(e.innerHTML)});t.addClass("typekit-kit"),a(t)}})}catch(t){}}))}if("webtype"==r){var m=t.common.isDownloadedSource?t.constants.readymag_host:"";if(!$('link.fonts[data-provider="webtype"]').length){var w=window.ServerData&&window.ServerData.fonts&&window.ServerData.fonts.webtype;n(m+w)}}if("custom"==r){var b=u[0].signed_css_url||u[0].css_url;/^\/api\/fonts\//i.test(b)?!function(){var t=$("<style>").attr("type","text/css");$("head").append(t),$.get(b,function(e){t.text(e),g++,g>=s.length&&_.isFunction(i)&&i()})}():n(b)}a($("link:not(.existing), style:not(.existing)")),$("link, style").removeClass("existing")}}),!u&&_.isFunction(i)&&i()},loadTypekitSubstitutionFonts:function(e){e&&e.length&&_.each(e,function(e){var i=e.data.id,n=(e.data.variations,_.findWhere(t.textutils.fontsShortList.typekit,{id:i})),n=n&&n.browse_info,n=n&&n.classification,s=n&&n.length&&n[0]||"sans-serif",r={"sans-serif":"news-gothic",decorative:"news-gothic",handmade:"news-gothic",blackletter:"news-gothic",script:"news-gothic","slab-serif":"news-gothic",serif:"georgia-pro",monospaced:"nitti"},a="template-export-pdf-typekit-substitution-"+(r[s]||r["sans-serif"]),o=t.templates[a],l=o({id:i});$("head").append(l)})},appendFontsCssToIFrame:function(t){var e=$("link.fonts, style.fonts"),i=$("link.fonts, style.fonts",t),n={},s=$("head",t);i.each(function(){n[$(this).attr("data-id")]=!0}),e.each(function(){var t=$(this);n[t.attr("data-id")]||t.clone().appendTo(s)})},isFastFontLoadCheckAvailable:function(){return Boolean(document.fonts&&window.Promise)},fastWaitForFontLoad:function(t,e,i){var s;if(document.fonts){var r=i+" "+e+" 12px "+t,a=document.fonts.load(r).then(function(){return document.fonts.check(r)?r:this.fontLoadedTimeoutCheck(r)}.bind(this)),o=new window.Promise(function(t,e){setTimeout(e,n)});s=window.Promise.race([a,o])}else s=window.Promise.reject();return s},exactWaitForFontLoad:function(t,n,s,r){function a(){var l=+new Date-v>i,c=o();return c||l?(f=void 0,u.remove(),void r(c,t,n,s)):void setTimeout(a,e)}function o(){var t=l;f.clearRect(0,0,h,d),g||(g=p.toDataURL("image/png"),t=c),f.font=t,f.fillStyle="000",f.fillText("a1-&q",0,20);var e=p.toDataURL("image/png");return m||(m=e),e!=g&&e!=m}var l=s+" "+n+" 12px "+t+", Arial",c=s+" "+n+" 12px Arial",h=20,d=20,u=$('<canvas width="'+h+'" height="'+d+'"></canvas>'),p=u[0],f=p.getContext("2d"),g="",m="",v=+new Date;u.appendTo("body").css({position:"absolute",left:0,top:"-999px"}),a()},fontLoadedTimeoutCheck:function(t){var i=Date.now(),s=function(r,a){var o=Date.now()-i;document.fonts.check(t)?r(t):o<n?setTimeout(s.bind(null,r,a),e):a()};return new window.Promise(function(t,e){s(t,e)})},getHotspotTextModels:function(t){var e=[];return t.widgets_collection&&t.widgets_collection.length&&(e=t.widgets_collection.filter(function(e){return"text"==e.get("type")&&t.get("wids").indexOf(e.get("_id"))>-1})),t._nestedWidgetsJSON&&t._nestedWidgetsJSON.length?e=_.filter(t._nestedWidgetsJSON,function(t){return"text"==t.type}):t.wids&&t.wids.length&&(e=_.filter(t.wids,function(t){return"text"==t.type})),e},getUsedFontsFromWidgetsModels:function(e){function i(t,e){return"function"==typeof t.get?t.get(e):t[e]}for(var n={},s={},r={},a={},o=e.models,l=0;l<o.length;l++){var c=o[l];if("slideshow"==i(c,"type")&&i(c,"text_style")){var h=i(c,"text_style");h["font-family"]&&h["font-weight"]&&h["font-style"]&&(s[h["font-family"]+"|"+h["font-style"]+"|"+h["font-weight"]]=1)}if("button"==i(c,"type")&&i(c,"font-family")&&i(c,"font-weight")&&i(c,"font-style")&&(r[i(c,"font-family")+"|"+i(c,"font-style")+"|"+i(c,"font-weight")]=1),"form"==i(c,"type")){var d=i(c,"style-"+i(c,"style")+"-fields"),u=_.clone(i(c,"style-"+i(c,"style")+"-button-default"));for(_.isEmpty(u)||(u["font-family"]="inherit"==u["font-family"]?d["font-family"]:u["font-family"],u["font-style"]="inherit"==u["font-style"]?d["font-style"]:u["font-style"],u["font-weight"]="inherit"==u["font-weight"]?d["font-weight"]:u["font-weight"]),a[d["font-family"]+"|"+d["font-style"]+"|"+d["font-weight"]]=1,u&&(a[u["font-family"]+"|"+u["font-style"]+"|"+u["font-weight"]]=1),j=0;j<t.viewports.length;j++){var p=c["viewport_"+t.viewports[j].name];p&&(d=p["style-"+p.style+"-fields"],u=_.clone(p["style-"+p.style+"-button-default"]),_.isEmpty(u)||(u["font-family"]="inherit"==u["font-family"]?d["font-family"]:u["font-family"],u["font-style"]="inherit"==u["font-style"]?d["font-style"]:u["font-style"],u["font-weight"]="inherit"==u["font-weight"]?d["font-weight"]:u["font-weight"]),d&&(a[d["font-family"]+"|"+d["font-style"]+"|"+d["font-weight"]]=1),u&&(a[u["font-family"]+"|"+u["font-style"]+"|"+u["font-weight"]]=1))}}"text"==i(c,"type")&&i(c,"text")&&_.extend(n,this.scanTextForFontsAndVariationsRaw(i(c,"text"),i(c,"version"))),"hotspot"==i(c,"type")&&_.each(this.getHotspotTextModels(c),_.bind(function(t){var e=i(t,"text");e&&_.extend(n,this.scanTextForFontsAndVariationsRaw(e,i(t,"version")))},this))}var f=_.extend({},n,s,r,a),g={};_.each(f,function(t,e){var i=e.split("|"),n=i[0],s=i[1].toLowerCase(),r=i[2].toLowerCase();g[n]=g[n]||[],g[n].push(("italic"==s?"i":"n")+Math.floor(r/100))});var m,v=[],y=this;return _.each(g,function(i,n){(m=_.findWhere(t.textutils.fontsShortList.webtype,{name:n}))?v.push({provider:"webtype",css_name:m.name,name:m.name,variations:m.variations,used_variations:y.calcBrowserUsedVariation(i,m.variations)}):(m=_.findWhere(t.textutils.fontsShortList.google,{family:n}))?v.push({provider:"google",css_name:m.family,name:m.family,variations:m.variations,used_variations:y.calcBrowserUsedVariation(i,m.variations)}):(m=_.findWhere(t.textutils.fontsShortList.typekit,{id:n}))?v.push({provider:"typekit",css_name:m.id,name:m.name,variations:m.variations,used_variations:y.calcBrowserUsedVariation(i,m.variations)}):e.includeCustom&&(m=_.findWhere(e.customList,{css_name:n}))&&v.push({provider:"custom",css_name:m.css_name,css_url:m.css_url,name:m.name,variations:m.variations,used_variations:y.calcBrowserUsedVariation(i,m.variations)})}),v},getUsedParagraphStylesFromWidgetsModels:function(e){function i(t,e){return"function"==typeof t.get?t.get(e):t[e]}var n,s,r="";for(n=0;n<e.length;n++)s=e[n],"text"==i(s,"type")&&i(s,"text")&&(r+=i(s,"text")),"hotspot"==i(s,"type")&&_.each(this.getHotspotTextModels(s),_.bind(function(t){r+=i(t,"text")||""},this));var a=[],o=t.constructorRouter.workspace.mag.edit_params.get("paragraph_styles");if(r)for(n=0;n<o.length;n++){var l=o[n];r.indexOf(l._name)>=0&&a.push(l)}return a},getUsedLinkStylesFromWidgetsModels:function(e){function i(t,e){return"function"==typeof t.get?t.get(e):t[e]}var n,s,r="";for(n=0;n<e.length;n++)s=e[n],"text"==i(s,"type")&&i(s,"text")&&(r+=i(s,"text")),"hotspot"==i(s,"type")&&_.each(this.getHotspotTextModels(s),_.bind(function(t){r+=i(t,"text")||""},this));var a=[],o=t.constructorRouter.workspace.mag.edit_params.get("link_styles");if(r)for(n=0;n<o.length;n++){var l=o[n];r.indexOf(l._name)>=0&&a.push(l)}return a},scanTextForFontsAndVariationsRaw:function(e,i){var n,s,r,a,o,l,c,h,d,u,p,f={},g={},m=[],v=document.defaultView.getComputedStyle;for(n=0;n<t.viewports.length;n++)e.split("-"+t.viewports[n].name).length>1&&m.push(t.viewports[n].name);for(r=$(".used-fonts-test"),r.length||(r=$("<div>").addClass("used-fonts-test").css({position:"absolute",display:"none !important",left:-9999,width:999}).appendTo("body")),r.removeClass("v1 v2").addClass("v"+(i||1)),s=r[0],s.innerHTML=e,l=s.querySelectorAll("span,p,a"),c=l.length,o=v(s,null),f[o.fontFamily+"|"+o.fontStyle+"|"+o.fontWeight]=1,a=0;a<c;a++)(l[a].getAttribute("style")||l[a].getAttribute("class"))&&(o=v(l[a],null),f[o.fontFamily+"|"+o.fontStyle+"|"+o.fontWeight]=1);for(n=0;n<m.length;n++)if(u=m[n],"default"!=u){for(a=0;a<c;a++)p=l[a],(h=p.getAttribute("data-style-"+u))&&("empty"==h?p.removeAttribute("style"):p.setAttribute("style",h)),(d=p.getAttribute("data-class-"+u))&&("empty"==d?p.removeAttribute("class"):p.setAttribute("class",d)),(p.getAttribute("style")||p.getAttribute("class"))&&(o=v(p,null),f[o.fontFamily+"|"+o.fontStyle+"|"+o.fontWeight]=1);n<m.length-1&&(s.innerHTML=e,l=s.querySelectorAll("span,p,a"),c=l.length)}return _.each(f,function(t,e){var i=e.split("|"),n=i[0],s=i[1].toLowerCase(),r=i[2].toLowerCase();n=n.split(",")[0],n=n.replace(/'|"/g,""),r=r.replace(/normal/g,"400"),r=r.replace(/regular/g,"400"),r=r.replace(/bold/g,"700"),g[n+"|"+s+"|"+r]=1}),g},calcBrowserUsedVariation:function(t,e){for(var i={},n=0;n<t.length;n++){for(var s,r,a,o=t[n],l=o.substr(1,1),c=o.substr(0,1),h=99999,d="",u=0;u<e.length;u++)s=e[u].substr(1,1)-0,r=e[u].substr(0,1),l<4&&(a=10*Math.abs(s-l)+(r==c?0:1e3)+(s<=l?0:100)),l>5&&(a=10*Math.abs(s-l)+(r==c?0:1e3)+(s>=l?0:100)),4==l&&(a=5==s?0+(r==c?0:1e3)+0:10*Math.abs(s-l)+(r==c?0:1e3)+(s<=l?0:100)),5==l&&(a=10*Math.abs(s-l)+(r==c?0:1e3)+(s<=l?0:100)),l==s&&c==r&&(a=0),a<h&&(h=a,d=e[u]);i[d]=1}return _.keys(i)},getVeryShortList:function(t){var e={google:[],typekit:[],webtype:[]};return _.each(t,function(t){var i,n=t.provider;switch(n){case"google":i={provider:n,family:t.name,variations:t.variations};break;case"typekit":i={provider:n,id:t.css_name,name:t.name,variations:t.variations};break;case"webtype":i={provider:n,name:t.name,variations:t.variations}}e[n]&&e[n].push(i)}),e},setShortList:function(e){t.textutils.fontsShortList=e}},window.fontsShortListCallback=function(e){t.textutils.setShortList(e)}}(RM),function(t){"use strict";var e={dimension1:"",dimension2:"",dimension3:"other",dimension4:"anonymous",dimension5:"free"};t.classes.Analytics=Backbone.Model.extend({WIDGET_THRESHOLD:10,initialize:function(e){if(_.bindAll(this),_.extend(this,e),this.isAuthHost=t.utils.URLParts(ServerData.config.readymag_auth_host).hostname==window.location.hostname,this.currentData=this._initCurrentData(),this.router||(this.router=t.viewerRouter||t.collectorRouter||t.constructorRouter||t.homepageRouter),this.currentData.userId&&!t.common.isDownloadedSource){var i=this.currentData.userId;ga("readymag.set","&uid",i)}Modernizr.localstorage&&this._saveCurrentUTMState(),Modernizr.localstorage&&!t.common.isDownloadedSource&&$(this._saveLoginData),this.lastTrackedUrl="",this._createWidgetBuf=0,this.shortlink_redirect=t.utils.getCookie("shortlink_redirect"),$(_.bind(function(){this.trackPage()},this))},sendEvent:function(e,i,n,s){if(!window.ga)return void console.log("No UA instance!");var r={action:e};if(_.isObject(i)?r=_.extend(r,i):(r.label=i||void 0,r.value=n||void 0),"Create Widget"==e){if(this._createWidgetBuf+=1,this._createWidgetBuf%=this.WIDGET_THRESHOLD,0!=this._createWidgetBuf)return;r.value=this.WIDGET_THRESHOLD}var a=this._extendParams(r),o={hitType:"event",eventCategory:a.category,eventAction:a.action,eventLabel:a.label,eventValue:a.value,page:a.page,location:a.href,hitCallback:s||a.cb||void 0};"Mag Actions"==a.category&&t.common.userTracker&&!this.isAuthHost&&"Key Press"!=a.action&&window.ga("t0.send",o);var l=_.clone(o);l=_.extend(l,this._addDimensions()),t.common.isDownloadedSource||(window.ga("readymag.send",l),this.nextCustom(l)),this.nextCallbacks(a)},trackPage:function(e){if(window.ga){var i=this._extendParams(e);if(void 0!=this.shortlink_redirect&&(i=_.extend(i,this._processRedirectUTM())),i.page!=this.lastTrackedUrl){this.lastTrackedUrl=i.page,this.trigger("trackpage",i.page),location.search.indexOf("utm_")!=-1&&(i.cb=_.bind(this._removeUTMQuery,this));var n={page:i.page,location:i.href,hitCallback:i.cb||void 0};i.campaignName&&i.campaignMedium&&i.campaignSource&&(n.campaignName=i.campaignName,n.campaignSource=i.campaignSource,n.campaignMedium=i.campaignMedium),t.common.userTracker&&!this.isAuthHost&&window.ga("t0.send","pageview",n);var s=_.clone(n);s=_.extend(s,this._addDimensions()),t.common.isDownloadedSource||(window.ga("readymag.send","pageview",s),this.nextCustom(s)),window.location.search.indexOf("utm_")!=-1&&this._removeUTMQuery(),this.nextTrackCallback(i)}}},nextCallbacks:function(t){window._gaUserCallbacks&&void 0!=window._gaUserCallbacks[t.action]&&window._gaUserCallbacks[t.action].length>0&&_.each(window._gaUserCallbacks[t.action],function(e){"function"==typeof e&&e(t)})},nextTrackCallback:function(t){window._gaUserCallbacks&&void 0!=window._gaUserCallbacks.pageview&&window._gaUserCallbacks.pageview.length>0&&_.each(window._gaUserCallbacks.pageview,function(e){"function"==typeof e&&e(t)})},nextCustom:function(t){var e=t.eventAction;switch(e||window.location.origin!=ServerData.config.readymag_auth_host||(t.eventAction="pageview",this.trackCustom(t)),e){case"Join Form Open":case"Join Button Click":case"Open main video":case"Close main video":case"Alert Show":case"Alert Upgrade":case"Create Mag":case"Domain Alert Show":case"Privacy Alert Show":case"Domain Alert Upgrade":case"Privacy Alert Upgrade":case"Teamwork Alert Show":case"Teamwork Alert Upgrade":case"Code Injection Alert Upgrade":case"Code Injection Alert Show":case"Add Team Member":case"Delete Team Member":case"Code Injection Alert Upgrade":case"Code Injection Alert Show":case"White Label Alert Upgrade":case"White Label Alert Show":case"GA Upgrade":case"Subscribe Click":case"Subscription Coupon Applied":case"Upgrade Click":case"Subscribed":case"PDF Export":case"HTML Export":case"Help Tour Open":case"Help Tour Start":
case"Help Tour Close":case"Help Tour Video Open":case"Help Tour Video Close":case"Affiliate Homepage Button Click":case"Affiliate Settings Learn Click":case"Affiliate Settings Start Click":case"Affiliate Started":case"Affiliate Social Share Click":case"Publish Mag":case"Republish Mag":case"Unpublish Mag":case"Map Domain":case"Set Project Password":case"Set Project GTM":case"Set Project GA":case"Page SEO Open":case"Page Sharing Open":case"Customize Page Sharing":case"Master Page Sharing":case"Restore Defaults Sharing":case"Joined":}},nextIntercom:function(t){var e=t.action,i=window.ServerData&&window.ServerData.me&&(window.ServerData.me.intercom_id||window.ServerData.me.user&&window.ServerData.me.user.intercom_id);if(_.isFunction(window.Intercom)&&i){var n,s={};switch(e){case"Help Tour Close":n="tour-closed",/welcome/i.test(t._step)||_.defer(function(){n="step-by-step-guide-passed",s.last_step=t._step,window.Intercom("trackEvent",n,s)});break;case"Help Tour Video Open":n="welcome-video-watched";break;case"Create Page":n="page-created",s.page_type=t._page_type;break;case"Create Widget":n="widget-created",s.widget_type=t._widget_type;break;case"Publish Mag":n="project-published";break;case"Add Team Member":n="team-member-added";break;case"Subscribed":n="subscribed",s.subscription_plan=t._success;break;case"Cancelled Autorenew":n="subscription-cancelled";break;case"Share Project":n="project-shared";break;case"Map Domain":n="domain-mapped",s.domain=t.domain}n&&window.Intercom("trackEvent",n,s)}},initCustomTracking:function(){if(this.isActiveCustomTracking()){try{var t={},e=(this.router.getAnalyticsDimensions&&this._parseDimensions(this.router.getAnalyticsDimensions()),(new UAParser).getResult());t.referrer=""==document.referrer?"direct":document.referrer,Modernizr.localstorage&&(localStorage.getItem("initial_referrer")||localStorage.setItem("initial_referrer",t.referrer),localStorage.getItem("initial_url")||localStorage.setItem("initial_url",window.location.href),t.distinct_id=this._getGAcid(),t.initial_referrer=localStorage.getItem("initial_referrer"),t.initial_url=localStorage.getItem("initial_url")),t.env_browser_name=e.browser.name,t.env_browser_major=e.browser.major,t.env_browser_version=e.browser.version,t.env_os_name=e.os.name,t.env_os_version=e.os.version,t.env_device_model=e.device.model,t.env_device_type=e.device.type,t.env_device_vendor=e.device.vendor,t.env_screen_width=screen.width,t.env_screen_height=screen.height,t.env_window_width=window.innerWidth,t.env_window_height=window.innerHeight}catch(t){}this.customTrackingInitData=t}},isActiveCustomTracking:function(){return!t.screenshot&&this.router&&!Modernizr.isboxversion},trackCustom:function(t){if(this.isActiveCustomTracking()){t=t||{},this.customTrackingInitData||this.initCustomTracking();var e=_.extend({name:t.eventAction},this.customTrackingInitData,t);$.post("/api/rm-tracker",e)}},registerUser:function(t){t=t||{},this.trackCustom("Joined",{_join_type:t._join_type,_user_id:t._user_id}),this.firstOpenFlag=!1},_parseDimensions:function(t){return{dimension1:t.magId||e.dimension1,dimension2:t.magCreatorId||e.dimension2,dimension3:t.pageType||e.dimension3,dimension4:t.userId||e.dimension4}},_addDimensions:function(e){var i={},n={};return this.router.getAnalyticsDimensions&&(n=this.router.getAnalyticsDimensions()),i.dimension1=n.magId||void 0,i.dimension2=n.magCreatorId||void 0,i.dimension3=n.pageType||void 0,i.dimension4=n.userId||"anonymous",t.constructorRouter&&0==t.constructorRouter.isOwner&&(i.dimension3="constructor shared"),this.isAuthHost&&(i.dimension5=this.currentData.subscription||"free"),this._triggerProjectView&&(i.metric1=1,this._triggerProjectView=!1),i=this._setScreenName(i)},_setScreenName:function(e){return t.viewerRouter&&t.viewerRouter.mag&&t.viewerRouter.magPasswordView&&1==t.viewerRouter.mag.is_private&&(e.screenName="Private project "+t.viewerRouter.mag.num_id),t.viewerRouter&&t.viewerRouter.mag&&0==t.viewerRouter.mag.is_private&&(e.screenName=t.viewerRouter.mag.title),t.constructorRouter&&1==t.constructorRouter.previewMode&&(e.screenName="Preview "+t.constructorRouter.mag.get("num_id")),t.constructorRouter&&0==t.constructorRouter.previewMode&&(e.screenName="Constructor "+t.constructorRouter.mag.get("num_id")),t.collectorRouter&&"shared-folder"!=t.collectorRouter.currentView.mode&&(e.screenName="Profile ‘"+t.collectorRouter.currentView.user.get("name")+"’"),t.collectorRouter&&"shared-folder"==t.collectorRouter.currentView.mode&&(e.screenName="Profile (shared folder) ‘"+t.collectorRouter.currentView.user.get("name")+"’"),e},_updateAnalyticsData:function(t){var e={rm_url:t.rm_url,rm_referrer:t.rm_referrer};$.post("/api/me/analytics",{analytics_data:e})},_correctUrl:function(t){return"/"==t?t:"/"==t[t.length-1]?t.substr(0,t.length-1):t},_initCurrentData:function(){var t={};return t.userId=null,this.isAuthHost&&window.ServerData.me&&(t.userId=ServerData.me._id||ServerData.me.user&&ServerData.me.user._id,t.userEmail=ServerData.me.email||ServerData.me.user&&ServerData.me.user.email,t.userFullName=ServerData.me.name||ServerData.me.user&&ServerData.me.user.name,t.subscription=this._getSubscription()),t},_getSubscription:function(){var t=ServerData.me.stripe&&ServerData.me.stripe.subscription_id||ServerData.me.user&&ServerData.me.user.stripe&&ServerData.me.user.stripe.subscription_id,e="",i="",n="";return t&&"none"!=t.toLowerCase()?(t=t.toLowerCase(),t&&/yearly/g.test(t)?n="yearly":t&&/monthly/g.test(t)&&(n="monthly"),i=t,i=i.replace(/ /g,""),i=i.replace(/_/g,""),i=i.replace(/(yearly|monthly)/g,""),i=i.replace(/plan/g,""),i=i.trim(),e="paid"):(e="free",i=""),e+" "+i+" "+n},_saveCurrentUTMState:function(){null!=localStorage.getItem("rm_url")||this.router.me||(this.firstOpenFlag=!0,localStorage.setItem("rm_url",window.location.href)),null!=localStorage.getItem("rm_referrer")||this.router.me||localStorage.setItem("rm_referrer",document.referrer)},_saveLoginData:function(){var e=t.utils.getCookie("send_join_event");e&&(e=JSON.parse(atob(e)),this.sendEvent("Joined",{label:e.type,join_type:e.type,fullName:this.currentData.userFullName,email:this.currentData.userEmail,user_id:this.currentData.userId}),this._updateAnalyticsData(e),t.utils.deleteCookie("send_join_event"))},_extendParams:function(e){var e=e||{},i=e;return t.common.isDownloadedSource||(i.dims=this.router.getAnalyticsDimensions&&this._parseDimensions(this.router.getAnalyticsDimensions())),i.page||(i.page="/"+Backbone.history.getFragment()),i.page.indexOf("?")!=-1&&(i.page=i.page.substr(0,i.page.indexOf("?"))),i.page=this._correctUrl(i.page),i.href=window.location.href,i.action&&(i.category=this.getActionCategory(i.action)),i},_processRedirectUTM:function(){if(this.shortlink_redirect){var e=JSON.parse(atob(this.shortlink_redirect));return t.utils.deleteCookie("shortlink_redirect"),{campaignName:e.utm_campaign,campaignSource:e.utm_source,campaignMedium:e.utm_medium}}},_removeUTMQuery:function(){if(window.history&&history.replaceState){var t=window.location.toString().replace(/\&utm([_a-z0-9=]+)/g,"");t=t.replace(/\?utm([_a-z0-9=]+)/,"?"),t=t.replace(/\?$/,""),history.replaceState({},"",t)}},_getGAcid:function(){var e=t.utils.getCookie("_ga"),i=null;return e&&(e=e.match(/GA[0-9]+\.[0-9]+\.(.*)/),e.length>1&&(i=e[1])),i||(i=t.utils.generateUUID()),i},getActionCategory:function(t){var e="";switch(t){case"Joined":case"Subscribed":case"Subscribe Error":case"Resumed Subscription":case"Changed Subscription":case"Coupon Applied":case"Cancelled Subscription":case"Cancelled Autorenew":e="Basic User Actions";break;case"Start publishing":case"Featured mag":case"Featured publisher":case"Announcement":case"Explore tour examples":case"View tour example":case"View tour publisher":case"Change slides - forget about code":case"Toggle templates slider":case"Start viewport quick demo":case"Close viewport quick demo":case"Open main video":case"Close main video":case"Open fonts slider":case"Toggle fonts slider":case"Toggle plans":case"Tour":case"Pricing":case"Templates":case"Explore":case"About":case"Join":case"Education":case"Facebook profile":case"Twitter profile":case"Vimeo profile":case"Readymag page":case"Contact hello":case"Contact support":case"Template demo":case"Join Form Open":case"Join Button Click":case"Affiliate Homepage Button Click":e="Homepage Actions";break;case"Share":case"Logo":case"Close Mag":case"Final Page Related Mags":case"Contents":case"Profile":case"Slideshow Toggle":case"Video Play":case"Video Pause":case"External Link":case"Anchor Link":case"Back Link":case"Scroll Top Link":case"Embed":case"Key Press":case"Hotspot Click":case"Hotspot Hover":e="Mag Actions";break;case"Alert Show":case"Alert Upgrade":case"Create Mag":case"Create Mag Request":case"Domain Alert Show":case"Privacy Alert Show":case"Domain Alert Upgrade":case"Privacy Alert Upgrade":case"Teamwork Alert Show":case"Teamwork Alert Upgrade":case"Code Injection Alert Upgrade":case"Code Injection Alert Show":case"White Label Alert Upgrade":case"White Label Alert Show":case"Add Team Member":case"Delete Team Member":case"GA Upgrade":case"Subscribe Click":case"Upgrade Click":case"PDF Export":case"HTML Export":case"Help Tour Open":case"Help Tour Start":case"Help Tour Close":case"Help Tour Video Open":case"Help Tour Video Close":case"Affiliate Settings Learn Click":case"Affiliate Settings Start Click":case"Affiliate Started":case"Affiliate Social Share Click":case"Publish Mag":case"Republish Mag":case"Unpublish Mag":case"Gift Code Purchase":case"Create Page":case"Create Widget":case"Share Project":case"Map Domain":case"Set Project Password":case"Set Project GTM":case"Set Project GA":case"Page SEO Open":case"Page Sharing Open":case"Customize Page Sharing":case"Master Page Sharing":case"Restore Defaults Sharing":case"Help Open":e="Process Actions";break;case"First Widget Pack Loaded":e="Performance"}return e},switchOn:function(){}})}(RM),function(t){"use strict";t.viewports=[{name:"default",width:1024,min_height:672,max_height:201600,caption:"Laptop & Tablet Landscape",shortcut:"1"},{name:"tablet_portrait",width:768,min_height:926,max_height:201600,caption:"Tablet Portrait",shortcut:"2"},{name:"phone_portrait",width:320,min_height:528,max_height:201600,caption:"Phone Portrait",shortcut:"3"}],t.viewport_fields_common=["x","y","w","h","z","hidden","angle","flip_h","flip_v","pack_id","fixed_position","is_full_width","sticked","animation"],t.viewport_fields={background:_.union(["color","opacity","selectedType","picture"],t.viewport_fields_common),picture:_.union(["picture","cropW","cropH","cropX","cropY","originalW","originalH","ratio","scale","pic_opacity","pic_color","border_size","border_color","border_radius","border_radius_max","opacity","anchor_link_pos"],t.viewport_fields_common),slideshow:_.union(["images_h","captions_h"],t.viewport_fields_common),text:_.union(["column_count","column_gap","bg_color","bg_opacity"],t.viewport_fields_common),shape:_.union(["rasterUrl","raster2xUrl","borders","weight","anchor_link_pos"],t.viewport_fields_common),button:_.union(["anchor_link_pos"],t.viewport_fields_common),hotspot:_.chain().union(["rasterUrl","raster2xUrl","borders","weight","anchor_link_pos"],t.viewport_fields_common).without("w","h").value(),form:_.union(["layout","style","style-colored-button-default","style-colored-button-hover","style-colored-fields","style-outlined-button-default","style-outlined-button-hover","style-outlined-fields","style-underlined-button-default","style-underlined-button-hover","style-underlined-fields"],t.viewport_fields_common)},t.viewport_listall=_.map(t.viewports,function(t){return"viewport_"+t.name}),t.viewport_list=_.without(t.viewport_listall,"viewport_default"),t.widgetViewportFields=function(e){return t.viewport_fields[e]||t.viewport_fields_common}}(RM);var googleMapsAPICallbacks=[],facebookAPICallbacks=[],twitterAPICallbacks=[],mailchimpAPICallbacks=[];"undefined"==typeof RM&&(RM={}),function(t){t.initutils={initGMapsAPI:function(e){if(window.google&&window.google.maps)return e();if(!window.processGoogleMapsAPICallbacks){window.processGoogleMapsAPICallbacks=function(){_.each(googleMapsAPICallbacks,function(t){_.isFunction(t)&&t()})};var i=document.createElement("script");i.type="text/javascript";var n="?key="+t.constants.GOOGLE_API+"&libraries=places&callback=processGoogleMapsAPICallbacks";t.constants.IS_FILE_PROTOCOL&&(n=""),i.src=t.utils.selectProtocol("//maps.googleapis.com/maps/api/js"+n),document.body.appendChild(i)}googleMapsAPICallbacks.push(e)},initFacebookAPI:function(e){var i,n=t.constants.FACEBOOK_APP_ID||"";if("function"==typeof e){if(t.initutils.isFacebookInited)return e();facebookAPICallbacks.push(e),i=$("#fb-root"),i.length||$("body").prepend($('<div id="fb-root"></div>')),window.fbAsyncInit=function(){FB.init({appId:n,xfbml:!1,version:"v2.2"}),_.each(facebookAPICallbacks,function(t){_.isFunction(t)&&t()}),t.initutils.isFacebookInited=!0},function(e,i,n){var s,r=e.getElementsByTagName(i)[0];e.getElementById(n)||(s=e.createElement(i),s.id=n,s.src=t.utils.selectProtocol("//connect.facebook.net/en_US/sdk.js"),r.parentNode.insertBefore(s,r))}(document,"script","facebook-jssdk")}},initTwitterAPI:function(e){return t.initutils.isTwitterInited?void(_.isFunction(e)&&e()):(_.isFunction(e)&&twitterAPICallbacks.push(e),void(t.initutils.isTwitterLoading||(t.initutils.isTwitterLoading=!0,$('body > script[src^="//syndication.twimg.com/tweets.json"]').remove(),$.ajax({url:t.utils.selectProtocol("//platform.twitter.com/widgets.js"),dataType:"script",cache:!1,success:function(){_.each(twitterAPICallbacks,function(t){_.isFunction(t)&&t()}),twttr.events.bind("click",t.utils.getFocusBack),t.initutils.isTwitterInited=!0,t.initutils.isTwitterLoading=!1}}))))},initMailchimpAPI:function(e){return t.initutils.isMailchimpInited?void(_.isFunction(e)&&e(t.initutils.mailchimp)):(_.isFunction(e)&&mailchimpAPICallbacks.push(e),void(t.initutils.isMailchimpLoading||(t.initutils.isMailchimpLoading=!0,$.ajax({url:t.utils.selectProtocol("//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js"),dataType:"script",cache:!1,success:function(){return window.require?void window.require(["mojo/signup-forms/Loader"],function(e){t.initutils.mailchimp=e,_.each(mailchimpAPICallbacks,function(e){_.isFunction(e)&&e(t.initutils.mailchimp)}),t.initutils.isMailchimpInited=!0}):void(mailchimpAPICallbacks=[])},complete:function(){t.initutils.isMailchimpLoading=!1}}))))}}}(RM),function(t,e){"use strict";t.classes.embedplugins=t.classes.embedplugins||{},t.embedutils=t.embedutils||{},t.embedutils.findPlugin=function(e){var i=t.embedMatcher.matchCode(e.code,e);return _.find(t.classes.embedplugins,function(t,e){return e.toLowerCase()==i})},t.classes.EmbedPlugin=Backbone.View.extend({embed_type:null,containerSelector:null,resizable:!0,proportional:!1,forceFrameSize:!1,initialize:function(e){this.block=e.block,this.widget=e.widget,_.bindAll(this),this.isInViewer=t.viewerRouter||t.constructorRouter&&t.constructorRouter.preview},parse:function(t,e){return e(t)},sanitize:function(t){return t=sanitize(t).xss(),$(t)},draw:function(t){t()}}),t.embedutils.instagramEmbedCallbacks=[],t.embedutils.initInstagram=function(e){return window.instgrm&&window.instgrm.Embeds&&_.isFunction(window.instgrm.Embeds.process)?(instgrm.Embeds.process(),e()):(t.embedutils.instagramEmbedCallbacks.push(e),t.embedutils.instagramInitXhr&&t.embedutils.instagramInitXhr.abort(),$('body > script[src^="//platform.instagram.com"]').remove(),void(t.embedutils.instagramInitXhr=$.ajax({url:t.utils.selectProtocol("//platform.instagram.com/en_US/embeds.js"),dataType:"script",success:function(){_.each(t.embedutils.instagramEmbedCallbacks,function(t){_.isFunction(t)&&t()})}})))},t.classes.embedplugins.Instagram=t.classes.EmbedPlugin.extend({embed_type:"instagram",containerSelector:"iframe",resizable:!0,initialize:function(e){t.classes.EmbedPlugin.prototype.initialize.apply(this,arguments),this.block&&_.extend(this.block.frame,{minwidth:164,minheight:264})},parse:function(t,e){return e(t.replace(/<script.*script>/i,""))},draw:function(e,i,n){var s,r,a,o,l,c=0,h=100,d=20,u=50,p=!1;i.html(e),t.embedutils.initInstagram(function(){l=setInterval(function(){if(c++,s=i.children(this.containerSelector),r=s.height(),r||c>d){if(r||c>u)return r&&"constructor"===t.common.mode&&(a=s.width(),o=s.height()),clearInterval(l),void n(a,o);if(p)return;p=!0,n()}}.bind(this),h)}.bind(this))},customResizeHandler:function(t,e,i){return t}}),t.embedutils.pinterestEmbedCallbacks=[],t.embedutils.initPinterest=function(e){var i,n=0,s=20;return _.isFunction(window.parsePinBtns)?e():(t.embedutils.pinterestEmbedCallbacks.push(e),$('body > script[src^="assets.pinterest.com/js/pinit.js"]').remove(),$("body").prepend($('<script defer src="//assets.pinterest.com/js/pinit.js" data-pin-build="parsePinBtns"></script>')),void(i=setInterval(function(){n++,(_.isFunction(window.parsePinBtns)||n>s)&&(clearInterval(i),e())},100)))},t.classes.embedplugins.Pinterest=t.classes.EmbedPlugin.extend({embed_type:"pinterest",containerSelector:"a",resizable:!1,forceFrameSize:!0,containerSelectors:{buttonPin:"span",buttonFollow:"span",embedPin:"span",embedUser:"span",embedBoard:"span"},parse:function(t,e){var i=t.match(/data-pin-do=\"(\S+)\"/);return _.isArray(i)&&i[1]&&(this.pinterestType=i[1],this.containerSelector=this.containerSelectors[this.pinterestType]||this.containerSelector),e&&e(t.replace(/<script.*script>/i,""))},draw:function(e,i,n){t.embedutils.initPinterest(function(){var s,r,a,o,l,c,h=0,d=100,u=20,p=50,f=!1;i.html(e),this.pinterestType||this.parse(e[0].outerHTML),this.pinterestType&&i.addClass(this.pinterestType),window.parsePinBtns(i.get(0)),l=setInterval(function(){if(h++,s=i.children(this.containerSelector).filter(function(){return/PIN_\d+/.test(this.className)}),r=s.height(),r||h>u){if(r||h>p)return r&&"constructor"===t.common.mode&&(a=s.outerWidth(!0),o=s.outerHeight(!0),"buttonFollow"==this.pinterestType&&(c=s.children("i"),c.length&&(a+=(c.outerWidth()||1)-1))),clearInterval(l),void n(a,o);if(f)return;f=!0,n()}}.bind(this),d)}.bind(this))}}),t.classes.embedplugins.FacebookVideo=t.classes.EmbedPlugin.extend({embed_type:"fbvideo",containerSelector:"iframe",resizable:!0,proportional:!0,forceFrameSize:!0,initialize:function(e){t.classes.EmbedPlugin.prototype.initialize.apply(this,arguments),this.block&&_.extend(this.block.frame,{minwidth:220,minheight:124})},parse:function(t,e){return e(t.replace(/<script.*script>/gi,"").replace(/<div\s+id=(\'|\")fb-root(\'|\")><\/div>/gi,""))},draw:function(e,i,n){var s,r,a;i.html(e),t.initutils.initFacebookAPI(function(){window.FB.XFBML.parse(i.get(0),function(){s=i.find(this.containerSelector),r=s.width(),a=s.height(),n(r,a)}.bind(this))}.bind(this))}}),t.embedutils.readymagEmbedCallbacks=[],t.embedutils.initReadymag=function(e){return t.common.isReadymagEmbedInited&&_.isFunction(window.RM_EMBED_parse)?e():(t.embedutils.readymagEmbedCallbacks.push(e),window.RM_EMBED_initAsync=function(){t.common.isReadymagEmbedInited=!0,_.each(t.embedutils.readymagEmbedCallbacks,function(t,e){_.isFunction(t)&&t()}),t.embedutils.readymagEmbedCallbacks=[]},void(t.embedutils.readymagInitXhr||($('body > script[src~="RM_EMBED_"]').remove(),t.embedutils.readymagInitXhr=$.ajax({url:t.constants.EMBED_SCRIPT_MAIN,dataType:"script"}))))},t.classes.embedplugins.Readymag=t.classes.EmbedPlugin.extend({embed_type:"readymag",containerSelector:"iframe",resizable:!0,initialize:function(e){t.classes.EmbedPlugin.prototype.initialize.apply(this,arguments),this.block&&this.block.frame&&(_.extend(this.block.frame,{minwidth:288,minheight:236,maxwidth:512,maxheight:383}),this.block.model.set({w:Math.max(this.block.model.get("w"),this.block.frame.minwidth),h:Math.max(this.block.model.get("h"),this.block.frame.minheight)}))},parse:function(t,e){return e(t.replace(/<script.*script>/i,""))},draw:function(e,i,n){i.html(e),t.embedutils.initReadymag(function(){window.RM_EMBED_parse(function(){var t=i.find(this.containerSelector),e=t.height();n(null,e)}.bind(this))}.bind(this))}}),t.classes.embedplugins.IFrame=t.classes.EmbedPlugin.extend({embed_type:"simple-iframe",containerSelector:"iframe",resizable:!0,parse:function(t,e){var i,n=/[\s\S]*?(\<iframe[\s\S]*?\>)[\s\S]*?(\<\/iframe\>)[\s\S]*?/i;return i=t.match(n),e(i&&i[1]&&i[2]?i[1]+i[2]:null)},sanitize:function(t){var e=$(t);if("object"!=typeof e||!e.length)return e;var i=$("<iframe></iframe>"),n=e.get(0).attributes,s=["allowtransparency","height","name","sandbox","scrolling","seamless","src","width"];return _(n).each(function(t){if("object"==typeof t&&t.specified&&_.contains(s,t.name.toLowerCase())){var e=t.name.toLowerCase(),n=t.value;"src"==e&&"https:"==window.location.protocol&&(n=n.replace(/^http(s?):\/\//i,"//")),i.attr(e,n)}}),i},draw:function(e,i,n){var s=e[0].src;if(!s||!s.trim())return void n();if(t.screenshot){var r=s.indexOf("youtube")>-1,a=s.indexOf("vimeo")>-1,o=r&&"youtube"||a&&"vimeo";if(o)return void this.setPosterInsteadOfVideo(o,s,i,n)}i.html(e);var l,c,h,d,u,p=0,f=100,g=20,m=50,v=!1;u=setInterval(function(){if(p++,l=i.children(this.containerSelector),c=l.height(),c||p>g){if(c||p>m)return c&&"constructor"===t.common.mode&&(h=l.width(),d=l.height()),clearInterval(u),void n(h,d);if(v)return;v=!0,n()}}.bind(this),f)},setPosterInsteadOfVideo:function(t,e,i,n){function s(e){h[0].src=e,i.css({"background-color":"#000"}),h.css({position:"absolute",top:0,bottom:0,margin:"auto",width:"100%",height:"auto"}),i.append(h),h.on("load",function(){"youtube"===t&&!c&&h[0].naturalWidth<=120?(c=!0,e="https://img.youtube.com/vi/"+r+"/hqdefault.jpg",h[0].src=e):(n(),h.off("load"))})}var r,a,o,l="",c=!1,h=$("<img/>");if("youtube"===t){if(a=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,o=e.match(a),!o||!o[7]||11!=o[7].length)return void n();r=o[7],l="https://img.youtube.com/vi/"+r+"/sddefault.jpg",s(l)}else if("vimeo"===t){if(a=/player\.vimeo\.com\/video\/([0-9]*)/,o=e.match(a),!o||!o[1])return void n();r=o[1],$.getJSON("https://www.vimeo.com/api/v2/video/"+r+".json?callback=?",{format:"jsonp"}).done(function(t){l=t[0].thumbnail_large,s(l)}).fail(function(){n()})}}}),t.classes.embedplugins.CodeInjection=t.classes.EmbedPlugin.extend({embed_type:"code-injection",containerSelector:"rm-code-injection",resizable:!0,HEAD_PASSTHROUGH_SELECTOR:"",parse:function(t,e){return e(t)},sanitize:function(t){var e=$.parseHTML(t,document,!0);return e},draw:function(t,e,i){var n=$(document).find("head"),s="<head>",r='<body style="padding:0; margin: 0; width: 100%; height: 100%; min-width: initial; min-height: auto;">',a='<!DOCTYPE html><html style="width: 100%; height: 100%; min-width: initial; min-height: auto;">',o=n.find(this.HEAD_PASSTHROUGH_SELECTOR),l=$('<iframe seamless style="width: 100%; height: 100%;"></iframe>'),c=$("<div></div>");if(!this.isInViewer||this.block&&this.block.model.get("use_iframe")||this.widget&&this.widget.use_iframe){o.each(function(){s+=this.outerHTML}),s+='<script src="/js/vendor/jquery-2.2.3.min.js"></script>',s+="</head>",c.html(t),r+=c[0].innerHTML+"</body>";var h=a+s+r+"</html>";return e.html(l),l[0].contentWindow.document.open(),l[0].contentWindow.document.write(h),l[0].contentWindow.document.close(),i(l.width(),l.height())}t=$(t),c.html(t);var d=c.find("script");d.each(function(){var t,e=this;e.src&&e.text&&(t=document.createElement("script"),t.text=e.text,e.text="",$(t).insertAfter($(e)))}),postscribe(e,c[0].innerHTML,{done:function(){return i(null,null)}}),e.css({"font-family":"initial","font-weight":"initial"})},loadNodeWithScripts:function(t,e,i){function n(){var e,s,r,o=a[l],c=10;return o?(l++,e=document.createElement("script"),o.src&&(e.src=o.src),o.text&&(e.text=o.text),o.src?void(o.src&&(e.onload=function(){clearInterval(s),n()},r=0,s=setInterval(function(){r++,r>c&&(e.onload=null,n())},1e3),t[0].appendChild(e))):(t[0].appendChild(e),n())):i()}var s,r=$('<div id="fake"></div>'),a=[];r.html(e),s=r.find("script"),s.each(function(){this.src&&this.text?(a.push({src:this.src}),a.push({text:this.text})):a.push({src:this.src,text:this.text})});var o=_.find(a,function(t){return!!t.src});if(!a.length||!o||a<2)return void t.html(r[0].innerHTML);s.remove();var l=0;t.html(r[0].innerHTML),n()}})}(RM),function(){"use strict";var t=this,e="undefined"!=typeof require,i=t._;if("undefined"==typeof i){if(!e)throw new Error("embed matcher requires underscore, see http://underscorejs.org");i=require("underscore")}var n={defaultType:"codeinjection",matchers:{instagram:[/^\s*<blockquote\s+class=.instagram-media.*<\/blockquote>\s*<script.*src=.*instagram.+>.*<\/script>\s*$/gi],pinterest:[/^\s*<a.*data-pin-do=.*<\/a>([\s\S]*<script.*src=.*pinterest.+>.*<\/script>)?\s*$/i],facebookvideo:[/^\s*<div\s+id=.fb-root.*<\/div>[\s\S]*<script>.*src.*facebook.*sdk.*<\/script>[\s\S]*<div\s+class=.fb-video.*<\/div>\s*$/i],readymag:[/^\s*<a\s+class=.rm-mag-embed.*<\/a>[\s\S]*<script.+id=.readymag-embed-init.+><\/script>\s*$/i],iframe:function(t){t=t||"";var e=t.replace(/<!--[\s\S]*-->/gi,"");return/^\s*<iframe[\s\S]*>[\s\S]*<\/iframe>\s*$/i.test(e)}},matchCode:function(t,e){t=(t||"").trim();for(var n in this.matchers){var s=this.matchers[n];if(i.isFunction(s))return s(t,e)?n:this.defaultType;for(var r in s)if(r=s[r],i.isFunction(r)){if(r(t,e))return n}else{var a=new RegExp(r.source,r.flags);if(a.test(t))return n}}return this.defaultType}};"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=n):t.RM?t.RM.embedMatcher=n:t.embedMatcher=n}.call(this),"undefined"==typeof RM&&(RM={}),function(t){t.videoutils={getVideoAspectFromPoster:function(t,e){var i={abort:function(){h.onload=null,h.onerror=null}},n={aspect_poster:null,aspect_real:null};if(!t)return e(n),i;var s,r,a,o,l,c,h=new Image;return h.onload=function(){function t(t,e){var i,n,s,r,l,c="row"==e?a:o,h=0,d=0,u=5,f=20,g=3;for(i=0;i<c;i++)n=("row"==e?t*a+i:i*a+t)<<2,s=p.data[n],r=p.data[n+1],l=p.data[n+2],h+=s+r+l,s<f&&r<f&&l<f&&d++;return h/=3*c,{isBlack:h<u&&c-d<g,isContrast:d<c/2}}l=h.width,c=h.height,a=200,o=Math.floor(a*(c/l)),s=$('<canvas id="qqq" width="'+a+'" height="'+o+'"></canvas>').css("visibility","hidden").appendTo("body"),r=s[0].getContext("2d"),r.drawImage(h,0,0,a,o);var i,d,u,p=r.getImageData(0,0,a,o),f=0,g=0,m=0,v=0;for(d=0;d<=o/2;d++){var u=t(d,"row");if(u.isContrast){(d<=1||t(d-1,"row").isBlack||t(d-2,"row").isBlack)&&(f=d);break}}for(d=o-1;d>o/2;d--){var u=t(d,"row");if(u.isContrast){(d>=o-2||t(d+1,"row").isBlack||t(d+2,"row").isBlack)&&(g=o-1-d);break}}var _=Math.max(f,g),y=0;if(!_){for(i=0;i<=a/2;i++){var u=t(i,"column");if(u.isContrast){(i<=1||t(i-1,"column").isBlack||t(i-2,"column").isBlack)&&(m=i);break}}for(i=a-1;i>a/2;i--){var u=t(i,"column");if(u.isContrast){(i>=a-2||t(i+1,"column").isBlack||t(i+2,"column").isBlack)&&(v=a-1-i);break}}y=Math.max(v,m)}_>o/3&&(_=0),y>a/3&&(y=0);var w=l/c;_?w=a/(o-2*_):y&&(w=(a-2*y)/o),s.remove(),n.aspect_poster=l/c,n.aspect_real=w,e(n)},h.onerror=function(){e(n)},h.src="/api/proxy/?url="+encodeURIComponent(t),i},setVideoPosition:function(t){if(t.aspect_poster&&t.$media&&t.$media.length){var e=t.$container.css("width"),i=t.$container.css("height");if(/px/.test(e+i))e=parseInt(e),i=parseInt(i);else{if(!t.mag)return;var n=t.mag.getContainerSizeCached();e=n.width,i=n.height}var s=t.aspect_poster,r=t.aspect_real||s,a=t.controls_remove?5:0,o=e+2*a,l=i+2*a,c=o,h=l;if(s){var d,u;o/l>r?(d=o,u=d/r):(u=l,d=u*r),s<r?(c=d,h=c/s):(h=u,c=h*s)}if("vimeo"==t.provider.toLowerCase()&&t.controls_remove){var p=(h-l)/2,f=(c-o)/2;if(_=50,minRightPadding=46,diffBottom=_-p,diffRight=minRightPadding-f,diffBottom>0||diffRight>0){var g=(h+2*diffBottom)/h,m=(c+2*diffRight)/c,v=Math.max(g,m);c*=v,h*=v}}if("youtube"==t.provider.toLowerCase()&&t.controls_remove){var p=(h-l)/2,_=103,y=_-p;y>0&&(h+=2*y,c=h*s)}var w=-a-(c-o)/2,b=-a-(h-l)/2;t.$media.css({left:w,top:b,width:c,height:h})}}}}(RM),"undefined"==typeof RM&&(RM={}),function(t){t.animationutils={DEG_TO_RAD:Math.PI/180,ANIMATION_PROPERTIES:function(){var t=!1,e="animation",i="AnimationIteration",n="AnimationEnd",s="animation-timing-function",r="@keyframes",a="transform",o="transform",l="Webkit Moz O ms Khtml".split(" "),c="webkit moz o MS кhtml".split(" "),h=document.createElement("div");if(void 0!=h.style.animationName)t=!0,i=i.toLowerCase(),n=n.toLowerCase();else for(var d=0;d<l.length;d++)if(void 0!=h.style[l[d]+"AnimationName"]){e=l[d]+"Animation",i=c[d]+i,n=c[d]+n,s="-"+l[d].toLowerCase()+"-"+s,r="@-"+l[d].toLowerCase()+"-keyframes",t=!0;break}if(void 0==h.style.transform)for(var d=0;d<l.length;d++)if(void 0!=h.style[l[d]+"Transform"]){a=l[d]+"Transform",o="-"+l[d].toLowerCase()+"-transform";break}return h=null,{animationSupported:t,animationJS:e,animationIterationJS:i,animationEndJS:n,animationTimingFunctionCSS:s,keyframeCSS:r,transformJS:a,transformCSS:o}}(),createAnimationTimeline:function(t){return new n(t)},getNormalizedAnimation:function(t,e,i,n){function s(t,e){var i,n=t.dx-e.dx,s=t.dy-e.dy;return i=0!=n||0!=s?Math.pow(n*n+s*s,.5)/t.speed:300/t.speed,Math.ceil(i)}var r={dx:0,dy:0,from_opacity:100,opacity:100,from_rotate:0,rotate:0,from_scale:100,scale:100},a={use_move:["dx","dy"],use_opacity:["from_opacity","opacity"],use_rotate:["from_rotate","rotate"],use_scale:["from_scale","scale"]},o=_.extend({},t);"scroll"==o.type&&(o.loop=!1),o.steps=[];for(var l={dx:0,dy:0},c=0;c<t.steps.length;c++){var h=_.extend({},t.steps[c]);_.each(a,_.bind(function(t,e){h[e]?(r[t[0]]=h[t[0]],r[t[1]]=h[t[1]]):(h[t[0]]=r[t[0]],h[t[1]]=r[t[1]])},this)),i&&(h.dx=0,h.rotate=0,h.from_rotate=0),"scroll"!=o.type||e||0!=c||(h.delay_px=0),1!=n&&e&&(h.dx*=n,h.dy*=n),"scroll"==o.type?(h.calcedDuration=s(h,l),h.calcedDelay=h.delay_px||0):(h.calcedDuration=h.duration||.001,h.calcedDelay=h.delay||0),h.acceleration=h.acceleration||"none",o.steps.push(h),l=h}return o}};var e=0,i=t.animationutils.ANIMATION_PROPERTIES,n=Backbone.View.extend({initialize:function(t){if(_.bindAll(this),_.extend(this,t),i.animationSupported){this.active=!1,this.reversed=!1,this.animationLength=0,this.hasRotation=!1;for(var e=0;e<this.steps.length;e++){var n=this.steps[e];this.animationLength+=n.calcedDelay+n.calcedDuration,n.use_rotate&&(0==e&&0!=n.from_rotate||0!=n.rotate)&&(this.hasRotation=!0)}this.$el.toggleClass("force3d",!!this.force3d),"scroll"!=this.type?this.generateNormalAnimation():this.generateFramesAnimation()}},generateNormalAnimation:function(){function t(t,e,n){var s="\t";return s+=_.map(t,function(t){return 100*t+"%"}).join(", ")+" {",s+=i.transformCSS+": "+r.getTransformString(e.dx,e.dy,e.rotate,e.scale/100)+"; ",s+="opacity: "+(0==e.opacity?0:e.opacity/100)+"; ",n&&(s+=i.animationTimingFunctionCSS+": "+n),s+="}\n"}for(var n=0,s=[[0]],r=this,a=this.steps.length,o=0;o<a;o++){var l=this.steps[o].calcedDelay/this.animationLength,c=this.steps[o].calcedDuration/this.animationLength;l>=1e-4?s[s.length-1].push(n+l):l=0,n+=l+c,o==a-1&&(n=1),s.push([n])}e++,this.id=e;var h=i.keyframeCSS+" animation_"+this.id+" {\n",d={none:"linear","ease-in":"ease-in","ease-out":"ease-out","ease-both":"ease-in-out"};h+=t(s[0],{dx:0,dy:0,opacity:this.steps[0].from_opacity,rotate:this.steps[0].from_rotate,scale:this.steps[0].from_scale},d[this.steps[0].acceleration]);for(var o=0;o<a;o++)h+=t(s[o+1],this.steps[o],this.steps[o+1]?d[this.steps[o+1].acceleration]:void 0);h+="}\n",this.keyframesStyle=document.createElement("style"),this.keyframesStyle.innerHTML=h,this.$el.append(this.keyframesStyle),this.$el.on(i.animationIterationJS,this.onAnimationIteration),this.$el.on(i.animationEndJS,this.onAnimationEnd),this.applyStepState(this.screenshotMode&&"load"==this.type?a-1:"initial")},generateFramesAnimation:function(){var t=0,e={dx:0,dy:0,opacity:this.steps[0].from_opacity,rotate:this.steps[0].from_rotate,scale:this.steps[0].from_scale};this.frames=[],this.frames.push({ind:0,isDelay:!1,params:e});for(var i=0;i<this.steps.length;i++){var n=this.steps[i];n.calcedDelay&&(this.frames.push({ind:t+1,isDelay:!0,params:e
}),t+=n.calcedDelay),e={dx:n.dx,dy:n.dy,opacity:n.opacity,rotate:n.rotate,scale:n.scale,acceleration:n.acceleration},this.frames.push({ind:t+1,isDelay:!1,params:e}),t+=n.calcedDuration}this.seek(0)},getTransformString:function(e,i,n,s){var r;if(s<.001&&(s=.001),this.hasRotation&&"scroll"!=this.type)r=this.force3d?"translate3d("+e+"px,"+i+"px,0) rotate("+n+"deg) scale("+s+")":"translate("+e+"px,"+i+"px) rotate("+n+"deg) scale("+s+")";else{var a=s,o=0,l=",";n&&(n*=t.animationutils.DEG_TO_RAD,a=Math.cos(n)*s,o=Math.sin(n)*s),a=Math.abs(a)<1e-6?0:a,o=Math.abs(o)<1e-6?0:o;var c=a+l+o,h=-o+l+a,d=e+l+i;r=this.force3d?"matrix3d("+c+",0,0,"+h+",0,0,0,0,1,0,"+d+",0,1)":"matrix("+c+l+h+l+d+")"}return r},applyStepState:function(t){if(this.$el.removeClass("invisible"),"initial"==t)this.$el[0].style[i.transformJS]=this.getTransformString(0,0,this.steps[0].from_rotate,this.steps[0].from_scale/100),this.$el[0].style.opacity=0==this.steps[0].from_opacity?0:this.steps[0].from_opacity/100;else{var e=this.steps[t];this.$el[0].style[i.transformJS]=this.getTransformString(e.dx,e.dy,e.rotate,e.scale/100),this.$el[0].style.opacity=0==e.opacity?0:e.opacity/100,0==e.opacity&&"hover"!=this.type&&this.$el.addClass("invisible")}},play:function(){if(!this.screenshotMode&&i.animationSupported){var t=i.animationJS;this.stop(),this.$el.removeClass("invisible"),this.$el.outerHeight(),this.$el[0].style[t+"Name"]="animation_"+this.id,this.$el[0].style[t+"Duration"]=this.animationLength+"s",this.$el[0].style[t+"IterationCount"]=this.loop?"infinite":1,this.$el[0].style[t+"Direction"]="alternate",this.$el[0].style[t+"FillMode"]="both",this.$el[0].style[t+"PlayState"]="",this.active=!0,this.reversed=!1}},reverse:function(){if(!this.screenshotMode&&i.animationSupported){var t=i.animationJS;this.stop(),this.$el.removeClass("invisible"),this.$el.outerHeight(),this.$el[0].style[t+"Name"]="animation_"+this.id,this.$el[0].style[t+"Duration"]=this.animationLength+"s",this.$el[0].style[t+"IterationCount"]=this.loop?"infinite":1,this.$el[0].style[t+"Direction"]="alternate-reverse",this.$el[0].style[t+"FillMode"]="both",this.$el[0].style[t+"PlayState"]="",this.active=!0,this.reversed=!0}},stop:function(){this.$el.removeClass("invisible"),this.$el[0].style[i.animationJS]="",this.active=!1,this.reversed=!1},onAnimationEnd:function(){this.reversed=!this.reversed,this.active=!1,this.$el[0].style[i.animationJS]="",this.applyStepState(this.reversed?this.steps.length-1:"initial"),this.trigger("full-cycle-end")},onAnimationIteration:function(t){var e=Math.round(t.originalEvent.elapsedTime/this.animationLength)%2;e?this.reversed=!0:(this.reversed=!1,this.trigger("full-cycle-end"))},resume:function(){this.screenshotMode||i.animationSupported&&(Modernizr.isdesktop?this.$el[0].style[i.animationJS+"PlayState"]="running":this.play(),this.active=!0)},pause:function(){i.animationSupported&&(Modernizr.isdesktop?this.$el[0].style[i.animationJS+"PlayState"]="paused":this.stop(),this.active=!1)},seek:function(t){function e(t,e,i,s){if(0==i)return t;if(i==s-1)return e;var r=i/(s-1);return{dx:t.dx==e.dx?t.dx:n(t.dx,e.dx,r,e.acceleration),dy:t.dy==e.dy?t.dy:n(t.dy,e.dy,r,e.acceleration),opacity:t.opacity==e.opacity?t.opacity:n(t.opacity,e.opacity,r,e.acceleration),rotate:t.rotate==e.rotate?t.rotate:n(t.rotate,e.rotate,r,e.acceleration),scale:t.scale==e.scale?t.scale:n(t.scale,e.scale,r,e.acceleration)}}function n(t,e,i,n){var s;return s=n&&"none"!=n?"ease-in"==n?i*i:"ease-out"==n?i*(2-i):i<.5?i*i*2:2*i*(2-i)-1:i,t+(e-t)*s}if(i.animationSupported){t=Math.max(Math.min(t,this.animationLength),0);var s,r=this.frames.length;for(s=0;s<r&&!(this.frames[s].ind>t);s++);s--;var a,o,l;this.frames[s].isDelay?a=e(this.frames[s].params,this.frames[s].params,0,1):(o=s?this.frames[s].ind-1:0,l=s==r-1?this.animationLength:this.frames[s+1].ind-1,a=e(this.frames[s?s-1:0].params,this.frames[s].params,t-o,l-o+1)),this.$el[0].style[i.transformJS]=this.getTransformString(a.dx,a.dy,a.rotate,a.scale/100),this.$el[0].style.opacity=0==a.opacity?0:a.opacity/100,this.$el.toggleClass("invisible",0==a.opacity)}},destroy:function(){this.$el.off(i.animationIterationJS,this.onAnimationIteration),this.$el.off(i.animationEndJS,this.onAnimationEnd),this.$el[0].style[i.animationJS]="",this.$el[0].style[i.transformJS]="",this.$el[0].style.opacity="",this.$el.removeClass("force3d"),this.keyframesStyle&&$(this.keyframesStyle).remove(),this.reversed=!1,this.active=!1}})}(RM),function(t,e){"use strict";t.classes.ServicePage=Backbone.View.extend({TEMPLATES:{404:"template-common-404","mag-suspended":"template-common-mag-suspended","user-suspended":"template-common-user-suspended","domain-error":"template-common-domain-errors"},initialize:function(e){_.bindAll(this),_.extend(this,e),this.router=this.router||t.homepageRouter||t.collectorRouter||t.constructorRouter,this.template=t.templates[this.TEMPLATES[this.type]],this.setElement(this.$container)},render:function(){return this.$el.html(this.template(this.templateData)),this.postRenderTasks(),this},postRenderTasks:function(){switch(this.type){case"domain-error":_.delay(_.bind(function(){this.$(".domain-errors").addClass("show-elements")},this),1e3)}}})}(RM),"undefined"==typeof RM&&(RM={}),function(t){t.buttonutils={STYLE_PREFIXES:{viewer:[".rmwidget.widget-button .common-button"],constructor:[".block.button .common-button"]},generateIndividualStyleCSS:function(t){var e=this.STYLE_PREFIXES[t.env],i=t.model,n=i.tp,s=this,r="";r+=_.map(e,function(t){return t+'[data-id="'+i._id+'"]'}).join(",\n")+" {\n",r+=s.generateStylesStr({model:i,indentation:!0,lineBreaks:!0}),r+="}\n\n","viewer"===t.env&&("icon"!==n&&"text_and_icon"!==n||(r+=_.map(e,function(t){return t+'[data-id="'+i._id+'"] .icon'}).join(",\n")+" {\n",r+='\t background-image: url("'+(Modernizr.retina?i.icon_raster2xUrl:i.icon_rasterUrl)+'");\n',r+="}\n\n")),r+=_.map(e,function(t){return t+'[data-id="'+i._id+'"].hovered'}).join(",\n")+" {\n",r+=s.generateStylesStr({model:i,attrPrefix:"hover-",indentation:!0,lineBreaks:!0}),r+="}\n\n","viewer"===t.env&&("icon"!==n&&"text_and_icon"!==n||(r+=_.map(e,function(t){return t+'[data-id="'+i._id+'"].hovered .icon'}).join(",\n")+" {\n",r+='\t background-image: url("'+(Modernizr.retina?i["hover-icon_raster2xUrl"]:i["hover-icon_rasterUrl"])+'");\n',r+="}\n\n"));var a="individual_button_style_"+i._id+"_"+t.env;$("#"+a).remove();var o=document.createElement("style");o.type="text/css",o.id=a,o.className="button_styles",o.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(o)},generateStylesStr:function(e){function i(t){var e=r[l+t];return("inherit"===e&&l||void 0===e)&&(e=r[t]),"border-color"===t&&"hover-"===l?0==r["hover-border-width"]&&(e=r["border-color"]):"border-color"===t&&0==r["border-width"]&&(e=r["hover-border-color"]),"border-color-opacity"===t&&"hover-"===l?0==r["hover-border-width"]&&(e=r["border-color-opacity"]):"border-color-opacity"===t&&0==r["border-width"]&&(e=r["hover-border-color-opacity"]),e}function n(t){return t+(/px/i.test(t)?"":"px")}var s="",r=e.model,a=e.indentation?"\t":"",o=";"+(e.lineBreaks?"\n":""),l=e.attrPrefix||"";return s+=a+"background-color: "+t.utils.getRGBA(i("background-color"),i("background-color-opacity")/100)+o,s+=a+"border-radius: "+n(i("border-radius"))+o,s+=a+"border-width: "+n(i("border-width"))+o,s+=a+"border-color: "+t.utils.getRGBA(i("border-color"),i("border-color-opacity")/100)+o,s+=a+"font-family: "+i("font-family")+o,s+=a+"font-weight: "+i("font-weight")+o,s+=a+"font-style: "+i("font-style")+o,s+=a+"color: "+t.utils.getRGBA(i("color"),i("color-opacity")/100)+o,s+=a+"font-size: "+n(i("font-size"))+o,s+=a+"letter-spacing: "+n(i("letter-spacing"))+o},destroyIndividualStyleCSS:function(t){var e=t.model,i="individual_button_style_"+e._id+"_"+t.env;$("#"+i).remove()}}}(RM),function(t,e){"use strict";t.classes.GiftView=Backbone.View.extend({MONTH_PRICE:20,YEAR_PRICE:192,template:t.templates["template-common-gift"],events:{"click .send-button":"onSendButtonClick","click .back-button":"onBackButtonClick","click .period-selector .period":"onPeriodClick","click .card-switcher":"onSwitchCardClick","input .card-wrapper.new-card .card-date input":"onCardExpChange","input .card-wrapper.new-card .card-cvc input":"onCardCvcChange","input input":"onInputChange","focus input":"clearAllErrors"},initialize:function(e){_.bindAll(this),_.extend(this,e),this.stripe.setPublishableKey(t.constants.stripe_live?t.constants.STRIPE_LIVE_PUBLIC_KEY:t.constants.STRIPE_TEST_PUBLIC_KEY),this.Model=Backbone.Model.extend({url:"/api/stripe/gift/create"}),this.me=this.router&&this.router.me},render:function(){var t=null;this.getCustomerData(function(e,i){!e&&i&&(t=i.sources&&i.sources.data&&i.sources.data[0]),this.$el.html(this.template({month_price:this.MONTH_PRICE,year_price:this.YEAR_PRICE,existing_card:t})),this.datePicker=new this.Pikaday({field:this.$(".field-wrapper.send input")[0],trigger:this.$(".field-wrapper.send .formated-date")[0],position:"top",defaultDate:new Date,setDefaultDate:!0,minDate:new Date,maxDate:new Date(2016,0,31),onSelect:this.updateFormatedDate,numberOfMonths:1}),this.updateFormatedDate(new Date),this.messageAutoResize=this.$(".field-wrapper.message textarea").RMAutoResizeTextArea({maxHeight:312,maxVisibleHeight:156,$scroll:this.$(".field-wrapper.message .description-scroll"),onChange:_.bind(function(t){this.$(".field-wrapper.message .counter").text(200-t.length)},this)}).data("autoresize"),this.$(".card-wrapper.new-card .card-number input").cardNumberFormatter(),Modernizr.isdesktop||FastClick.attach(this.$el[0]),this.clearAllErrors(),this.recalcSendButtonState(),this.delegateEvents()}.bind(this))},getCustomerData:function(t){if(!(this.router&&this.router.me&&this.router.me.get("stripe")))return t(null);var e=!0,i=$.ajax({url:"/api/stripe/customer",method:"GET",success:function(e){t(null,e)},error:function(e){t(e)},complete:function(){e=!1}});setTimeout(function(){if(e)return i&&i.abort(),t(null)},7e3)},updateFormatedDate:function(t){var e=this.getFormatedDate(t),i=this.getFormatedDate(new Date);this.$(".field-wrapper.send .formated-date").text((e==i?"Today — ":"")+this.getFormatedDate(t))},getFormatedDate:function(t){var e=t.getDate(),i=t.getMonth(),n=t.getFullYear(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e+" "+s[i]+", "+n},onPeriodClick:function(t){var e=$(t.currentTarget);e.addClass("active").siblings().removeClass("active");var i=e.hasClass("month")?this.MONTH_PRICE:this.YEAR_PRICE;this.$(".bottom-block .charge-sum span").text("$"+i)},onSwitchCardClick:function(t){var e=$(t.currentTarget).attr("data-value");this.$(".card-wrapper."+e).removeClass("hidden").siblings(".card-wrapper").addClass("hidden"),this.clearAllErrors(),this.recalcSendButtonState()},clearAllErrors:function(){this.$(".bottom-block").removeClass("show-error"),this.$(".field-wrapper").removeClass("show-error")},showStripeError:function(t){this.$(".bottom-block").find(".error").text(t),this.$(".bottom-block").addClass("show-error")},onInputChange:function(){this.clearAllErrors(),this.recalcSendButtonState()},recalcSendButtonState:function(){var t=this.getFormData();this.$(".bottom-block").toggleClass("inactive",!!t.hasErrors)},onBackButtonClick:function(){this.$(".form-wrapper").removeClass("invisible"),this.$(".congrats-wrapper").addClass("invisible"),this.$(".field-wrapper.email input").val(""),this.recalcSendButtonState()},onSendButtonClick:function(){function t(t){var e=["January","February","March","April","May","June","July","August","September","October","November","December"],i=t.split("-");return e[i[1]-1]+" "+parseInt(i[2])+", "+parseInt(i[0])}this.clearAllErrors();var e=new this.Model,i=this.getFormData();if(i.hasErrors)return i.$errorFields.addClass("show-error"),this.$(".bottom-block").find(".error").text("PLEASE CHECK THE FIELDS ABOVE MARKED WITH RED"),void this.$(".bottom-block").addClass("show-error");this.$(".bottom-block .send-button").addClass("show-loader"),this.$(".charging-overlay").show(),this.$el.on("keydown",function(t){t.stopPropagation(),t.preventDefault()});var n={success:function(e){this.$(".form-wrapper").addClass("invisible"),this.$(".congrats-wrapper").removeClass("invisible"),this.$(".congrats-wrapper .subscription .caption").html("1 "+i.period.capitalize()+" of<br>Super Publisher"),this.$(".congrats-wrapper .subscription .price").text("$"+Math.round(e.get("amount")/100)),this.$(".congrats-wrapper .order-info .info-email").text(e.get("deliver_email")),this.$(".congrats-wrapper .order-info .info-date").text(t(e.get("deliver_at"))),this.$(".congrats-wrapper .order-info .info-code").text(e.get("code")),Modernizr.isphone&&this.router&&this.router.mag&&this.router.mag.setScrollPosition({delta:this.$(".back-button").offset().top-this.$(".send-button").offset().top,animate:!0}),this.router&&this.router.analytics&&this.router.analytics.sendEvent("Gift Code Purchase","superpublisher_"+i.period+"ly"),s()}.bind(this),error:function(t,e){this.showStripeError(e.responseText),s()}.bind(this)},s=function(){this.$(".bottom-block .send-button").removeClass("show-loader"),this.$(".charging-overlay").hide(),this.$el.off("keydown")}.bind(this),r=_.pick(i,"plan_id","deliver_at","deliver_message","deliver_email","from_name");_.isEmpty(i.card)?e.save(r,n):this.stripe.card.createToken(i.card,function(t,i){i.error?(this.showStripeError(i.error&&i.error.message||"Sorry, some problems with your card."),s()):(r.card_token=i.id,e.save(r,n))}.bind(this))},getFormData:function(){var e=this.$(".period-selector .period.active"),i=this.$(".field-wrapper.email"),n=this.$(".field-wrapper.from"),s=this.$(".field-wrapper.message"),r=this.$(".field-wrapper.send"),a=this.$(".card-wrapper:not(.hidden)"),o=this.$(".card-wrapper.new-card .field-wrapper.card-name"),l=this.$(".card-wrapper.new-card .field-wrapper.card-number"),c=this.$(".card-wrapper.new-card .field-wrapper.card-date"),h=this.$(".card-wrapper.new-card .field-wrapper.card-cvc"),d=new Date(r.find("input").val()),u=d.getDate(),p=d.getMonth()+1,f=d.getFullYear(),g={plan_id:e.attr("data-plan"),deliver_email:$.trim(i.find("input").val()),from_name:$.trim(n.find("input").val()),deliver_message:$.trim(s.find("textarea").val()),deliver_at:f+"-"+(p<10?"0":"")+p+"-"+(u<10?"0":"")+u,useExistingCard:a.hasClass("existing-card"),period:e.hasClass("month")?"month":"year"},m=$();if(t.utils.isValidEmail(g.deliver_email)||(m=m.add(i)),!g.useExistingCard){var v={},_=$.trim(o.find("input").val()),y=l.find("input").val().replace(/\s/g,""),w=c.find("input").val().replace(/\s/g,""),b=h.find("input").val().replace(/\s/g,"");""==$.trim(_)?m=m.add(o):v.name=_,/^\d{16,16}$/.test(y)?v.number=y:m=m.add(l),/^(0[1-9]|1[0-2])(\/|\\)(1[6-9]|[2-9][0-9])$/.test(w)||"12/15"==w?(v.exp_month=parseInt(w.substr(0,2),10),v.exp_year=2e3+parseInt(w.substr(3,2),10)):m=m.add(c),/^\d{3,4}$/.test(b)?v.cvc=b:m=m.add(h)}return m.length?(g.hasErrors=!0,g.$errorFields=m):g.card=v,g},onCardExpChange:function(t){var e,i;e=$(t.currentTarget),/[^\d\/]/g.test(e.val())&&e.val(e.val().replace(/[^\d\/]/g,"")),/\/\//g.test(e.val())&&e.val(e.val().replace(/\/\//g,"/")),i=e.val().replace(/\D/g,""),this.prev_exp_digits&&i.length>this.prev_exp_digits.length&&i.length<6&&(e.val(i.replace(/^(\d{2})(.*)$/,"$1/$2")),/^\d\d\/$/g.test(e.val())&&_.defer(function(){e.setCursorPos(3)})),this.prev_exp_digits=i},onCardCvcChange:function(t){var e=$(t.currentTarget),i=e.val();/\D/g.test(i)&&e.val(i.replace(/\D/g,""))}})}(RM),function(){"use strict";var t=this,e="undefined"!=typeof require,i=t._;if("undefined"==typeof i){if(!e)throw new Error("shareutils requires underscore, see http://underscorejs.org");i=require("underscore")}var n=null;if(e){var s=require("path").dirname(require.main.filename);n=require(s+"/tools.coffee")}var r={defaultDescription:"Built with Readymag—a tool to design anything on the web.",maxTweetLen:116,addOrigin:function(t,i){return e?n.addOrigin.apply(this,arguments):t?i&&t.indexOf("://")==-1?i+t:t:""},addFilenameComponent:function(t,i){return e?n.addFilenameComponent.apply(this,arguments):RM.utils.addFilenameComponent.apply(this,arguments)},getPageScreenshot:function(t,i,n){n=n||{};var s=e?n.host:window.location.protocol+"//"+window.location.host,r=i&&i.screenshot;return r?this.addOrigin(this.addFilenameComponent(r,1024),s):""},_formatTweet:function(t){var e=t.prefix+t.val+t.suffix;if(t.minLength=void 0==t.minLength?1:t.minLength,e.length>r.maxTweetLen){var i=Math.max(t.val.length-(e.length-r.maxTweetLen+1),t.minLength);e=t.prefix+t.val.substring(0,i)+"…"+t.suffix}return e},getDefaultShare:function(t,e,n){if(n=n||{},i.isEmpty(e)||!i.isObject(e))return{};var s=e.emptyTitle?"":e.title,a="",o=e.description||(n.customDomain?"":r.defaultDescription),l="";n.customDomain?a=n.forProject?s||"Project":(s?s+" — ":"")+(t.title||"Page "+t.num):(n.forProject||(a=(t.title?"‘"+t.title+"’":"Page "+t.num)+" from "),a+=(s?"‘"+s+"’":"Project")+" by "+e.user.name,n.forProject&&e.description&&(a+=" | Readymag")),l=n.forProject?r.getPageScreenshot(e,i.findWhere(e.pages,{num:1}),n):r.getPageScreenshot(e,t,n);var c="";return n.customDomain?n.forProject?c=s?r._formatTweet({prefix:"",val:s,suffix:""}):"Project":s||t.title?!s&&t.title?c=r._formatTweet({prefix:"",val:t.title,suffix:""}):s&&!t.title?c=r._formatTweet({prefix:"",val:s,suffix:" — Page "+t.num}):s&&t.title&&(c=r._formatTweet({prefix:"",val:s,suffix:" — "+t.title,minLength:20}),c.length>r.maxTweetLen&&(c=t.title,c.length>r.maxTweetLen&&(c=r._formatTweet({prefix:"",val:t.title,suffix:""})))):c="Page "+t.num:n.forProject?c=s?r._formatTweet({prefix:"‘",val:s,suffix:"’ by "+e.user.name}):"Project by "+e.user.name:s||t.title?!s&&t.title?c=r._formatTweet({prefix:"‘",val:t.title,suffix:"’ from Project by "+e.user.name}):s&&!t.title?c=r._formatTweet({prefix:"Page "+t.num+" from ‘",val:s,suffix:"’ by "+e.user.name}):s&&t.title&&(c=r._formatTweet({prefix:"‘"+t.title+"’ from ‘",val:s,suffix:"’ by "+e.user.name,minLength:20}),c.length>r.maxTweetLen&&(c="‘"+t.title+"’ by "+e.user.name,c.length>r.maxTweetLen&&(c=r._formatTweet({prefix:"‘",val:t.title,suffix:"’ by "+e.user.name})))):c="Page "+t.num+" from Project by "+e.user.name,{image:l,title:a||"",description:o||"",tweet:c}},getFinalShare:function(t,e,n){if(n=n||{},i.isEmpty(e)||!i.isObject(e))return{};var s=r.getDefaultShare(t,e,n),a=e.master_share_pid&&i.find(e.pages,function(t){return t._id.toString()==e.master_share_pid.toString()}),t=n.forProject?i.findWhere(e.pages,{num:1}):t,o=a||t,l=o.custom_shares;return i.isEmpty(l)||(s.title=l.title||"",s.description=l.description||"",s.tweet=l.tweet||"",l.image?s.image=l.image:o.screenshot?s.image=r.getPageScreenshot(e,o,n):s.image=""),s},getDefaultSEO:function(t,e,n){if(n=n||{},i.isEmpty(e)||!i.isObject(e))return{};var s=e.emptyTitle?"":e.title,a="",o="";return n.customDomain?t&&t.num>1?a=(s?s+" — ":"")+(t.title||"Page "+t.num):(a=s||"Project",o=e.description||""):(t&&t.num>1?a=(t.title?"‘"+t.title+"’":"Page "+t.num)+" from ":o=e.description||r.defaultDescription,a+=(s?"‘"+s+"’":"Project")+" by "+e.user.name+" | Readymag"),{title:a||"",description:o||"",keywords:""}},getFinalSEO:function(t,e,n){if(n=n||{},i.isEmpty(e)||!i.isObject(e))return{};var s=r.getDefaultSEO(t,e,n);return s.title=t.seo&&t.seo.title||s.title,s.description=t.seo&&t.seo.description||s.description,s.keywords=t.seo&&t.seo.keywords||s.keywords,s},_openShareWindow:function(t,e,i){e=e||626,i=i||436,window.open(t,"sharer","width="+e+",height="+i+",toolbar=0,status=0")},share:function(t){var e,i=r.getFinalShare(t.page,t.mag,{forProject:t.forProject,customDomain:t.customDomain}),n=t.mag.emptyTitle?"":t.mag.title;if(/^https?\:\/\//i.test(t.host)||(t.host="http://"+t.host),/\/$/i.test(t.host)||(t.host+="/"),e=t.forProject?t.host+(t.customDomain&&!t.customDomainProfile?"":t.mag.num_id+"/"):t.host+"p"+t.page.num_id+"/",t.publishedVersion){if("facebook"==t.tp&&r._openShareWindow("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)),"twitter"==t.tp){var s;s=n?r._formatTweet({prefix:"I’ve just published a project ‘",val:n,suffix:"’"}):"I’ve just published a Project",r._openShareWindow("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(s))}if("email"==t.tp){var a=encodeURIComponent((t.mag.is_private?"private ":"")+(n?"project ‘"+n+"’":"Project")),o="mailto:",l="Check out my "+a,c="Hey, check out my new "+a+": "+e+(t.mag.is_private?encodeURIComponent("\n")+"Password: "+t.mag.pass:"");window.location.href=o+"?subject="+l+"&body="+c}}else{if("facebook"==t.tp&&r._openShareWindow("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)),"twitter"==t.tp&&r._openShareWindow("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(i.tweet)),"gplus"==t.tp&&r._openShareWindow("https://plus.google.com/share?url="+encodeURIComponent(e)),"pinterest"==t.tp&&r._openShareWindow("http://pinterest.com/pin/create/button/?url="+encodeURIComponent(e)+"&media="+encodeURIComponent(i.image)+"&description="+encodeURIComponent(i.title)),"linkedin"==t.tp&&r._openShareWindow("http://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(e)+"&title="+encodeURIComponent(i.title)+(i.description?"&summary="+encodeURIComponent(i.description):""),552,460),"email"==t.tp){var o="mailto:",l="Check out "+encodeURIComponent(i.title),c=l+encodeURIComponent("\n\n")+e+(t.mag.is_private?encodeURIComponent("\n")+"Password: "+t.mag.pass:"");window.location.href=o+"?subject="+l+"&body="+c}if("report"==t.tp){var o="mailto:"+RM.constants.SUPPORT_MAIL,l="Report "+encodeURIComponent(e),c=encodeURIComponent("Please tell us why are you reporting this: ");window.location.href=o+"?subject="+l+"&body="+c}}if("report"!=t.tp){var h=t.source+" / "+t.tp+" ("+(t.forProject?"project":"page")+") / "+i.title+" ("+e+")";t.analytics&&t.analytics.sendEvent("Share",h)}}};"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=r):t.RM?t.RM.shareutils=r:t.shareutils=r}.call(this),"undefined"==typeof RM&&(RM={}),function(t){t.performance={DUMP:!0,IS_ON:t.utils&&t.utils.queryUrlGetParam("performance_debug"),_paramsCache:{},getWidgetPackId:function(t){return"widget pack "+t},widgetPackStart:function(t,e,i){var n=_.without(_.unique(_.map(e,function(t){return t.screenIndex})),void 0),s={pageNumber:i.num,screenIndex:n.length>1?n.join(", "):n[0],pack:e};this.start(this.getWidgetPackId(t),s)},start:function(t,e){this.IS_ON&&window.performance&&(window.performance.mark("start"+t),e&&(this._paramsCache[t]=e))},widgetPackEnd:function(t,e){this.end(this.getWidgetPackId(t),e)},end:function(t,e){this.IS_ON&&window.performance&&(window.performance.mark("end"+t),e&&this.measure(t))},measure:function(t){if(this.IS_ON&&window.performance){var e="start"+t,i="end"+t,n="timing"+t;if(window.performance.getEntriesByName(e).length&&window.performance.getEntriesByName(i).length){window.performance.measure(n,e,i);var s=this._paramsCache[t];if(delete this._paramsCache[t],this.DUMP){s&&s.pack&&(s.pack=_.map(s.pack,function(t){return t.$el[0]}));var r=window.performance.getEntriesByName(n);r.length&&console.log(t,"started at",Math.round(r[0].startTime),"ended at",Math.round(r[0].startTime+r[0].duration),"duration",Math.round(r[0].duration),s)}}}},now:function(){return window.performance&&window.performance.now()}}}(RM),function(t,e){t.fn.RMSwipe=function(e){var i=function(t,e){this.options=_.clone(t),this.$swipes=e,_.defaults(this.options,{actionTreshold:25,rubberBand:!0,rubberBandForce:1/1.55,tolerance:5,disableOnScaled:!0,autoAnimate:!0,immediateCallback:!1,maxTransitionSpeed:400,minTransitionSpeed:100,stopOnItems:["input","textarea",".no-rmswipe"]})};i.prototype={initialize:function(){_.bindAll(this),this.$swipes.on("touchstart",this.onTouchStart),this.$swipes.on("touchmove",this.onTouchMove),this.$swipes.on("touchend touchcancel",this.onTouchEnd)},destroy:function(){return this.$swipes&&(this.$swipes.off("touchstart",this.onTouchStart),this.$swipes.off("touchmove",this.onTouchMove),this.$swipes.off("touchend touchcancel",this.onTouchEnd),this.$swipes.data("swipe",null)),this.$swipes},onTouchStart:function(e){e=e.originalEvent;var i=e.touches,n=this.options,s=this,r=window.innerWidth!=document.documentElement.clientWidth;if(n.stopOnItems&&n.stopOnItems.length){var a=t(e.target).closest(n.stopOnItems.join(", "));if(a.length&&this.$swipes.find(a).length)return}if(!this.animating&&!this.data&&!(1!=i.length||(e.scale&&1!==e.scale||r)&&n.disableOnScaled)){this.data={},this.data.constraints=n.getCurrentConstraints(t(e.target)),this.data.id=i[0].identifier,this.data.clientX=i[0].clientX,this.data.clientY=i[0].clientY,this.data.lastTime=+new Date,this.data.shift=0,this.data.velocity=0,this.data.$moveItems=this.data.constraints.$moveItems||this.$swipes,this.data.$moveItems=this.data.$moveItems.filter(function(){return 3!=this.nodeType}),this.data.$referenceItem=this.data.constraints.$referenceItem||this.data.$moveItems.last(),this.data.$referenceItem.length||(this.data.$referenceItem=this.data.$moveItems.last(),console.log("No reference object found, use substitution: ",this.data.constraints,t(e.target),this.data.$moveItems,this.$swipes)),this.data.translate=[],this.data.oldStyle=[],this.data.$moveItems.each(function(){var e=t(this);s.data.translate.push(RM.utils.getCurrentTranslate(this)),s.data.oldStyle.push(e.attr("style"))}),this.data.isTargetScrollable=!(!n.$scrollElements||!t(e.target).closest(n.$scrollElements).length);var o=this.data.$referenceItem[0].getBoundingClientRect();this.data.targetX=o.left,this.data.targetY=o.top}},onTouchMove:function(e){function i(t,e){return e?t>e.max?e.max+(c.rubberBand?Math.pow(t-e.max,c.rubberBandForce):0):t:0}e=e.originalEvent;var n,s,r,a=e.touches,o=a[0],l=this.data,c=this.options,h=c.tolerance,d=l&&l.constraints,u=this;if(!this.animating&&l&&1==a.length&&!(e.scale&&1!==e.scale&&c.disableOnScaled||o.identifier!=l.id)){if(!this.started||l.noActionConstraints&&!l.isTargetScrollable){s={up:l.clientY-o.clientY,down:o.clientY-l.clientY,left:l.clientX-o.clientX,right:o.clientX-l.clientX};var p=0,r="";s.up>p&&(r="up",p=s.up),s.down>p&&(r="down",p=s.down),s.left>p&&(r="left",p=s.left),s.right>p&&(r="right",p=s.right);var f=!1;if(this.started&&(f=d.up&&s.up>h||d.down&&s.down>h||d.left&&s.left>h||d.right&&s.right>h),p>=h)if(this.started=!0,d[r]||f){var g=l.$referenceItem[0].getBoundingClientRect();l.targetX==g.left&&l.targetY==g.top||(l.noActionMovement=!0);var m=d.left||d.right?Math.abs(l.clientX-o.clientX):0,v=d.up||d.down?Math.abs(l.clientY-o.clientY):0;l.axis=m>v?"x":"y",l.translateInd="x"==l.axis?0:1,l.noActionMovement||(l.clientX=o.clientX,l.clientY=o.clientY,l.$moveItems.addClass("swiping")),l.noActionConstraints=!1,c.onSwipeStart&&c.onSwipeStart()}else l.noActionConstraints=!0}if(this.started&&(l.isTargetScrollable?l.noActionConstraints&&!l.noActionMovement||e.preventDefault():e.preventDefault()),this.started&&!l.noActionConstraints&&!l.noActionMovement){"x"==l.axis?(n=o.clientX-l.clientX,n<0?(r="left",n=-i(-n,d.left)):n>0&&(r="right",n=i(n,d.right))):(n=o.clientY-l.clientY,n<0?(r="up",n=-i(-n,d.up)):n>0&&(r="down",n=i(n,d.down))),l.$moveItems.each(function(e,i){var s=l.translate[e],r=s[l.translateInd];c.customMoveCheck&&!c.customMoveCheck(t(this),n)||(s[l.translateInd]+=n),u.applyTransform(this,l.oldStyle[e],s,0),s[l.translateInd]=r});var _=l.shift,y=Math.abs(_-n)/(1+ +new Date-l.lastTime);l.shift=n,l.curDir=r,l.velocity=.8*y+.2*l.velocity}l.lastTime=+new Date}},onTouchEnd:function(e){e=e.originalEvent;var i=e.touches,n=this.data,s=this.options,r=n&&n.constraints,a=this;if(!this.animating&&(!i.length||"touchcancel"==e.type)&&n){if(!this.started)return void(this.data=null);if(!n.noActionConstraints&&!n.noActionMovement)if(r[n.curDir]&&!r[n.curDir].noTrigger&&Math.abs(n.shift)>=s.actionTreshold){var o=s.beforeAutoAnimation?s.beforeAutoAnimation(n.curDir,n.shift):null,l=o?o.autoAnimate:s.autoAnimate,c=o?o.immediateCallback:s.immediateCallback;if(l){this.animating=!0;var h=Math.abs(Math.abs(n.shift)-r[n.curDir].max)/n.velocity,d=s.getMaxTransitionSpeed?s.getMaxTransitionSpeed():s.maxTransitionSpeed,u=Math.max(Math.min(d,h),s.minTransitionSpeed),p=!1;n.$moveItems.each(function(e,i){if(!s.customMoveCheck||s.customMoveCheck(t(this),n.shift)){var o=n.translate[e];"up"==n.curDir||"left"==n.curDir?o[n.translateInd]-=r[n.curDir].max:o[n.translateInd]+=r[n.curDir].max,p||(RM.utils.waitForTransitionEnd(t(this),u+1e3,"transform",function(){a.animating=!1,c||s.callback(n.curDir),n.$moveItems.each(function(t,e){this.style.cssText=n.oldStyle[t]||" "}),n.$moveItems.removeClass("swiping")}),p=!0),a.applyTransform(this,n.oldStyle[e],o,u)}else this.style.cssText=n.oldStyle[e]||" "}),c&&s.callback(n.curDir)}else n.$moveItems.each(function(t,e){this.style.cssText=n.oldStyle[t]||" "}),s.callback(n.curDir),n.$moveItems.removeClass("swiping")}else n.$moveItems.removeClass("swiping"),n.$moveItems.each(function(t,e){this.style.cssText=n.oldStyle[t]||" "});this.data=null,this.started=null}},applyTransform:function(t,e,i,n){var s=Math.round(1e5*i[0])/1e5,r=Math.round(1e5*i[1])/1e5,a="translateX("+s+"px) translateY("+r+"px) translateZ(0)",o="transform "+n+"ms ease",l="",c="";l+="-webkit-transform: "+a+";",l+="-ms-transform: "+a+";",l+="transform: "+a+";",c+="-webkit-transition: -webkit-"+o+";",c+="transition: "+o+";",t.style.cssText=e+";"+l+c}};var n=t(this),s=new i(e,n);return s.initialize(),n.data("swipe",s),this}}(jQuery),function(t,e){t.fn.RMAutoResizeTextArea=function(e){var i=function(t,e){this.options=_.clone(t),this.$input=e,_.defaults(this.options,{maxHeight:9999,maxVisibleHeight:9999,disableMultiline:!1,$scroll:null}),this.$scroll=this.options.$scroll};i.prototype={initialize:function(){_.bindAll(this),this.$input.on("input",this.resizeTextArea),this.$input.on("keydown",this.keyDown),this.options.$scroll&&(this.$input.on("scroll",this.onScroll),this.$input.bind("mousewheel",this.onMouseWheel),this.$scroll.bind("mousewheel",this.onMouseWheel),this.$scroll.RMDrag({start:this.startScrollDrag,move:this.moveScrollDrag,end:this.stopScrollDrag,silent:!0,preventDefault:!0})),this.data={handle_pos:0,handle_size:0,container_size:0,content_size:0,scroll_pos:0,scroll_percent:0};var t="0% 0%";try{t=this.$input.css("background-position")}catch(t){}var e=t.split(" ");this.background_x=parseInt(e[0],10),this.background_y=parseInt(e[1],10),this.prevText=this.$input.val(),this.resizeTextArea()},onMouseWheel:function(t,e){if(this.options.$scroll){var i=-Math.ceil(.1*e);if(i){t.preventDefault(),i>0&&i<1&&(i=1),i<0&&i>-1&&(i=-1);var n=i+this.$input.scrollTop();this.$input.scrollTop(n)}}},onScroll:function(t){if(this.options.$scroll){this.data.scroll_pos=this.$input.scrollTop();var e=this.data.content_size-this.data.container_size;this.data.scroll_pos>e&&(this.data.scroll_pos=e),e>0?this.data.scroll_percent=this.data.scroll_pos/e:this.data.scroll_percent=0,this.data.handle_pos=Math.ceil(this.data.scroll_percent*(this.data.container_size-this.data.handle_size)),this.$scroll.css("top",this.data.handle_pos),this.$input.css("background-position",this.background_x+"px "+(this.background_y-this.data.scroll_pos)+"px")}},recalcScroll:function(){this.options.$scroll&&(this.data.handle_size=this.data.container_size/this.data.content_size,this.data.handle_size=Math.max(Math.min(this.data.handle_size,1),0),this.data.handle_size=Math.sqrt(this.data.handle_size),this.data.handle_size=Math.ceil(this.data.handle_size*this.data.container_size),this.data.container_size>=this.data.content_size?this.$scroll.css("display","none"):this.$scroll.css("display","block"),this.$scroll.css("height",this.data.handle_size),this.onScroll())},startScrollDrag:function(t){this.$scroll.addClass("dragging"),this.oldDeltaY=0},moveScrollDrag:function(t){var e=t.deltaY-this.oldDeltaY,i=(this.data.container_size-this.data.handle_size)/(this.data.content_size-this.data.container_size);e<0&&e>-i&&(e=-i),
e>0&&e<i&&(e=i);var n=this.data.handle_pos+e,s=n/(this.data.container_size-this.data.handle_size);s=Math.min(Math.max(s,0),1);var r=s*(this.data.content_size-this.data.container_size);this.$input.scrollTop(r),this.oldDeltaY=t.deltaY},stopScrollDrag:function(t){this.$scroll.removeClass("dragging")},keyDown:function(){this.st=this.$input[0].selectionStart,this.ed=this.$input[0].selectionEnd},resizeTextArea:function(){try{this.$input.css("background-position")}catch(t){return}var t=this.$input.val(),e=this.$input.scrollTop();if(this.options.disableMultiline){var i=t.split("\n").join("");if(i!=t)return this.$input.val(i),_.defer(_.bind(function(){this.$input[0].selectionStart=this.st,this.$input[0].selectionEnd=this.ed},this)),void this.resizeTextArea()}var n=this.calcHeight();if(n>this.options.maxHeight){if(t.length-this.prevText.length==1)this.$input.val(this.prevText);else{for(var s=0,r=t.length-1;s<r;){var a=Math.floor((s+r)/2),i=t.substring(0,a+1);this.$input.val(i),n=this.calcHeight(),n>this.options.maxHeight?r=a:s=a+1}this.$input.val(t.substring(0,r))}return _.defer(_.bind(function(){this.$input[0].selectionStart=this.st,this.$input[0].selectionEnd=this.ed},this)),void this.resizeTextArea()}n>this.options.maxVisibleHeight?(this.$input.height(this.options.maxVisibleHeight),this.data.container_size=this.options.maxVisibleHeight,this.data.content_size=n):(this.$input.height(n),this.data.container_size=n,this.data.content_size=n),this.options.onChange&&this.options.onChange(t),this.$input.scrollTop(e),this.prevText=t,this.recalcScroll()},calcHeight:function(){return this.$input.height(0),this.$input.scrollTop("9999"),this.$input.height()+this.$input.scrollTop()}};var n=t(this),s=new i(e,n);return s.initialize(),n.data("autoresize",s),this}}(jQuery),function(t,e){"use strict";t.classes.Share=Backbone.View.extend({template:t.templates["template-viewer-share"],events:{"click .buttons-wrapper .button":"share","click .send-report":"share","click .open-embed":"openEmbed","click .close":"hide","click .embed-wrapper .back":"closeEmbed","click .embed-wrapper .embed-code":"selectEmbedCode","keyup .embed-wrapper .embed-code":"onKeyUp","click .type-selector":"onTypeSelectorClick","click .size-selector":"onSizeSelectorClick",click:"onClick"},initialize:function(t){return _.bindAll(this),_.extend(this,t),this},render:function(){return this.setElement(this.template({hasOverlay:Modernizr.isphone})),this.$el.appendTo(this.$container),this.selectFullMode(),Modernizr.isphone&&(this.shareSwipe=this.$el.RMSwipe({minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,beforeAutoAnimation:_.bind(function(t,e){return{autoAnimate:!0,immediateCallback:!0}},this),getCurrentConstraints:_.bind(function(t){var e={},i=this.$el.filter(".share-popup");return e.$referenceItem=i,e.$moveItems=i,e.up={max:0,noTrigger:!0},e.down={max:i.height()},e},this),callback:_.bind(function(t){this.hide()},this)}).data("swipe")),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"keypress-"+$.keycodes.esc,this.hide),$("body").on("click",this.hideOnBodyClick),this},show:function(){return this.shown||(clearTimeout(this.hideTimeout),this.$el.removeClass("hidden"),this.$el.height(),this.$el.addClass("show-popup"),this.$container.addClass("no-hover"),this.shown=!0,this.updateEmbed()),this},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.$el.removeClass("show-popup"),this.$container.removeClass("no-hover"),this.hideTimeout=setTimeout(_.bind(function(){this.closeEmbed(),this.$el.addClass("hidden")},this),400),this.shown=!1),this},destroy:function(){return clearTimeout(this.hideTimeout),$("body").off("click",this.hideOnBodyClick),this.shareSwipe&&this.shareSwipe.destroy(),this.remove()},hideOnBodyClick:function(t){Modernizr.isphone||$(t.target).closest(this.$container).length||this.hide()},onPageChange:function(t,e){this.hide()},onFinalPageShow:function(){this.hide()},onClick:function(t){Modernizr.isphone&&$(t.currentTarget).hasClass("share-popup-overlay")&&this.hide()},onKeyUp:function(t){t.stopPropagation()},openEmbed:function(t){this.router.analytics&&this.router.analytics.sendEvent("Embed","contents ("+this.shareMode+")"),this.selectEmbedCode(),this.$el.addClass("show-embed")},updateEmbed:function(){var e,i=this.mag.currentPage||this.mag.pages[0],n=this.$(".size-selector").attr("data-selected"),s={responsive:"responsive",big:512,small:288};this.$(".embed-wrapper .embed-code").val(t.classes.Share.getEmbedCode({shareMode:this.shareMode,cur_page_num_id:i.num_id,mag_num_id:this.mag.num_id,size:s[n]})),e=this.mag.model.getPageScreenshot(256,{_id:"page"==this.shareMode?i._id:this.mag.coverPid}),this.currentEmbedSrc!==e&&(this.$(".thumb-pic").attr("src",e),this.currentEmbedSrc=e)},closeEmbed:function(t){this.$el.removeClass("show-embed")},share:function(e){t.shareutils.share({host:(t.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:$(e.currentTarget).attr("data-tp"),source:"share panel",page:this.mag.currentPage||this.mag.pages[0],mag:_.extend(this.mag.model.toJSON(),{user:this.mag.user}),forProject:"full"==this.shareMode,customDomain:!(!t.common.isDomainViewer&&!t.common.embedDomainName),customDomainProfile:!(!t.common.customDomainProfile&&"User"!=t.common.embedDomainType),analytics:this.router.analytics})},onTypeSelectorClick:function(t){if(Modernizr.isphone){var e=$(t.target);e.closest(".type-full").length&&this.selectFullMode(),e.closest(".type-page").length&&this.selectPageMode()}else{var i=this.$(".type-selector").attr("data-tp")||"page";"page"==i?this.selectFullMode():this.selectPageMode()}},onSizeSelectorClick:function(t){var e,i,n=$(t.currentTarget),s=n.attr("data-selected");e=_.map(n.find(".size"),function(t){return $(t).attr("data-size")}),i=e.indexOf(s)+1,i=i>=e.length?0:i,n.attr("data-selected",e[i]),this.updateEmbed()},selectPageMode:function(){this.$(".type-selector").attr("data-tp","page"),this.shareMode="page",this.updateEmbed()},selectFullMode:function(){this.$(".type-selector").attr("data-tp","full"),this.shareMode="full",this.updateEmbed()},selectEmbedCode:function(t){Modernizr.isdesktop&&this.$(".embed-wrapper .embed-code").get(0).setSelectionRange(0,9999)}},{getEmbedCode:function(e){var i,n,s,r,a,o=t.constants.EMBED_SCRIPT_INIT,l='<script async src="'+o+'" id="readymag-embed-init"></script>';return i=t.common.embedDomainName||window.location.protocol+"//"+window.location.hostname,n="full"==e.shareMode?e.mag_num_id:"p"+e.cur_page_num_id,a=' data-uri="'+n+'" ',a+=' data-width="'+e.size+'" ',(t.common.isDomainViewer||t.common.embedDomainName)&&(a+=' data-domain="'+i+'" ',t.common.customDomainProfile||"User"==t.common.embedDomainType||(n="full"==e.shareMode?"":"p"+e.cur_page_num_id)),t.constants.IS_LIVE||(a+=' data-origin="'+t.constants.readymag_embed_host+'" '),s=i+"/"+n,r='<a class="rm-mag-embed" href="'+s+'"'+a+' target="_blank">'+s+"</a>\n",r+l}})}(RM),function(t,e){"use strict";t.classes.Page=Backbone.View.extend({template:t.templates["template-viewer-page"],initialize:function(t){return _.bindAll(this),this.mag=t.mag,this.router=t.router,this.$container=t.$container,this.viewerType=t.viewerType,this.totalPages=t.totalPages,this.isStickyVerticalViewer=t.isStickyVerticalViewer,this.widgetsData=t.pageData.wids,_.defaults(t.pageData,{title:"",width:this.mag.getViewportSetting("width"),height:this.mag.getViewportSetting("min_height")}),_.extend(this,_.omit(t.pageData,["wids","widgets"])),this.contentPosition={left:0,top:0},this},render:function(){return this.setElement(this.template({isStickyVerticalViewer:this.isStickyVerticalViewer})),this.$el.appendTo(this.$container),this.zIndex=this.totalPages-this.num+2,"vertical"==this.viewerType&&this.$el.css("z-index",this.zIndex),this.$content=this.$(".page-content-container"),this.$scrollWrapper=this.$(".content-scroll-wrapper"),this.$scrollWrapper.one("scroll",this.fixSafariScroll),this.$fixedBgContainer=this.$(".page-fixed-bg-container"),this.$fixedPositionContainer=this.$(".fixed-position-container"),this.$fixedPositionContainerTop=this.$(".fixed-position-container-top"),this.$contentBounds=this.$(".content-bounds"),this.pageViewport=this.getPageViewport(),"horizontal"==this.viewerType&&this.$scrollWrapper.bind("scroll",this.onScroll),this.createLQBackground(),t.screenshot==this._id&&(this.$el.css({overflow:"hidden",height:this.height,width:1024,position:"relative"}),"true"===t.utils.queryUrlGetParam("pdf")&&(this.$fixedPositionContainer.css({height:"100%"}),this.$fixedPositionContainerTop.css({height:"100%"})),this.onResize(),this.on("pageLoaded",function(){this.mag.router.sendReadyEvent({page:this})},this)),this},show:function(){return this.shown||(this.$el.removeClass("hidden"),this.shown=!0,"horizontal"==this.viewerType&&this.onResize(),this.widgets&&this.lastViewportUsedForWidgetsCreation==this.pageViewport||this.createWidgetsForCurrentViewport()),this},start:function(t){if(!this.started||t&&t.forceStart)return this.started=!0,t=t||{},_.each(this.widgets,function(e){(!t||!t.widgetTypes||_.indexOf(t.widgetTypes,e.type)>=0)&&e.start()}),this.focusPage(),this.$scrollWrapper.addClass("accelerated-scroll"),this.animations&&this.animations.start(),this},stop:function(t){if(this.started)return t=t||{},this.started=!1,this.$scrollWrapper.removeClass("accelerated-scroll"),_.each(this.widgets,function(e){(!t||!t.widgetTypes||_.indexOf(t.widgetTypes,e.type)>=0)&&e.stop()}),this.animations&&this.animations.stop(),this},getUrl:function(){return window.location.protocol+"//"+window.location.hostname+"/p"+this.num_id+"/"},setPosition:function(t,e){this.lastPosition==t&&this.lastNeighbour==e||(this.$el.removeClass("center-page prev-page next-page neighbour").addClass(t+"-page "+(e?"neighbour":"")),this.lastPosition=t,this.lastNeighbour=e)},scrollOnVerticalMode:function(e){this.hasScrollOnVerticalMode=!0;var i,n,s=this.pageHeight-this.pageBgHeight;e<0?(i=-e,n=0):s>=e?(i=0,n=-e):(i=s-e,n=-s),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=-n,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.isStickyVerticalViewer||(this.$el.css("top",0),t.utils.applyTransform(this.$el,i?"translateY("+i+"px) translateZ(0)":""),this.hasFixedWidgets?this.$contentBounds.css("top",n):t.utils.applyTransform(this.$contentBounds,n?"translateY("+n+"px)":""))},resetScrollOnVerticalMode:function(e){this.hasScrollOnVerticalMode&&(this.hasScrollOnVerticalMode=!1,this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=0,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.isStickyVerticalViewer||(this.$el.css("top",""),t.utils.applyTransform(this.$el,""),this.hasFixedWidgets?this.$contentBounds.css("top",0):t.utils.applyTransform(this.$contentBounds,"")))},hide:function(){return this.shown&&(this.$el.addClass("hidden"),this.shown=!1),this},destroyAllWidgets:function(){this.loaded=!1,this.videoBGStarted=!1,_.each(this.widgets,function(t){t.destroy(),t.off()}),this.animations&&this.animations.destroy(),delete this.animations,clearTimeout(this.fireReadyTimeout),this.widgets=null},destroy:function(){return this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.resetWaitForAnimationEnd(),this.destroyLQBackground({animate:!1}),this.destroyAllWidgets(),this.remove()},isSwipeInProgress:function(){return this.$el.hasClass("swiping")},getPageZIndex:function(){return this.zIndex||1},getWidgetsPacks:function(){if(!this.widgets)return[];var t,e,i=this.visibleWidgetsCoords,n=(i.top+(i.scrollTop||0))/i.scale,s=(i.bottom+(i.scrollTop||0))/i.scale,r=s-n,a=1/r,o=[],l=[];if(!this.BGWidget||this.BGWidget.rendered||this.BGWidget.loaded||l.push(this.BGWidget),this.fixedWidgets&&this.fixedWidgets.length){var c;for(t=0;t<this.fixedWidgets.length;t++)c=this.fixedWidgets[t],c.rendered||c.loaded||l.push(c)}var h,d=[],u=99999,p=-99999,f=!1;for(t=0;t<this.widgets.length;t++)if(e=this.widgets[t],!e.rendered&&!e.loaded&&"background"!=e.type&&!e.fixed_position){var g=Math.floor((e.y-n)*a),m=Math.ceil((e.y+e.h-n)*a)-1;u=Math.min(g,u),p=Math.max(m,p),g<=0&&m>=0?h=0:g>0?h=g:m<0&&(h=m),e.screenIndex=h,d[h]=d[h]||[],d[h].push(e),f=!0}if(f){for(d[0]&&o.push(d[0]),d[1]&&o.push(d[1]),d[-1]&&o.push(d[-1]),t=2;t<=p;t++)d[t]&&o.push(d[t]);for(t=-2;t>=u;t--)d[t]&&o.push(d[t])}return l.length&&(o.length?o[0]=l.concat(o[0]):o=[l]),o},loadWidgetsPack:function(t,e){function i(){r++,o&&s==r&&e()}var n,s=0,r=0,a=0,o=!1;for(n=0;n<t.length;n++){var l=t[n];l.rendered||l.loaded||l.destroyed||(l.DO_NOT_WAIT_FOR_PRELOAD||(s++,l.on("loaded destroyed",i,l)),a++,l.render())}o=!0,a||e(),s==r&&e()},loadForScreenshotMode:function(){_.each(this.widgets,function(t){t.render().start()})},createWidgetsForCurrentViewport:function(){this.destroyAllWidgets(),this.BGWidget=null,this.fixedWidgets=[];var e=this.pageViewport,i=[],n=[],s=99999,r=this,a=this;_.each(this.widgetsData,function(i){var r=a.getWidgetViewportData(i,e);t.widgets[r.type]&&!r.hidden&&(!r.fixed_position&&r.z&&"background"!=r.type&&(s=Math.min(s,r.z)),n.push(r))}),99999==s&&(s=0),_.each(n,function(e){e.fixed_position&&(e.z<s||Modernizr.isdesktop)?e.$fixedContainer=a.$fixedPositionContainer:e.$fixedContainer=a.$fixedPositionContainerTop;var n=new t.widgets[e.type](e,r);"background"==n.type&&(a.BGWidget=n,a.hasVideoBG=n.hasVideoBG()),n.isValid()&&(n.fixed_position&&a.fixedWidgets.push(n),i.push(n))}),this.animations=new t.classes.Animations({page:this,widgets:i}),this.widgets=_.sortBy(i,"y"),this.signalOnLoading(),this._onFontsLoad=[],this._widgetsWithFontsToLoad=[],this._fontLoaderCalled=0,this._widgetsWithFontsCount=_.reduce(this.widgets,function(t,e){return t+(e.hasFontsToLoad()?1:0)},0),this._widgetsWithLoadAnimation=_.reduce(this.widgets,function(t,e){return t+(e.hasLoadAnimation()?1:0)},0),this.hasFixedWidgets=!!this.fixedWidgets.length,this.$el.removeClass("page-with-fixeds-desktop page-with-fixeds-mobile").toggleClass("page-with-fixeds-desktop",this.hasFixedWidgets&&Modernizr.isdesktop).toggleClass("page-with-fixeds-mobile",this.hasFixedWidgets&&!Modernizr.isdesktop),this.hasFixedWidgets&&!this.retargetScroll&&"horizontal"==this.viewerType&&Modernizr.isdesktop&&(this.retargetScroll=window.RetargetMouseScroll&&window.RetargetMouseScroll(this.$fixedPositionContainer.get(0),this.$scrollWrapper.get(0))),this.lastViewportUsedForWidgetsCreation=e},getWidgetViewportData:function(i,n){var s=_.clone(i),r={};return"default"!=n&&i["viewport_"+n]&&(_.each(t.viewport_fields[i.type]||t.viewport_fields_common,function(t){("shape"!=i.type||"borders"!=t&&"weight"!=t)&&("background"==i.type&&"picture"==t||(r[t]=e))}),_.extend(s,r,i["viewport_"+n])),s},signalOnLoading:function(){function t(){"background"==this.type&&s.destroyLQBackground({animate:!0}),n--,this.hasLoadAnimation()&&(s._widgetsWithLoadAnimation--,s._widgetsWithLoadAnimation||s.trigger("loadAnimationsReady")),n||(s.fireReadyTimeout=setTimeout(i,200))}function e(){s.videoBGStarted=!0,_.delay(function(){s.trigger("videoBGStarted")},1300)}function i(){s.loaded=!0,s.trigger("pageLoaded")}var n=this.widgets.length,s=this;_.each(this.widgets,function(e){e.on("loaded",t,e)},this),this.BGWidget&&this.hasVideoBG&&this.BGWidget.on("videoBGStarted",e,this.BGWidget),0==n&&(this.fireReadyTimeout=setTimeout(i,200))},getFontsVariations:function(e){var i=t.textutils.getUsedFontsFromWidgetsModels({includeCustom:!0,customList:_.filter(this.mag.edit_params.fonts,{provider:"custom"}),models:e}),n=[];return _.each(i,function(t){for(var e=0;e<t.used_variations.length;e++)n.push({fontFamily:t.css_name,fontWeight:100*(t.used_variations[e].substr(1,1)-0),fontStyle:"n"==t.used_variations[e].substr(0,1)?"normal":"italic"})}),n},addFontsToLoad:function(e,i){if(this._widgetsWithFontsToLoad.push(e),this._onFontsLoad.push(i),this._fontLoaderCalled++,this._fontLoaderCalled==this._widgetsWithFontsCount){var n=this.getFontsVariations(this._widgetsWithFontsToLoad);if(_.isEmpty(n))return void this.onAllFontsLoad();this._fontsToLoadLeft=n.length,_.each(n,_.bind(function(e){t.textutils.exactWaitForFontLoad(e.fontFamily,e.fontWeight,e.fontStyle,this.onOneFontLoad)},this))}},onOneFontLoad:function(t,e,i,n){this._fontsToLoadLeft--,0==this._fontsToLoadLeft&&_.delay(this.onAllFontsLoad,500)},onAllFontsLoad:function(){_.each(this._onFontsLoad,function(t){t&&t()})},updateViewport:function(){var t=this.getPageViewport(),e=this.pageViewport;t!=e&&(this.pageViewport=t,this.createLQBackground(),this.shown&&(this.createWidgetsForCurrentViewport(),this.started&&(this.started=!1,this.start())))},waitForAnimationEnd:function(e){this.resetWaitHook=t.utils.waitForTransitionEnd(this.$el,this.mag.getPageTransitionTime()+1e3,"transform",e)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},backToTop:function(){this.scrollTo(0)},scrollTo:function(t){this.$scrollWrapper&&this.$scrollWrapper.animate({scrollTop:t},500)},focusPage:function(){Modernizr.isdesktop&&"vertical"!=this.viewerType&&0==this.$el[0].getBoundingClientRect().left&&(this.$content.focus(),this.mag.$el.scrollTop(0))},markAsLast:function(){this.lastPage=!0,this.$el.addClass("last")},isLastPage:function(){return!!this.lastPage},isBottomArrowVisible:function(){return!this.wasScrolled&&this.scrollable},scrollPageALittle:function(){this.$scrollWrapper.animate({scrollTop:$(window).height()/2},500)},getPageViewport:function(){var e=this.mag.viewport,i=this;if("default"==e||t.screenshot)return"default";if(this["viewport_"+e]&&this["viewport_"+e].enabled)return e;var n=_.findWhere(t.viewports,{name:e}).width,s=_.reduce(t.viewports,function(e,s,r){return("default"==s.name||i["viewport_"+s.name]&&i["viewport_"+s.name].enabled)&&Math.abs(s.width-n)<=Math.abs(t.viewports[e].width-n)?r:e},0);return t.viewports[s].name},onResize:function(i){if(i=i||{},this.shown||"horizontal"!=this.viewerType){var n=this.mag.getContainerSizeCached(),s=this.mag.getViewportSetting("width",this.pageViewport),r=n.width/s,a=this["viewport_"+this.pageViewport]&&this["viewport_"+this.pageViewport].height||this.height;"default"==this.mag.viewport&&Modernizr.isdesktop&&(r=1);var o={width:s,height:a,scaledWidth:Math.round(s*r),scaledHeight:Math.round(a*r),scale:r},l=Math.min(o.scaledWidth,n.width),c=o.scaledHeight,h=Math.max((n.height-c)/2,0),d=Math.max((n.width-l)/2,0);return this.$content.css({width:o.width,height:o.height,top:h,left:d}),this.contentPosition={left:d,top:h},Math.abs(o.scale-1)<1e-6?(t.utils.applyTransform(this.$content,""),o.scale=1):t.utils.applyTransform(this.$content,"scale("+o.scale+")"),this.contentHeight=o.height,this.pageHeight=Math.max(n.height,o.scaledHeight),this.pageBgHeight=n.height,this.pageWidth=o.width,"vertical"==this.viewerType&&this.isStickyVerticalViewer&&this.$el.css({height:this.pageHeight,top:i.absolutePosition}),this.scale=o.scale,this.$contentBounds.css({width:n.width,height:this.pageHeight}),this.prevScale!=e&&this.prevScale!=this.scale&&this.animations&&this.animations.updateTimelines(),this.animations&&this.animations.onResize(),this.trigger("resize",{containerSize:n,contentPosition:this.contentPosition}),this.scrollable=c-this.mag.SCROLLABLE_TRESHOLD>n.height,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.top=-h,this.visibleWidgetsCoords.bottom=-h+n.height,this.visibleWidgetsCoords.scale=r,this.resizeLQBackground(),this.prevScale=this.scale,this.pageHeight}},onScroll:function(){this.wasScrolled=!0,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=this.$scrollWrapper.scrollTop(),this.mag.onCurrentPageScroll(this,this.visibleWidgetsCoords.scrollTop),this.animations&&this.animations.onScroll()},createLQBackground:function(){if(!t.screenshot){var e=this.getWidgetViewportData(_.findWhere(this.widgetsData,{type:"background"}),this.pageViewport);if(this.LQBG){if("picture"==e.selectedType&&"picture"==this.LQBG.selectedType&&e.picture&&this.LQBG.picture&&e.picture.poorUrl==this.LQBG.picture.poorUrl||"video"==e.selectedType&&"video"==this.LQBG.selectedType&&e.video&&this.LQBG.video&&e.video.thumbnail_url==this.LQBG.video.thumbnail_url)return void this.resizeLQBackground();this.destroyLQBackground({animate:!1})}if(this.$fixedBgContainer.css("background-color","#"+e.color),e.picture&&"picture"==e.selectedType&&e.picture.poorUrl||e.video&&"video"==e.selectedType&&e.video.thumbnail_url){this.LQBG=_.extend({},e);var i=t.templates["template-viewer-widget-background"];if(this.LQBG.$el=$(i({data:e})),this.LQBG.$el.addClass("low-quality").appendTo(this.$fixedBgContainer),"picture"==this.LQBG.selectedType){var n=$("<img/>");n.on("load",_.bind(function(){this.LQBG&&this.LQBG.$el.find(".picture-background").css({"background-image":"url("+this.LQBG.picture.poorUrl+")"})},this)).attr("src",this.LQBG.picture.poorUrl)}if("video"==this.LQBG.selectedType){var s=this.LQBG.video.thumbnail_url.replace("http://","https://"),r=$("<img/>").addClass("poster").css("opacity",0).appendTo(this.LQBG.$el.find(".video-background .video-container"));r.on("load",_.bind(function(){r.css({width:"",height:""}).css("opacity",1);var t=r[0].width,e=r[0].height;this.LQBG&&!this.LQBG.video.aspect_poster&&(this.LQBG.video.aspect_poster=t/e),this.resizeLQBackground()},this)).attr("src",s)}}}},resizeLQBackground:function(){t.screenshot||this.LQBG&&"video"==this.LQBG.selectedType&&t.videoutils.setVideoPosition({mag:this.mag,$container:this.LQBG.$el.find(".video-background .video-container"),$media:this.LQBG.$el.find(".video-background .video-container .poster"),provider:this.LQBG.video.provider_name,aspect_poster:this.LQBG.video.aspect_poster,aspect_real:this.LQBG.video.aspect_real,controls_remove:!0})},destroyLQBackground:function(e){if(!t.screenshot&&this.LQBG){e=e||{},e.animate=e.animate&&"picture"==this.LQBG.selectedType&&this.started;var i=this.LQBG.$el;this.LQBG=null,e.animate?(i.css("opacity",0),setTimeout(function(){i.remove()},400)):i.remove()}},fixSafariScroll:function(t){if(Modernizr.safari&&Modernizr.isdesktop){var e=this.$scrollWrapper.scrollTop();0!==e&&this.$scrollWrapper.scrollTop(0)}}})}(RM),function(t,e){"use strict";t.classes.Navigation=Backbone.View.extend({ARROWS_SHOW_DELAY:1e3,BOTTOM_SHOW_DELAY:1e3,BOTTOM_HIDE_DELAY:0,template:t.templates["template-viewer-navigation"],events:{"click .navigation-arrow.left":"goPrevPage","click .navigation-arrow.right":"goNextPage","click .navigation-arrow.bottom":"scrollCurrentPage"},initialize:function(t){return _.bindAll(this),_.extend(this,t),this.updateScaleState.__debounced=_.debounce(this.updateScaleState,100),this},render:function(){return this.setElement(this.template({})),this.$el.appendTo(this.$container),this.$prev=this.$(".navigation-arrow.left"),this.$next=this.$(".navigation-arrow.right"),this.$bottom=this.$(".navigation-arrow.bottom"),_.delay(_.bind(function(){this.$prev.removeClass("offscreen"),this.$next.removeClass("offscreen")},this),this.ARROWS_SHOW_DELAY),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"keypress-"+$.keycodes.left,this.goPrevPage),this.listenTo(this.mag,"keypress-"+$.keycodes.right,this.goNextPage),Modernizr.isdesktop&&$(window).bind("mousewheel",this.onMouseWheel),Modernizr.isdesktop||($(window).bind("gesturechange",this.updateScaleState.__debounced),this.updateScaleState(),(this.mag.getPagesCount()>1||this.hasFinalPage)&&this.setSwipeAction()),this},destroy:function(){return Modernizr.isdesktop&&$(window).unbind("mousewheel",this.onMouseWheel),Modernizr.isdesktop||($(window).unbind("gesturechange",this.updateScaleState.__debounced),this.pagesSwipe&&this.pagesSwipe.destroy()),this.remove()},onMouseWheel:function(t,e,i,n){this.preventTrackpadSwipeTill&&+new Date<this.preventTrackpadSwipeTill||Math.abs(i)>40&&Math.abs(i)>Math.abs(n)&&(i>0&&this.goPrevPage(),i<0&&this.goNextPage(),this.preventTrackpadSwipeTill=+new Date+1e3)},setSwipeAction:function(){this.pagesSwipe=this.mag.$mag_container.RMSwipe({$scrollElements:this.mag.$mag_container,getMaxTransitionSpeed:_.bind(function(){return this.mag.getPageTransitionTime()},this),customMoveCheck:_.bind(function(t,e){if(this.hasFinalPage&&this.mag.isLastPage()){if(this.finalPageShown&&!t.hasClass("final-page"))return!1;if(!this.finalPageShown){if(!t.hasClass("final-page")&&e<0)return!1;if(t.hasClass("final-page")&&e>0)return!1}}return!(t.hasClass("prev-page")&&e<0)&&!(t.hasClass("next-page")&&e>0)},this),beforeAutoAnimation:_.bind(function(t,e){return this.mag.isLastPage()&&this.hasFinalPage&&("left"==t&&!this.finalPageShown||"right"==t&&this.finalPageShown)?{autoAnimate:!0,immediateCallback:!0}:(this.mag.showPageCounter(t),{autoAnimate:!0,immediateCallback:!1})},this),onSwipeStart:_.bind(function(){!this.finalPageShown&&this.mag.showPageCounter()},this),getCurrentConstraints:_.bind(function(t){var e={},i=this.mag.$mag_container.width(),n=t.closest(".page, .final-page");return this.mag.isLastPage()&&this.hasFinalPage&&this.finalPageShown?e.$moveItems=n:e.$moveItems=n.add(n.prev()).add(n.next()),e.$referenceItem=e.$moveItems.filter(":not(.center-page)").first(),!this.mag.isLastPage()||this.hasFinalPage&&!this.finalPageShown?e.left={max:i}:e.left={max:0,noTrigger:!0},this.mag.isFirstPage()&&!this.finalPageShown?e.right={max:0,noTrigger:!0}:e.right={max:i},e},this),callback:_.bind(function(t){"right"==t&&this.mag.goPrevPage({animation:!1,bySwipe:!0}),"left"==t&&this.mag.goNextPage({animation:!1,bySwipe:!0})},this)}).data("swipe")},onFinalPageShow:function(){this.finalPageShown=!0,this.$next.addClass("hidden"),this.$bottom.addClass("final-page-offscreen"),this.$prev.toggleClass("hidden",!Modernizr.isdesktop)},onFinalPageHide:function(){this.finalPageShown=!1,this.$next.removeClass("hidden"),this.$bottom.removeClass("final-page-offscreen"),this.$prev.toggleClass("hidden",this.mag.isFirstPage())},onPageChange:function(t,e){this.$next.toggleClass("hidden",!(!this.mag.isLastPage()||this.mag.finalPage)||!(!this.mag.finalPage||!this.mag.finalPage.shown)),this.recalcBottomArrowState(t),this.$prev.toggleClass("hidden",this.mag.isFirstPage()),this.mag.updateArrowsColor(t)},recalcBottomArrowState:function(t){clearTimeout(this.bottomArrowTimeout);var e=t.isBottomArrowVisible();this.isPreview&&"default"!=this.mag.viewport&&(e=!1),this.bottomArrowTimeout=setTimeout(_.bind(function(){this.$bottom.toggleClass("offscreen",!e)},this),e?this.BOTTOM_SHOW_DELAY:this.BOTTOM_HIDE_DELAY)},goPrevPage:function(t){this.mag.goPrevPage({animation:!0})},goNextPage:function(t){this.mag.goNextPage({animation:!0})},scrollCurrentPage:function(t){this.mag.scrollCurrentPageALittle()},updateScaleState:function(){Modernizr.android||this.$prev.add(this.$next).add(this.$bottom).toggleClass("scaled-offscreen",t.utils.isPageNativelyScaled())}})}(RM),function(t,e){"use strict";t.classes.Toolbar=Backbone.View.extend({PAGE_COUNTER_TIMEOUT:2800,PAGE_COUNTER_TIMEOUT_INITIAL:4e3,template:t.templates["template-viewer-toolbar"],events:{"click .menu-button":"toggleMenu","click .share-button":"toggleShare","click .embed-close-button":"onEmbedCloseClick"},initialize:function(t){return _.bindAll(this),_.extend(this,t),this},render:function(){if(this.setElement(this.template({mag:this.mag,isPreview:this.isPreview,hasMenu:this.hasMenu,hasShare:this.hasShare,hasPageCounter:this.hasPageCounter,pageCounterInsideMenu:this.hasMenu&&Modernizr.isphone,totalPages:this.mag.getPagesCount()})),this.$el.appendTo(this.$container),this.$menuButton=this.$el.find(".menu-button"),this.$shareButton=this.$el.find(".share-button"),this.$pageCounter=this.$el.find(".page-counter"),this.$pageCounterWrapper=this.$pageCounter.parent(),this.hasShare&&(this.share=new t.classes.Share({mag:this.mag,router:this.router,$container:Modernizr.isphone?this.$container:this.$shareButton}).render(),this.hasMenu||this.$shareButton.addClass("without-menu-button")),this.hasMenu&&(this.magMenu=new t.classes.MagMenu({mag:this.mag,pages:this.pages,router:this.router,isPreview:this.isPreview,hasProjectInfo:this.hasProjectInfo,publishDate:this.publishDate,$container:this.$container,$toolbar:this.$el,viewerType:this.viewerType}).render()),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"menuShown",this.onMenuShow),this.listenTo(this.mag,"menuHidden",this.onMenuHide),this.listenTo(this.mag,"presentationModeOn",this.onPresentationModeOn),this.listenTo(this.mag,"presentationModeOff",this.onPresentationModeOff),!this.isPreview){var e=this.$(".offscreen-initially:visible"),i=150,n=e.length*i+800;e.each(function(t,e){setTimeout(function(){$(e).removeClass("offscreen-initially")},n),n-=i})}return this.$("div[data-alt]:not(.rmalttext), a[data-alt]:not(.rmalttext)").RMAltText(),this},destroy:function(){return this.share&&this.share.destroy(),this.magMenu&&this.magMenu.destroy(),this.remove()},isMenuOpened:function(){return!!this.menuShown},closeMenu:function(){this.magMenu&&this.magMenu.hide()},onPageChange:function(t,e){this.showPageCounter(t,e),this.$menuButton.removeClass("waiting-video-bg-start preloading"),this.prevPage&&this.stopListening(this.prevPage),t&&(t.loaded||(this.$menuButton.addClass("preloading"),this.listenTo(t,"pageLoaded",this.onPageLoaded)),t.hasVideoBG&&!t.videoBGStarted&&(this.$menuButton.addClass("waiting-video-bg-start"),this.listenTo(t,"videoBGStarted",this.onVideoBGStarted)),this.prevPage=t)},onPageLoaded:function(){this.$menuButton.removeClass("preloading")},onVideoBGStarted:function(){this.$menuButton.removeClass("waiting-video-bg-start")},onFinalPageShow:function(){this.magMenu&&this.magMenu.hide(),this.finalPageShown=!0,this.updateVisibilityState()},onFinalPageHide:function(){this.finalPageShown=!1,this.updateVisibilityState()},onPresentationModeOn:function(){this.isPresentationMode=!0,this.updateVisibilityState()},onPresentationModeOff:function(){this.isPresentationMode=!1,this.updateVisibilityState()},updateVisibilityState:function(){this.finalPageShown||this.isPresentationMode?this.$el.stop().fadeOut(200):this.$el.stop().fadeIn(200)},onMenuShow:function(){this.menuShown=!0,this.hidePageCounter()},onMenuHide:function(){this.menuShown=!1},getPageCounterSize:function(t){if(!this.cachedPageCounterData){this.$pageCounter.find(".cur").text("0");var e=this.$pageCounter.outerWidth();this.$pageCounter.find(".cur").text("00");var i=this.$pageCounter.outerWidth(),n=i-e,s=e-n;this.cachedPageCounterData={baseSize:s,digitSize:n},this.$pageCounter.find(".cur").text(t)}var r=this.cachedPageCounterData;return r.baseSize+(t+"").length*r.digitSize},updatePageCounterSize:function(t){this.$pageCounter.length&&this.$pageCounterWrapper.length&&(!this.menuShown&&this.pageCounterShown?this.$pageCounterWrapper.css("width",this.getPageCounterSize(t)):this.$pageCounterWrapper.css("width",""))},showPageCounter:function(t,e){this.hasPageCounter&&(this.$pageCounter.find(".cur").text(t.num),e.showPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.addClass("show-page-counter"),this.pageCounterShown=!0,Modernizr.android?setTimeout(_.bind(function(){this.updatePageCounterSize(t.num)},this),17):this.updatePageCounterSize(t.num),this.pageCounterTimeout=setTimeout(this.hidePageCounter,e.initial?this.PAGE_COUNTER_TIMEOUT_INITIAL:this.PAGE_COUNTER_TIMEOUT)))},hidePageCounter:function(){this.hasPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.removeClass("show-page-counter"),this.pageCounterShown=!1,this.updatePageCounterSize())},toggleMenu:function(t){this.magMenu&&this.magMenu.toggle()},toggleShare:function(t){$(t.target).is(this.$shareButton)&&this.share&&this.share.toggle();
},postMessageToParent:function(t,e){var i={type:t,data:e},n=window.parent;n&&n.postMessage(JSON.stringify(i),"*")},onEmbedCloseClick:function(t){this.postMessageToParent("close-fullscreen")}})}(RM),function(t,e){"use strict";t.classes.Branding=Backbone.View.extend({template:t.templates["template-viewer-branding"],initialize:function(t){return _.bindAll(this),_.extend(this,t),this},render:function(){return this.setElement(this.template()),this.$el.appendTo(this.$container),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.hide),this.listenTo(this.mag,"finalPageHidden",this.show),_.delay(function(){this.$el.removeClass("offscreen-initially")}.bind(this),800),this},onPageChange:function(t,e){},hide:function(){this.$el.stop().fadeOut(200)},show:function(){this.$el.stop().fadeIn(200)}})}(RM),function(t,e){"use strict";var i=1;t.classes.Widget=Backbone.View.extend({template:t.templates["template-viewer-widget"],initialize:function(t,e,n){return _.bindAll(this),_.extend(this,t,t.params),this.page=e,this.$pageContainer=n||this.page.$content,this.$document=$(document),this._id=this._id||i++,this.x=this.x||0,this.y=this.y||0,this},render:function(){return this.makeBox("some-widget-class"),this.rendered=!0,this},widgetIsLoaded:function(){this.loaded||this.destroyed||(this.loaded=!0,this.started&&this.start(),this.trigger("loaded"))},isValid:function(){return!0},hasFontsToLoad:function(){return!1},hasLoadAnimation:function(){return!(!this.animation||!this.animation.type||"load"!=this.animation.type||_.isEmpty(this.animation.steps))},start:function(){return this.started=!0,this},stop:function(){return this.started=!1,this},destroy:function(){return this.stop(),this.destroyed=!0,this.trigger("destroyed"),delete this.animationObj,this.$el.off(),this.remove()},BringToTopZ:function(){if(this.animationObj){var t=this.animationObj.getAnimationContainer();this.savedAnimationContainerZIndex=t.css("z-index"),t.css("z-index",99999+this.z)}this.$el.css("z-index",99999+this.z)},BackToNormalZ:function(){if(this.animationObj){var t=this.animationObj.getAnimationContainer();t.css("z-index",this.savedAnimationContainerZIndex||this.z)}this.$el.css("z-index",this.z)},makeBox:function(t){this.setElement(this.template());var e=this.fixed_position?this.$fixedContainer:this.$pageContainer;this.animationObj&&(e=this.animationObj.getAnimationContainer()),this.$el.appendTo(e).addClass(t).toggleClass("full-width",!!this.is_full_width).toggleClass("inside-hotspot",!!this.insideHotspot),this.applyBoxStyle(),(this.is_full_width||this.fixed_position||this.sticked)&&this.listenTo(this.page,"resize",this.onPageResize)},onPageResize:function(){this.applyBoxStyle()},calcBoxStyle:function(e){e=e||{};var i={left:this.x,top:this.y,width:this.w,height:this.h,right:"",bottom:"","margin-left":"","margin-top":"","z-index":this.z||1},n=parseInt(this.full_width_margin,10)||0,s=parseInt(this.sticked_margin,10)||0,r=this.page.scale,a=this.fixed_position;if(this.angle&&(i.width=Math.round(this.w),i.height=Math.round(this.h),this.angle%90==0&&i.width%2!==i.height%2&&(i.width+=1)),this.is_full_width&&(i.left=-this.page.contentPosition.left+n,i.width=this.page.mag.getContainerSizeCached().width/r-2*n,a)){if(i.left=n,"horizontal"==this.page.viewerType){var o=this.page.$scrollWrapper,l=o.width()-o[0].clientWidth;i.width-=l/r}["nw","n","ne"].indexOf(a)>-1&&(a="nw"),["w","c","e"].indexOf(a)>-1&&(a="w"),["sw","s","se"].indexOf(a)>-1&&(a="sw")}if(this.sticked){var l=0;"horizontal"==this.page.viewerType&&(l=this.page.$scrollWrapper.width()-this.page.$scrollWrapper[0].clientWidth),"left"==this.sticked&&(i.left=-this.page.contentPosition.left+s),"right"==this.sticked&&(i.left=this.page.mag.getContainerSizeCached().width/r-s-this.w-this.page.contentPosition.left-l/r),"top"==this.sticked&&(i.top=-this.page.contentPosition.top/r+s),"bottom"==this.sticked&&(i.top=this.$pageContainer.height()-s-this.h+this.page.contentPosition.top/r)}if(e.calcBBox){a&&(i.left*=r,i.top*=r,i.width*=r,i.height*=r),i.sinAngle=Math.sin(-(this.angle||0)*Math.PI/180),i.cosAngle=Math.cos(-(this.angle||0)*Math.PI/180);var c=t.mathutils.calcBoundingBox(i,a);return i.width=c.bb_width,i.height=c.bb_height,i.left=c.bb_left,i.top=c.bb_top,a&&_.extend(i,t.utils.getFixedPositionCSS(a,i,1)),{dimensions:i}}a&&_.extend(i,t.utils.getFixedPositionCSS(a,i,r));var h={rotateX:this.angle&&this.antialiasRotation?"0deg":"",rotateY:this.angle&&this.antialiasRotation?"0deg":"",rotateZ:this.angle?this.angle+"deg":"",scaleX:this.flip_h?-1:1,scaleY:this.flip_v?-1:1};return a&&(h.scaleX*=r,h.scaleY*=r),Math.abs(h.scaleX-1)<1e-6&&(h.scaleX=""),Math.abs(h.scaleY-1)<1e-6&&(h.scaleY=""),{dimensions:i,transform:h}},applyBoxStyle:function(){var e=this.calcBoxStyle();this.animationObj&&(e=this.animationObj.modifyWidgetPosition(e)),this.$el.css(e.dimensions);var i=_.map(e.transform,function(t,e){return t?e+"("+t+")":""}).join(" ");t.utils.applyTransform(this.$el,$.trim(i))},calcDistsToPageVisibleBounds:function(){var t,e=this.page.mag.getContainerSizeCached(),i=this.$el[0].getBoundingClientRect(),n=this.page.mag.isPreview?this.page.mag.$mag_container[0].getBoundingClientRect():{top:0,left:0},s=(i.top+i.height/2-n.top)/this.page.scale,r=(e.height-(i.top+i.height/2-n.top))/this.page.scale,a=(i.left+i.width/2-n.left)/this.page.scale,o=(e.width-(i.left+i.width/2-n.left))/this.page.scale;if(this.fixed_position){var l=this.page.$el[0].getBoundingClientRect(),c=(i.top+i.height/2-l.top)/this.page.scale,h=(l.height-(i.top+i.height/2-l.top))/this.page.scale;t={left:Math.max(0,a),right:Math.max(0,o),top:Math.max(0,Math.min(s,c)),bottom:Math.max(0,Math.min(r,h))}}else{var d=this.page.contentPosition.left/this.page.scale,u=this.page.contentPosition.top/this.page.scale,p=this.x+this.w/2,f=this.y+this.h/2,c=f+u,h=this.page.contentHeight-f+u;t={left:Math.max(0,p+d),right:Math.max(0,this.page.pageWidth-p+d),top:Math.max(0,Math.min(s,c)),bottom:Math.max(0,Math.min(r,h))}}return t},checkLink:function(){var t=" ";if(this.clickLink){this.clickLink=this.page.mag.matchSameDomainLink(this.clickLink);var e=/^http(s?)\:\/\//i.test(this.clickLink)||/^mailto\:/i.test(this.clickLink)||/^tel\:/i.test(this.clickLink),i=/^__rm_goback$/i.test(this.clickLink),n=this.mailchimpMatcher.test(this.clickLink),s=this.anchorRegexp.test(this.clickLink),r=this.shareRegexp.test(this.clickLink),a=this.clickLink,o=this.clickTarget||"_blank",l=e?"external-link":i?"goback-link":"maglink";if(n&&(l="mailchimp-link"),s&&(l="anchor-link"),r&&(l="share-link"),!e){var c=a;/^back\sto\stop$/i.test(a)&&(c=this.page._id);var h=this.page.mag.getPageNum(c),a=h&&this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(c):"javascript:void(0)";h?o="":a="",c==this.page._id&&(l+=" back-to-top")}if(i&&(a="javascript:void(0)"),n){a="javascript:void(0)";var d=this.clickLink.match(this.mailchimpMatcher)[1];t+=" data-mailchimp='"+d+"'"}if(s&&(a="javascript:void(0)",t+=" data-anchor-link-pos='"+this.anchor_link_pos+"'",t+=" data-page-uri='"+(this.page.uri||this.page.num)+"'"),r){a="javascript:void(0)";var u=this.clickLink.match(this.shareRegexp);t+=" data-share-provider='"+u[1]+"' data-share-type='"+u[2]+"'"}0!=a.indexOf("mailto")&&0!=a.indexOf("tel")&&"maglink"!=l||(o=""),a&&this.$el.wrap('<a class="'+l+'" href="'+a+'" target="'+o+'"'+t+">")}}})}(RM),function(t,e){"use strict";t.classes.MagMenu=Backbone.View.extend({template:t.templates["template-viewer-mag-menu"],events:{"click .page":"onPageClick"},initialize:function(e){return _.bindAll(this),_.extend(this,e),this.IMG_STUB=(t.common.isDownloadedSource?"":"/")+"img/spacer.gif",Modernizr.isphone?"horizontal"==this.viewerType?(this.PAGE_WIDTH=140,this.PAGE_HEIGHT=92):(this.PAGE_WIDTH=240,this.PAGE_HEIGHT=158):(this.PAGE_WIDTH=280,this.PAGE_HEIGHT=184),this.loadVisibleScreenshots.__debounced=_.debounce(this.loadVisibleScreenshots,500),this.unloadInvisibleScreenshots.__debounced=_.debounce(this.unloadInvisibleScreenshots,3e3),this},render:function(){this.setElement(this.template({mag:this.mag,pages:this.pages,width:this.PAGE_WIDTH,height:this.PAGE_HEIGHT,stub:this.IMG_STUB,viewerType:this.viewerType,publishDate:this.publishDate,hasProjectInfo:this.hasProjectInfo})),this.$el.appendTo(this.$container),this.$pagesWrapper=this.$(".pages-wrapper");var e=this.$(".page"),i=this.$(".logo-wrapper");if("horizontal"==this.viewerType?(this.LOGO_SIZE=i.width()||0,this.$(".pages").css("width",e.length*this.PAGE_WIDTH+this.LOGO_SIZE),this.$pagesWrapper.scrollLeft(99999)):(this.LOGO_SIZE=i.height()||0,this.$(".pages").css("height",e.length*this.PAGE_HEIGHT+this.LOGO_SIZE),this.$pagesWrapper.scrollTop(99999)),Modernizr.isdesktop&&(this.scroll=this.$(".scroll-wrapper").RMScroll({$container:this.$pagesWrapper,$content:this.$(".pages"),$handle:this.$(".scroll"),wheelScrollSpeed:1.3,gap_start:8,gap_end:8+this.LOGO_SIZE,maxHandleSize:136,dragScroll:!0,tp:this.viewerType}).data("scroll")),this.$pagesWrapper.bind("scroll",this.onScroll),this.cacheSize(),this.cacheScroll(),this.cachePagesPos(),this.loadedScreenshots={},"horizontal"==this.viewerType&&Modernizr.isphone||$(".menu-info .mag-title").dotdotdot({height:Modernizr.isphone?48:68,wrap:"letter",callback:_.bind(function(t,e){t&&this.$(".menu-info .mag-title").attr("title",this.mag.title)},this)}),!Modernizr.isdesktop){var n="horizontal"==this.viewerType?this.$el.height():this.$el.width(),s=this.$el.add(this.$toolbar);"horizontal"==this.viewerType&&this.mag.navigation&&(s=s.add(this.mag.navigation.$bottom)),this.menuSwipe=s.RMSwipe({$scrollElements:this.$pagesWrapper,minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,getCurrentConstraints:_.bind(function(){var t={};return t.$referenceItem=this.$el,t="horizontal"==this.viewerType?this.shown?{up:{max:0,noTrigger:!0},down:{max:n}}:{up:{max:n},down:{max:0,noTrigger:!0}}:this.shown?{left:{max:0,noTrigger:!0},right:{max:n}}:{left:{max:n},right:{max:0,noTrigger:!0}}},this),callback:_.bind(function(t){this.shown?this.hide():this.show()},this)}).data("swipe")}return this.isPreview&&this.listenTo(t.constructorRouter,"renewScreenshot",this.renewScreenshot),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"keypress-"+$.keycodes.m,this.toggle),this.listenTo(this.mag,"keypress-"+$.keycodes.esc,this.hide),$(window).on("resize",this.onResize),this.$el.bind("mousewheel",this.onMouseWheel),this},show:function(){return this.finalPageShown?this:(this.shown||(this.shown=!0,this.mag.$el.addClass("viewer-mag-menu-shown"),this.mag.$el.toggleClass("viewer-mag-menu-no-project-info",!this.hasProjectInfo),this.loadOtherScreenshots(),this.mag.trigger("menuShown")),this)},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.mag.$el.removeClass("viewer-mag-menu-shown viewer-mag-menu-no-project-info"),this.clearLoadOtherTimeout(),this.mag.focusCurrentPage(),this.shown=!1,this.mag.trigger("menuHidden")),this},destroy:function(){return $(window).off("resize",this.onResize),this.$el.unbind("mousewheel",this.onMouseWheel),this.menuSwipe&&this.menuSwipe.destroy(),this.$pagesWrapper.unbind("scroll",this.onScroll),this.remove()},onMouseWheel:function(t){t.preventDefault()},onResize:function(){this.cacheSize(),this.scroll&&this.scroll.recalc(),this.mag.currentPage&&this.shiftToPage(this.mag.currentPage.num,!1)},onScroll:function(){this.cacheScroll()},cacheSize:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollSize="horizontal"==this.viewerType?this.$pagesWrapper.width():this.$pagesWrapper.height()},cacheScroll:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollPos="horizontal"==this.viewerType?this.$pagesWrapper.scrollLeft():this.$pagesWrapper.scrollTop()},cachePagesPos:function(){this.cachedData=this.cachedData||{},this.cachedData.pagesPos={};var t=this.cachedData.pagesPos,e=this.viewerType,i=this.PAGE_WIDTH,n=this.PAGE_HEIGHT;_.each(this.pages,function(s,r){t[s.num]=r*("horizontal"==e?i:n)})},onPageChange:function(t,e){this.shown||(this.loadVisibleScreenshots.__debounced(),!Modernizr.isdesktop&&this.unloadInvisibleScreenshots.__debounced()),this.shiftToPage(t.num,this.shown),_.isEmpty(this.loadedScreenshots)&&this.loadVisibleScreenshots()},onFinalPageShow:function(){this.hide(),this.finalPageShown=!0},onFinalPageHide:function(){this.finalPageShown=!1},shiftToPage:function(t,e){var i,n=this.$('.page[data-num="'+t+'"]'),s=this.cachedData.scrollSize,r=this.cachedData.scrollPos,a="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT,o=this.cachedData.pagesPos[t],l=r+a/2,c=r+s-a/2;if(this.$(".page.active").removeClass("active"),n.addClass("active"),o<l)i=o-l;else{if(!(o+a>c))return;i=o+a-c}var h="horizontal"==this.viewerType?"scrollLeft":"scrollTop",d={};d[h]=r+i,this.$pagesWrapper.stop().animate(d,e?300:0)},onPageClick:function(t){if((Modernizr.isdesktop||t.originalEvent.forwardedTouchEvent||!window.FastClick||window.FastClick.notNeeded(window.document.body))&&(!this.scroll||!this.scroll.wasContentDrag)){var e=$(t.currentTarget).data("num");this.mag.currentPage&&e==this.mag.currentPage.num||this.mag.showPage(e,{animation:!1})}},renewScreenshot:function(e){var i=this.$(".page").filter(function(){return $(this).data("id")==e}),n=t.constructorRouter.mag.pages.find(function(t){return t.id==e}),s=n&&n.getScreenshot(this.PAGE_WIDTH);i.attr("data-src")?i.attr("data-src",s):i.find(".screenshot").prop("src",s)},getVisibleScreenshotRange:function(){var t=this.cachedData.scrollSize,e=this.cachedData.scrollPos,i="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT;return{min:Math.max(0,Math.floor(e/i)),max:Math.min(this.mag.getPagesCount()-1,Math.floor((e+t)/i))}},loadVisibleScreenshots:function(){if(this.mag.pages&&this.mag.pages.length){var t=this.getVisibleScreenshotRange(),e=this;this.$(".page").each(function(i){var n=$(this),s=n.attr("data-src");if(i>=t.min&&i<=t.max&&s&&!e.loadedScreenshots[i]){var n=$(this);n.find(".screenshot").prop("src",s),n.removeAttr("data-src"),e.loadedScreenshots[i]=!0}})}},unloadInvisibleScreenshots:function(){if(!this.shown){var t=this.getVisibleScreenshotRange(),e=this;this.$(".page").each(function(i){var n=$(this),s=n.attr("data-src");if((i<t.min||i>t.max)&&!s&&e.loadedScreenshots[i]){var n=$(this);n.attr("data-src",n.find(".screenshot").prop("src")),n.find(".screenshot").prop("src",e.IMG_STUB),delete e.loadedScreenshots[i]}})}},loadOtherScreenshots:function(){this.clearLoadOtherTimeout(),this.loadOtherSafeTimeout=500,this.loadNextScreenshot()},loadNextScreenshot:function(){var t,e,i,n=this.getVisibleScreenshotRange(),s=Math.floor((n.min+n.max)/2),r=this.loadedScreenshots,a=this.mag.getPagesCount()-1;for(t=s;t<=a&&r[t];t++);for(e=s;e>=0&&r[e];e--);if(!(e<0&&t>a)){i=t>a?e:e<0?t:t-s>s-e?e:t,r[i]=!0;var o=this.$(".page").eq(i),l=o.find(".screenshot"),c=this;l.one("load error",function(t){clearTimeout(c.$curLoadingTimeout),c.loadNextScreenshot()}),this.$curLoadingTimeout=setTimeout(function(){l.off(),c.loadOtherSafeTimeout*=1.1,c.loadNextScreenshot()},this.loadOtherSafeTimeout),l.prop("src",o.attr("data-src")),o.removeAttr("data-src"),this.$curLoadingScreenshot=l}},clearLoadOtherTimeout:function(){this.$curLoadingScreenshot&&this.$curLoadingScreenshot.off(),clearTimeout(this.$curLoadingTimeout)}})}(RM),function(t,e){"use strict";t.classes.FinalPage=Backbone.View.extend({template:t.templates["template-viewer-final-page"],events:{"click .share-button":"share","click .share-embed":"openEmbed","click .embed-wrapper .embed-close":"closeEmbed","click .embed-wrapper .embed-code":"selectEmbedCode","keyup .embed-wrapper .embed-code":"onKeyUp","click .full-name":"toProfile","click .logo":"toHomepage","click .related-link":"toRelated","click .dop-container-join .buttons-panel .use-email":"showNativeJoin","click .dop-container-join .native-join .cancel":"hideNativeJoin","click .size-selector":"onSizeSelectorClick"},initialize:function(t){return _.bindAll(this),_.extend(this,t),this},render:function(){var e="empty";return"recent"==this.finalPageType&&this.recentMags.length&&(e="recent"),"join"==this.finalPageType&&(e="join"),this.setElement(this.template({mag:this.mag,disableSocials:this.isPrivate,recentMags:this.recentMags,tp:e,magLink:this.mag.getUrl(),isStickyVerticalViewer:this.isStickyVerticalViewer,tweetText:t.shareutils.getFinalShare(null,_.extend(this.mag.model.toJSON(),{user:this.mag.user}),{forProject:!0,customDomain:t.common.isDomainViewer}).tweet,specialRecentView:"recent"==e&&1==this.recentMags.length&&!Modernizr.isphone})),this.$el.appendTo(this.$container),"join"==e&&new t.classes.Login({useNavigate:!1,$node:this.$(".dop-container-join"),router:this.router}).render(),this.updateEmbedPreview(),this.updateEmbed(),"horizontal"==this.viewerType?(this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"keypress-"+$.keycodes.esc,this.hide)):this.show(),this},show:function(){return this.shown||(this.$el.removeClass("offscreen hidden"),this.shown=!0,"horizontal"==this.viewerType&&this.mag.trigger("finalPageShown"),this.selectEmbedCode(),Modernizr.isphone||this.socialsInitialized||_.delay(_.bind(function(){this.socialsInitialized=!0,t.initutils.initTwitterAPI(function(){window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load()}),t.initutils.initFacebookAPI(_.bind(function(){window.FB.XFBML.parse(this.$el.get(0))},this))},this),300)),this},hide:function(){return this.shown&&(this.$el.addClass("offscreen"),this.shown=!1,this.closeEmbed(),this.mag.trigger("finalPageHidden")),this},destroy:function(){return this.remove()},setSizeAndPosForStickyVersion:function(t){t=t||{},this.$el.css({height:this.getHeight(),top:t.absolutePosition})},scrollOnVerticalMode:function(e){this.hasScrollOnVerticalMode=!0,this.$el.css("top",0),t.utils.applyTransform(this.$(".final-page-wrapper"),"translateY("+-e+"px)")},resetScrollOnVerticalMode:function(e){this.hasScrollOnVerticalMode&&(this.hasScrollOnVerticalMode=!1,this.$el.css("top",""),t.utils.applyTransform(this.$(".final-page-wrapper"),""))},getHeight:function(){return this.$(".final-page-wrapper").height()},onPageChange:function(t,e){this.$el.toggleClass("hidden",!this.mag.isLastPage()),this.hide()},showNativeJoin:function(){this.$(".dop-container-join .buttons-panel").fadeOut(300),this.$(".dop-container-join .native-join").fadeIn(300)},hideNativeJoin:function(){this.$(".dop-container-join .buttons-panel").fadeIn(300),this.$(".dop-container-join .native-join").fadeOut(300)},toProfile:function(){this.router.analytics&&this.router.analytics.sendEvent("Profile","final page")},toHomepage:function(){this.router.analytics&&this.router.analytics.sendEvent("Logo","final page")},toRelated:function(t){var e=$(t.target),i=e.attr("href")||e.parent().attr("href"),n=e.find(".overflow-block").text();this.router.analytics&&this.router.analytics.sendEvent("Final Page Related Mags",n+" ("+i+")")},onKeyUp:function(t){t.stopPropagation()},openEmbed:function(t){$(t.currentTarget).hasClass("disabled")||(this.router.analytics&&this.router.analytics.sendEvent("Embed","final page"),this.$(".embed-wrapper").removeClass("hidden"))},closeEmbed:function(t){this.$(".embed-wrapper").addClass("hidden")},updateEmbedPreview:function(){var t=this.mag.model.getPageScreenshot(Modernizr.retina?256:512,{_id:this.mag.coverPid});this.$(".embed-wrapper .thumb-pic").attr("src",t)},updateEmbed:function(){var e=this.$(".size-selector").attr("data-selected"),i={responsive:"responsive",big:512,small:288};this.$(".embed-wrapper .embed-code").val(t.classes.Share.getEmbedCode({shareMode:"full",mag_num_id:this.mag.num_id,size:i[e]}))},onSizeSelectorClick:function(t){var e,i,n=$(t.currentTarget),s=n.attr("data-selected");e=_.map(n.find(".size"),function(t){return $(t).attr("data-size")}),i=e.indexOf(s)+1,i=i>=e.length?0:i,n.attr("data-selected",e[i]),this.updateEmbed()},selectEmbedCode:function(t){Modernizr.isdesktop&&this.$(".embed-wrapper .embed-code").get(0).setSelectionRange(0,9999),!Modernizr.isdesktop&&t&&(t.stopPropagation(),t.preventDefault())},share:function(e){$(e.currentTarget).hasClass("disabled")||t.shareutils.share({host:(t.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:$(e.currentTarget).attr("data-tp"),source:"final page",page:null,mag:_.extend(this.mag.model.toJSON(),{user:this.mag.user}),forProject:!0,customDomain:!(!t.common.isDomainViewer&&!t.common.embedDomainName),customDomainProfile:!(!t.common.customDomainProfile&&"User"!=t.common.embedDomainType),analytics:this.router.analytics})}})}(RM),function(t,e){"use strict";t.classes.Mag=Backbone.View.extend({TYPEKIT_PREVIEW_API_LINK:"//use.typekit.net/previewkits/pk-v1.js",PRELOAD_COUNT_HORIZONTAL:{backward:1,forward:Modernizr.isdesktop?5:Modernizr.isphone?3:2},PRELOAD_COUNT_VERTICAL:{backward:Modernizr.isdesktop?5:(Modernizr.isphone,2),forward:Modernizr.isdesktop?10:(Modernizr.isphone,3)},SCROLLABLE_TRESHOLD:100,SCROLL_SNAP:220,template:t.templates["template-viewer-mag"],initialize:function(e,i){_.bindAll(this),e||(e={}),_.defaults(e,{pages:[]});var n=_(e.pages).chain().reduce(function(t,e){return t.concat(e.wids)},[]).filter({is_global:!0}).value();return _(e.pages).each(function(t){t.wids=t.wids.concat(_.reject(n,function(e){return e.pid==t._id}))}),_.extend(this,e),this.model=new t.models.UserMag(e,{parse:!0}),this.router=i,this.isPreview=i.isPreview,this.$container=i.$mags_container,Modernizr.isdesktop&&$("<div>").bind("mousewheel",function(){}),this.setViewerOptions(this.getMagViewport()),this.continueLoading.__debounced=_.debounce(this.continueLoading,200),this.loadPages.__debounced=_.debounce(this.loadPages,700),this.onResize.__debounced=_.debounce(this.onResize,300),this.onMagScroll.__throttled=_.throttle(this.onMagScroll,100),this.widgetPackCount=0,this},setViewerOptions:function(e){var i={arrows:!0,menubutton:!0,projectinfo:!0,sharebutton:!0,pagecounter:!0,endpage:!0,endpagetype:"join",viewertype:"horizontal",slidein:!0};i=_.extend(i,this.model.get("opts")),i.viewertype=t.screenshot?"horizontal":i.viewertype,(!Modernizr.isdesktop||this.isPreview&&"default"!=e)&&(i.slidein=!1),"vertical"!=i.viewertype||Modernizr.isdesktop||(this.isStickyVerticalViewer=Modernizr.csspositionsticky,this.isStickyVerticalViewer||(i.viewertype="horizontal",this.pages.length>1&&(i.arrows=!0))),i.sharebutton=i.sharebutton&&!this.isPreview&&!!this.published&&!this.is_private,i.pagecounter=i.pagecounter&&!this.isPreview&&this.pages.length>1,i.endpage=i.endpage&&!this.isPreview&&!!this.published,this.model.user&&this.model.user.get&&"540dc7a3a5c9259a383b910b"==this.model.user.get("_id")&&(i=_.extend(i,{arrows:!0,menubutton:this.isPreview,sharebutton:!1,pagecounter:!1,endpage:!1})),this.viewOpts=i,this.PRELOAD_COUNT="horizontal"==this.viewOpts.viewertype?this.PRELOAD_COUNT_HORIZONTAL:this.PRELOAD_COUNT_VERTICAL},setViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").addClass("viewer-type-"+this.viewOpts.viewertype).removeClass("pages-pos-normal pages-pos-overlap").addClass("pages-pos-"+(this.viewOpts.slidein?"overlap":"normal")),"vertical"==this.viewOpts.viewertype&&($("html").addClass("overflow-on-vertical-view"),this.isStickyVerticalViewer&&(this.$el.addClass("viewer-type-vertical-sticky"),$("body").addClass("overflow-on-vertical-view")))},unsetViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").removeClass("pages-pos-normal pages-pos-overlap"),"vertical"==this.viewOpts.viewertype&&($("html").removeClass("overflow-on-vertical-view"),this.$magScrollSizer.css("height",""),this.isStickyVerticalViewer&&(this.$el.removeClass("viewer-type-vertical-sticky"),$("body").removeClass("overflow-on-vertical-view")))},render:function(){function e(){t.textutils.appendFontsCssToDocument({version:s,fonts:r.edit_params&&r.edit_params.fonts,typekit_url:r.typekit_url})}if(!this.active){this.title=this.title||"Project",this.magOpenTime=new Date,this.setElement(this.template({hasStandaloneBottomArrow:!this.isPreview&&"vertical"==this.viewOpts.viewertype&&this.viewOpts.arrows,isPreview:!!this.isPreview})),this.$el.appendTo(this.$container),this.setViewerClasses(),$("body").on("click","a.external-link",this.toExternalLink).on("click",".maglink.back-to-top",this.backToTopCurrentPage).on("click",".maglink",this.maglink).on("click",".goback-link",this.onGobackLinkClick).on("click",".mailchimp-link",this.onMailchimpLinkClick).on("click",".anchor-link",this.onAnchorLinkClick).on("click",".share-link",this.onShareLinkClick),this.$mag_container=this.$(".mag-pages-container"),this.$mag_container.on("scroll",this.fixFocusScroll),this.$mag_viewport_device=this.$(".mag-pages-viewport-device"),this.$pages_container=this.$(".mag-pages-container .container"),this.$pages_blackout=this.$pages_container.find(".blackout"),"vertical"==this.viewOpts.viewertype&&(this.$magScrollContainer=$(window),this.$magScrollSizer=$("body"),this.isStickyVerticalViewer&&(this.$magScrollSizer=$("body").add(this.$el)),this.$magScrollHandler=$(window),this.$magScrollAnimate=$("body, html")),"vertical"==this.viewOpts.viewertype&&(this.$bottomArrow=this.$(".navigation-arrow.bottom"),this.$bottomArrow.one("click",this.scrollMagALittle)),this.active=!0;var i=this.pages;this.pages=null,this.viewport=null,this.switchToViewport(this.getMagViewport()),this.onResize(),Modernizr.isdesktop||setTimeout(this.onResize,1500),this.pages=_(i).chain().sortBy(function(t){return t.num}).map(_.bind(function(e){return new t.classes.Page({mag:this,router:this.router,totalPages:i.length,pageData:e,viewerType:this.viewOpts.viewertype,isStickyVerticalViewer:this.isStickyVerticalViewer,$container:this.$pages_container}).render()},this)).value();var n=this.getPage(this.getPagesCount());n&&n.markAsLast(),"horizontal"==this.viewOpts.viewertype&&this.setPagesTransitions(),t.screenshot||("horizontal"==this.viewOpts.viewertype&&this.viewOpts.arrows&&(this.navigation=new t.classes.Navigation({mag:this,router:this.router,$container:this.$el,isPreview:this.isPreview,hasFinalPage:this.viewOpts.endpage,viewerType:this.viewOpts.viewertype}).render()),this.viewOpts.endpage&&(this.finalPage=new t.classes.FinalPage({me:this.router.me,mag:this,router:this.router,$container:this.$pages_container,isPreview:this.isPreview,isPrivate:this.is_private,viewerType:this.viewOpts.viewertype,finalPageType:this.viewOpts.endpagetype,isStickyVerticalViewer:this.isStickyVerticalViewer,recentMags:this.model.recentMags||_([])}).render()),this.toolbar=new t.classes.Toolbar({mag:this,pages:this.pages,router:this.router,$container:this.$el,isPreview:this.isPreview,hasMenu:this.viewOpts.menubutton,hasProjectInfo:this.viewOpts.projectinfo,hasShare:this.viewOpts.sharebutton&&!t.constants.IS_FILE_PROTOCOL,hasPageCounter:this.viewOpts.pagecounter,viewerType:this.viewOpts.viewertype,publishDate:this.published?new Date(this.published).format("mmm dd, yyyy"):"unpublished"}).render(),!this.must_show_branding||t.common.embedMode&&!Modernizr.isdesktop||(this.branding=new t.classes.Branding({mag:this,$container:this.$el}).render())),"vertical"==this.viewOpts.viewertype&&(this.onResize(),Modernizr.isdesktop&&this.getPage(1)&&this.getPage(1).$content.focus(),$("body").on("keydown",this.onVerticalViewKeyDown)),Modernizr.isdesktop?($(window).on("mousedown",this.onMouseDown),$(window).on("mouseup",this.onMouseUp),$(window).on("mousewheel",this.onMouseWheel)):($(window).on("touchstart",this.onDragStart),$(window).on("touchmove",this.onDragMove),$(window).on("touchend touchcancel",this.onDragEnd),$(window).on("pageshow",this.onResize)),t.utils.PageVisibilityManager.addEventListener(this.onPageVisibilityChange),this.listenTo(this,"finalPageShown",this.onFinalPageShow),this.listenTo(this,"finalPageHidden",this.onFinalPageHide),$(window).on("resize",this.onResize),$(window).on("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.on("scroll",this.isStickyVerticalViewer?this.onMagScroll.__throttled:this.onMagScroll),$("body").on("keyup",this.onKeyup),t.textutils.generateCSS("paragraph","viewer",document,this.edit_params&&this.edit_params.paragraph_styles),t.textutils.generateCSS("link","viewer",document,this.edit_params&&this.edit_params.link_styles),t.textutils.setShortList(t.textutils.getVeryShortList(this.edit_params&&this.edit_params.fonts));var s=!this.isPreview&&this.model.get("is_published")?"published":"edit",r=this;return"edit"!=s||window.TypekitPreview||Modernizr.isboxversion?e():$.getScript(this.TYPEKIT_PREVIEW_API_LINK,function(t,i,n){e()}),this}},destroy:function(){return _.each(this.pages,function(t){t.destroy()}),this.pages=null,$("body").off("click","a.external-link",this.toExternalLink).off("click",".maglink.back-to-top",this.backToTopCurrentPage).off("click",".maglink",this.maglink).off("click",".goback-link",this.onGobackLinkClick).off("click",".mailchimp-link",this.onMailchimpLinkClick).off("click",".anchor-link",this.onAnchorLinkClick).off("click",".share-link",this.onShareLinkClick),this.toolbar&&this.toolbar.destroy(),this.navigation&&this.navigation.destroy(),this.finalPage&&this.finalPage.destroy(),Modernizr.isdesktop?($(window).off("mousedown",this.onMouseDown),$(window).off("mouseup",this.onMouseUp),$(window).off("mousewheel",this.onMouseWheel)):($(window).off("touchstart",this.onDragStart),$(window).off("touchmove",this.onDragMove),$(window).off("touchend touchcancel",this.onDragEnd),$(window).off("pageshow")),this.unsetViewerClasses(),t.utils.PageVisibilityManager.removeEventListener(this.onPageVisibilityChange),$(window).off("resize",this.onResize),$(window).off("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.off("scroll",this.isStickyVerticalViewer?this.onMagScroll.__throttled:this.onMagScroll),$("body").off("keyup",this.onKeyup),this.active=!1,this.remove()},getUrl:function(){return t.common.isDomainViewer?window.location.protocol+"//"+window.location.hostname+"/"+(t.common.customDomainProfile?this.num_id+"/":""):window.location.protocol+"//"+window.location.hostname+"/"+this.num_id+"/"},getPage:function(t,e){return parseInt(t,10)==t&&(t=parseInt(t,10)),_.isNumber(t)?this.pages[t-1]:_(this.pages).find(function(e){return e.uri==t})},getPagesCount:function(){return this.pages.length},isFirstPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num-1)},isLastPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num+1)},getPageNum:function(t){var e=_.find(this.pages,function(e){return e._id==t});return e&&e.num},getPageUri:function(t){var e=_.find(this.pages,function(e){return e._id==t});if(!e)return null;var i=e.uri?e.uri+"/":1==e.num?"":e.num+"/";return this.router.getMagUri(this)+i},getPageTransitionTime:function(){var t=400,e=this.getContainerSizeCached().width,i=this.getContainerSizeCached().height;return t=Modernizr.isdesktop?550:Modernizr.istablet?e>i?550:470:e>i?520:370},onPageVisibilityChange:function(){if(this.currentPage)if(t.utils.PageVisibilityManager.isPageHidden()){this.currentPage.stop({widgetTypes:["video","background","iframe"]});var e=this.getPage(this.currentPage.num+1);e&&e.started&&(e.stop({widgetTypes:["video","background","iframe"]}),this.restartNextPage=!0)}else{this.currentPage.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0});var e=this.getPage(this.currentPage.num+1);e&&this.restartNextPage&&(e.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0}),delete this.restartNextPage)}},updateArrowsColor:function(t){if(t){var e=t.arrows_color||"white";this.$el.removeClass("navigation-white-arrows").removeClass("navigation-black-arrows").addClass("navigation-"+e+"-arrows")}},onFinalPageShow:function(){this.currentPage&&this.currentPage.stop({widgetTypes:["audio","video","background","iframe"]
}),"horizontal"==this.viewOpts.viewertype&&(this.$pages_container.removeClass("disable-transitions"),this.$pages_container.addClass("fade-last-page-on-final-page"))},onFinalPageHide:function(){this.currentPage&&this.currentPage.start({widgetTypes:["audio","video","background","iframe"]}),"horizontal"==this.viewOpts.viewertype&&this.$pages_container.removeClass("fade-last-page-on-final-page")},onDragStart:function(t){clearTimeout(this.touchInProgressTimeout),this.pauseLoading("touch");var e=t.originalEvent.targetTouches[0];this.globalTouchObject={$target:$(t.target).closest(".has-horizontal-scroll, .has-vertical-scroll"),x:e.screenX,y:e.screenY,startTime:+new Date}},onDragMove:function(e){var i=this.globalTouchObject;if(!(e.originalEvent.touches.length>1)&&i){if("horizontal"==this.viewOpts.viewertype){var n=this.currentPage&&this.currentPage.hasFixedWidgets&&$(e.target).closest(this.$mag_container).length;n&&!i.$target.length&&(i.$target=this.currentPage.$scrollWrapper)}else i.$target.length||(i.$target=this.$magScrollContainer);if(!i.$target.length)return void e.preventDefault();if(!t.utils.isPageNativelyScaled()){var s=e.originalEvent.targetTouches[0],r=(s.screenX-i.x,s.screenY-i.y),a=5;if(Math.abs(r)>a&&i.$target.hasClass("has-vertical-scroll")){var o=i.$target[0].scrollHeight,l=i.$target.outerHeight();r>0&&i.$target.scrollTop()<=0&&e.preventDefault(),r<0&&i.$target.scrollTop()>=o-l&&e.preventDefault()}i.$target.hasClass("has-horizontal-scroll")}}},onDragEnd:function(e){this.checkDoubleTap(e),this.touchInProgressTimeout=setTimeout(_.bind(function(){this.continueLoading("touch")},this),400);var i=this.globalTouchObject;if(i){var n=e.originalEvent.changedTouches[0],s=n.screenX-i.x,r=n.screenY-i.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(s)<3&&Math.abs(r)<3&&+new Date-i.startTime<500&&!t.utils.isPageNativelyScaled()&&$(e.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalTouchObject},checkDoubleTap:function(e){if(!(e.originalEvent.touches.length>0)){var i=+new Date,n=i-(this.lastTouchEndTime||i+1);if(this.lastTouchEndTime=i,n<500&&n>0&&t.utils.isPageNativelyScaled()){var s=$('meta[name="viewport"]');if(s.length){var r=s.attr("content"),a=r.replace(/maximum\-scale\=[0-9\.]*/,"maximum-scale=1.0");if(s.attr("content",a),Modernizr.android){var o=$("<div>").appendTo("body");_.delay(function(){o.remove()},500),setTimeout(_.bind(function(){s.attr("content",r);var t=$("<div>").appendTo("body");_.delay(function(){t.remove()},500)},this),1e3)}else s.attr("content",r);this.lastTouchEndTime=0,_.delay(function(){$(window).trigger("gesturechange")},300),_.delay(function(){$(window).trigger("gesturechange")},1e3)}}}},onMouseDown:function(t){this.globalMouseObject={x:t.screenX,y:t.screenY,startTime:+new Date}},onMouseUp:function(t){var e=this.globalMouseObject;if(e){var i=t.screenX-e.x,n=t.screenY-e.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(i)<3&&Math.abs(n)<3&&+new Date-e.startTime<500&&$(t.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalMouseObject},onMouseWheel:function(t){t.originalEvent.deltaX<0&&Math.abs(t.originalEvent.deltaY)<2&&t.preventDefault()},onKeyup:function(e){if("input"!=e.target.tagName.toLowerCase()&&("textarea"!=e.target.tagName.toLowerCase()||"copyhack"==e.target.className)&&_.isEmpty(t.common.disableShortcuts)&&!this.isInPresentationMode){var i=_.findWhere(t.viewports,{shortcut:String.fromCharCode(e.keyCode)});i&&this.isPreview&&(this.switchToViewport(i.name),this.setViewerOptions(i.name),this.setViewerClasses(),this.onResize(),this.loadPages());var n="unknown",s=_.find($.keycodes,function(t,i){var s=$.keycodes[i]===e.keyCode;return s&&(n=i),s});s&&(this.trigger("keypress-"+e.keyCode,e),this.router.analytics&&this.router.analytics.sendEvent("Key Press",n))}},onKeydown:function(e){if("input"!=event.target.tagName.toLowerCase()&&("textarea"!=event.target.tagName.toLowerCase()||"copyhack"==event.target.className)&&_.isEmpty(t.common.disableShortcuts)&&this.isInPresentationMode&&!(e.altKey||e.ctrlKey||e.metaKey))switch(e.which){case 8:case 33:case 80:case 37:case 72:case 38:case 75:e.preventDefault(),this.goPrevPage({animation:!0});break;case 13:case 34:case 78:case 39:case 76:case 40:case 74:e.preventDefault(),this.goNextPage({animation:!0});break;case 36:e.preventDefault(),this.goFirstPage();break;case 35:e.preventDefault(),this.goLastPage();break;case 9:case 32:e.preventDefault(),e.shiftKey?this.goPrevPage({animation:!0}):this.goNextPage({animation:!0});break;case 77:e.preventDefault(),this.trigger("keypress-"+e.keyCode,e)}},onVerticalViewKeyDown:function(t){if(!this.isInPresentationMode&&"vertical"===this.viewOpts.viewertype&&(t.which===$.keycodes.down||t.which===$.keycodes.up)){if(t.preventDefault(),this.arrowKeyLastScrollAt&&new Date-this.arrowKeyLastScrollAt<400)return;var e=t.which===$.keycodes.down;this.arrowKeyLastScrollAt=+new Date;var i,n,s=window.innerHeight,r=this.$magScrollContainer.scrollTop(),a=this.getScrollPosition(),o=Math.round(s/4),l=function(t){return t&&t<=o},c=function(t){return t>o&&t<s},h=_.bind(function(){var t=this.magPagesPos[this.currentPage.num];return Math.abs(r-t.y)},this),d=this.currentPage.pageHeight,u=0===a&&!this.isFirstPage();if(e)i=d-a-s,n=l(i)?d-a:c(i)?i:s,u&&this.viewOpts.slidein&&(n+=h());else{if(u){var p=this.magPagesPos[this.currentPage.num-1];a=p?p.h:0}i=a-s,n=l(i)||a<s?-a:-s,u&&this.viewOpts.slidein&&(n-=this.SCROLL_SNAP-h())}this.setScrollPosition({delta:n,animate:!0})}},togglePresentationMode:function(t){!!this.isInPresentationMode!=t&&Modernizr.isdesktop&&(this.isPreview||(t?($("body").on("keydown",this.onKeydown),this.trigger("presentationModeOn")):($("body").off("keydown",this.onKeydown),this.trigger("presentationModeOff")),this.isInPresentationMode=t))},recalcBottomArrowState:function(t){this.currentPage&&t===this.currentPage&&this.navigation&&this.navigation.recalcBottomArrowState(t)},setScrollPosition:function(t){if(this.currentPage){var e;"vertical"==this.viewOpts.viewertype?(e="undefined"!=typeof t.offset?this.magPagesPos[this.currentPage.num].y+t.offset:this.$magScrollContainer.scrollTop()+t.delta,t.animate?this.$magScrollAnimate.animate({scrollTop:e},500):this.$magScrollContainer.scrollTop(e)):(e="undefined"!=typeof t.offset?t.offset:this.currentPage.$scrollWrapper.scrollTop()+t.delta,t.animate?this.currentPage.$scrollWrapper.animate({scrollTop:e},500):this.currentPage.$scrollWrapper.scrollTop(e))}},getScrollPosition:function(){if(!this.currentPage)return 0;var t=0;return t="vertical"==this.viewOpts.viewertype?Math.max(this.$magScrollContainer.scrollTop()-this.magPagesPos[this.currentPage.num].y,0):this.currentPage.$scrollWrapper.scrollTop()},onMagScroll:function(){this.pauseWidgetsLoadingOnScroll();var t=this.findPageOnCurrentMagScroll({pageStartsOnBottom:this.isStickyVerticalViewer});this.lastPageScroll=Math.max(t.scroll-t.pos.y,0),this.lastPageScrollPercent=this.lastPageScroll/t.page.pageHeight;var i={initiator:"scroll",pageScroll:this.lastPageScroll};if(this.viewOpts.slidein?i.nextPageScroll=0:i.nextPageScroll=i.pageScroll-t.pos.h,i.nextPageVisible=t.pos.h-i.pageScroll<this.getContainerSizeCached().height,this.viewOpts.slidein){var n=(t.pos.h-i.pageScroll)/this.getContainerSizeCached().height;i.nextPageBlackout=Math.min(Math.max(n,0),1)}if(this.showPage(t.page.num,i),this.finalPage&&!this.isStickyVerticalViewer&&(t.finalPageScroll!=e?this.finalPage.scrollOnVerticalMode(t.finalPageScroll):this.finalPage.resetScrollOnVerticalMode()),this.finalPage){var s=t.finalPageShown,r=!!this.lastFinalPageState;s!=r&&this.trigger(s?"finalPageShown":"finalPageHidden"),this.lastFinalPageState=s}if(this.$bottomArrow&&+this.magOpenTime+2e3<+new Date){this.$bottomArrow.addClass("offscreen");var a=this.$bottomArrow;delete this.$bottomArrow,setTimeout(function(){a.remove()},400)}},scrollMagALittle:function(){this.$magScrollAnimate.animate({scrollTop:this.$magScrollContainer.scrollTop()+this.getContainerSizeCached().height},500)},findPageOnCurrentMagScroll:function(t){t=t||{};var e,i,n,s,r=this.$magScrollContainer.scrollTop(),a=this.getContainerSizeCached(),r=Math.min(Math.max(r,0),this.magHeight-a.height),o=this.pages.length,l=r+(t.pageStartsOnBottom?a.height-50-16-16:0);for(e=0;e<o;e++){i=this.pages[e],n=this.magPagesPos[i.num];var c,h=s?s.y+s.h:n.y;if(l>=h&&l<n.y+n.h||e==o-1)return e==o-1&&(c=Math.max(r-n.y-n.h-n.dh,0)),{page:i,scroll:r,pos:n,finalPageScroll:c,finalPageShown:this.finalPage&&!(l>=h&&l<n.y+n.h)};s=n}},onCurrentPageScroll:function(t,e){this.pauseWidgetsLoadingOnScroll(),this.lastPageScroll=e,this.lastPageScrollPercent=this.lastPageScroll/t.pageHeight,this.loadPages.__debounced()},scrollCurrentPageALittle:function(){this.currentPage&&this.currentPage.scrollPageALittle()},focusCurrentPage:function(){this.currentPage&&this.currentPage.focusPage()},backToTopCurrentPage:function(){if("vertical"==this.viewOpts.viewertype){var e=this.findPageOnCurrentMagScroll();this.$magScrollAnimate.animate({scrollTop:e.pos.y},500)}else this.currentPage&&this.currentPage.backToTop();t.analytics&&t.analytics.sendEvent("Scroll Top Link")},scrollPageToPos:function(t,e){var i,n,s=this.getPage(t),r=this.getContainerSizeCached(),a=s.scale;e=e||0,e*=a,e+=s.contentPosition.top,"vertical"==this.viewOpts.viewertype?(i=this.magPagesPos[s.num],n=Math.max(0,i.y+e),n=Math.min(n,i.y+i.h-r.height),this.$magScrollAnimate.animate({scrollTop:n},500)):(n=Math.max(0,e),s.scrollTo(n))},pauseWidgetsLoadingOnScroll:function(){},toExternalLink:function(e){var i=$(e.target).closest("a").attr("href");t.analytics&&t.analytics.sendEvent("External Link",i)},maglink:function(t){if(2!=t.which&&!t.metaKey&&!t.ctrlKey){var e=$(t.currentTarget).data("link")||$(t.currentTarget).attr("href");if(!e)return!1;this.router.navigate(e,{trigger:!0}),t.preventDefault()}},onGobackLinkClick:function(e){var i=this.router.getPreviousFragment();t.analytics&&t.analytics.sendEvent("Back Link",i),i?this.router.navigate(i,{trigger:!0}):this.router.go(1)},onMailchimpLinkClick:function(e){var i,n=$(e.currentTarget);if(!n.hasClass("disabled")){n.flashClass("disabled",3e3);try{i=JSON.parse(n.attr("data-mailchimp"))}catch(t){i=null}i&&t.initutils.initMailchimpAPI(function(e){t.utils.deleteCookie("MCEvilPopupClosed"),e.start(i)})}},onAnchorLinkClick:function(e){var i=$(e.currentTarget),n=parseInt(i.attr("data-anchor-link-pos"),10)||0,s=i.attr("data-page-uri");n&&s&&(this.scrollPageToPos(s,n),t.analytics&&t.analytics.sendEvent("Anchor Link",n))},onShareLinkClick:function(e){t.shareutils.share({host:(t.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:$(e.currentTarget).attr("data-share-provider"),source:"mag links",page:this.currentPage||this.pages[0],mag:_.extend(this.model.toJSON(),{user:this.user}),forProject:"mag"==$(e.currentTarget).attr("data-share-type"),customDomain:!(!t.common.isDomainViewer&&!t.common.embedDomainName),customDomainProfile:!(!t.common.customDomainProfile&&"User"!=t.common.embedDomainType),analytics:this.router.analytics})},showPageCounter:function(t){if(this.toolbar){var e=1;this.currentPage&&(e=this.currentPage.num+(t?"left"==t?1:-1:0),e=Math.max(Math.min(e,this.getPagesCount()),1)),this.toolbar.showPageCounter(this.getPage(e),{showPageCounter:!0})}},showPage:function(t,i){function n(){function t(){for(var t=0;t<o.pages.length;t++){var e=o.pages[t];(e.num<h||e.num>d)&&e.hide()}!o.lastFinalPageState&&s.start(),o.loadPages()}i.animation||l||window.requestAnimationFrame(function(){o.$pages_container.removeClass("disable-transitions")}),o.continueLoading("page-change-animation"),"vertical"==o.viewOpts.viewertype&&"scroll"!=i.initiator&&o.$magScrollContainer.scrollTop(o.magPagesPos[s.num].y),o.isPreview&&o.$el.scrollTop(0),clearInterval(o.showPageCompleteInterval),o.loadingPaused?o.showPageCompleteInterval=setInterval(function(){o.loadingPaused||(clearInterval(o.showPageCompleteInterval),t())},17):t()}i=i||{},this.active||this.render();var s=this.getPage(t),r=this.currentPage,a=s&&this.getPage(s.num+1),o=this;"vertical"==this.viewOpts.viewertype&&(i.animation=!1,s&&s.scrollOnVerticalMode(i.pageScroll||0),s&&a&&i.nextPageScroll!=e&&(a.scrollOnVerticalMode(i.nextPageScroll),this.isStickyVerticalViewer||(i.nextPageVisible?a.start():a.stop())),s&&i.nextPageBlackout!=e&&this.$pages_blackout.css({display:a?"block":"none",opacity:i.nextPageBlackout,"z-index":s.getPageZIndex()}));var l=!this.currentPage;if(!l&&(t==this.currentPage.num||t==this.currentPage.uri))return!1;if(!s)return this.router.onError(),!1;if(r)if("horizontal"==this.viewOpts.viewertype||this.isStickyVerticalViewer)r.stop();else{a==r&&i.nextPageVisible||r.stop();var c=r&&this.getPage(r.num+1);c&&!(c==s||c==a&&i.nextPageVisible)&&c.stop()}else i.animation=!1;this.pauseLoading("page-change-animation"),this.currentPage=s,r&&r.resetWaitForAnimationEnd(),clearInterval(this.showPageCompleteInterval),this.$pages_container.toggleClass("disable-transitions",!i.animation),i.animation&&(this.viewOpts.slidein&&r&&r.num>s.num?r.waitForAnimationEnd(n):s.waitForAnimationEnd(n)),this.direction=!r||r.num<s.num?"forward":"backward";for(var h=s.num-("forward"==this.direction?this.PRELOAD_COUNT.backward:this.PRELOAD_COUNT.forward),d=s.num+("forward"==this.direction?this.PRELOAD_COUNT.forward:this.PRELOAD_COUNT.backward),u=0;u<this.pages.length;u++){var p=this.pages[u];p.num<s.num?p.setPosition("prev",p.num+1==s.num):p.num>s.num?p.setPosition("next",p.num-1==s.num):p.setPosition("center",p.num==s.num),p.num>=h&&p.num<=d&&p.show(),"vertical"==this.viewOpts.viewertype&&(p.num<s.num||p.num>s.num+1)&&p.resetScrollOnVerticalMode()}!i.animation&&n(),this.router.setUrlString({replace:!l}),this.router.trackPage(),this.router.setTitle(),this.trigger("pageChanged",s,{showPageCounter:i.animation||i.bySwipe||l||"scroll"==i.initiator,initial:l}),"vertical"==this.viewOpts.viewertype&&this.updateArrowsColor(s)},goNextPage:function(t){var e=this.finalPage&&this.finalPage.shown;return this.isLastPage()?void(e||this.finalPage&&this.finalPage.show()):void(this.currentPage&&this.router.go(this.currentPage.num+1,t))},goPrevPage:function(t){var e=this.finalPage&&this.finalPage.shown;return this.isLastPage()&&e?void(this.finalPage&&this.finalPage.hide()):void(this.isFirstPage()||this.currentPage&&this.router.go(this.currentPage.num-1,t))},goFirstPage:function(){this.router.go(1)},goLastPage:function(){this.router.go(this.getPagesCount())},pauseLoading:function(t){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[t]=!0,this.loadingPaused=!0},continueLoading:function(t){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[t]=!1,this.loadingPaused=!_.every(_.values(this.pauseReasons),function(t){return!t})},loadPages:function(){function t(t,e){t<0||t>=s.length||e<0||e>=s[t].length||a.push(s[t][e])}if(this.pages&&this.pages.length){var e=this.getPagesLoadOrder();if(e&&e.length){var i,n,s=[];for(i=0;i<e.length;i++){var r=this.pages[e[i]].getWidgetsPacks();r.length&&s.push(r)}if(s.length){var a=[];for(i=0;i<s.length;i++){0==i&&t(i,0),t(i+1,0);for(var n=1;n<s[i].length;n++)t(i,n)}this.widgetsPacksLoadQueue=a,this.stopPagesLoad(),this.loadNextWidgetsPack()}}}},stopPagesLoad:function(){clearTimeout(this.loadNextWidgetsTimer)},loadNextWidgetsPack:function(){if(this.widgetsPacksLoadQueue.length){if(this.loadingPaused)return void(this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,50));var i=this.widgetsPacksLoadQueue.shift();if(!i.length)return void(this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17));var n=i[0].page;if(!n.shown||n.loaded)return void(this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17));var s=this.widgetPackCount+1;t.performance.widgetPackStart(s,i,n),n.loadWidgetsPack(i,_.bind(function(){if(t.performance.widgetPackEnd(s,!0),this.widgetPackCount++,this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17),1===this.widgetPackCount&&t.performance.now()){var i=Math.round(t.performance.now());this.router.analytics&&this.router.analytics.sendEvent("First Widget Pack Loaded",e,i)}},this))}},getPagesLoadOrder:function(){function t(t){t<0||t>=s||!a.pages[t].shown||a.pages[t].loaded||r.push(t)}var e=this.currentPage;if(e){var i,n=e.num-1,s=this.pages.length,r=[],a=this,o=e.num-("forward"==this.direction?this.PRELOAD_COUNT.backward:this.PRELOAD_COUNT.forward),l=e.num+("forward"==this.direction?this.PRELOAD_COUNT.forward:this.PRELOAD_COUNT.backward);if(t(n),"backward"==this.direction){for(t(n-1),t(n+1),i=n-2;i>=o;i--)t(i);for(i=n+2;i<=l;i++)t(i)}else{for(t(n+1),t(n-1),i=n+2;i<=l;i++)t(i);for(i=n-2;i>=o;i--)t(i)}return r}},onGestureChange:function(){this.onResize.__debounced()},checkFullscreen:function(){this.fullscreenCheckCounter=5,clearInterval(this.fullscreenCheckTimer),this.fullscreenCheckTimer=setInterval(_.bind(function(){var t=window.fullScreen||window.innerWidth==screen.width&&window.innerHeight>=screen.height-1;this.togglePresentationMode(t),this.fullscreenCheckCounter--,this.fullscreenCheckCounter||clearInterval(this.fullscreenCheckTimer)},this),500)},onResize:function(e){if(this.checkFullscreen(),!Modernizr.isdesktop&&"horizontal"==this.viewOpts.viewertype||"vertical"==this.viewOpts.viewertype&&!this.isStickyVerticalViewer){var i="horizontal"==this.viewOpts.viewertype?$("html, body").add(this.$el):this.$el,n=t.utils.isPageNativelyScaled(),s=window.innerHeight;337==s&&414==$(window).height()&&s++,i.height(n?"100%":s),!n&&i.scrollTop(0)}var r=this.getContainerSize(),a=r.width>r.height?"landscape":"portrait",o=!1;if(!Modernizr.isdesktop&&this.prevOrientation&&this.prevOrientation!=a&&(this.switchToViewport(this.getMagViewport()),this.setPagesTransitions(),this.stopPagesLoad(),o=!0,setTimeout(this.onResize,300),setTimeout(this.onResize,1500)),this.prevOrientation=a,this.isPreview&&"default"!=this.viewport){var l=Math.round((this.$el.width()-r.width)/2),c=Math.round((this.$el.height()-r.height)/2);this.$mag_container.add(this.$mag_viewport_device).css({top:Math.max(c,0),left:Math.max(l,0),width:r.width,height:r.height})}else this.$mag_container.add(this.$mag_viewport_device).css({top:"",left:"",width:"",height:""});this.$mag_viewport_device.attr("data-viewport",this.viewport),this.setNewPagesWidths(r.width,r.height),this.magHeight=0,this.magPagesPos=[];var h=this.pages&&this.pages.length;if(_.each(this.pages,_.bind(function(t,e){var i=t.onResize({absolutePosition:this.magHeight}),n=0;(e<h-1||this.finalPage)&&this.viewOpts.slidein&&(n=this.SCROLL_SNAP),this.magPagesPos[t.num]={y:this.magHeight,h:i,dh:n},this.magHeight+=i+n},this)),this.finalPage&&(this.isStickyVerticalViewer&&this.finalPage.setSizeAndPosForStickyVersion({absolutePosition:this.magHeight}),this.magHeight+=this.finalPage.getHeight()),"vertical"==this.viewOpts.viewertype&&this.magHeight){var d=this.$magScrollSizer.width(),u=0;if(this.isPreview&&"default"!=this.viewport&&(u=Math.max(this.$el.height()-this.getViewportSetting("min_height"),0)),this.$magScrollSizer.css("height",this.magHeight+u),d!=this.$magScrollSizer.width()&&Modernizr.isdesktop&&this.onResize(),this.currentPage)if(this.isStickyVerticalViewer){if(o){var p=this.getScrollPosForNewSize();setTimeout(_.bind(function(){this.$magScrollContainer.scrollTop(p)},this),0)}}else this.$magScrollContainer.scrollTop(this.getScrollPosForNewSize()),this.onMagScroll();this.$bottomArrow&&this.$bottomArrow.toggleClass("offscreen",this.$magScrollContainer.scrollTop()+r.height+this.SCROLLABLE_TRESHOLD>this.magHeight)}if("horizontal"==this.viewOpts.viewertype&&this.currentPage&&o){var p=this.getScrollPosForNewSize();setTimeout(_.bind(function(){this.currentPage.$scrollWrapper.scrollTop(p)},this),0)}this.currentPage&&this.loadPages.__debounced()},getScrollPosForNewSize:function(){return this.currentPage?"vertical"==this.viewOpts.viewertype?this.magPagesPos[this.currentPage.num].y+(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:0},setNewPagesWidths:function(t,e){var i=this.$el.find("#page-position-style"),n=Modernizr.isdesktop?"":" translateZ(0)",s="\t\t\t\t\t.mag .mag-pages-container .container {\n\t\t\t\t\t\tleft: 0px;\n\t\t\t\t\t\twidth: "+t+"px;\n\t\t\t\t\t}\n\t\t\t\t\t.mag .mag-pages-container .container .page {\n\t\t\t\t\t\tleft: 0px;\n\t\t\t\t\t\twidth: "+t+"px;\n\t\t\t\t\t}\n\t\t\t\t\t.mag .mag-pages-container .container .final-page {\n\t\t\t\t\t\tleft: 0px;\n\t\t\t\t\t\twidth: "+t+"px;\n\t\t\t\t\t}\n",r="";if("horizontal"==this.viewOpts.viewertype)r="\t\t\t\t\t\t.mag .mag-pages-container .container .final-page.offscreen {\n\t\t\t\t\t\t\t-webkit-transform: translateX("+t+"px) "+n+";\n\t\t\t\t\t\t\ttransform: translateX("+t+"px) "+n+";\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.mag .mag-pages-container .container .page.prev-page {\n\t\t\t\t\t\t\t-webkit-transform: translateX("+(this.viewOpts.slidein?0:-t)+"px) "+n+";\n\t\t\t\t\t\t\ttransform: translateX("+(this.viewOpts.slidein?0:-t)+"px) "+n+";\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.mag .mag-pages-container .container .page.center-page {\n\t\t\t\t\t\t\t-webkit-transform: translateX(0) "+n+";\n\t\t\t\t\t\t\ttransform: translateX(0) "+n+";\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.mag .mag-pages-container .container .page.next-page {\n\t\t\t\t\t\t\t-webkit-transform: translateX("+t+"px) "+n+";\n\t\t\t\t\t\t\ttransform: translateX("+t+"px) "+n+";\n\t\t\t\t\t\t}";else if(this.isStickyVerticalViewer){var a=this.getContainerSizeCached().height;r="\t\t\t\t\t\t\t.mag .mag-pages-container .container .page .page-fixed-bg-container,\t\t\t\t\t\t\t.mag .mag-pages-container .container .page .fixed-position-container,\t\t\t\t\t\t\t.mag .mag-pages-container .container .page .fixed-position-container-top {\t\t\t\t\t\t\t\theight: "+a+"px;\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.mag .mag-pages-container .container .page .fixed-position-container,\t\t\t\t\t\t\t.mag .mag-pages-container .container .page .fixed-position-container-top,\t\t\t\t\t\t\t.mag .mag-pages-container .container .page:not(.hide-sticky) .content-scroll-wrapper {\t\t\t\t\t\t\t\tmargin-top: "+-a+"px;\t\t\t\t\t\t\t}\n"}else r="\t\t\t\t\t\t\t.mag .mag-pages-container .container .final-page {\n\t\t\t\t\t\t\t\ttop: "+(e+1)+"px;\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.mag .mag-pages-container .container .page.prev-page {\n\t\t\t\t\t\t\t\ttop: "+(-e-1)+"px;\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.mag .mag-pages-container .container .page.next-page {\n\t\t\t\t\t\t\t\ttop: "+(e+1)+"px;\t\t\t\t\t\t\t}\n";i.length||(i=$('<style id="page-position-style" type="text/css">'),i.appendTo(this.$el)),"horizontal"==this.viewOpts.viewertype?(this.$pages_container.addClass("disable-transitions-on-resize"),i.text(s+r),this.$pages_container.height(),this.$pages_container.removeClass("disable-transitions-on-resize")):i.text(s+r)},setPagesTransitions:function(){var t=this.$el.find("#page-transition-style"),e=this.getPageTransitionTime(),i="cubic-bezier(0.40, 0.24, 0.40, 1)",n="\t\t\t\t\t.mag .mag-pages-container .container .page {\n\t\t\t\t\t\t-webkit-transition:\tall "+e+"ms "+i+";\t\t\t\t\t\ttransition: all "+e+"ms "+i+";\t\t\t\t\t}\n\t\t\t\t\t.mag .mag-pages-container .container .page.center-page {\n\t\t\t\t\t\t-webkit-transition:\tall "+(e-5)+"ms "+i+";\t\t\t\t\t\ttransition: all "+(e-5)+"ms "+i+";\t\t\t\t\t}\n\t\t\t\t\t.mag .mag-pages-container .container .final-page {\n\t\t\t\t\t\t-webkit-transition:\tall "+e+"ms "+i+";\t\t\t\t\t\ttransition: all "+e+"ms "+i+";\t\t\t\t\t}\n\t\t\t\t\t";t.length||(t=$('<style id="page-transition-style" type="text/css">'),t.appendTo(this.$el)),t.text(n)},switchToViewport:function(t){if(this.viewport!=t){var e=this.viewport;this.viewport=t,this.trigger("change:viewport",{viewport:this.viewport,oldViewport:e}),_.each(this.pages,function(t){t.updateViewport()})}},getContainerSize:function(){function e(){return window.innerHeight>window.innerWidth?Math.max(window.innerHeight,screen.height-20-20+1):screen.width}var i,n;return this.isPreview&&"default"!=this.viewport?(i=this.getViewportSetting("width"),n=Math.min(this.getViewportSetting("min_height"),this.$el.height())):(i=t.screenshot?$(window).width():this.$el.width(),n=t.screenshot?window.innerHeight:this.isStickyVerticalViewer?e():this.$el.height()),this.containerSize={width:i,height:n},this.containerSize},getContainerSizeCached:function(){return this.containerSize||this.getContainerSize()},getMagViewport:function(){if(this.isPreview)return this.constructorViewport||"default";var e="default";if(!Modernizr.isdesktop){var i=this.$el.width(),n=_.reduce(t.viewports,function(e,n,s){return Math.abs(n.width-i)<=Math.abs(t.viewports[e].width-i)?s:e},0);e=t.viewports[n].name}return e},getViewportSetting:function(e,i){i=i||this.viewport;var n=_.findWhere(t.viewports,{name:i})||{};return n[e]},log:function(){for(var t="",e=0;e<arguments.length;e++)t+=arguments[e]+" ";var i=$("#log");i.length||(i=$('<div id="log">').css({position:"fixed",background:"rgba(0, 0, 0, 0.7)",color:"#fff",width:200,height:300,left:10,top:10,"z-index":999999,overflow:"auto"}).appendTo("body"));var n=i.html(),s=n.split("<br>");i.html(s.slice(-17).join("<br/>")+"<br/>"+t),i.scrollTop(999999)},fixFocusScroll:function(){this.$mag_container.scrollTop(0),this.$mag_container.scrollLeft(0)},matchSameDomainLink:function(e){var i=e.match(new RegExp("//"+t.utils.escapeSpecial(window.location.hostname)+"/(.*)")),n=i&&i[1];if(n){var s=this.getPage(n);if(s)return s._id}return e}})}(RM),function(t,e){"use strict";t.classes.ViewerRouter=Backbone.Router.extend({routes:{":user(/)(:mag)(/)(:pagenum)(/)":"start"},mags:{},initialize:function(){this.route(/^(\d+)\/*(\d*)\/*$/,"start"),t.common.isDomainViewer&&this.route("(:mag)(/)(:pagenum)(/)","start"),t.common.isDownloadedSource&&(this.route("(:pagenum)","start"),/msie [6-9]/i.test(navigator.userAgent)&&(location.href="sorry.html")),$("html").toggleClass("viewer-embed-mode",!!t.common.embedMode),_.bindAll(this),this.started=!1,!t.common.isDownloadedSource&&t.data.usersLoader.me&&(this.me=t.data.usersLoader.me),this.$mags_container=$("#mags"),this.on("route",this.onRoute),this.magsData=window.ServerData.mags,this.internalHistory=[],window.ServerData&&_.each(window.ServerData.mags,_.bind(function(e,i){e&&e.user&&e.user._id&&(this.cachedMag=e,t.common.isDownloadedSource||(e.user.isMe=this.me&&this.me.get("_id")==e.user._id),t.common.isDomainViewer&&(this.magUri=e.uri,this.userUri=e.user&&e.user.uri))},this)),t.screenshot||(t.analytics=t.analytics||new t.classes.Analytics({router:this}),this.analytics=t.analytics),!t.common.isDomainViewer&&this.cachedMag&&this.route(/^gift(\/.*?)?$/,function(){return this.noUrlRewrite=!0,this.start(this.cachedMag.num_id)}.bind(this)),this.isPreview||window.sessionStorage.removeItem("constructorViewport")},start:function(e,i,n){if(t.common.isDomainViewer&&(this.magsData.magNotFound||this.magsData.domainNotFound||this.magsData.magNotPublished||this.magsData.subscriptionExpired)){var s=new t.classes.ServicePage({type:"domain-error",$container:$("#service-pages"),templateData:{state:this.magsData}});return void s.render()}if(t.common.isDomainViewer&&!t.common.customDomainProfile)parseInt(e,10)!=e&&e&&/^p\d+\/?$/i.test(e)?(n=null,i=e,e=null):(n=e,e=this.userUri,i=this.magUri);else if(t.common.isDownloadedSource)n=e,e=null,i=null;else if(parseInt(e,10)==e||/^p\d+\/?$/i.test(e)){var r=i;i=e,n=r,e=null}else if(t.common.customDomainProfile){var r=i;i=e,n=r,e=this.userUri}else if(!i)return this.notFound();this.latestFragment=Backbone.history.getFragment(),n=n||1;var a=e+"_"+i;if(this.username=e,this.started!=a||this.loaded==a){if(this.started=a,this.loaded==this.started)return void this.go(n,{animation:!1});if(this.cachedMag)return this.cachedMag instanceof t.classes.Mag||this.cachedMag.forbidden||this.cachedMag.is_suspended||(this.cachedMag=new t.classes.Mag(this.cachedMag,this)),this.mag=this.cachedMag,void this.onLoadMag(n);this._loadingMagDataXHR&&this._loadingMagDataXHR.abort(),this._loadingMagDataXHR=this.fetchData(this.username,i,{success:_.bind(function(e){this.mag&&this.mag.num_id&&e&&e.num_id!=this.mag.num_id&&window.location.reload(),this.mag=new t.classes.Mag(e,this),this.cachedMag=this.mag,this.onLoadMag(n)},this),error:this.notFound})}},onLoadMag:function(e){var i;return this.loaded=this.started||!0,this.mag.forbidden?(this.requestMagPassword(this.latestFragment,_.clone(this.mag)),delete this.cachedMag,delete this.loaded,void delete this.started):this.mag.is_suspended?void this.showSuspended():(t.common.isDownloadedSource||($.post("/api/countview/"+this.mag.num_id),t.analytics&&(t.analytics._triggerProjectView=!0)),this.mag._requested_page?(i=this.mag._requested_page,delete this.mag._requested_page):i=e,Modernizr.addTest("screenshot-mode",function(){return t.screenshot}),this.mag.render(),this.go(i,{animation:!1}),t.common.mode="mag",void(this.analytics&&this.analytics.switchOn()))},getAnalyticsDimensions:function(){return{magId:this.mag&&this.mag.model&&this.mag.model.get("num_id")||this.mag&&this.mag.num_id,magCreatorId:this.mag&&this.mag.model&&this.mag.model.user.get("_id")||this.mag&&this.mag.user._id,pageType:"viewer",userId:this.me&&this.me.get("_id")}},fetchData:function(t,e,i){var i=i||{};return t?i.url="/api/readymag/"+t+"/"+e:i.url="/api/readymag/"+e,$.ajax(i)},sendReadyEvent:function(t){t=t||{},t=_.defaults(t,{page:{}});var e=document.createElement("MyExtensionDataElement");e.setAttribute("width",t.page.width),e.setAttribute("height",t.page.height),e.setAttribute("_id",t.page._id),document.documentElement.appendChild(e);var i=document.createEvent("Events");t&&t.error?i.initEvent("MyErrorEvent",!0,!1):i.initEvent("MyExtensionEvent",!0,!1),e.dispatchEvent(i)},setTitle:function(){if(this.mag&&this.mag.currentPage){var e=_.extend({},this.mag.model.toJSON());e.user=this.mag.user,document.title=t.shareutils.getFinalSEO(this.mag.currentPage,e,{customDomain:!!t.common.isDomainViewer}).title}},trackPage:function(){t.screenshot||_.defer(_.bind(function(){this.analytics&&this.analytics.trackPage()},this))},go:function(t,e){t=t||1,this.mag.showPage(t,e)},setUrlString:function(e){if(!this.noUrlRewrite&&(e=e||{},!t.screenshot)){var i,n=this.mag.currentPage;if(i=t.common.isDomainViewer&&!t.common.customDomainProfile||t.common.isDownloadedSource?"":t.common.customDomainProfile?this.getMagUri(this.mag):this.username?this.mag.user.uri+"/"+(this.mag.uri||this.mag.num_id)+"/":this.isPreview?this.mag.num_id+"/":this.getMagUri(this.mag),this.isPreview&&(i+="preview/"),n&&"1"!=n.num&&(i+=(n.uri||n.num.toString())+"/"),this.internalHistory.push(i),i!==Backbone.history.getFragment()){var s=parseInt(_.last(Backbone.history.getFragment(),"/"))||1,r=s==n.num||e.replace;this.navigate(i,{replace:r})}}},getPreviousFragment:function(){return this.internalHistory[this.internalHistory.length-2]},getMagUri:function(e){return t.common.customDomainProfile?(e.uri||e.num_id)+"/":t.common.isDomainViewer?"":_.isEmpty(e.user)?e.num_id+"/":e.user.uri+"/"+(e.uri||e.num_id)+"/"},onError:function(){console.error("Navigation error! page not found: "+Backbone.history.getFragment()),this.mag&&this.go(1,{animation:!1})},createLoginViewForIframe:function(e,i,n){new t.classes.Login({useNavigate:!1,$node:$(e),router:this,joinCallback:i,errorMessages:n}).render()},createGiftViewForIframe:function(e){new t.classes.GiftView({el:$(e.node),stripe:e.stripe,Pikaday:e.Pikaday,router:this}).render()},createMagFromTemplate:function(e,i){new t.classes.CreateMag({router:this,me:this.me,tp:e,templateID:i})},destroy:function(){this.cachedMag&&this.cachedMag.destroy(),this.magPasswordView&&this.magPasswordView.remove(),this.magSuspendedView&&this.magSuspendedView.remove()},requestMagPassword:function(e,i){this.magPasswordView||(this.magPasswordView=new t.classes.MagPassword({router:this,$parent:$("#mags")})),this.magPasswordView.render({mag:i,mag_url:e})},showSuspended:function(){var e=new t.classes.ServicePage({type:"mag-suspended",$container:$("#service-pages")});e.render()},notFound:function(){_.defer(function(){var e=new t.classes.ServicePage({
type:"404",$container:$("#service-pages")});e.render()})}})}(RM),function(t,e){"use strict";t.classes.Animations=Backbone.View.extend({initialize:function(e){_.bindAll(this),_.extend(this,e);var n={};_.each(this.widgets,_.bind(function(e){e.animation&&e.animation.type&&"none"!=e.animation.type&&!_.isEmpty(e.animation.steps)&&((e.fixed_position||e.is_full_width||e.sticked)&&(e.animation.UUID=t.utils.generateUUID()),n[e.animation.UUID]=n[e.animation.UUID]||[],n[e.animation.UUID].push(e))},this)),this.animations=[],_.each(n,_.bind(function(t){var e=t[0].animation.type;this.page.mag;if(Modernizr.isdesktop||"hover"!=e){var n=new i[e]({page:this.page,widgets:t});this.animations.push(n)}},this))},start:function(){_.each(this.animations,function(t){t.start()})},stop:function(){_.each(this.animations,function(t){t.stop()})},onScroll:function(t){t=t||{},(this.page.mag.currentPage==this.page||t.forceApply)&&_.each(this.animations,function(e){e.onScroll&&e.onScroll(t)})},onResize:function(){_.each(this.animations,function(t){t.onResize()})},updateTimelines:function(){_.each(this.animations,function(t){t.createAnimationTimeline()})},destroy:function(){_.each(this.animations,function(t){t.destroy()}),delete this.animations}});var i={},n=Backbone.View.extend({className:"animation-container",initialize:function(t){_.bindAll(this),_.extend(this,t),_.each(this.widgets,_.bind(function(t){t.animationObj=this},this)),this.isFixed=this.widgets[0].fixed_position,this.isFullwidth=this.widgets[0].is_full_width,this.isSticked=this.widgets[0].sticked,this.$container=this.isFixed?this.widgets[0].$fixedContainer:this.page.$content,this.$el.appendTo(this.$container),this.createAnimationTimeline(),this.onResize({updateAll:!0})},createAnimationTimeline:function(){this.timeline&&this.timeline.destroy(),this.animation=t.animationutils.getNormalizedAnimation(this.widgets[0].animation,this.isFixed,this.isFullwidth,this.page.scale);var e,i=!0;if(Modernizr.isdesktop)for(e=0;e<this.animation.steps.length;e++){var n=this.animation.steps[e];if(n.use_scale&&(0==e&&n.from_scale>100||n.scale>100)){i=!1;break}}this.timeline=t.animationutils.createAnimationTimeline({el:this.$el,steps:this.animation.steps,type:this.animation.type,force3d:i,loop:!!this.animation.loop,screenshotMode:!!t.screenshot})},start:function(){this.timeline&&this.paused&&(this.paused=!1,this.timeline.resume())},stop:function(){this.timeline&&this.timeline.active&&(this.paused=!0,this.timeline.pause())},getAnimationContainer:function(){return this.$el},modifyWidgetPosition:function(t){return this.isFixed?(t.dimensions.left="50%",t.dimensions.top="50%",t.dimensions.right="",t.dimensions.bottom="",t.dimensions["margin-left"]=-t.dimensions.width/2,t.dimensions["margin-top"]=-t.dimensions.height/2):(t.dimensions.left-=this.bbox_css.left,t.dimensions.top-=this.bbox_css.top),t},onResize:function(t){if(t=t||{},t.updateAll||this.isFixed&&this.prevPageScale!=this.page.scale||this.isFullwidth||this.isSticked){var e,i={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY,z:0};this.isFixed||this.isFullwidth||this.isSticked?this.bbox_css=this.widgets[0].calcBoxStyle({calcBBox:!0}).dimensions:(_.each(this.widgets,function(t){e=t.calcBoxStyle({calcBBox:!0}).dimensions,i.t=Math.min(i.t,e.top),i.l=Math.min(i.l,e.left),i.b=Math.max(i.b,e.top+e.height),i.r=Math.max(i.r,e.left+e.width),i.z=Math.max(i.z,e["z-index"])},this),this.bbox_css={left:i.l,top:i.t,width:i.r-i.l,height:i.b-i.t,"z-index":i.z}),this.$el.css(this.bbox_css)}this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.prevPageScale=this.page.scale},destroy:function(){this.stop(),this.timeline&&this.timeline.destroy(),this.remove()}});i.scroll=n.extend({onScroll:function(t){if(t=t||{},this.timeline&&(this.page.mag.currentPage==this.page||t.forceApply)){var e=Math.max(0,this.page.visibleWidgetsCoords.scrollTop||0);if(this.isFixed)return void this.timeline.seek(e);var i={top:1,center:.5,bottom:0},n=this.bbox_css.top+this.innerContentTop,s=n-this.innerContainerHeight,r=i[this.animation.steps[0].start_point||"bottom"],a=r*(n-s)+s+this.animation.steps[0].start_offset||0;a<=0?this.timeline.seek(e/this.page.scale):this.timeline.seek(Math.max(0,e-a*this.page.scale)/this.page.scale)}},onResize:function(){n.prototype.onResize.apply(this,arguments),this.onScroll()}}),i.load=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),t.screenshot||this.page.on("loadAnimationsReady",this.onLoadAnimationsReady)},start:function(){t.utils.PageVisibilityManager.isPageHidden()||(n.prototype.start.apply(this,arguments),this.checkStartOnLoad())},onLoadAnimationsReady:function(){this.loadAnimationsReady=!0,setTimeout(this.checkStartOnLoad,Modernizr.safari?1200:700)},checkStartOnLoad:function(){t.screenshot||this.timeline&&this.page.started&&this.loadAnimationsReady&&!this.startedOnLoad&&(this.timeline.play(),Modernizr.isdesktop&&Modernizr.safari&&(this.timeline.pause(),setTimeout(this.timeline.resume,17)),this.startedOnLoad=!0)}}),i.click=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),this.waitingForEnd=!1,this.lastTimeClick=0,this.$el.on("click",this.onClick),this.$el.css("cursor","pointer")},onClick:function(){if(this.timeline&&!(+new Date-this.lastTimeClick<300)){this.lastTimeClick=+new Date;var t=this.timeline;t.active?(this.waitingForEnd?t.off("full-cycle-end",this.onCycleEnd):t.on("full-cycle-end",this.onCycleEnd),this.waitingForEnd=!this.waitingForEnd):(this.waitingForEnd=!1,t.reversed?t.reverse():t.play())}},onCycleEnd:function(){var t=this.timeline;t.off("full-cycle-end",this.onCycleEnd),this.waitingForEnd=!1,t.loop?t.stop():t.reversed?t.reverse():t.play()},destroy:function(){this.$el.css("cursor",""),n.prototype.destroy.apply(this,arguments)}}),i.hover=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),_.each(this.widgets,_.bind(function(t){["text","shape","picture","button"].indexOf(t.type)!=-1&&(t.hasHoverAnimation=!0)},this)),this.$el.on("mouseenter",this.onMouseEnter),this.$el.on("mouseleave",this.onMouseLeave)},onMouseEnter:function(t){if(this.timeline){var e=this.timeline;e.active?!e.loop&&e.reversed?e.on("full-cycle-end",this.onCycleEnd):e.off("full-cycle-end",this.onCycleEnd):!e.reversed&&e.play()}},onMouseLeave:function(t){if(this.timeline){var e=this.timeline;e.active?!e.loop&&e.reversed?e.off("full-cycle-end",this.onCycleEnd):e.on("full-cycle-end",this.onCycleEnd):!e.loop&&e.reversed&&e.reverse()}},onCycleEnd:function(){var t=this.timeline;t.off("full-cycle-end",this.onCycleEnd),t.loop?t.stop():t.reversed?t.reverse():t.play()}})}(RM),window.iconSVGCache=[],function(t,e){"use strict";t.classes.ShapeSVG=function(){},t.classes.ShapeSVG.prototype={MAX_ICON_CACHE_SIZE:30,generateShapeSVG:function(t,e,i,n,s){function r(t,e,i,n,s,r,a){var o="mask_"+r,l="clip_"+r,c="",h=2;return s>0&&a>.99&&(h=1),c="<defs>",s>0&&(c+='<mask id="'+o+'">',"path"==t&&(c+='<path d="'+e.path+'" style="fill:white; stroke:black; stroke-width:'+s*h+'"/>'),"ellipse"==t&&(c+='<ellipse cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:white; stroke:black; stroke-width:'+s*h+'"/>'),c+="</mask>"),c+='<clippath id="'+l+'">',"path"==t&&(c+='<path d="'+e.path+'"/>'),"ellipse"==t&&(c+='<ellipse cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'"/>'),c+="</clippath>",c+="</defs>","path"==t&&(c+='<path mask="url(#'+o+')" d="'+e.path+'" style="fill:'+i+'; stroke:none; stroke-width:0; pointer-events: visiblePainted;"/>'),"ellipse"==t&&(c+='<ellipse mask="url(#'+o+')" cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:'+i+'; stroke:none; stroke-width:0; pointer-events: visiblePainted;"/>'),0==s?c:("path"==t&&(c+='<path clip-path="url(#'+l+')" d="'+e.path+'" style="fill:none; stroke:'+n+"; stroke-width:"+2*s+'; pointer-events: visiblePainted;"/>'),"ellipse"==t&&(c+='<ellipse clip-path="url(#'+l+')" cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:none; stroke:'+n+"; stroke-width:"+2*s+'; pointer-events: visiblePainted;"/>'),c)}function a(t,e,i,n){for(var s,r,a,o=2*Math.PI/t,l=Math.PI/2-(t%2==1?0:o/2),c=[],h=999999,u=-999999,p=999999,f=-999999,g=0;g<t;g++)s=l+g*o,r=.5+.5*Math.cos(s),a=.5-.5*Math.sin(s),c.push({x:r,y:a}),r<h&&(h=r),r>u&&(u=r),a<p&&(p=a),a>f&&(f=a);for(var g=0;g<t;g++)c[g].x=(c[g].x-h)*(e/(u-h)),c[g].y=(c[g].y-p)*(i/(f-p)),c[g].x=Math.round(c[g].x*d)/d,c[g].y=Math.round(c[g].y*d)/d;return c}function o(t){if(!t)return 99999;for(var e,i=99999,n=t.length,s=0;s<n;s++){var r=t[s].x-t[(s+1)%n].x,a=t[s].y-t[(s+1)%n].y;e=Math.sqrt(r*r+a*a),e<i&&(i=e),t[s].side=e}return i}function l(t,e,i,n,s,r){if(!t)return{};if(e<=1e-4)return{};var a=[],o=t.length;e=Math.min(e,i/2);for(var l=0;l<o;l++){var c,h,u,p,f=t[l],g=t[(l+1)%o],m=t[l].side,v=(g.x-f.x)/m,_=(g.y-f.y)/m;c=f.x+v*e,h=f.y+_*e,u=g.x-v*e,p=g.y-_*e,c=Math.round(c*d)/d,h=Math.round(h*d)/d,u=Math.round(u*d)/d,p=Math.round(p*d)/d,a.push({x:c,y:h}),a.push({x:u,y:p})}return{points:a,radius:e}}function c(t,e,i){if(!t)return"";for(var n=t.length,s="",r=0;r<n;r++){var a=2*r+1,o=(2*r+2)%(2*n);if(s+=0==r?"M":"L",e){s+=e[a].x+" "+e[a].y+" ";var l=e[a].x-e[o].x,c=e[a].y-e[o].y,h=(l*l+c*c)/4,d=1/h-1/(i*i),u=Math.sqrt(1/d);s+="A"+u+" "+u+" 0 0 0 "+e[o].x+" "+e[o].y+" "}else s+=t[r].x+" "+t[r].y+" "}return s+" Z "}var h,d=1e5,u=this.getRGBA(e.get("bg_color"),e.get("bg_opacity")),p=this.getRGBA(e.get("color"),e.get("opacity"));if(s="hotspot"===e.get("type")?s||e.get("pin_type"):s||e.get("tp"),"ellipse"==s){var f=i/2,g=n/2,m=e.get("borders"),m=Math.min(m,f,g);h=r("ellipse",{cx:f,cy:g,rx:f,ry:g},u,p,m,e.id+"_"+t,e.get("opacity"))}if("rectangle"==s||"polygon"==s){"hotspot"===e.get("type")&&(u="rgba(0, 0, 0, 0)",p=u);var v="rectangle"==s?4:e.get("sides"),m=e.get("borders"),_=e.get("radius")||0,y=a(v,i,n,m),w=o(y),b=l(y,_,w),x=c(y,b.points,b.radius);h=r("path",{path:x},u,p,m,e.id+"_"+t,e.get("opacity"))}if("line"==s){var m=e.get("weight"),g=Math.round(n/2)+(m%2==1?.5:0),x="",k=[13*m/3,2*m/3].join(" "),T=m>1?[.001,5*m/3].join(" "):[1,2].join(" "),S="dotted"==e.get("stroke")?m/2:0;if(x="M"+S+" "+g+" L"+i+" "+g,"solid"==e.get("stroke")&&(h='<path d="'+x+'" style="fill:none; stroke:'+u+";stroke-width:"+m+'"/>'),"double"==e.get("stroke")){var P="M"+S+" "+(g-m)+" L"+i+" "+(g-m),C="M"+S+" "+(g+m)+" L"+i+" "+(g+m);h='<path d="'+P+'" style="fill:none; stroke:'+u+";stroke-width:"+m+'"/>',h+='<path d="'+C+'" style="fill:none; stroke:'+u+";stroke-width:"+m+'"/>'}"dotted"==e.get("stroke")&&(h='<path d="'+x+'" stroke-linecap="round" stroke-dasharray="'+T+'" style=" fill:none; stroke:'+u+";stroke-width:"+m+'"/>'),"dashed"==e.get("stroke")&&(h='<path d="'+x+'" stroke-dasharray="'+k+'" style=" fill:none; stroke:'+u+";stroke-width:"+m+'"/>')}if("icon"==s){var M=this.iconData||this.current_icon_data;if(!M)return null;var I=M.$svg.clone();return I.css({width:"100%",height:"100%"}),u=this.getRGBA(e.get("bg_color"),1),I.find("*:not(.fixed-color)").each(function(){var t=$(this);t.css({fill:"","fill-opacity":""}),t.get(0).removeAttribute("fill"),t.get(0).removeAttribute("fill-opacity")}),I.get(0).setAttribute("fill",u),I.get(0).setAttribute("fill-opacity",e.get("bg_opacity")),I}return'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+i+'px" height="'+n+'px">'+h+"</svg>"},getRGBA:function(t,e){if(0==e)return"none";var i=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return e>.99?"rgb("+i[0]+","+i[1]+","+i[2]+")":"rgba("+i[0]+","+i[1]+","+i[2]+", "+e+")"}}}(RM),function(t,e){"use strict";t.classes.TextViewports=function(){},t.classes.TextViewports.prototype={text_viewport_attributes:["style","class","data-size-leading-linked","data-size-leading-ratio","data-anchor-link-pos"],switchTextToViewport:function(t,e){if(t=t||"","default"==e)return t;var i=$("<div>").html(t),n=this.text_viewport_attributes,s=this;i.find("*").each(function(){var t=$(this);_.each(n,function(i){var n=s.getViewportAttributeName(i,e),r=s.getViewportAttributeName(i,"default"),a=t.attr(n),o=t.attr(i);t.removeAttr(r),o&&t.attr(r,o),a&&("empty"==a?t.removeAttr(i):t.attr(i,a))})});var r=i.html();return i.empty().remove(),r},getViewportAttributeName:function(t,e){var i=t+"-"+e;return/^data/.test(i)||(i="data-"+i),i}}}(RM),function(t,e){"use strict";t.classes.AudioPlayer=Backbone.View.extend({initialize:function(t,e,s){_.bindAll(this),this.params=t,this.$container=e,this.readyCallback=s||function(){},!_(["standard","visual"]).contains(t.current_type)&&!Modernizr.opera||Modernizr.msie?this.player=new n(t,e,s,this):this.player=new i(t,e,s,this),this.render()},render:function(){this.player&&this.player.render()},show:function(){this.player&&this.player.show()},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},applyPlayerStyle:function(t){this.player&&this.player.applyPlayerStyle&&this.player.applyPlayerStyle(t)},destroy:function(){this.player&&(this.player.isDestroyed=!0,this.player&&this.player.destroy(),this.player=null)}});var i=Backbone.View.extend({initialize:function(e,i,n,s){_.bindAll(this),this.inner_template=t.templates["template-common-audio-player-standard"],this.parent=s,this.params=e,this.$container=i,this.readyCallback=n||function(){}},render:function(){var t=[];t.push("auto_play=false"),t.push("buying="+this.params.socials),t.push("liking="+this.params.socials),t.push("download="+this.params.socials),t.push("sharing="+this.params.socials),t.push("show_artwork="+this.params.artwork),t.push("show_comments="+this.params.comments),t.push("show_playcount="+this.params.playcount),t.push("color="+this.params.color),t.push("auto_advance=true"),t.push("show_user=true"),"visual"==this.params.current_type&&t.push("visual=true"),this.params.parsed_url=this.params.parsed_url.replace(/^http:/,"https:");var e=this.params.parsed_url+"&"+t.join("&");this.setElement($(this.inner_template({src:e}))),this.$container.append(this.$el),this.player=SC.Widget(this.$el[0]),this.player.bind("ready",_.bind(function(){setTimeout(_.bind(function(){this.readyCallback(this.parent)},this),500)},this)),setTimeout(_.bind(function(){this.readyCallback(this.parent)},this),2e3)},show:function(){this.$el&&this.$el.css("opacity",1)},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},destroy:function(){this.player.unbind("ready"),this.$el&&this.$el.remove(),this.player=null}}),n=Backbone.View.extend({apiKey:t.constants.SOUNDCLOUD_API,defaultCover:"/img/common/audio-player/cover.png",initialize:function(e,i,n,s){_.bindAll(this),this.inner_template=t.templates["template-common-audio-player-minimal"],this.parent=s,this.params=e,this.$container=i,this.readyCallback=n||function(){},this.isHTHML5=this.html5AudioAvailable()},render:function(){this.setElement($(this.inner_template({src:this.params.url}))),this.$container.append(this.$el),this.applyPlayerStyle(this.params),this.isHTHML5?this.audioEngine=new s(this.$container,this):this.audioEngine=new r(this.$container,this),this.loadTracksData([{url:this.params.url}])},applyPlayerStyle:function(t){this.$el&&(this.$el.toggleClass("no-artwork",!t.artwork),this.$el.toggleClass("no-info",!t.info),this.$(".sc-info").css("color",t.artwork?"#fff":"#"+t.color),this.$(".sc-left").css("color","#"+t.color),this.$(".sc-button svg path").css("fill","#"+t.color))},tracksIsLoaded:function(e){if(this.tracks=null,this.audioEngine){var i=e.playerObj.tracks;if(!i.length)return this.$el.remove(),this.ready=!0,void this.readyCallback(this.parent);this.tracks=i,this.currentTrackNum=0,this.$el.removeClass("loading"),this.audioEngine.on("scPlayer:onAudioReady",this.onAudioReady).on("scPlayer:onMediaPlay",this.onMediaPlay).on("scPlayer:onMediaPause",this.onMediaPause).on("scPlayer:onMediaEnd",this.onMediaEnd).on("scPlayer:onMediaBuffering",this.onMediaBuffering),this.$elements={},this.$elements.scrubber=this.$(".sc-scrubber"),this.$elements.play_button=this.$(".sc-button"),this.$elements.play_wrapper=this.$(".sc-button-wrapper"),this.$elements.buffer=this.$(".sc-buffer"),this.$elements.played=this.$(".sc-played"),this.$elements.time=this.$(".sc-left");var n=this.updateTrackInfo(this.currentTrackNum);if(this.$elements.play_button.on("click",this.onPlayClick),Modernizr.isdesktop&&(this.$elements.scrubber.on("mousemove",this.onScrubberMouseMove),this.$elements.scrubber.on("click",this.onScrubberClick)),this.$(".sc-artwork-list").on("click",this.onPlayClick),Modernizr.isdesktop&&this.$elements.play_button.RMDrag({move:this.moveHandleDrag,end:this.endHandleDrag,silent:!1,preventDefault:!0}),t.screenshot)var s=$("<img/>").load(_.bind(function(){setTimeout(_.bind(function(){this.ready=!0,!this.isDestroyed&&this.readyCallback(this.parent),s.remove()},this),100)},this)).attr("src",n);else this.ready=!0,this.readyCallback(this.parent)}},moveHandleDrag:function(t){this.playing&&this.pause(),this.isDragging=!0,this.$el.addClass("dragging"),this.scrub(t.pageX)},endHandleDrag:function(t){t.moved&&this.play(),this.$el.removeClass("dragging"),setTimeout(_.bind(function(){this.isDragging=!1},this),0)},onScrubberMouseMove:function(t){var e=$(t.currentTarget),i=e.find(".sc-hover-indicator"),n=t.pageX-e.offset().left;i.css("left",n+"px")},onScrubberClick:function(t){return this.playing||this.play(),this.scrub(t.pageX),!1},onPlayClick:function(t){if(!this.isDragging)return this.playing?this.pause():this.play(),t.stopPropagation(),!1},onAudioReady:function(){this.audioEngine&&this.audioEngine.play(),this.audioEngine&&this.audioEngine.setVolume(100)},onMediaPlay:function(){this.$el.addClass("playing"),this.playing=!0,clearInterval(this.positionPoll),this.positionPoll=setInterval(this.updatePlayState,500)},onMediaPause:function(){this.$el.removeClass("playing"),this.playing=!1,clearInterval(this.positionPoll),this.positionPoll=null},onMediaEnd:function(){this.$elements.played.css("width","0%"),this.$elements.play_button.css("left","0%"),this.$el.removeClass("playing"),this.playing=!1,this.audioEngine&&this.audioEngine.stop();var t=(this.currentTrackNum+1)%this.tracks.length;this.play(t),0==t&&(this.pause(),this.updateTrackInfo(0))},onMediaBuffering:function(t){this.$elements.buffer.css("width",t+"%")},play:function(t){if(this.tracks&&(t==e&&(t=this.currentTrackNum),this.audioEngine&&(!this.playing||t!=this.currentTrackNum))){var i=this.tracks[t];this.$el.addClass("playing"),this.playing=!0,t==this.currentTrackNum&&this.audioEngine.firstLoad?this.audioEngine&&this.audioEngine.play():(this.updateTrackInfo(t),this.currentTrackNum=t,this.audioEngine&&this.audioEngine.load(i,this.apiKey))}},pause:function(){this.audioEngine&&this.playing&&(this.$el.removeClass("playing"),this.playing=!1,this.audioEngine&&this.audioEngine.pause())},scrub:function(t){if(this.audioEngine){var e=(t-this.$elements.play_wrapper.offset().left-this.$elements.play_button.width()/2)/this.$elements.play_wrapper.width(),e=Math.min(Math.max(Math.min(e,.999),0),this.$elements.buffer.width()/this.$elements.scrubber.width());this.$elements.play_button.css("left",Math.floor(this.$elements.play_wrapper.width()*e)+"px"),this.audioEngine&&this.audioEngine.seek(e)}},updatePlayState:function(){if(this.audioEngine){var t=this.audioEngine.getDuration(),e=this.audioEngine.getPosition(),i=e/t;this.$elements.played.css("width",100*i+"%"),this.$elements.play_button.css("left",Math.floor(this.$elements.play_wrapper.width()*i)+"px"),t&&this.$elements.time.html(this.timecode(t-e))}},updateTrackInfo:function(t){if(this.tracks){var e=this.tracks[t];this.$(".sc-info h3").html('<a target="_blank" href="'+e.permalink_url+'">'+e.title+"</a>"),this.$(".sc-info h4").html('by <a target="_blank" href="'+e.user.permalink_url+'">'+e.user.username+"</a>");var i;i=e.artwork_url?e.artwork_url.replace("-large","-t300x300"):e.user&&e.user.avatar_url?e.user.avatar_url.replace("-large","-t300x300"):this.defaultCover,this.$(".sc-artwork-list .sc-loaded-artwork").css("background-image",'url("'+i+'")'),this.$elements.time.html(this.timecode(e.duration));var n=(t+1)%this.tracks.length,s=(t-1+this.tracks.length)%this.tracks.length,r=this.tracks[n],a=this.tracks[s];return!r.preload&&r.artwork_url&&(r.preload=new Image,r.preload.src=r.artwork_url.replace("-large","-t300x300")),!a.preload&&a.artwork_url&&(a.preload=new Image,a.preload.src=a.artwork_url.replace("-large","-t300x300")),i}},loadTracksData:function(t){var e=0,i={tracks:[]},n=this,s=function(r){if(!n.isDestroyed){var a=n.scApiUrl(r.url);$.getJSON(a,function(o){n.isDestroyed||(e+=1,o.tracks?i.tracks=i.tracks.concat(o.tracks):o.duration?(o.permalink_url=r.url,i.tracks.push(o)):o.creator?t.push({url:o.uri+"/tracks"}):o.username?/favorites/.test(r.url)?t.push({url:o.uri+"/favorites"}):t.push({url:o.uri+"/tracks"}):$.isArray(o)&&(i.tracks=i.tracks.concat(o)),t[e]?s(t[e]):n.tracksIsLoaded({playerObj:i,url:a}))}).fail(function(){!n.isDestroyed&&n.readyCallback(n.parent)})}};s(t[e])},scApiUrl:function(t){var e="https:"===document.location.protocol,i=(e||/^https/i.test(t)?"https":"http")+"://api.soundcloud.com/resolve?url=",n="format=json&client_id="+this.apiKey+"&callback=?";return e&&(t=t.replace(/^http:/,"https:")),/api\./.test(t)?t+"?"+n:i+t+"&"+n},html5AudioAvailable:function(){var t=!1;try{var e=new Audio;t=e.canPlayType&&/maybe|probably/.test(e.canPlayType("audio/mpeg"))}catch(t){}return t},timecode:function(t){var e={h:Math.floor(t/36e5),m:Math.floor(t/6e4%60),s:Math.floor(t/1e3%60)},i=[];return e.h>0&&i.push(e.h),i.push(e.m<10&&e.h>0?"0"+e.m:e.m),i.push(e.s<10?"0"+e.s:e.s),i.join(":")},show:function(){this.$el&&this.$el.css("opacity",1)},destroy:function(){this.pause(),this.audioEngine&&this.audioEngine.off(),this.audioEngine&&this.audioEngine.destroy(),this.audioEngine=null,this.$el&&this.$el.remove()}}),s=Backbone.View.extend({initialize:function(e,i){_.bindAll(this),this.inner_template=t.templates["template-common-audio-player-engine-html5"],this.parent=i,this.$container=e,this.firstLoad=!1;var n=this;this.callbacks={onReady:function(){n.player&&n.trigger("scPlayer:onAudioReady")},onPlay:function(){n.player&&n.trigger("scPlayer:onMediaPlay")},onPause:function(){n.player&&n.trigger("scPlayer:onMediaPause")},onEnd:function(){n.player&&n.trigger("scPlayer:onMediaEnd")},onBuffer:function(t){n.player&&n.trigger("scPlayer:onMediaBuffering",t)}},this.render()},render:function(){this.setElement($(this.inner_template({}))),this.$container.append(this.$el),this.player=this.$el.find("audio")[0],this.player.addEventListener("play",this.callbacks.onPlay,!1),this.player.addEventListener("pause",this.callbacks.onPause,!1),this.player.addEventListener("timeupdate",this.onTimeUpdate,!1),this.player.addEventListener("progress",this.onProgress,!1)},onTimeUpdate:function(t){if(this.player){var e=(this.player.buffered.length&&this.player.buffered.end(0))/this.player.duration*100;this.callbacks.onBuffer(e),this.player.currentTime===this.player.duration&&this.callbacks.onEnd()}},onProgress:function(t){if(this.player){var e=(this.player.buffered.length&&this.player.buffered.end(0))/this.player.duration*100;this.callbacks.onBuffer(e)}},load:function(t,e){this.player&&(this.firstLoad=!0,this.player.pause(),this.player.src=t.stream_url+(/\?/.test(t.stream_url)?"&":"?")+"client_id="+e,this.player.load(),this.player.play())},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},stop:function(){this.player&&this.player.currentTime&&(this.player.currentTime=0,this.player.pause())},seek:function(t){if(this.player&&this.player.src)try{this.player.currentTime=this.player.duration*t}catch(t){}},getDuration:function(){return this.player?1e3*this.player.duration:0},getPosition:function(){return this.player?1e3*this.player.currentTime:0},setVolume:function(t){this.player&&(this.player.volume=t/100)},destroy:function(){this.$el.remove(),this.player=null}}),r=Backbone.View.extend({initialize:function(e,i){_.bindAll(this),this.inner_template_flash=t.templates["template-common-audio-player-engine-flash"],this.inner_template_flash_ie=t.templates["template-common-audio-player-engine-flash-ie"],this.parent=i,this.$container=e,this.firstLoad=!1;var n=this;this.callbacks={onReady:function(){n.player&&n.trigger("scPlayer:onAudioReady")},onPlay:function(){n.player&&n.trigger("scPlayer:onMediaPlay")},onPause:function(){n.player&&n.trigger("scPlayer:onMediaPause")},onEnd:function(){n.player&&n.trigger("scPlayer:onMediaEnd")},onBuffer:function(t){n.player&&n.trigger("scPlayer:onMediaBuffering",t)}}},render:function(t){var e="soundcloud_"+this.parent.parent.params._id,i="https:"===document.location.protocol,n=(i?"https":"http")+"://player.soundcloud.com/player.swf?url="+t+"&amp;enable_api=true&amp;player_type=engine&amp;object_id="+e;Modernizr.msie?this.setElement($(this.inner_template_flash_ie({id:e,swf:n}))):this.setElement($(this.inner_template_flash({id:e,swf:n}))),this.$container.append(this.$el),this.$el.find("object").on("soundcloud:onPlayerReady",_.bind(function(t,i){this.player=window.soundcloud.getPlayer(e),this.callbacks.onReady()},this)).on("soundcloud:onMediaBuffering",_.bind(function(t,e){this.callbacks.onBuffer(e.percent)},this)).on("soundcloud:onMediaEnd",this.callbacks.onEnd).on("soundcloud:onMediaPlay",this.callbacks.onPlay).on("soundcloud:onMediaPause",this.callbacks.onPause)},load:function(t){this.firstLoad?this.player&&this.player.api_load(t.uri):(this.firstLoad=!0,this.render(t.uri))},play:function(){this.player&&this.firstLoad&&this.player.api_play()},pause:function(){this.player&&this.firstLoad&&this.player.api_pause()},stop:function(){this.player&&this.firstLoad&&this.player.api_stop()},seek:function(t){this.player&&this.firstLoad&&this.player.api_seekTo(this.player.api_getTrackDuration()*t)},getDuration:function(){return this.player&&this.firstLoad&&this.player.api_getTrackDuration&&1e3*this.player.api_getTrackDuration()},getPosition:function(){return this.player&&this.firstLoad&&this.player.api_getTrackPosition&&1e3*this.player.api_getTrackPosition()},setVolume:function(t){this.player&&this.player.api_setVolume&&this.player.api_setVolume(t)},destroy:function(){this.player=null,this.$el&&this.$el.remove()}})}(RM),function(t,e){"use strict";t.classes.SlideshowPlayer=Backbone.View.extend({THUMBNAILS_HEIGHT:72,COUNTERS_HEIGHT:24,COUNTER_WIDTH:14,THUMBNAIL_WIDTH:56,THUMBNAIL_PADDING:8,THUMBNAILS_PADDING:16,AUTOPLAY_INTERVAL:4e3,swipeStartDistance:5,scrollStartDistance:3,swipeDistance:35,IMG_ACCELERATION_DELAY:500,PREDISPLAY_COUNT:{backward:1,forward:Modernizr.isdesktop?5:Modernizr.isphone?3:2},events:{"click .images .prev-picture-arrow-middle":"prevImage","click .images .next-picture-arrow-middle":"nextImage","click .images .prev-picture-arrow-bottom":"prevImage","click .images .next-picture-arrow-bottom":"nextImage","click .images .fullscreen":"toggleFullscreen","click .counters .counter":"counterClick","click .thumbnails .thumb":"thumbnailClick","click .images":"onImageClick","blur .captions .caption":"onCaptionBlur"},initialize:function(e,i,n,s,r){_.bindAll(this),this.template=t.templates["template-common-slideshow-player"],this.block=s,this.model=s&&s.model,this.params=e,this.$container=i,this.environment=n,this.preloadImagesList=[],this.mag=r,this.params.w=Math.ceil(this.params.w),this.handleCounters="constructor"==n||"theme_captions"==e.current_theme&&e.theme_data.counters,this.handleThumbnails="constructor"==n||"theme_classic"==e.current_theme&&e.theme_data.thumbnails,this.currentPic={$el:null,num:null},this.initialRender=!0,this.render(),this.applyVisualState(e),this.applyPictures(e),this.applyTextStyles(e);var a=this.params.pictures||[];if(this.handleCounters&&this.$counters_container.css("width",a.length*this.COUNTER_WIDTH),this.$counters_container.children(":first-child").addClass("active"),this.handleThumbnails&&this.$thumbnails_container.css("width",a.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.$thumbnails_container.children(":first-child").addClass("active"),this.recalcCounters(e),this.recalcThumbnails(e),this.moveToImage(this.currentImageID,!1,"change-pictures"),"viewer"===this.environment){var o=this.preloadImagesList.length;if(!o)return _.defer(_.bind(function(){this.trigger("ready")},this));var l=_.bind(function(){o--,o||this.isDestroyed||this.trigger("ready")},this);_.each(this.preloadImagesList,function(t){this.isDestroyed||(t.preload=new Image,$(t.preload).on("load",l).on("error",l),t.preload.src=t.url)},this)}this.$container.append(this.$el),this.initialRender=!1,this.handleCounters&&Modernizr.isdesktop&&(this.counters_scroll=this.$counters_scroll_wrapper.RMScroll({$container:this.$counters.find(".items-wrapper"),$content:this.$counters_container,$handle:this.$counters.find(".scroll"),wheelScrollSpeed:.1,scrollStep:14,tp:"horizontal",needRecalc:!1}).data("scroll")),this.handleThumbnails&&(Modernizr.isdesktop?this.thumbnails_scroll=this.$thumbnails_scroll_wrapper.RMScroll({$container:this.$thumbnails.find(".items-wrapper"),$content:this.$thumbnails_container,$handle:this.$thumbnails.find(".scroll"),wheelScrollSpeed:.3,onScroll:this.preloadThumbImages,tp:"horizontal",needRecalc:!1}).data("scroll"):this.$thumbnails.find(".items-wrapper").bind("scroll",this.preloadThumbImages)),this.setSwipeAction()},render:function(){this.setElement($(this.template({tp:this.environment}))),this.$el.attr("data-id",this.params._id),this.$images=this.$(".images"),this.$images_wrapper=this.$images.find(".images-wrapper"),this.$counters=this.$(".counters"),this.$counters_container=this.$counters.find(".items"),this.$counters_scroll_wrapper=this.$counters.find(".scroll-wrapper"),this.$thumbnails=this.$(".thumbnails"),this.$thumbnails_container=this.$thumbnails.find(".items"),this.$thumbnails_scroll_wrapper=this.$thumbnails.find(".scroll-wrapper"),this.$captions=this.$(".captions")},applyVisualState:function(t,e){if(t.theme_data){var i={w:e?e.w:t.w,h:e?e.h:t.h,images_h:e?e.images_h:t.images_h,captions_h:e?e.captions_h:t.captions_h,thumbnails_h:this.THUMBNAILS_HEIGHT,counters_h:this.COUNTERS_HEIGHT,theme:t.current_theme,thumbnails:t.theme_data.thumbnails,counters:t.theme_data.counters};i.showThumbnails="theme_classic"==i.theme&&i.thumbnails,i.showCounters="theme_captions"==i.theme&&i.counters,i.showCaptions="theme_captions"==i.theme,i.showFullscreen=t.theme_data.fullscreen,this.$images.css("height",i.images_h),this.$thumbnails.css({display:i.showThumbnails?"block":"none",height:i.thumbnails_h}),this.$counters.css({display:i.showCounters?"block":"none",height:i.counters_h}),this.$captions.css({display:i.showCaptions?"block":"none",height:i.captions_h}),this.$images.find(".fullscreen").toggle(i.showFullscreen),this.$images.find(".bottom-arrows").toggleClass("hidden","theme_classic"!==i.theme),this.$images.find(".prev-picture-arrow-middle").toggleClass("hidden","theme_captions"!==i.theme),this.$images.find(".next-picture-arrow-middle").toggleClass("hidden","theme_captions"!==i.theme);var n=t.theme_data,s=this.getRGBA(n.controls_color,n.controls_opacity),r=this.getRGBA(n.background_color,n.background_opacity);if(this.$("svg path").css("stroke",s),this.$("svg .fullscreen-path-1").css("fill",s),this.$(".counters-text").css("color",s),this.$images.css("background",r),this.$thumbnails.css("background",r),this.setNewPicsWidths(i.w),this.setPicsTransitions(),this.$images_wrapper.children(".image").each(_.bind(function(t,e){var s=$(e);s.css({"background-size":this.setImageSize(n.fill,s.attr("data-width"),s.attr("data-height"),i.w,i.images_h)})},this)),!this.initialRender){var a=t.pictures||[];this.handleCounters&&this.$counters_container.css("width",a.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",a.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(t,e),this.recalcThumbnails(t,e),
this.moveToImage(this.currentImageID,!1,"change-visual-style")}}},getRGBA:function(t,e){var i="",n=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return i=e>.99?"rgb("+n[0]+","+n[1]+","+n[2]+")":"rgba("+n[0]+","+n[1]+","+n[2]+", "+e+")"},getOriginalUrl:function(t){return t.rasterUrl||t.url},getScaledUrl:function(t){return Modernizr.retina?t.scaled2xUrl||t.rasterUrl||t.url:t.scaledUrl||t.rasterUrl||t.url},applyPictures:function(e){if(e.theme_data){var i=e.pictures||[];this.$el.toggleClass("no-images",!i.length),this.$images.find(".bottom-arrows").toggleClass("no-images",i.length<=1),this.$images.find(".prev-picture-arrow-middle").toggleClass("no-images",i.length<=1),this.$images.find(".next-picture-arrow-middle").toggleClass("no-images",i.length<=1),this.$images.find(".bottom-arrows .counters-text .counters-text-total").html(i.length),this.$images_wrapper.empty(),this.handleCounters&&this.$counters_container.empty(),this.handleThumbnails&&this.$thumbnails_container.empty(),i=_.sortBy(i,"num");for(var n=0;n<i.length;n++){var s,r=i[n];if(s=$("<div>").addClass("image").attr("data-id",r.id).toggleClass("error",!!r.error).css({"background-size":this.setImageSize(e.theme_data.fill,r.width,r.height,e.w,e.images_h)}).appendTo(this.$images_wrapper),"constructor"==this.environment&&s.css({"background-image":r.url?'url("'+this.getScaledUrl(r)+'")':"none"}),"viewer"==this.environment&&r.url&&(s.attr("data-src",this.getScaledUrl(r)),r.scaledUrl&&s.data("orig-src",this.getOriginalUrl(r))),r.url&&r.width&&r.height&&s.attr("data-width",r.width).attr("data-height",r.height),this.handleThumbnails&&(s=$("<div>").addClass("thumb").attr("data-id",r.id).toggleClass("error",!!r.error).css({left:(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)*n-this.THUMBNAIL_PADDING/2}).appendTo(this.$thumbnails_container),"constructor"==this.environment&&s.css({"background-image":r.thumbUrl?'url("'+r.thumbUrl+'")':"none"}),"viewer"==this.environment&&r.thumbUrl&&s.attr("data-src",r.thumbUrl)),this.handleCounters&&$("<div>").addClass("counter").attr("data-id",r.id).css({left:this.COUNTER_WIDTH*n}).appendTo(this.$counters_container),"theme_captions"==this.params.current_theme&&"viewer"==this.environment){var a=$("<div>").addClass("caption-wrapper").attr("data-id",r.id);$("<div>").addClass("caption").html(t.utils.plainTextToHtml(r.text,{detectLinks:!0})).appendTo(a),a.appendTo(this.$captions)}}this.$images_wrapper.children(":first-child").data("first-child",!0),this.$images_wrapper.children(":last-child").data("last-child",!0),this.updateCurrentImageID(e),this.initialRender||(this.handleCounters&&this.$counters_container.css("width",i.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",i.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(e),this.recalcThumbnails(e),this.moveToImage(this.currentImageID,!1,"change-pictures")),i.length||this.$images.find(".bottom-arrows .counters-text .counters-text-current").html(0)}},applyTextStyles:function(t){var e=_.omit(t.text_style,"size-leading-linked","size-leading-ratio");/px/i.test(e["font-size"])||(e["font-size"]+="px"),/px/i.test(e["letter-spacing"])||(e["letter-spacing"]+="px"),/px/i.test(e["line-height"])||(e["line-height"]+="px"),/#/i.test(e.color)||(e.color="#"+e.color),e.opacity/=100,this.$captions.find(".caption").css(e)},setNewPicsWidths:function(t){var e=this.$el.find("#slideshow-images-position-style-"+this.params._id),i=Modernizr.isdesktop?"":" translateZ(0)",n='\t\t\t\t\t.common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n\t\t\t\t\t\tleft: 0px;\n\t\t\t\t\t\twidth: '+t+'px;\n\t\t\t\t\t}\n\t\t\t\t\t.common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n\t\t\t\t\t\tleft: 0px;\n\t\t\t\t\t\twidth: '+t+'px;\n\t\t\t\t\t}\n\t\t\t\t\t.common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.prev-image {\n\t\t\t\t\t\t-webkit-transform: translateX('+-t+"px) "+i+";\n\t\t\t\t\t\ttransform: translateX("+-t+"px) "+i+';\n\t\t\t\t\t}\n\t\t\t\t\t.common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.center-image {\n\t\t\t\t\t\t-webkit-transform: translateX(0) '+i+";\n\t\t\t\t\t\ttransform: translateX(0) "+i+';\n\t\t\t\t\t}\n\t\t\t\t\t.common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.next-image {\n\t\t\t\t\t\t-webkit-transform: translateX('+t+"px) "+i+";\n\t\t\t\t\t\ttransform: translateX("+t+"px) "+i+";\n\t\t\t\t\t}\n\t\t\t\t\t";e.length||(e=$('<style id="slideshow-images-position-style-'+this.params._id+'" type="text/css">'),e.appendTo(this.$el)),e.text(n)},setPicsTransitions:function(){var t=this.$el.find("#slideshow-images-transition-style-"+this.params._id),e=this.getPicsTransitionTime(),i="cubic-bezier(0.40, 0.24, 0.40, 1)",n='\t\t\t\t\t.common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image {\n\t\t\t\t\t\t-webkit-transition:\tall '+e+"ms "+i+";\t\t\t\t\t\ttransition: all "+e+"ms "+i+';\t\t\t\t\t}\n\t\t\t\t\t.common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.center-image {\n\t\t\t\t\t\t-webkit-transition:\tall '+(e-5)+"ms "+i+";\t\t\t\t\t\ttransition: all "+(e-5)+"ms "+i+";\t\t\t\t\t}\n\t\t\t\t\t";t.length||(t=$('<style id="slideshow-images-transition-style-'+this.params._id+'" type="text/css">'),t.appendTo(this.$el)),t.text(n)},getPicsTransitionTime:function(){if(!t.screenshot){var e=450;if(!this.mag)return e;if(this.isFullscreenMode)return _.isFunction(this.mag.getPageTransitionTime)?this.mag.getPageTransitionTime():e;var i,n=1;return n="default"===this.mag.viewport&&Modernizr.isdesktop||"constructor"===this.environment?1:this.mag.currentPage&&this.mag.currentPage.visibleWidgetsCoords&&this.mag.currentPage.visibleWidgetsCoords.scale,i=Math.round(this.params.w*n),e=i>=768?550:i>=667?520:i>=568?490:i>=480?470:400}},setImageSize:function(t,e,i,n,s){if(!e||!i)return t?"cover":"contain";var r,a;return t?(n/s>e/i?(r=n+2,a=Math.round(r*i/e)):(a=s+2,r=Math.round(a*e/i)),r+"px "+a+"px"):e<n&&i<s?e+"px "+i+"px":(n/s>e/i?(a=s+2,r=Math.round(a*e/i)):(r=n+2,a=Math.round(r*i/e)),r+"px "+a+"px")},onCaptionBlur:function(){if("viewer"!=this.environment&&this.model){var t=this.$captions.find(".caption").val(),e=_.clone(this.model.get("pictures")),i=_.findWhere(e,{id:this.$captions.find(".caption").attr("data-id")});if(i&&i.text!=t){var n=e.indexOf(i);e[n]=_.extend({},i,{text:t}),this.model.save({pictures:e},{silent:!0,toHistory:!0}),this.block.workspace.trigger("redraw")}}},recalcCounters:function(t,e){if("theme_captions"==t.current_theme&&t.theme_data.counters){var i=t.pictures||[],n=e?e.w:t.w,s=this.COUNTER_WIDTH*i.length,r=Math.floor(n/this.COUNTER_WIDTH)*this.COUNTER_WIDTH,a=Math.min(s,r),o=Math.floor((n-a)/2);this.$counters_scroll_wrapper.css({left:o,width:a}),this.$counters_container.css({width:s})}},recalcThumbnails:function(t,e){if("theme_classic"==t.current_theme&&t.theme_data.thumbnails){var i=t.pictures||[],n=e?e.w:t.w,s=i.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING,r=Math.min(s,n-this.THUMBNAILS_PADDING),a=Math.floor((n-r)/2);this.thumbsWidth=r,this.$thumbnails_scroll_wrapper.css({left:a,width:r}),this.$thumbnails_container.css({width:s})}},onImageClick:function(t){if("constructor"!=this.environment&&Modernizr.isdesktop){var e=this.$images;t&&t.stopPropagation();var i=e.get(0).getBoundingClientRect().width;t.pageX<e.offset().left+i/2?this.prevImage():this.nextImage()}},prevImage:function(t){this.imagePrevNext(t,"prev","switch-to-image")},nextImage:function(t){this.imagePrevNext(t,"next","switch-to-image")},imagePrevNext:function(t,e,i){if(this.currentImageID){var n="next"==e?this.currentPic.$el.next():this.currentPic.$el.prev();n.length||(n=this.$images_wrapper.children(":"+("next"==e?"first":"last"))),this.moveToImage(n.attr("data-id"),!0,i),t&&t.stopPropagation()}},thumbnailClick:function(t){this.moveToImage($(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},counterClick:function(t){this.moveToImage($(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},moveToImage:function(t,i,n){function s(){if(r.each(function(t){var e=$(this);(t<d||t>u)&&e.addClass("hidden")}),a.data("first-child")&&h.$images_wrapper.children().last().removeClass("hidden"),a.data("last-child")&&h.$images_wrapper.children().first().removeClass("hidden"),i||h.initialRender||window.requestAnimationFrame(function(){h.$images_wrapper.addClass("enable-transitions")}),h.trigger("currentImageChanged",t,i,n),h.handleCounters&&!h.initialRender){var s=h.$counters_container.children('[data-id="'+t+'"]');h.$counters_container.children(".active").removeClass("active"),s.addClass("active");var o=s.get(0).offsetLeft,l=h.$counters.find(".items-wrapper").width(),c=e;o+2*h.COUNTER_WIDTH-h.$counters.find(".items-wrapper").scrollLeft()>l?c=o+2*h.COUNTER_WIDTH-l:o-h.COUNTER_WIDTH-h.$counters.find(".items-wrapper").scrollLeft()<0&&(c=o-h.COUNTER_WIDTH),c!=e&&(i?h.$counters.find(".items-wrapper").stop().animate({scrollLeft:c},200):h.$counters.find(".items-wrapper").scrollLeft(c))}if(h.handleThumbnails&&!h.initialRender){var p=h.$thumbnails_container.children('[data-id="'+t+'"]');h.$thumbnails_container.children(".active").removeClass("active"),p.addClass("active");var o=p.position().left,l=h.$thumbnails.find(".items-wrapper").width(),c=e;o+2*(h.THUMBNAIL_WIDTH+h.THUMBNAIL_PADDING)-h.THUMBNAIL_PADDING/2-h.$thumbnails.find(".items-wrapper").scrollLeft()>l?c=o+2*(h.THUMBNAIL_WIDTH+h.THUMBNAIL_PADDING)-h.THUMBNAIL_PADDING/2-l:l>2*(h.THUMBNAIL_WIDTH+h.THUMBNAIL_PADDING)&&o-h.THUMBNAIL_WIDTH-h.THUMBNAIL_PADDING/2-h.$thumbnails.find(".items-wrapper").scrollLeft()<0&&(c=o-h.THUMBNAIL_WIDTH-h.THUMBNAIL_PADDING/2)}if(c!=e&&(i?h.$thumbnails.find(".items-wrapper").stop().animate({scrollLeft:c},200):h.$thumbnails.find(".items-wrapper").scrollLeft(c)),h.model&&"constructor"==h.environment){var f=h.model.get("pictures"),g=_.findWhere(f,{id:h.currentImageID});g?h.$captions.find(".caption").val(g.text).attr("data-id",h.currentImageID):h.$captions.find(".caption").val("").attr("data-id","")}else"theme_captions"==h.params.current_theme&&"viewer"==h.environment&&(i?h.$captions.find('.caption-wrapper[data-id="'+h.currentImageID+'"]').stop().fadeIn(200).siblings().stop().fadeOut(200):(h.$captions.find(".caption-wrapper").stop().css({display:"none"}),h.$captions.find('.caption-wrapper[data-id="'+h.currentImageID+'"]').stop().css({display:"block"})));h.preloadImages(),h.preloadThumbImages()}if(t){var r=this.$images_wrapper.children(".image"),a=r.filter('[data-id="'+t+'"]'),o=r.index(a),l=_.clone(this.currentPic),c={num:o},h=this;if(a.length&&o!=-1){this.currentImageID=t,this.currentPic.$el=a,this.currentPic.num=o,"switch-to-image"==n&&(this.disableAutoplayOnUserInteraction=!0,this.stopAutoplay()),this.$images_wrapper.toggleClass("enable-transitions",i),this.resetWaitForAnimationEnd(),i&&l.$el&&this.waitForAnimationEnd(l.$el,s),this.direction=!l.$el||!l.$el.length||l.num<c.num?"forward":"backward",a.data("first-child")&&l.$el&&l.$el.length&&l.$el.data("last-child")?this.direction="forward":a.data("last-child")&&l.$el&&l.$el.length&&l.$el.data("first-child")&&(this.direction="backward");var d=c.num-("forward"==this.direction?this.PREDISPLAY_COUNT.backward:this.PREDISPLAY_COUNT.forward),u=c.num+("forward"==this.direction?this.PREDISPLAY_COUNT.forward:this.PREDISPLAY_COUNT.backward);r.each(function(t){var e=$(this);t<c.num?h.setPicPosition(e,"prev",t+1===c.num):t>c.num?h.setPicPosition(e,"next",t-1===c.num):h.setPicPosition(e,"center",t===c.num),t>=d&&t<=u&&e.removeClass("hidden")}),h.$images.find(".counters-text-current").html(o+1),!i&&s()}}},waitForAnimationEnd:function(e,i){this.resetWaitHook=t.utils.waitForTransitionEnd(e,this.getPicsTransitionTime()+1e3,"transform",i)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},setPicPosition:function(t,e,i){t.data("last-position")===e&&t.data("last-neighbour")===i||(t.removeClass("center-image prev-image next-image neighbour").addClass(e+"-image "+(i?"neighbour":"")),t.data("last-position",e),t.data("last-neighbour",i))},preloadImages:function(){function e(t){if(r.isFullscreenMode&&t.data("orig-src")){var e=new Image;e.onload=function(){t.css({"background-image":'url("'+e.src+'")'}).removeData("orig-src")},e.src=t.data("orig-src")}t.attr("data-src")&&(r.preloadImagesList.push({url:t.attr("data-src")}),t.css({"background-image":'url("'+t.attr("data-src")+'")'}).removeAttr("data-src"))}if("viewer"==this.environment){var i=this.$images_wrapper.children('[data-id="'+this.currentImageID+'"]');if(i.length){var n=i.prev();n.length||(n=this.$images_wrapper.children(":last"));var s=i.next();s.length||(s=this.$images_wrapper.children(":first"));var r=this;e(i),t.screenshot||(e(n),e(s))}}},preloadThumbImages:function(){if("viewer"==this.environment&&"theme_classic"==this.params.current_theme&&this.params.theme_data.thumbnails){var t=this.initialRender?this.thumbsWidth:this.$thumbnails_scroll_wrapper.width(),e=this.initialRender?0:this.$thumbnails.find(".items-wrapper").scrollLeft();this.$thumbnails.find(".items-wrapper .thumb").each(_.bind(function(i,n){var s=$(n),r=s.attr("data-src");if(r){var a=i*this.THUMBNAIL_WIDTH-this.THUMBNAIL_PADDING/2,o=this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING;a-e>t+o||a+o-e<0-o||(this.preloadImagesList.push({url:s.attr("data-src")}),s.css({"background-image":'url("'+s.attr("data-src")+'")'}).removeAttr("data-src"))}},this))}},updateCurrentImageID:function(t){if(!t.pictures||!t.pictures.length)return void(this.currentImageID=e);if(this.currentImageID){var i=_.findWhere(t.pictures,{id:this.currentImageID});this.currentImageID=i?i.id:this.getFirstPictureID(t)}else this.currentImageID=this.getFirstPictureID(t)},getFirstPictureID:function(t){var e=_.sortBy(t.pictures,"num");return e[0].id},toggleFullscreen:function(t){"constructor"!=this.environment&&(this.isFullscreenMode?this.leaveFullscreen():this.enterFullscreen(),t.stopPropagation())},enterFullscreen:function(){"constructor"!=this.environment&&(this.isFullscreenMode||(this.isFullscreenMode=!0,this.$parentBeforeFullscreen=this.$el.parent(),$(".constructor .widgetbar").addClass("hidden"),this.$el.addClass("fullscreen-mode"),this.$el.appendTo("body").css("z-index",999),$(window).on("resize",this.onFullscreenResize),$("body").on("keyup",this.onFullscreenKeyUp),_.defer(function(){t.common.disableShortcuts.slideshow=!0}),this.onFullscreenResize(),t.utils.getFocusBack(),this.preloadImages()))},onFullscreenKeyUp:function(t){t.keyCode==$.keycodes.left&&this.prevImage(),t.keyCode==$.keycodes.right&&this.nextImage(),t.keyCode==$.keycodes.esc&&this.leaveFullscreen()},onFullscreenResize:function(){var t=this.$el.width(),e=this.$el.height();if("theme_classic"==this.params.current_theme)var i=e-(this.params.theme_data.thumbnails?this.THUMBNAILS_HEIGHT:0);if("theme_captions"==this.params.current_theme)var i=e-this.params.captions_h-(this.params.theme_data.counters?this.COUNTERS_HEIGHT:0);this.applyVisualState(this.params,{w:t,h:e,images_h:i,captions_h:this.params.captions_h})},leaveFullscreen:function(){"constructor"!=this.environment&&this.isFullscreenMode&&(this.isFullscreenMode=!1,this.$el.appendTo(this.$parentBeforeFullscreen).css("z-index","auto"),$(window).off("resize",this.onFullscreenResize),this.$el.removeClass("fullscreen-mode"),$(".constructor .widgetbar").removeClass("hidden"),$("body").off("keyup",this.onFullscreenKeyUp),_.defer(function(){delete t.common.disableShortcuts.slideshow}),this.applyVisualState(this.params),this.setNewPicsWidths(this.params.w))},startAutoplay:function(){this.autoPlayInterval||this.disableAutoplayOnUserInteraction||(this.autoPlayInterval=setInterval(_.bind(function(){this.imagePrevNext(null,"next","switch-to-image-autoplay")},this),this.AUTOPLAY_INTERVAL))},stopAutoplay:function(){clearInterval(this.autoPlayInterval),this.autoPlayInterval=null},destroy:function(){this.isDestroyed=!0,this.stopAutoplay(),this.leaveFullscreen(),this.resetWaitForAnimationEnd(),this.$el&&this.$el.remove()},setSwipeAction:function(){Modernizr.isdesktop||(this.picsSwipe=this.$images_wrapper.RMSwipe({$scrollElements:this.mag.$mag_container,maxTransitionSpeed:this.getPicsTransitionTime(),rubberBandForce:1/1.47,getCurrentConstraints:function(t){var e={},i=this.isFullscreenMode?this.$images_wrapper.width():this.params.w;return e.$moveItems=this.currentPic.$el.add(this.currentPic.$el.prev()).add(this.currentPic.$el.next()),e.$referenceItem=e.$moveItems.filter(":not(.center-image)").first(),this.currentPic.$el.is(":last-child")?e.left={max:0,noTrigger:!0}:e.left={max:i},this.currentPic.$el.is(":first-child")?e.right={max:0,noTrigger:!0}:e.right={max:i},e}.bind(this),onSwipeStart:function(){this.$images_wrapper.removeClass("enable-transitions"),this.disableAutoplayOnUserInteraction=!0,this.stopAutoplay()}.bind(this),customMoveCheck:function(t,e){return!(t.hasClass("prev-image")&&e<0)&&!(t.hasClass("next-image")&&e>0)}.bind(this),callback:function(t){var e;"right"===t&&(e=this.currentPic.$el.prev()),"left"===t&&(e=this.currentPic.$el.next()),e.length||(e=this.currentPic.$el),this.moveToImage(e.attr("data-id"),!1,"switch-to-image")}.bind(this)}).data("swipe"))}})}(RM),function(t,e){"use strict";t.classes.ButtonWidget=Backbone.View.extend({MIN_ICON_MARGIN:8,initialize:function(e){e&&(_.bindAll(this),this.block=e.block,this.model=e.block&&e.block.model,this.model=e.model,this.$container=e.$container,this.environment=e.environment,this.mag=e.mag,_.extend(this.model,{env:this.environment}),this.generateIndividualStyleCSS({env:this.environment,model:this.model}),this.template=t.templates["template-common-button-widget"],"constructor"===this.environment?this.text_template=t.templates["template-constructor-block-button"]:this.text_template=t.templates["template-viewer-widget-button"],this.render())},render:function(){var e=(this.model.tp,t.buttonutils.generateStylesStr({model:this.model}));this.setElement($(this.template({data:this.model}))),$(this.text_template({data:this.model})).appendTo(this.$el),this.$text=this.$(".text"),this.$icon=this.$(".icon"),this.$button=this.$text.closest(".common-button"),this.$button.attr("style",e),this.applyButtonType(this.model.tp),"circle"===this.model.form&&this.applyCircleRadius(this.model.w),this.applyTextContainerSize(this.model),this.applyIconContainerSize(this.model),this.applyIconPosition(this.model),"viewer"===this.environment&&this.$container.css("border-radius",this.$button.css("border-radius")),this.$el.appendTo(this.$container),this.renderFinishTimeout=setTimeout(function(){var t=["background-color","background-color-opacity","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing"];"circle"!==this.model.form&&t.push("border-radius"),t.forEach(function(t){this.$button.css(t,"")}.bind(this)),this.applyTransition()}.bind(this),500)},applyTransition:function(){if("viewer"===this.environment&&!Modernizr.touch){var t=this.model.transition;t&&this.$button.addClass("transition")}},applyButtonType:function(t){var e="inline-block";"text"===t?(this.$text.css("display",e),this.$icon.css("display","none")):"icon"===t?(this.$icon.css("display",e),this.$text.css("display","none")):"text_and_icon"===t&&this.$icon.add(this.$text).css("display",e)},applyCircleRadius:function(t){this.$button.css("border-radius","100%")},applyTextContainerSize:function(t){var e=t["letter-spacing"],i=0,n=0;e>0?i=e:e<0&&(n=e),this.$text.css({width:t.text_w+"px","padding-left":i+"px","text-indent":n+"px",height:t.text_h+"px","line-height":t.text_h+"px"})},applyIconContainerSize:function(t){var e=(t.tp,t.icon_w),i=t.icon_h,n=(t.icon_pos,0),s=0;this.$icon.css({width:e+"px",height:i+"px","margin-right":s+"px","margin-left":n+"px"})},calcIconMarginFromText:function(t){return Math.ceil(t/4)},calcIconTopBottomMargin:function(t){return Math.ceil(t/3)},calcTextTopBottomMargin:function(t){return Math.ceil(t/6)},applyIconPosition:function(t){var e=t.icon_pos;"left"===e?this.$button.css({"flex-direction":"row","-webkit-flex-direction":"row"}):"right"===e&&this.$button.css({"flex-direction":"row-reverse","-webkit-flex-direction":"row-reverse"})},generateIndividualStyleCSS:function(e){t.buttonutils.generateIndividualStyleCSS({env:e.env,model:e.model})},destroy:function(){clearTimeout(this.renderFinishTimeout),t.buttonutils.destroyIndividualStyleCSS({env:this.environment,model:this.model}),this.$el&&this.$el.remove()}})}(RM),function(t,e){"use strict";t.classes.HotspotWidget=Backbone.View.extend({TIP_GAP:15,initialize:function(e){e&&(_.bindAll(this),this.block=e.block,this.model=e.model,this.$container=e.$container,this.environment=e.environment,this.mag=e.mag,this.template=t.templates["template-common-hotspot-widget"],this.render())},render:function(){this.setElement($(this.template({data:this.model}))),"viewer"===this.environment&&(this.apply_tip_container_size({width:this.model.tip_w,height:this.model.tip_h}),this.apply_tip_position(this.model)),this.$el.appendTo(this.$container)},apply_tip_container_size:function(t){t&&0===t.height&&(t.height=120),t&&this.$(".tip").css(t)},apply_tip_bg_color:function(e){this.$(".blocks-wrapper").css("background-color",t.utils.getRGBA(e["tip_background-color"],e["tip_background-color-opacity"]/100))},apply_tip_border_radius:function(t){this.$(".blocks-wrapper").add(this.$(".tip")).css("border-radius",t["tip_border-radius"]+"px")},apply_tip_box_shadow:function(t){this.$(".tip").toggleClass("box-shadow",!!t["tip_box-shadow"])},apply_tip_position:function(t,e){e=e||{};var i,n=this.$(".tip"),s=t.tip_pos,r=t.tip_w,a=t.tip_h||120,o=t.w,l=t.h,c="",h="",d=this.TIP_GAP;return"top"===s?(c=-(d+a),h=o/2-r/2):"right"===s?(c=l/2-a/2,h=o+d):"bottom"===s?(c=l+d,h=o/2-r/2):"left"===s&&(c=l/2-a/2,h=-(d+r)),i={top:c,left:h},n.css(i),i},destroy:function(){this.remove()}})}(RM),function(t,e){"use strict";t.classes.FormWidget=Backbone.View.extend({MIN_FIELD_WIDTH:50,MIN_FIELD_HEIGHT:30,INVALID_COLOR:"ff4828",INVALID_BORDER_WIDTH:2,DROPDOWN_TRIANGLE_SVG:'<svg class="form-dropdown-triangle" xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 11 11"><polygon points="2 4 9 4 5.5 8 "/></svg>',DROPDOWN_TRIANGLE_OPACITY_MULTIPLIER:.4,initialize:function(e){_.bindAll(this),this.data=e.data,this.$container=e.$container,this.environment=e.environment,this.buttonTemplate=t.templates["template-common-form-button"]},render:function(){this.rendered||(this.setElement($("<div>")),this.$el.addClass("form-wrapper").appendTo(this.$container),this.$el.on(Modernizr.isdesktop?"mouseenter":"touchstart",".button",this.onButtonHover).on(Modernizr.isdesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut).on("change","select",this.onDropdownChange).on("mouseenter",".input-wrapper",this.onInputHover).on("mouseleave",".input-wrapper",this.onInputHoverOut),this.rendered=!0);for(var t=this.data,e=t.fields,i=$("<div>"),n=0;n<e.length;n++){var s=e[n],r=$("<input>");if(r.attr("type","text").attr("autocapitalize","name"==s.tp?"on":"off").attr("autocomplete","off").attr("autocorrect","off").attr("name",s.caption).attr("placeholder",s.caption+(s.optional&&"viewer"!==this.environment?" (optional)":"")).attr("spellcheck",!1).attr("data-sort",s.sort),"email"==s.tp&&r.attr("inputmode","email"),"phone"==s.tp&&r.attr("inputmode","tel"),"number"==s.tp&&r.attr("inputmode","numeric"),"dropdown"==s.tp&&(r.attr({tabindex:-1}),r.prop({readonly:!0}),r.addClass("fake-dropdown")),r.wrap('<div class="input-wrapper">').parent().appendTo(i),"dropdown"==s.tp&&s.items){var a=$("<select>"),o=$(this.DROPDOWN_TRIANGLE_SVG);a.attr("name",s.caption),$('<option value="" selected></option>').prop("disabled",!s.optional).appendTo(a);for(var l=0;l<s.items.length;l++)$("<option>").attr("value",s.items[l]).text(s.items[l]).appendTo(a);r.parent().append(o).append(a)}}$(this.buttonTemplate()).appendTo(i),this.$el.html(i.html()).addClass("common-form"),this.$button=this.$(".button"),this.$buttonIcons=this.$(".button svg"),this.$inputs=this.$(".input-wrapper"),this.$triangles=this.$(".form-dropdown-triangle"),this.recalcStyles()},onDropdownChange:function(t){$(t.currentTarget).parent().find("input").val($(t.currentTarget).val())},setButtonHoverState:function(){this.forceHoverState=!0,this.applyButtonStyle()},unsetButtonHoverState:function(){this.forceHoverState=!1,this.applyButtonStyle()},recalcStyles:function(t){this.$el.attr("data-layout",this.data.layout).attr("data-style",this.data.style),this.$button.find(".caption").text(this.data["button-caption"]),this.resizeElements(t),this.applyInputsStyle(this.$inputs),this.applyButtonStyle(t)},getMinimalDimensions:function(){var t,e=this.data,i=e.fields,n=e["style-"+e.style+"-fields"],s=e["style-"+e.style+"-button-default"],r=this.getButtonValue.bind(this,s,n),a=s.gutter+i.length*n.gutter,o=n["underline-width"]||0,l=Math.max(Math.ceil(1.25*r("font-size")),this.MIN_FIELD_HEIGHT)+o,c=Math.max(Math.ceil(1.25*n["font-size"]),this.MIN_FIELD_HEIGHT)+o,h=Math.max(l,c);return"vertical"==e.layout&&(t={width:this.MIN_FIELD_WIDTH,height:a+(i.length+1)*h}),"horizontal"==e.layout&&(t={width:a+(i.length+1)*this.MIN_FIELD_WIDTH,height:h}),t},resizeElements:function(t){var i=this.data,n=i.fields,s=i["style-"+i.style+"-fields"],r=i["style-"+i.style+"-button-default"],a=r.gutter+n.length*s.gutter,o=t&&t.w!=e?t.w:i.w,l=t&&t.h!=e?t.h:i.h,c=Math.floor("vertical"==i.layout?l:o),h=Math.ceil((c-a)/(n.length+1)),d=h*(n.length+1)+a-c;this.$inputs.add(this.$button).each(function(t,e){var a={};t==n.length+1-d&&h--,"vertical"==i.layout?(a.width=o+"px",a.height=h+"px",t<n.length&&(a["margin-bottom"]=t<n.length-1?s.gutter:r.gutter+s.gutter),a["margin-right"]=""):(a.width=h+"px",a.height=l+"px",t<n.length&&(a["margin-right"]=t<n.length-1?s.gutter:r.gutter+s.gutter),a["margin-bottom"]=""),$(e).css(a)})},showInputPlaceholdersAsValues:function(t){this.$inputs.each(function(e,i){var n=$(i).find("input");n.val(t?n.attr("placeholder"):"")})},applyInputsStyle:function(t,e){e=e||{};var i,n=this.data,s=(n.fields,_.clone(n["style-"+n.style+"-fields"]));"underlined"==n.style?(e.invalid&&(s["underline-color"]=this.INVALID_COLOR,s["underline-opacity"]=100,s["underline-width"]=s["underline-width"]||this.INVALID_BORDER_WIDTH),i={"background-color":"transparent","border-radius":0,"box-shadow":"inset 0 "+-s["underline-width"]+"px 0 0 "+this.getRgba(s["underline-color"],s["underline-opacity"])}):(e.invalid&&(s["border-color"]=this.INVALID_COLOR,s["border-opacity"]=100,s["border-width"]=s["border-width"]||this.INVALID_BORDER_WIDTH),i={"background-color":this.getRgba(s.color,s.opacity),"border-radius":s["border-radius"]+"px","box-shadow":"inset 0 0 0 "+s["border-width"]+"px "+this.getRgba(s["border-color"],s["border-opacity"])});var r={"font-family":s["font-family"],"font-style":s["font-style"],"font-weight":s["font-weight"],color:this.getRgba(s["text-color"],s["text-opacity"]),"font-size":s["font-size"],"letter-spacing":s["letter-spacing"],"margin-bottom":s["underline-width"]?s["underline-width"]+"px":0};t.css(i).find("input, select").css(r),t.find(".form-dropdown-triangle").each(function(t,e){var i=$(e),n=i.parent(),r=n.find("input"),a=r.position().top,o=n.height()-r.height()-a;i.css({fill:this.getRgba(s["text-color"],s["text-opacity"]*this.DROPDOWN_TRIANGLE_OPACITY_MULTIPLIER),top:a,bottom:o})}.bind(this))},applyButtonStyle:function(){var t=this.data,e=(t.fields,t["style-"+t.style+"-fields"]),i=t["style-"+t.style+"-button-default"],n=t["style-"+t.style+"-button-hover"],s=this.getButtonValue.bind(this,i,e),r=this.getHoverValue.bind(this,n,i,e),a=s("letter-spacing");this.$button.css({"line-height":this.$button.height()+"px","background-color":this.getRgba(s("color"),s("opacity")),"border-radius":s("border-radius")+"px","box-shadow":"inset 0 0 0 "+s("border-width")+"px "+this.getRgba(s("border-color"),s("border-opacity")),"font-family":s("font-family"),"font-style":s("font-style"),"font-weight":s("font-weight"),color:this.getRgba(s("text-color"),s("text-opacity")),"font-size":s("font-size"),"letter-spacing":a,"text-indent":a/2||0}),this.$buttonIcons.css({fill:this.getRgba(s("text-color"),s("text-opacity"))}),this.$button.attr("data-default",this.$button.attr("style")),this.$button.css({"background-color":this.getRgba(r("color"),r("opacity")),"box-shadow":"inset 0 0 0 "+r("border-width")+"px "+this.getRgba(r("border-color"),r("border-opacity")),color:this.getRgba(r("text-color"),r("text-opacity"))}),this.$button.attr("data-hover",this.$button.attr("style")),this.forceHoverState||this.$button.attr("style",this.$button.attr("data-default")),this.$button.outerHeight(),this.$button.toggleClass("with-transition",!!n.transition&&"viewer"==this.environment)},getRgba:function(e,i){var n=t.utils.hex2rgb(e);return"rgba("+n[0]+", "+n[1]+","+n[2]+","+i/100+")"},getButtonValue:function(t,e,i){return"inherit"==t[i]?e[i]:t[i]},getHoverValue:function(t,e,i,n){return"inherit"==t[n]?this.getButtonValue(e,i,n):t[n]},onInputHover:function(t){var e=this.data,i=_.clone(e["style-"+e.style+"-fields"]);$(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]))},onInputHoverOut:function(t){var e=this.data,i=_.clone(e["style-"+e.style+"-fields"]);$(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]*this.DROPDOWN_TRIANGLE_OPACITY_MULTIPLIER))},onButtonHover:function(t){this.$button.hasClass("submitted")||this.$button.attr("style",this.$button.attr("data-hover"))},onButtonHoverOut:function(t){this.$button.attr("style",this.$button.attr("data-default"))},destroy:function(){this.$el.off(Modernizr.isdesktop?"mouseenter":"touchstart",".button",this.onButtonHover).off(Modernizr.isdesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut).off("change","select",this.onDropdownChange),this.$el&&this.$el.remove()}})}(RM),function(t,e){"use strict";t.widgets.text=t.classes.Widget.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){this.makeBox("text"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.bg_color=this.bg_color==e?"ffffff":this.bg_color,this.bg_opacity=this.bg_opacity==e?0:this.bg_opacity,this.column_count=this.column_count==e?1:this.column_count,this.column_gap=this.column_gap==e?16:this.column_gap;var i=[parseInt(this.bg_color.substring(0,2),16),parseInt(this.bg_color.substring(2,4),16),parseInt(this.bg_color.substring(4,6),16)];this.bg_opacity>.99?this.bg="rgb("+i[0]+","+i[1]+","+i[2]+")":this.bg="rgba("+i[0]+","+i[1]+","+i[2]+", "+this.bg_opacity+")",this.text=this.switchTextToViewport(this.text,this.insideHotspot?"default":this.page.pageViewport);var n=t.templates["template-viewer-widget-text"],s=$(n(this));this.seamlessFontsShow(),this.$el.append(s),this.$el.on(Modernizr.isdesktop?"mouseenter":"touchstart","a",this.onLinkMouseEnter),this.$el.on(Modernizr.isdesktop?"mouseleave":"touchend","a",this.onLinkMouseLeave),this.$el.on("click","a",this.onLinkClick),s.addClass("v"+(this.version||1));var r=this;return this.$el.find("a").each(function(){var i=$(this),n=i.attr("data-pid");/^back\sto\stop$/i.test(i.attr("href"))&&(n=r.page._id);var s=r.page.mag.matchSameDomainLink(i.attr("href"));if((s==i.attr("href")||n)&&(s=e),n=n||s){var a=r.page.mag.getPageNum(n),o=a&&r.page.mag.getPageUri?"/"+r.page.mag.getPageUri(n):"javascript:void(0)";a?i.attr("href",o).addClass("maglink").attr("target",""):i.removeAttr("href"),n==r.page._id&&i.addClass("back-to-top")}else if(/^__rm_goback$/i.test(i.attr("href")))i.attr("href","javascript:void(0)").addClass("goback-link");else if(r.mailchimpMatcher.test(i.attr("href"))){
var l=i.attr("href").match(r.mailchimpMatcher)[1];i.attr("href","javascript:void(0)").attr("data-mailchimp",l).addClass("mailchimp-link"),t.initutils.initMailchimpAPI()}else if(r.shareRegexp.test(i.attr("href"))){var c=i.attr("href").match(r.shareRegexp);i.attr("href","javascript:void(0)").attr("data-share-provider",c[1]).attr("data-share-type",c[2]).addClass("share-link")}else r.anchorRegexp.test(i.attr("href"))?(i.attr("href","javascript:void(0)").addClass("anchor-link"),i.attr("data-page-uri",r.page.uri||r.page.num)):i.addClass("external-link");!i.attr("href")||0!=i.attr("href").indexOf("mailto")&&0!=i.attr("href").indexOf("tel")||i.attr("target","")}),t.screenshot&&!this.insideHotspot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this.$el.find("span.soundcite").each(function(e,i){t.screenshot||window.soundcite&&window.soundcite.createPlayer(i)}),this},isValid:function(){var t=$("<div>").html(this.text).text();return""!=$.trim(t)},hasFontsToLoad:function(){return!0},stop:function(){return this.started=!1,t.screenshot||this.destroyed||!this.rendered||this.$el&&this.$el.find("span.soundcite").each(function(t,e){window.soundcite&&window.soundcite.pausePlayer(e)}),this},destroy:function(){return this.$el&&this.$el.find("span.soundcite").each(function(t,e){window.soundcite&&window.soundcite.destroyPlayer(e)}),t.classes.Widget.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},seamlessFontsShow:function(){if(t.textutils.isFastFontLoadCheckAvailable()&&!t.screenshot&&!this.insideHotspot&&this.hasFontsToLoad()){this.$el.css({visibility:"hidden"});var e=function(){this.$el.css({visibility:"inherit"})}.bind(this);this.makeSureFontsLoaded().then(e).catch(e)}},makeSureFontsLoaded:function(){var e=this.page.getFontsVariations([this]),i=[];return _.each(e,_.bind(function(e){var n=t.textutils.fastWaitForFontLoad(e.fontFamily,e.fontWeight,e.fontStyle);i.push(n)},this)),window.Promise.all(i)},onLinkMouseEnter:function(t){var e=$(t.currentTarget).attr("data-uuid"),i=this.$el.find("a[data-uuid='"+e+"']");i.addClass("hovered")},onLinkMouseLeave:function(t){var e=$(t.currentTarget).attr("data-uuid"),i=this.$el.find("a[data-uuid='"+e+"']");i.removeClass("hovered")},onLinkClick:function(e){if(2!=e.which&&!e.metaKey&&!e.ctrlKey){var i=$(e.currentTarget),n=$.trim(i.attr("href")),s=n.match(/\/start\-with\-template\/(\d+)$/i),r=s&&s[1];r&&t.viewerRouter&&t.viewerRouter.createMagFromTemplate&&(e.preventDefault(),t.viewerRouter.createMagFromTemplate("template-link",r))}}}).extend(t.classes.TextViewports.prototype)}(RM),function(t,e){"use strict";t.widgets.picture=t.classes.Widget.extend({antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){this.makeBox("widget-picture"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0;var i=this.getPictureUrl();if(/\.gif/.test(i)&&(this.isGIF=!0),this.$el.html(""),0!=_.last(i.split(".")).indexOf("svg")||t.constants.IS_FILE_PROTOCOL){var n=!!(this.border_size>0||this.border_radius>0||this.border_radius_max||this.is_full_width);if(this.insideHotspot&&this.isGIF){var s=this.scale;$("<div/>").appendTo(this.$el).css({position:"absolute","background-image":"url("+i+")","background-position":"50% 50",width:Math.max(Math.round(this.originalW*s),this.w),height:Math.max(Math.round(this.originalH*s),this.h),top:-Math.round(this.cropY*s),left:-Math.round(this.cropX*s)}).attr("url",i)}else n&&$("<div/>").appendTo(this.$el).css({"background-image":"url("+i+")","background-position":"50% "+(this.fwpos==e?50:this.fwpos)+"%","box-shadow":this.border_size>0?"inset 0 0 0 "+this.border_size+"px #"+(this.border_color||"000000"):"none","border-radius":(this.border_radius_max?"9999":this.border_radius||0)+"px",opacity:"undefined"==typeof this.opacity?1:this.opacity}).attr("url",i);$("<img/>").appendTo(this.$el).toggleClass("saveable",!!(n||this.insideHotspot&&this.isGIF)).css("opacity","undefined"==typeof this.opacity?1:this.opacity).load(_.bind(function(){this.$el.find("img").attr("url",i),this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded).attr("src",i)}else this.loadVector(i);return this.checkLink(),this},isValid:function(){return!!this.getPictureUrl()},start:function(){return this.started=!0,Modernizr.safari&&this.isGIF&&this.$el.flashClass("fix-safari-gif",100),this},getPictureUrl:function(){if(!this.picture)return"";var t=Modernizr.retina?this.picture.final2xUrl||this.picture.finalUrl:this.picture.finalUrl;return(this.is_full_width||this.page.mag.isPreview&&this.animation)&&(t=this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl),t||this.picture.effectUrl||this.picture.editedVectorUrl||this.picture.url},loadVector:function(t){this.svgAjax=$.get(t+"?c",_.bind(function(e){this.$svg=$(e).find("svg").attr("width","").attr("height","");var i=$(e).find("svg").get(0).cloneNode(!0),n=(this.$svg.attr("viewBox"),new Image);$(n).on("load error",_.bind(function(){$(n).appendTo(window.document.body).css({width:"100%",height:"100%"});var t=$(i);t.get(0).setAttribute("viewBox","0 0 "+$(n).width()+" "+$(n).height()),t.appendTo(window.document.body);var e=t.get(0).getBBox();this.$svg.get(0).setAttribute("viewBox",e.x+" "+e.y+" "+e.width+" "+e.height),this.$svg.get(0).setAttribute("preserveAspectRatio","xMidYMid meet"),$(n).remove(),t.remove();var s=$('<div class="svg-scale-wrapper"></div>');this.$svg.appendTo(s),s.appendTo(this.$el),this.widgetIsLoaded()},this)),n.src=t},this)).fail(this.widgetIsLoaded)},checkLink:function(){var t=" ";if(this.clickLink){this.clickLink=this.page.mag.matchSameDomainLink(this.clickLink);var e=/^http(s?)\:\/\//i.test(this.clickLink)||/^mailto\:/i.test(this.clickLink)||/^tel\:/i.test(this.clickLink),i=/^__rm_goback$/i.test(this.clickLink),n=this.mailchimpMatcher.test(this.clickLink),s=this.anchorRegexp.test(this.clickLink),r=this.shareRegexp.test(this.clickLink),a=this.clickLink,o=this.clickTarget||"_blank",l=e?"external-link":i?"goback-link":"maglink";if(n&&(l="mailchimp-link"),s&&(l="anchor-link"),r&&(l="share-link"),!e){var c=a;/^back\sto\stop$/i.test(a)&&(c=this.page._id);var h=this.page.mag.getPageNum(c),a=h&&this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(c):"javascript:void(0)";h?o="":a="",c==this.page._id&&(l+=" back-to-top")}if(i&&(a="javascript:void(0)"),n){a="javascript:void(0)";var d=this.clickLink.match(this.mailchimpMatcher)[1];t+=" data-mailchimp='"+d+"'"}if(s&&(a="javascript:void(0)",t+=" data-anchor-link-pos='"+this.anchor_link_pos+"'",t+=" data-page-uri='"+(this.page.uri||this.page.num)+"'"),r){a="javascript:void(0)";var u=this.clickLink.match(this.shareRegexp);t+=" data-share-provider='"+u[1]+"' data-share-type='"+u[2]+"'"}0!=a.indexOf("mailto")&&0!=a.indexOf("tel")&&"maglink"!=l||(o=""),a&&this.$el.wrap('<a class="'+l+'" href="'+a+'" target="'+o+'"'+t+">")}}})}(RM),function(t,e){"use strict";t.widgets.background=t.classes.Widget.extend({render:function(){return this.rendered=!0,this.page.on("resize",this.onResize,this),this.template=t.templates["template-viewer-widget-background"],this.setElement(this.template({data:this})),this.$el.prependTo(this.page.$fixedBgContainer),this.$picture=this.$(".picture-background"),this.$video=this.$(".video-background"),this.$videoContainer=this.$(".video-container"),this.picture&&"picture"==this.selectedType?this.renderPicture():this.video&&"video"==this.selectedType?this.renderVideo():this.widgetIsLoaded(),this},start:function(){return this.started=!0,"video"==this.selectedType&&!t.screenshot&&this.rendered&&this.videoWidget&&!this.destroyed&&(this.videoWidget.start(),this.onResize()),this},stop:function(){return this.started=!1,"video"==this.selectedType&&!t.screenshot&&this.rendered&&this.videoWidget&&!this.destroyed&&this.videoWidget.stop(),this},destroy:function(){return this.page.off("resize",this.onResize,this),"video"==this.selectedType&&(this.videoWidget&&this.videoWidget.destroy(),this.videoWidget=null),t.classes.Widget.prototype.destroy.apply(this,arguments)},hasVideoBG:function(){return!(t.screenshot||!Modernizr.isdesktop||!this.video||"video"!=this.selectedType)},onResize:function(){!this.destroyed&&this.$videoContainer&&this.video&&t.videoutils.setVideoPosition({mag:this.page.mag,$container:this.$videoContainer,$media:this.$videoContainer.children(),provider:this.video.provider_name,aspect_poster:this.video.aspect_poster||this.videoWidget&&this.videoWidget.aspect_poster,aspect_real:this.video.aspect_real,controls_remove:!0})},renderPicture:function(){if(!this.picture)return void this.widgetIsLoaded();var e=this.picture.finalUrl||this.picture.effectUrl||this.picture.url,i=$("<img/>");i.on("load",_.bind(function(){this.$picture.css({"background-image":"url("+e+")"}),t.screenshot?setTimeout(this.widgetIsLoaded,200):this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded).attr("src",e)},renderVideo:function(){this.video.id=this.id,this.video.mute=this.mute,this.video.loop=this.loop,this.video.controls=!1,this.videoWidget=new t.widgets.video(this.video,this.page,this.$videoContainer),this.videoWidget.on("loaded",_.bind(function(){this.widgetIsLoaded(),this.onResize()},this)),this.videoWidget.on("playStarted",_.bind(function(){this.trigger("videoBGStarted")},this)),this.videoWidget.render()}})}(RM),function(t,e){"use strict";t.widgets.slideshow=t.classes.Widget.extend({render:function(){return this.makeBox("widget-slideshow"),this.pictures=_.filter(this.pictures,function(t){return!t.error}),this.player=new t.classes.SlideshowPlayer(this,this.$el,"viewer",null,this.page&&this.page.mag),this.player.on("ready",_.bind(function(){setTimeout(this.widgetIsLoaded,100)},this)),this.rendered=!0,this},isValid:function(){return this.pictures&&this.pictures.length},start:function(){return this.started=!0,!t.screenshot&&!this.destroyed&&this.player&&this.theme_data.autoplay&&this.rendered&&this.loaded&&this.player.startAutoplay(),this},stop:function(){return this.started=!1,!t.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.stopAutoplay(),this},destroy:function(){return this.player&&this.player.off(),this.player&&this.player.destroy(),this.player=null,t.classes.Widget.prototype.destroy.apply(this,arguments)}})}(RM),function(t,e){"use strict";t.widgets.twitter=t.classes.Widget.extend({CONTENT_WAIT_TICK:100,CONTENT_WAIT_MAX_TICKS:20,CONTENT_IMG_WAIT:1e3,DO_NOT_WAIT_FOR_PRELOAD:!0,render:function(){this.makeBox("widget-twitter"),this.rendered=!0;var e,i;return this.current_type?(i=this[this.current_type],"mag"===i.use_own_url?i.url=this.page.mag.getUrl():"page"!==i.use_own_url&&i.url||(i.url=this.page.getUrl()),t.screenshot||(i.text=t.shareutils.getFinalShare(this.page,_.extend(this.page.mag.model.toJSON(),{user:this.page.mag.user}),{forProject:"mag"===i.use_own_url,customDomain:t.common.isDomainViewer}).tweet),e=t.templates["template-constructor-block-twitter-"+this.current_type],this.$el.html(e(i)),"type_timeline"===this.current_type&&this.$el.find("a").attr({width:this.w,height:this.h}),t.initutils.initTwitterAPI(function(){this.destroyed||(window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load(),_(["type_timeline","type_embed"]).contains(this.current_type)?this.waitForTwitterContent():this.widgetIsLoaded())}.bind(this)),this):(this.widgetIsLoaded(),this)},waitForTwitterContent:function(){var t,e,i,n=0,s=!1,r={type_timeline:".timeline-Widget",type_embed:"blockquote.tweet"};clearInterval(t),t=setInterval(_.bind(function(){return n++,this.destroyed?void clearInterval(t):(e=this.$el.find("iframe"),1==e.length&&(i=r[this.current_type],s=e.contents().find(i).length>0),void((s||n>this.CONTENT_WAIT_MAX_TICKS)&&("type_embed"==this.current_type&&e.css({margin:0,"max-width":"100%"}),"type_timeline"==this.current_type&&(console.log("$frame : ",e),e.css({width:"100%",height:"100%!important","max-width":"100%"})),clearInterval(t),setTimeout(_.bind(function(){this.widgetIsLoaded()},this),this.CONTENT_IMG_WAIT))))},this),this.CONTENT_WAIT_TICK)}})}(RM),function(t,e){"use strict";t.widgets.facebook=t.classes.Widget.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,initialize:function(){return t.classes.Widget.prototype.initialize.apply(this,arguments),"type_like_box"==this.current_type&&(this.current_type="type_page",this.type_page=this.type_like_box),this.recalcPosition.__debounced=_.debounce(this.recalcPosition,300),this},render:function(){return this.makeBox("widget-facebook"),this.rendered=!0,this.started?this.start():!t.screenshot&&this.widgetIsLoaded(),this},start:function(){if(this.started=!0,this.destroyed||!this.rendered||this.innerRendered)return this;this.innerRendered=!0;var e,i,n=this,s=["type_like_button","type_page","type_comments"];return this.current_type?(i=this[this.current_type],i.w=this.w,i.h=this.h,"mag"===i.use_own_url?i.url=this.page.mag.getUrl():"page"!==i.use_own_url&&i.url||(i.url=this.page.getUrl()),e=t.templates["template-constructor-block-facebook-"+this.current_type],this.$el.html(e({data:i})).removeClass(s.join(" ")).addClass(this.current_type),"type_comments"===this.current_type?this.$el.css({"overflow-x":"hidden","overflow-y":"auto"}):"type_like_button"!==this.current_type&&this.$el.css({overflow:"hidden"}),t.initutils.initFacebookAPI(function(){!n.destroyed&&n.innerRendered&&window.FB.XFBML.parse(n.$el.get(0),function(){_.delay(function(){!n.destroyed&&n.innerRendered&&(n.widgetIsLoaded(),"type_like_button"===n.current_type&&(n.iframe_w=n.$("iframe").width(),n.iframe_h=n.$("iframe").height(),n.bindWindowListener()))},500)})}),this):(this.widgetIsLoaded(),this)},bindWindowListener:function(){Modernizr.isphone||$(window).on("message",this.onWindowMessage)},unbindWindowListener:function(){Modernizr.isphone||$(window).off("message",this.onWindowMessage)},stop:function(){return this.started=!1,this.unbindWindowListener(),this.$el.empty(),this.innerRendered=!1,this},onWindowMessage:function(t){this.started&&this.rendered&&!this.destroyed&&/type=resize\.iframe/.test(t.originalEvent.data)&&/facebook/.test(t.originalEvent.origin)&&this.recalcPosition.__debounced()},recalcPosition:function(){if(this.started&&this.rendered&&!this.destroyed){var e,i,n,s,r,a,o,l,c,h,d=24,u=this.$("iframe"),p=this.$el.get(0),f=p.style.transform||p.style.webkitTransform||p.style.MozTransform||p.style.msTransform||p.style.OTransform||"";if(this.unbindWindowListener(),e=u.width(),i=u.height(),a=this.page.mag,r=a.getContainerSizeCached(),"vertical"==this.page.viewerType){var g=this.page.mag.magPagesPos[this.page.num];n=u.offset().left,o=r.width,this.fixed_position?(l=this.$fixedContainer.height(),s=this.$el.position().top-(this.$el.offset().top-u.offset().top)):(l=g.h,s=this.y-(this.$el.offset().top-u.offset().top)),c=(n+e>o||n<0)&&e!==this.iframe_w?n+e-o:0,h=(s+i>l||s<0)&&i!==this.iframe_h?s+i-l:0}else n=u.offset().left,s=u.offset().top,o=r.width,l=r.height,c=(n+e>o||n<0)&&e!==this.iframe_w?n+e-o:0,h=(s+i>l||s<0)&&i!==this.iframe_h?s+i-l:0;c&&(c=n<0?n-d:c+d),h&&(h=s<0?s-d:h+d),f=f.replace(/translateX\(.*\)/i,"").replace(/translateY\(.*\)/i,""),f+=" translateX("+-c+"px) ",f+=" translateY("+-h+"px) ",this.$el.flashClass("animate",300),t.utils.applyTransform(this.$el,f),this.w==e&&this.h==i?(u.css("left",0),this.BackToNormalZ()):"type_like_button"===this.current_type&&this.BringToTopZ(),_.delay(function(){this.bindWindowListener()}.bind(this),300)}}})}(RM);var youTubeApiIsReady=!1,ytQueue=[];window.onYouTubeIframeAPIReady=function(){youTubeApiIsReady=!0,_.each(ytQueue,function(t){_.isFunction(t.cb)&&t.cb()})},function(t,e){"use strict";var i=function(t,e){var i=_.bind(t,e);return youTubeApiIsReady?i():void ytQueue.push({cb:i,context:e})},n=function(t,e){this.playerIsReady=!1,this.queue=[],i(function(){this.yt=new YT.Player(t.id,{events:{onReady:_.bind(function(){this.destroyed||(this.playerIsReady=!0,_.each(this.queue,function(t){_.isFunction(t.cb)&&t.cb()}))},this)}})},this),this.start_time=e&&e.start_time};n.prototype={addToQueue:function(t,e){var i=_.bind(t,e);return this.playerIsReady?i():void this.queue.push({cb:i,context:e})},on:function(t,e,i){var n=_.bind(e,i||window),s={finish:0,play:1,pause:2};return"ready"==t?void this.addToQueue(n,this):void this.addToQueue(function(){this.yt.addEventListener("onStateChange",function(e){s[t]==e.data&&n()})},this)},mute:function(){this.addToQueue(function(){this.yt.mute()},this)},unMute:function(){this.addToQueue(function(){this.yt.unMute()},this)},pause:function(){this.addToQueue(function(){this.yt&&this.yt.pauseVideo&&this.yt.pauseVideo()},this)},play:function(){this.addToQueue(function(){this.yt.playVideo()},this)},rewind:function(t){this.addToQueue(function(){this.yt.seekTo(t||0)},this)},loop:function(){this.rewind(this.start_time||.01)},getDuration:function(){return this.duration||(this.duration=this.yt.getDuration()),this.duration},getCurrentTime:function(){return this.yt.getCurrentTime&&this.yt.getCurrentTime()||0},checkLoop:function(){if(this.getDuration()-this.yt.getCurrentTime()<.5)return this.loop(),!0},destroy:function(){ytQueue=_.reject(ytQueue,function(t){return t.context==this}),delete this.yt,delete this.queue,this.destroyed=!0}};var s=function(t,e){_.bindAll(this),this.id=t.id,this.start_time=e&&e.start_time};s.prototype={on:function(t,e,i){$f(this.id).addEvent(t,e)},mute:function(){$f(this.id).api("setVolume",0)},unMute:function(){return!1},pause:function(){$f(this.id).api("pause")},play:function(){$f(this.id).api("play")},rewind:function(t){$f(this.id).api("seekTo",t||0)},loop:function(){this.start_time&&this.rewind(this.start_time)},getCurrentTime:function(t){$f(this.id).api("getCurrentTime",t)},setColor:function(t){$f(this.id).api("setColor",t)},destroy:function(){var t=$f(this.id);t&&(t.removeEvent("ready"),t.removeEvent("play"),t.removeEvent("finish"),t.removeEvent("pause"))}};var r={Vimeo:_.template('<iframe src="https://player.vimeo.com/video/<%=video_id%>?wmode=opaque&api=1&loop=<%=(loop)?1:0%>&player_id=video_<%=id%><%=(!real)?"_c":""%>&title=<%=info?1:0%>&byline=<%=info?1:0%>&portrait=<%=info?1:0%>&color=<%=color%>" id="video_<%=id%><%=(!real)?"_c":""%>" width="<%=w%>" height="<%=h%>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'),YouTube:_.template('<iframe <% if (real) {%>id="yt_<%=video_id%>"<%}%> src="https://www.youtube.com/embed/<%=video_id%>?wmode=opaque&enablejsapi=1&playlist=&autohide=1&loop=<%=(loop)?1:0%>&showinfo=<%=info?1:0%>&theme=<%=theme%>&controls=<%=controls? 1: 0%><%=html5 ? "&html5=1" : ""%>&rel=0&vq=hd1080" width="<%=w%>" height="<%=h%>" frameborder="0" allowfullscreen></iframe>')};t.widgets.video=t.classes.Widget.extend({RESTART_TIMEOUT:5e3,initialize:function(e,i,n){return t.classes.Widget.prototype.initialize.apply(this,arguments),this.$container=n,delete this.real,this},render:function(){return this.$container?this.setElement(this.$container):this.makeBox("video"),this.rendered=!0,this.setPosterInsteadOfVideo(),this},isValid:function(){return this.video_id&&this.provider_name},_needAutoStart:function(){return this.autoplay&&Modernizr.isdesktop&&!t.utils.PageVisibilityManager.isPageHidden()},start:function(){this.started=!0,this.onPlayFired=!1;var e=this.$container&&this.page&&this.page.mag&&"default"!=this.page.mag.viewport&&!!this.page.mag.viewport;return e&&this.trigger("playStarted"),t.screenshot||!this.rendered||this.destroyed||e?this:(this.playerInitialized||(this.$el.append(this.getEmbed()),this.$iframe=this.$el.find("iframe"),this.$iframe.attr("id","video_"+this.id),this.player=this.createPlayer(this.provider_name,this.$iframe,{start_time:this.start_time}),this.player&&this.player.on("ready",this.onPlayerReady),this.playerInitialized=!0),this.player&&this._needAutoStart()&&this.player.play(),this)},stop:function(){return this.started=!1,clearInterval(this.loopInterval),!t.screenshot&&!this.destroyed&&this.player&&this.rendered&&("youtube"==this.provider_name.toLowerCase()?(this._needAutoStart()&&this.player.pause(),!this._needAutoStart()&&this.onPlayFired&&this.player.pause()):this.player.pause()),this},destroy:function(){return clearInterval(this.loopInterval),this.player&&this.player.destroy(),this.player=null,t.classes.Widget.prototype.destroy.apply(this,arguments)},setPosterInsteadOfVideo:function(){var e=this.thumbnail_url;return e?(this.$poster&&this.$poster.remove(),this.$poster&&this.$poster.off(),this.$poster=$("<img/>").addClass("poster").css("opacity",0).appendTo(this.$el),void this.$poster.on("load",_.bind(function(){this.$poster.css({width:"",height:""}).css("opacity",1);var e=this.$poster[0].width,i=this.$poster[0].height;this.aspect_poster||(this.aspect_poster=e/i),t.videoutils.setVideoPosition({mag:this.page.mag,$container:this.$el,$media:this.$poster,provider:this.provider_name,aspect_poster:this.aspect_poster,aspect_real:this.aspect_real,controls_remove:!!this.$container}),setTimeout(this.widgetIsLoaded,100)},this)).on("error",_.bind(function(){return this.oldUrl=this.thumbnail_url,this.thumbnail_url=this.thumbnail_url.replace("https://","http://"),this.oldUrl==this.thumbnail_url?void this.widgetIsLoaded():void this.setPosterInsteadOfVideo()},this)).attr("src",e)):void this.widgetIsLoaded()},createPlayer:function(t,e,i){return"vimeo"==t.toLowerCase()?new s(e[0],i):"youtube"==t.toLowerCase()?new n(e[0],i):null},getEmbed:function(t){return t=t||this,_.defaults(t,{real:!0,w:640,h:320,theme:"dark",color:"3ab9ff",info:!1,controls:!0,id:_.uniqueId("video_"),origin:encodeURIComponent(window.location.protocol+"//"+window.location.hostname)}),Modernizr.safari&&(t.html5=!0),t.video_id?r[t.provider_name](t):null},onPlayerReady:function(){!this.destroyed&&this.player&&(this.$container||_.delay(_.bind(function(){this.$iframe&&this.$iframe.addClass("fade-out")},this),600),this.player.on("pause",this.onPause),this.player.on("play",this.onPlay),this.start_time&&(this.player.rewind(this.start_time),this.player.pause()),Modernizr.isdesktop&&"vimeo"==this.provider_name.toLowerCase()&&this.player.on("playProgress",this.onProgress),this.started&&this._needAutoStart()&&this.player.play(),this.player.setColor&&this.player.setColor(this.color))},onPlay:function(){t.analytics&&t.analytics.sendEvent("Video Play",this.title+" / "+this.url),this.$iframe&&!this.$iframe.hasClass("fade-out")&&(this.$iframe.addClass("fade-out"),this.trigger("playStarted")),clearInterval(this.loopInterval),this.loop&&this.player.checkLoop&&(this.loopInterval=setInterval(_.bind(function(){var t=this.player.checkLoop();t&&(clearInterval(this.loopInterval),Modernizr.safari&&_.delay(function(){this.onPlay()}.bind(this),200))},this),100)),this.mute?this.player.mute():this.player.unMute(),this.onPlayFired=!0},onPause:function(){if("Vimeo"==this.provider_name)this.player.getCurrentTime(_.bind(function(e){var e=Math.round(e);t.analytics&&t.analytics.sendEvent("Video Pause",this.title+" / "+this.url+" / "+e+" sec.",e)},this));else if("YouTube"==this.provider_name){var e=Math.round(this.player.getCurrentTime());t.analytics&&t.analytics.sendEvent("Video Pause",this.title+" / "+this.url+" / "+e+" sec.",e)}},onProgress:function(t,e){this.onPlayFired||this.onPlay(),1==t.percent&&this.loop&&this.player.loop&&this.player.loop(),0==parseFloat(t.seconds)?this.restartTimeout||(this.restartTimeout=setTimeout(_.bind(function(){clearInterval(this.loopInterval),this.playerInitialized=!1,this.player&&this.player.destroy(),this.player=null,this.$iframe&&this.$iframe.remove(),!this.destroyed&&this.started&&this.start(),delete this.restartTimeout},this),this.RESTART_TIMEOUT)):(clearTimeout(this.restartTimeout),delete this.restartTimeout)}})}(RM),function(t,e){"use strict";t.widgets.audio=t.classes.Widget.extend({render:function(){return this.makeBox("audio"),this.player=new t.classes.AudioPlayer(this,this.$el,this.widgetIsLoaded),this.player.show(),this.rendered=!0,this},isValid:function(){return this.parsed_url},start:function(){return this.started=!0,!t.screenshot&&!this.destroyed&&this.player&&this.autoplay&&this.rendered&&this.loaded&&Modernizr.isdesktop&&!t.utils.PageVisibilityManager.isPageHidden()&&this.player.play(),this},stop:function(){return this.started=!1,!t.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.pause(),this},destroy:function(){return this.player&&this.player.destroy(),this.player=null,t.classes.Widget.prototype.destroy.apply(this,arguments)}})}(RM),function(t,e){"use strict";t.widgets.shape=t.classes.Widget.extend(t.classes.ShapeSVG.prototype).extend({mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){if(this.makeBox("widget-shape"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,"icon"==this.tp){if(this.$el.addClass("icon"),this.antialiasRotation=!0,!this.rasterUrl)return this.widgetIsLoaded(),this;var t=$("<img>");t.on("load",_.bind(function(){this.$el.html(t),this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded),t.attr("src",Modernizr.retina?this.raster2xUrl||this.rasterUrl||"":this.rasterUrl||"")}else this.redrawSVG(),this.widgetIsLoaded();return this.checkLink(),this},start:function(){Modernizr.firefox&&"icon"!==this.tp&&this.borders>0&&this.redrawSVG()},redrawSVG:function(){var e=this,i={id:e._id,get:function(t){return e[t]}};if("rectangle"!=this.tp||1!=this.opacity||Modernizr.isdesktop&&0!=this.borders){var n=this.generateShapeSVG("viewer",i,this.$el.width(),this.$el.height());this.$el.html(n)}else{var s=t.utils.hex2rgb(this.bg_color),r=t.utils.hex2rgb(this.color);s.push(this.bg_opacity),this.$el.css({"background-color":"rgba("+s.join(",")+")","border-color":"rgb("+r.join(",")+")","border-radius":this.radius||0,"border-style":"solid","border-width":this.borders,"box-sizing":"border-box"}),this.$el.addClass("div-instead-of-svg")}},onPageResize:function(e){t.classes.Widget.prototype.onPageResize.apply(this,arguments),"icon"!==this.tp&&this.redrawSVG()}})}(RM),function(t,e){"use strict";t.widgets.iframe=t.classes.Widget.extend({render:function(){this.makeBox("widget-iframe"),this.rendered=!0;var t=this.getPluginClass();return t?(this.plugin=new t({widget:this}),this.$el.addClass(this.plugin.embed_type),this.drawPlugin(),this):(this.widgetIsLoaded(),this)},drawPlugin:function(){this.$el.empty(),this.contentCleared=!1,this.drawInProgress=!0,this.plugin.parse(this.code,function(e){if(this.$data=this.plugin.sanitize(e),t.screenshot&&setTimeout(_.bind(function(){this.widgetIsLoaded()},this),5e3),this.plugin.draw(this.$data,this.$el,function(e,i){var n=t.screenshot?5e3:2e3;this.loadTimeout=setTimeout(function(){this.drawInProgress=!1,this.destroyed||(this.widgetIsLoaded(),this.$data.off&&this.$data.off("load"),this.started||this.clearContent())}.bind(this),n)}.bind(this)),!t.screenshot){if(!_.isFunction(this.$data.one))return;this.$data.one("load",function(){this.drawInProgress=!1,!this.destroyed&&this.started&&(this.widgetIsLoaded(),clearTimeout(this.loadTimeout))}.bind(this))}}.bind(this))},widgetIsLoaded:function(){this.loaded||this.destroyed||(this.loaded=!0,this.trigger("loaded"))},isValid:function(){return this.code&&this.getPluginClass()},start:function(){return this.started=!0,this.destroyed||!this.rendered?this:(this.contentCleared&&this.drawPlugin(),this)},stop:function(){return this.started=!1,this.plugin?(this.widgetIsLoaded(),this.drawInProgress?void 0:(this.clearContent(),this)):this},clearContent:function(){this.clear_content&&(this.$el.empty(),this.contentCleared=!0)},getPluginClass:function(){return t.embedutils.findPlugin(this)},destroy:function(){return this.clearContent(),this.plugin&&this.plugin.remove(),t.classes.Widget.prototype.destroy.apply(this,arguments)}})}(RM),function(t,e){"use strict";t.widgets.gmaps=t.classes.Widget.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,render:function(){return this.makeBox("widget-gmaps"),this.$el.html($('<div class="map-container"></div>')),this.rendered=!0,t.initutils.initGMapsAPI(function(){this.destroyed||_.defer(function(){if(!this.destroyed){var t;this.map=new google.maps.Map(this.$(".map-container").get(0),{zoom:this.map_zoom,center:new google.maps.LatLng(this.center_lat,this.center_lng),mapTypeId:this.map_type_id||google.maps.MapTypeId.ROADMAP,disableDefaultUI:!this.show_controls,streetViewControl:!1}),this.marker_lat&&this.marker_lng&&"directions"!==this.current_type&&(this.marker=new google.maps.Marker({map:this.map,position:new google.maps.LatLng(this.marker_lat,this.marker_lng)}),google.maps.event.addListener(this.marker,"click",function(){this.infowindow&&this.infowindow.open(this.map,this.marker)}.bind(this)),this.infowindow=new google.maps.InfoWindow({maxWidth:this.w-100}),this.formatted_address?this.infowindow.setContent(this.formatted_address):(t=new google.maps.Geocoder,t.geocode({latLng:new google.maps.LatLng(this.marker_lat,this.marker_lng)},function(t,e){e==google.maps.GeocoderStatus.OK&&t[0]&&this.infowindow.setContent(t[0].formatted_address)}.bind(this)))),"directions"==this.current_type&&this.direction_start_lat&&this.direction_start_lng&&this.direction_end_lat&&this.direction_end_lng&&this.direction_route_type?(this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer({preserveViewport:!0}),this.directionsService.route({origin:new google.maps.LatLng(this.direction_start_lat,this.direction_start_lng),destination:new google.maps.LatLng(this.direction_end_lat,this.direction_end_lng),travelMode:google.maps.TravelMode[this.direction_route_type.toUpperCase()]},function(t,e){e==google.maps.DirectionsStatus.OK&&(this.directionsDisplay.setDirections(t),this.directionsDisplay.setMap(this.map),google.maps.event.addListener(this.map,"tilesloaded",function(){this.widgetIsLoaded()}.bind(this)))}.bind(this))):google.maps.event.addListener(this.map,"tilesloaded",function(){this.widgetIsLoaded()}.bind(this)),"custom"==this.current_type&&this.custom_json&&this.map.setOptions({styles:JSON.parse(this.custom_json)})}}.bind(this))}.bind(this)),this},start:function(){return this.started=!0,this.rendered&&!this.destroyed&&this.map?(google.maps.event.trigger(this.map,"resize"),this.map.setCenter(new google.maps.LatLng(this.center_lat,this.center_lng)),this):this},destroy:function(){return this.map&&google.maps.event.clearListeners(this.map,"tilesloaded"),this.marker&&google.maps.event.clearListeners(this.marker,"click"),t.classes.Widget.prototype.destroy.apply(this,arguments)}})}(RM),function(t,e){"use strict";t.widgets.button=t.classes.Widget.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){this.preloadIconImage({default:!0});var e;return this.makeBox("widget-button"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,e={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.buttonWidget=new t.classes.ButtonWidget(e),this.preloadIconImage({hover:!0}),this.$el.on(Modernizr.isdesktop?"mouseenter":"touchstart",this.onButtonHover),this.$el.on(Modernizr.isdesktop?"mouseleave":"touchend",this.onButtonHoverOut),this.$el.on("click",this.onButtonClick),this.checkLink(),t.screenshot?(this.waitForIconImageLoad(),this.waitForUsedFontsLoad()):this.widgetIsLoaded(),this},hasFontsToLoad:function(){return t.screenshot&&("text"==this.tp||"text_and_icon"==this.tp)},onButtonHover:function(t){this.$(".common-button").addClass("hovered")},onButtonHoverOut:function(t){this.$(".common-button").removeClass("hovered")},onButtonClick:function(e){if(2!=e.which&&!e.metaKey&&!e.ctrlKey){var i=this.$el.closest("a"),n=$.trim(i.attr("href")),s=n.match(/\/start\-with\-template\/(\d+)$/i),r=s&&s[1];
r&&t.viewerRouter&&t.viewerRouter.createMagFromTemplate&&(e.preventDefault(),t.viewerRouter.createMagFromTemplate("template-link",r))}},checkLink:function(){var t=" ";if(this.clickLink){this.clickLink=this.page.mag.matchSameDomainLink(this.clickLink);var e=/^http(s?)\:\/\//i.test(this.clickLink)||/^mailto\:/i.test(this.clickLink)||/^tel\:/i.test(this.clickLink),i=/^__rm_goback$/i.test(this.clickLink),n=this.mailchimpMatcher.test(this.clickLink),s=this.anchorRegexp.test(this.clickLink),r=this.shareRegexp.test(this.clickLink),a=this.clickLink,o=this.clickTarget||"_blank",l=e?"external-link":i?"goback-link":"maglink";if(n&&(l="mailchimp-link"),s&&(l="anchor-link"),r&&(l="share-link"),!e){var c=a;/^back\sto\stop$/i.test(a)&&(c=this.page._id);var h=this.page.mag.getPageNum(c),a=h&&this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(c):"javascript:void(0)";h?o="":a="",c==this.page._id&&(l+=" back-to-top")}if(i&&(a="javascript:void(0)"),n){a="javascript:void(0)";var d=this.clickLink.match(this.mailchimpMatcher)[1];t+=" data-mailchimp='"+d+"'"}if(s&&(a="javascript:void(0)",t+=" data-anchor-link-pos='"+this.anchor_link_pos+"'",t+=" data-page-uri='"+(this.page.uri||this.page.num)+"'"),r){a="javascript:void(0)";var u=this.clickLink.match(this.shareRegexp);t+=" data-share-provider='"+u[1]+"' data-share-type='"+u[2]+"'"}0!=a.indexOf("mailto")&&0!=a.indexOf("tel")&&"maglink"!=l||(o=""),a&&this.$el.wrap('<a class="'+l+'" href="'+a+'" target="'+o+'"'+t+">")}},preloadIconImage:function(t){t=t||{};var e=this.tp;if("icon"===e||"text_and_icon"===e){if(t.default){var i=new Image;i.src=Modernizr.retina?this.icon_raster2xUrl||this.icon_rasterUrl:this.icon_rasterUrl}if(t.hover){var n=new Image;n.src=Modernizr.retina?this["hover-icon_raster2xUrl"]||this["hover-icon_rasterUrl"]:this["hover-icon_rasterUrl"]}}},_widgetIsLoaded:function(){this.loaded||this.destroyed||(t.screenshot?this.iconImageLoaded&&this.fontLoaded&&this.widgetIsLoaded():this.widgetIsLoaded())},waitForIconImageLoad:function(){this.iconImageLoaded=!1,"icon"!==this.tp&&"text_and_icon"!==this.tp||!this.icon_rasterUrl?this.onIconImageLoaded():$("<img>").on("load",this.onIconImageLoaded).on("error",this.onIconImageLoaded).attr("src",Modernizr.retina?this.icon_raster2xUrl||this.icon_rasterUrl||"":this.icon_rasterUrl||"")},onIconImageLoaded:function(){this.iconImageLoaded=!0,this._widgetIsLoaded()},waitForUsedFontsLoad:function(){this.fontLoaded=!1,this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.onFontLoaded):this.onFontLoaded()},onFontLoaded:function(){this.fontLoaded=!0,this._widgetIsLoaded()},destroy:function(){return this.buttonWidget&&this.buttonWidget.destroy(),this.buttonWidget=null,this.$el.off(Modernizr.isdesktop?"mouseenter":"touchstart",this.onButtonHover),this.$el.off(Modernizr.isdesktop?"mouseleave":"touchend",this.onButtonHoverOut),this.$el.off("click",this.onButtonClick),t.classes.Widget.prototype.destroy.apply(this,arguments)}})}(RM),function(t,e){"use strict";t.widgets.hotspot=t.classes.Widget.extend(t.classes.ShapeSVG.prototype).extend({DO_NOT_WAIT_FOR_PRELOAD:!0,PHONE_TIP_WIDTH:280,MOUSE_LEAVE_TIMEOUT:100,EDGE_GAP:16,events:{"click .pin":"onPinClick",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},render:function(){var e;if(this.makeBox("widget-hotspot"),this.rendered=!0,this.phoneTipWrapperTemplate=t.templates["template-common-hotspot-widget-mobile-wrapper"],this.isPreview=!(!t.constructorRouter||!t.constructorRouter.preview),e={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.hotspotWidget=new t.classes.HotspotWidget(e),this.$pin=this.$(".pin").addClass("viewer"),this.started&&this.renderTip(),"icon"==this.pin_type){if(this.$el.addClass("icon"),!this.rasterUrl)return this.widgetIsLoaded(),this;var i=$("<img>");i.on("load",_.bind(function(){this.$(".pin").html(i),this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded),i.attr("src",Modernizr.retina?this.raster2xUrl||this.rasterUrl||"":this.rasterUrl||"")}else this.renderPinShape(),this.widgetIsLoaded();return this},renderPinShape:function(){var t,e=new Backbone.Model(this);e.id=this._id,t=this.generateShapeSVG("viewer",e,this.w,this.h),this.$pin.html(t)},renderTip:function(){if(!this.isTipRendered){if(this.$tip=$('<div class="tip viewer invisible"></div>'),this.$tip.toggleClass("box-shadow",this["tip_box-shadow"]),this.$tip.css({"border-radius":this["tip_border-radius"]}),this.$blocksWrapper=$('<div class="blocks-wrapper"></div>'),this.$blocksWrapper.appendTo(this.$tip),this.$blocksWrapper.css({"background-color":t.utils.getRGBA(this["tip_background-color"],this["tip_background-color-opacity"]/100),"border-radius":this["tip_border-radius"]}),this.$(".common-hotspot").append(this.$tip),this.pictureData=_.findWhere(this.wids||[],{type:"picture"}),this.textData=_.findWhere(this.wids||[],{type:"text"}),this.hasPictureWidget=!(!this.pictureData||this.pictureData.hidden),this.hasTextWidget=!(!this.textData||this.textData.hidden),this.hasPictureWidget&&(this.pictureData.insideHotspot=!0,this.pictureWidget=new t.widgets.picture(this.pictureData,this.page,this.$blocksWrapper),this.pictureWidget.isValid()?(this.pictureData.w=Math.min(this.tip_w,this.pictureData.w),this.pictureWidget.render()):(this.tip_h-=this.pictureWidget.h||0,this.textData&&(this.textData.y=0),this.pictureWidget=null,this.hasPictureWidget=!1)),this.hasTextWidget&&(this.textData.insideHotspot=!0,this.textWidget=new t.widgets.text(this.textData,this.page,this.$blocksWrapper),this.textWidget.w=Math.min(this.tip_w,this.textWidget.w),this.textWidget.render()),!this.hasPictureWidget&&!this.hasTextWidget)return void this.$tip.remove();this.$closeButton=$('<div class="hotspot-phone-close"></div>'),this.$tip.append(this.$closeButton),this.isTipRendered=!0}},start:function(){return this.started=!0,this.rendered&&!this.destroyed&&this.renderTip(),this},stop:function(){return this.started=!1,this.isTipVisible&&this.hideTip(),this},applyTipPosition:function(){function t(t){var e,i,n,l;switch(t){case"top":e=s.top-r.h/2-o-a.h,n=s.bottom+r.h/2+o,l=s.left-a.w/2,i=s.right-a.w/2;break;case"right":e=s.top-a.h/2,n=s.bottom-a.h/2,l=s.left+r.w/2+o,i=s.right-r.w/2-o-a.w;break;case"bottom":e=s.bottom+r.h/2+o,n=s.bottom-r.h/2-o-a.h,l=s.left-a.w/2,i=s.right-a.w/2;break;case"left":e=s.top-a.h/2,n=s.bottom-a.h/2,l=s.left-r.w/2-o-a.w,i=s.right+r.w/2+o}return{top:e,left:l,bottom:n,right:i}}function e(e){var i,n=e,s=-(1/0),r=!1;return _.each(["top","right","bottom","left"],function(a){if(!r){var o=t(a);i=_.min(o),a==e&&o[a]>0?(n=a,r=!0):i>s&&o[a]>=0&&(s=i,n=a)}}),n}var i,n,s=this.calcDistsToPageVisibleBounds(),r={w:this.w,h:this.h},a={w:this.$tip.width(),h:this.$tip.height()},o=this.hotspotWidget.TIP_GAP,l=this.tip_pos,c=_.pick(this,"w","h","tip_w","tip_h","tip_pos"),h=!1,d=!1;l=e(this.tip_pos),c.tip_pos=l,n=this.hotspotWidget.apply_tip_position(c),i=t(l),_.each(i,function(t,e){if(t<0)switch(e){case"top":n.top-=t-this.EDGE_GAP,h=!0;break;case"bottom":h||(n.top+=t-this.EDGE_GAP);break;case"left":n.left-=t-this.EDGE_GAP,d=!0;break;case"right":d||(n.left+=t-this.EDGE_GAP)}}.bind(this)),this.$tip.css(n)},adjustPictureSize:function(){var t,e=this.tip_w/this.PHONE_TIP_WIDTH;this.pictureWidget&&(t=this.isPhone()?{width:this.PHONE_TIP_WIDTH,height:this.pictureData.h/e}:{width:this.pictureData.w,height:this.pictureData.h},this.pictureWidget.$el.css(t))},onPinClick:function(){this.isHoverable()||(this.isTipVisible?this.hideTip():this.isTipRendered&&this.showTip(),t.analytics&&this.isTipVisible&&t.analytics.sendEvent("Hotspot Click"))},onMouseenter:function(){this.isHoverable()&&this.isTipRendered&&(clearTimeout(this.mouseLeaveTimeout),this.isTipVisible||this.showTip(),t.analytics&&t.analytics.sendEvent("Hotspot Hover"))},onMouseleave:function(){this.isHoverable()&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.MOUSE_LEAVE_TIMEOUT))},showTip:function(){this.isTipRendered&&(this.adjustPictureSize(),this.isPhone()?(this.$phoneTipWrapper=this.$phoneTipWrapper||$(this.phoneTipWrapperTemplate()),this.$phoneTipWrapper.toggleClass("preview",this.isPreview),this.$phoneTipWrapper.detach().appendTo(this.isPreview?".mag-pages-container":"body"),this.$phoneTipWrapper.on("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.on("touchmove",this.onTipTouchMove),this.$tipParent=this.$tip.parent(),this.$tip.detach().appendTo(this.$phoneTipWrapper.find(".center-cell")),_.defer(function(){this.$phoneTipWrapper.removeClass("invisible")}.bind(this)),this.$phoneTipWrapper.on("click",function(t){var e=$(t.target).closest(".tip");e.is(this.$tip)||(this.hideTip(),this.$phoneTipWrapper.off())}.bind(this)),this.$closeButton.on("click",this.onCloseButtonClick)):(this.hotspotWidget.apply_tip_container_size({width:this.tip_w,height:this.tip_h}),this.applyTipPosition(),this.$tip.removeClass("invisible"),this.BringToTopZ(),this.page.mag.router.$mags_container.on("mousedown touchstart",this.onGlobalMouseDown),this.isHoverable()||$("body").on("keydown",this.onBodyKeyDown)),this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.isTipVisible=!0)},hideTip:function(){this.isTipVisible&&(this.isTipVisible=!1,clearTimeout(this.mouseLeaveTimeout),this.isPhone()?(this.$phoneTipWrapper.addClass("invisible"),this.$phoneTipWrapper.off("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.off("touchmove",this.onTipTouchMove),_.delay(function(){this.$tip.detach().appendTo(this.$tipParent),this.$phoneTipWrapper&&this.$phoneTipWrapper.detach()}.bind(this),200)):(this.$tip.addClass("invisible"),_.delay(function(){this.BackToNormalZ()}.bind(this),200),$("body").off("keydown",this.onBodyKeyDown)),this.stopListening(this.page.mag,"change:viewport"))},onTipTouchStart:function(t){this.tipScrollY=t.originalEvent.touches.item(0).clientY},onTipTouchMove:function(t){t.stopPropagation();var e=$(t.currentTarget),i=this.tipScrollY-t.originalEvent.touches.item(0).clientY;(i<0&&e.scrollTop()<=0||i>0&&e.scrollTop()+e.height()>=e[0].scrollHeight)&&t.preventDefault(),this.tipScrollY=t.originalEvent.touches.item(0).clientY},onCloseButtonClick:function(){this.$closeButton.off("click",this.onCloseButtonClick),this.hideTip()},onMagViewportBeforeChange:function(t){this.hideTip()},onGlobalMouseDown:function(t){var e=$(t.target),i=e.closest(".pin"),n=e.closest(".tip");i.is(this.$pin)||n.is(this.$tip)||(this.page.mag.router.$mags_container.off("mousedown touchstart",this.onGlobalMouseDown),this.hideTip())},isPhone:function(){return Modernizr.isphone||this.isPreview&&"phone_portrait"==this.page.mag.viewport},isHoverable:function(){return"hover"==this.tip_show_on&&Modernizr.isdesktop&&!this.isPhone()&&"tablet_portrait"!==this.page.mag.viewport},onBodyKeyDown:function(t){t.keyCode==$.keycodes.esc&&this.hideTip()},destroy:function(){return this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,t.classes.Widget.prototype.destroy.apply(this,arguments)}})}(RM),function(t,e){"use strict";t.widgets.form=t.classes.Widget.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,NUMBER_TEST_REGEX:/^[0-9.,`']+$/,render:function(){return this.makeBox("widget-form"),this.rendered=!0,this.formWidget=new t.classes.FormWidget({data:this,environment:"viewer",$container:this.$el}),this.formWidget.render(),this.$button=this.$(".button"),this.$button.on("click",this.onButtonClick),this.$("input").on("keydown",this.onInputKeyDown),this.$("input").on("input",this.onInput),this.$("select").on("change",this.onInput),t.screenshot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this},hasFontsToLoad:function(){return t.screenshot},destroy:function(){return this.formWidget&&this.formWidget.destroy(),this.formWidget=null,this.$(".button").off("click",this.onButtonClick),t.classes.Widget.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},onButtonClick:function(e){var i;this.$button.hasClass("submitted")||(i=this.validateForm(),i&&(this.setButtonState("submitted"),t.common.isDownloadedSource?this.submitToIframe(function(t){t&&(console.log("err : ",t),this.setButtonState("error"))}):this.submitForm(function(t){t&&(console.log("err : ",t),this.setButtonState("error"),t.responseJSON&&"email_not_confirmed"==t.responseJSON.name&&_.delay(function(){alert(t.responseJSON.message)},100))}.bind(this))))},getDataBySort:function(t){return t=parseInt(t,10),_.findWhere(this.fields,{sort:t})},validateForm:function(){var e=this.$("input"),i=!0;return _.each(e,function(e){var n=$(e),s=n.val().trim(),r=this.getDataBySort(n.attr("data-sort")),a=!0;if(s)switch(r.tp){case"name":case"text":case"dropdown":break;case"email":t.utils.isValidEmail(s)||(a=!1);break;case"phone":/^[0123456789 +\-]+$/.test(s)||(a=!1);break;case"number":this.NUMBER_TEST_REGEX.test(s)&&!isNaN(parseFloat(s))||(a=!1)}else a=r.optional;a||(this.formWidget.applyInputsStyle(n.closest(".input-wrapper"),{invalid:!0}),i=!1)}.bind(this)),i},onInput:function(t){var e=$(t.currentTarget).parent().find("input");this.formWidget.applyInputsStyle(e.closest(".input-wrapper")),this.setButtonState()},onInputKeyDown:function(t){t.keyCode===$.keycodes.enter&&this.onButtonClick()},getFormData:function(){var e={wid:this._id,mag_num_id:this.page.mag.num_id,is_preview:!(!t.constructorRouter||!t.constructorRouter.preview),fields:[]};return _.each(this.fields,function(t){var i=this.$("input[data-sort="+t.sort+"]").val().trim();if("number"==t.tp){var n=parseFloat(i);i=isNaN(n)?i:n}e.fields.push({caption:t.caption,type:t.tp,value:i})}.bind(this)),e},submitForm:function(t){this.xhr&&this.xhr.abort(),this.xhr=$.ajax({dataType:"json",contentType:"application/json",url:"/api/connect/forms/submit",data:JSON.stringify(this.getFormData()),method:"POST",success:function(e){t()},error:function(e){t({status:e.status,responseJSON:e.responseJSON,responseText:e.responseText})}})},submitToIframe:function(t){var e,i,n=this.endpoint_url&&this.endpoint_url.custom_url;return n?(e=$("#form_submit_iframe"),e.length||(e=$('<iframe id="form_submit_iframe" name="form_submit_iframe" style="display:none;"></iframe>').appendTo("body")),i=this.$el.find("form"),i.length||(i=this.$el.find(".form-wrapper").wrap('<form method="post" target="form_submit_iframe"></form>').parent().attr("action",n)),i.get(0).submit(),void t(null)):t("No custom URL specified for submit")},setButtonState:function(t){t=t||"";var e=["error","submitted"];this.$button.removeClass(e.join(" ")).addClass(t)}})}(RM),function(t,e){"use strict";t.models.SocketModel=Backbone.Model.extend({parse:function(t,e){return!e||!e.xhr||this.isNew()||e&&e.noSocketUpdate||(_.isEmpty(t)&&(t=this.toJSON()),this.triggerSocketUpdate(t,e)),Backbone.Model.prototype.parse.apply(this,arguments)},triggerSocketUpdate:function(e,i){var n=e;if(i&&i.patch&&(n=_.extend({},i.attrs,this.pick("_id","pid"))),n=this.getChangedAttributes?this.getChangedAttributes():n,_.isEmpty(n)&&(n=this.toJSON()),!n.pid&&this.getPageId&&"Page"==!this.name&&(n.pid=this.getPageId()),this.getViewport&&"default"!=this.getViewport()){var s=n.pid||this.getPageId&&this.getPageId();return this.triggerViewportUpdate(s)}t.constructorRouter.trigger("update_from_server",this.name,n)},triggerViewportUpdate:function(e){t.constructorRouter.trigger("update_from_server","Viewport",e)}})}(RM),function(t,e){"use strict";var i=t.models.SocketModel.prototype;t.models.Model=t.models.SocketModel.extend({save:function(e,n,s){var r,a=this;_.isObject(e)||null==e?(r=e,s=n):(r={},r[e]=n),s&&s.skipMagChanging&&this.urlRoot&&(s.url=this.url()+(this.url().indexOf("?")>-1?"&":"?")+"skip_changed=true"),s=s?_.clone(s):{};var o=i.save.apply(this,arguments);if(o)return o.error(function(e,i){"abort"!=i&&(e.status&&e.status<500||(a.wasNotSaved=!0,t.constructorRouter.raiseConnectionError()))}),o.success(function(){a.wasNotSaved&&a.trigger("re-saved"),a.wasNotSaved=!1}),this.skipResponse&&(o.skipResponse=!0),t.Events.trigger("save:model",{model:this,setAttrs:r,options:s}),!this.skipMagChanging&&!s.skipMagChanging&&t.constructorRouter.mag&&t.constructorRouter.mag.set("changed",!0),o},sync:function(t,e,n){if("patch"==t.toLowerCase()&&e.collection&&e.collection.page){var s=e.collection.page.getCurrentViewport();if(!("default"==s||n&&n.forceDefaultViewport||this.isNested)){var r=e.toJSON(),a={};a["viewport_"+s]=_.pick(r["viewport_"+s],_.keys(n.attrs)),_.isEmpty(a["viewport_"+s])&&delete a["viewport_"+s];var o=_.difference(_.keys(n.attrs),_.keys(a["viewport_"+s]));_.extend(a,_.pick(e.attributes,o)),n.attrs=a}}return i.sync.apply(this,arguments)},parse:function(t,e){return e&&e.xhr&&e.xhr.skipResponse?(i.parse.apply(this,arguments),this.isNew()?t:void 0):i.parse.apply(this,arguments)},set:function(e,i,n){var s,r;if(_.isObject(e)||null==e?(s=e,r=i):(s={},s[e]=i,r=n),r=r||{},r.viewport&&!r.forceDefaultViewport&&!r.xhr&&this.getViewport&&this.getViewport()!=r.viewport)return this["viewport_"+r.viewport]=_.extend(this["viewport_"+r.viewport]||{},s),this;var a=this.cloneJSON(),o=Backbone.Model.prototype.set.apply(this,arguments);return t.Events.trigger("set:model",{model:this,prevAttrs:a,setAttrs:s,options:n}),o},cloneJSON:function(){var t=this.toJSON();return _.each(t,function(e,i){t[i]=_.cloneWithObjects(e)}),t}})}(RM),function(t,e){"use strict";var i=t.models.SocketModel.prototype;t.models.Mag=t.models.SocketModel.extend({idAttribute:"_id",urlRoot:"/api/mag/",PUBLISH_URL:"/api/publish/",UNPUBLISH_URL:"/api/unpublish/",CHECKDOMAIN_URL:"/api/checkdomain",SETDOMAIN_URL:"/api/mag/domain/",publish_attempts:0,user_templates:{},name:"Mag",undoKeys:[],initialize:function(e,i){_.bindAll(this),this.globalWidgets=new t.collections.Widgets,t.collections.Pages&&(this.pages=new t.collections.Pages,this.trashPages=new t.collections.TrashPages,this.pages.on("change:screenshot",function(t){this.trigger("change:page:screenshot",t.id)},this)),this.on("mag_state_changed",function(t){t&&t.socketUpdate||this.triggerSocketUpdate()},this),this.on("change:updated",function(t,e,i){this.trigger("mag_state_changed",i)},this),this.on("change:changed",function(t,e,i){if(e){if(this.trigger("changed"),i&&i.socketUpdate)return;this.triggerSocketUpdate({changed:e})}},this),this.on("change:pids",function(t,e,i){_.defer(_.bind(function(){this.pages.each(function(t){t&&e.indexOf(t.id)==-1&&this.pages.remove(t.id)},this)},this)),i&&(i.xhr||i.socketUpdate||i.success)||this.triggerSocketUpdate(this.pick("pids"),{})},this),this.on("change:opts",function(t,e,i){i&&i.socketUpdate||this.triggerSocketUpdate(this.pick("opts"))}),this.on("error",function(){this._saveduser&&this.set("user",this._saveduser),delete this._saveduser},this),t.Events.on("global_appear:widget",function(t){this.globalWidgets.add(t)}.bind(this)),t.Events.on("global_disappear:widget",function(t){this.globalWidgets.remove(t)}.bind(this))},parse:function(e){return this.has("changed")&&delete e.changed,_.isObject(this.get("user"))&&delete e.user,e.last_changed=e.last_changed&&new Date(e.last_changed),e.user&&(this.user=new t.models.User(e.user,{parse:!0})),i.parse.apply(this,arguments)},save:function(){if(!this.get("user"))return i.save.apply(this,arguments);var t=i.save.apply(this,arguments);return this.set("changed",!0),t},getPage:function(t){return this.pages.get(t)},addPage:function(e,i){var n=e.specialScreenshot;delete e.specialScreenshot,e=e||{},this._addBlock||(this._addBlock=!0,e.num=e.num||this.getMaxNum()+1,e.mid=this.id,$.ajax({url:"/api/page/",method:"POST",dataType:"json",data:e,success:function(s){this._addBlock=!1;var r=new t.models.Page(s.page,{parse:!0});s.edit_params&&(t.constructorRouter.mag.edit_params.set(s.edit_params),t.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),t.constructorRouter.textStyles.generateCSS("link","constructor",document)),r.specialScreenshot=n,this.onAdd(r),this.sendAnalyticsEvent("Create Page",{_page_type:e.template?"template":"blank"}),i&&i(r)},error:function(t){if(this._addBlock=!1,400==t.status)try{i(JSON.parse(t.responseText))}catch(t){alert("Seems there is a connection problem.")}else alert("Seems there is a connection problem.")},context:this}))},onAdd:function(t,e){this.pages.add(t);var i;i=_.clone(this.get("pids")),i.push(t.id),i=_(i).chain().uniq().compact().value(),this.set({pids:i},e)},sendAnalyticsEvent:function(e,i){var n=t.constructorRouter||t.collectorRouter||t.viewerRouter||t.homepageRouter;n&&n.analytics&&n.analytics.sendEvent(e,i)},getActivePages:function(){return this.pages.filter(function(t){return _.include(this.get("pids"),t.id)},this)},getTitle:function(){return this.get("title")||"Project Title"},getMaxNum:function(){var t=_.max(_.map(this.getActivePages(),function(t){return t.get("num")}));return(!t||t<0)&&(t=0),t},loadFull:function(t){var e=t.success;t.success=_.bind(function(i,n,s){var r=_.clone(i);this.pages.reset(r.pages,{parse:!_.has(t,"parse")||t.parse});r.pages;delete r.pages,this.set(this.parse(r)),this.initGlobalWidgets(),e&&e(i,n,s)},this),$.ajax(_.extend(t,{url:"/api/magFullById/"+this.get("num_id"),dataType:"json"}))},loadActualScreenshot:function(t){if(this._actualScreenshots=this._actualScreenshots||{},!this._actualScreenshots[t]){this._actualScreenshots[t]=!0;var e=this.getPage(t);e.requestActualScreenshot(_.bind(function(){delete this._actualScreenshots[t],this.trigger("change:page:screenshot",t)},this))}},fetchTrashPages:function(t){t=t||{};var e=this.urlRoot+this.get("num_id")+"/trash";return $.get(e,_.bind(function(e){this.trashPages.reset(e,{parse:!0}),e&&e.length||this.set("has_deleted_pages",!1),t.success&&t.success(e)},this)).fail(t.error)},restorePage:function(e,i){i=i||{},$.ajax({type:"POST",url:"/api/user/permissions/can_create_page",data:JSON.stringify({mag:this.toJSON()}),contentType:"application/json",context:this,success:function(){this.trashPages.get(e);$.get("/api/pageFullById/"+e,_.bind(function(e){e=new t.models.Page(e,{parse:!0}),this.onAdd(e),this.trashPages.remove(e),this.set("has_deleted_pages",!!this.trashPages.length),this.save(),i.success&&i.success(e)},this)).fail(i.error)},error:i.error})},emptyTrash:function(t){t=t||{},$.ajax({url:this.urlRoot+this.get("num_id")+"/trash",type:"DELETE",success:function(){this.trashPages.reset(),this.trashPages.triggerSocketUpdate(),this.set("has_deleted_pages",!1),t.success&&t.success()},error:t.error,context:this})},deleteTrashPage:function(t,e){e=e||{};var i=this.trashPages.get(t)||this.pages.get(t);$.ajax({url:"/api/page/"+t+"/trash",type:"DELETE",success:function(){this.trashPages.get(t)&&(this.trashPages.remove(i),this.set("has_deleted_pages",!!this.trashPages.length)),e.success&&e.success()},error:e.error,context:this})},getPageNumId:function(t,e){var i=e&&e.onlyActive?_(this.getActivePages()):this.pages,n=i.find(function(e){return e.get("num")==t});return n&&n.get("num_id")},getPageId:function(t,e){var i=e&&e.onlyActive?_(this.getActivePages()):this.pages,n=i.find(function(e){return e.get("num")==t||e.get("uri")==t});return n&&n.id},getPageUri:function(t){var e=this.pages.find(function(e){return e.get("_id")==t});return e&&(e.get("uri")||e.get("num"))},getPageNum:function(t){var e=this.pages.find(function(e){return e.get("_id")==t});return e&&e.get("num")},deletePage:function(e,i){var n,s,r,a,o=_.reject(this.get("pids"),function(t){return t===e.id},this);return!_.isEmpty(o)&&(this.get("master_share_pid")==e.get("_id")&&this.unset("master_share_pid"),n=e.getOwnGlobalWidgets(),_.isEmpty(n)||(s=this.pages.get(o[0]),r=this.changeParentPage(n,s,{silent:!0}),a=n.concat(r),t.constructorRouter.workspace.save_group(a,{skipHistory:!0})),this._deleteXHR&&this._deleteXHR.abort(),this._deleteXHR=this.save({pids:o},{success:_.bind(function(){e.isEmptyPage||(this.set("has_deleted_pages",!0),this.trigger("change:has_deleted_pages")),i&&i(),e.isEmptyPage&&!this.get("shared")&&this.deleteTrashPage(e.id)},this)}),void e.save({trash_date:new Date},{silent:!0,noSocketUpdate:!0}))},deleteMag:function(t){$.ajax({type:"DELETE",url:"/api/mag/"+this.get("num_id"),success:function(){"function"==typeof t&&t()},error:function(){console.log("Cannot delete :(")},context:this})},publish:function(t,i){this.updateUsedFonts({success:_.bind(function(n){var s={major:t||e,description:t?i||e:e};this.publish_attempts+=1,$.ajax({type:"POST",url:this.PUBLISH_URL+this.get("num_id"),global:!1,data:s,success:_.bind(function(t){this.set(_.extend(this.parse(t),{changed:!1})),this.publish_attempts=0},this),error:_.bind(function(t){this.trigger("mag_publish_error",t.responseJSON||{error:t.statusText,message:t.responseText})},this)})},this),error:_.bind(function(){this.trigger("mag_publish_error",{error:"Used fonts save error",message:"Used fonts save error"})},this)})},unpublish:function(){$.ajax({type:"POST",url:this.UNPUBLISH_URL+this.get("num_id"),success:_.bind(function(t){this.set({is_published:null,published:null,updated:null})},this),error:_.bind(function(){console.error(arguments)},this)})},checkDomain:function(t,e){return $.ajax({type:"POST",url:this.CHECKDOMAIN_URL,data:{num_id:this.get("num_id"),domain:t},success:_.bind(function(i){this.set({last_checked_domain:t},{silent:!0}),e&&e(i)},this),error:_.bind(function(){console.error(arguments),e&&e(null)},this)})},mapDomain:function(t,e){return e=e||{},$.ajax({type:"POST",url:this.SETDOMAIN_URL+this.get("num_id"),data:{domain:t,status:"on"},success:_.bind(function(i){this.set({domain:t},{silent:!0}),e.success&&e.success(i)},this),error:_.bind(function(t){return t&&t.status>=500?e.error(null):e.error&&e.error({badDNSSettings:!0})},this)})},unmapDomain:function(t){return $.ajax({type:"POST",url:this.SETDOMAIN_URL+this.get("num_id"),data:{status:"off"},success:_.bind(function(e){this.unset("domain",{silent:!0}),t&&t(e)},this),error:_.bind(function(){console.error(arguments),t&&t(null)},this)})},loadUserTemplates:function(t){this.currentXHR&&this.currentXHR.abort(),this.currentXHR=$.ajax({url:"/api/user_templates/",dataType:"json",success:_.bind(function(e){this.isTemplatesLoaded=!0,this.user_templates=e,t&&t.cb&&t.cb(e)},this),error:_.bind(function(){console.error("Error loading page templates"),this.isTemplatesLoaded=!1,t&&t.cb&&t.cb()},this)})},getPageTemplate:function(t){var e=null;return _.any(this.user_templates,function(i){if(i.id==t)return e=i,!0}),e},addCustomPageTemplate:function(t){var e=_.find(this.user_templates,function(t){return t.custom});e&&e.templates.unshift(t)},getUsedFonts:function(e){e=e||{};var i=[];return _.each(this.pages.models,function(t){_.each(t.widgets.models,function(t){i.push(t)})}),t.textutils.getUsedFontsFromWidgetsModels(_.extend(e,{models:i}))},updateUsedFonts:function(t){t=t||{};var e=this.getUsedFonts({includeCustom:!0,customList:_.filter(this.edit_params&&this.edit_params.get("fonts"),{provider:"custom"})}),i=[],n=[];_.each(e,function(t){"typekit"==t.provider&&i.push({id:t.css_name,variations:t.used_variations}),"custom"==t.provider&&n.push(t.css_name)}),this.save({used_typekit_fonts:i,used_custom_fonts:n},{url:this.url()+"?skip_changed=true",success:_.bind(function(){t.success&&t.success()},this),error:_.bind(function(){t.error&&t.error()},this)})},filterUnusedFonts:function(){var t=this.edit_params.attributes.fonts,e=_.any(t,function(t){return"typekit"==t.provider&&t.hidden});if(e){var i=_.pluck(_.where(this.getUsedFonts({includeCustom:!1}),{provider:"typekit"}),"css_name"),n=_.reject(t,function(t){return i.indexOf(t.css_name)===-1&&t.hidden&&"typekit"==t.provider});_.isEqual(_.pluck(n,"css_name"),_.pluck(t,"css_name"))||this.edit_params.save({fonts:n},{silent:!0})}},mergeEditParams:function(e){e=e||{};var i,n=this.edit_params,s=_.clone(n.get("paragraph_styles"))||[],r=!1;i=_.pluck(s,"_name"),_.each(e.paragraph_styles,function(t){_.contains(i,t._name)||(s.push(t),r=!0)}),r&&(n.set("paragraph_styles",s),t.constructorRouter.textStyles.generateCSS("paragraph","constructor",document));var a=_.clone(n.get("link_styles"))||[],o=!1;i=_.pluck(a,"_name"),_.each(e.link_styles,function(t){_.contains(i,t._name)||(a.push(t),o=!0)}),o&&(n.set("link_styles",a),t.constructorRouter.textStyles.generateCSS("link","constructor",document)),(r||o)&&this.save(),e.fonts&&e.fonts.length&&t.constructorRouter.fonts.addFonts(e.fonts,"paste")},triggerEditParamsRewrite:function(e,i){JSON.stringify(e.paragraph_styles)!=JSON.stringify(i.paragraph_styles)&&t.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),JSON.stringify(e.link_styles)!=JSON.stringify(i.link_styles)&&t.constructorRouter.textStyles.generateCSS("link","constructor",document),JSON.stringify(e.fonts)!=JSON.stringify(i.fonts)&&t.constructorRouter.fonts.appendFontsCssToDocument({version:"edit"},function(){t.constructorRouter.trigger("font-added")})},fetchLastChanged:function(t){this.fetch({data:{fields:"last_changed"},noSocketUpdate:!0,success:_.bind(function(e){if(this.previousAttributes()&&this.previousAttributes().last_changed){var i=new Date(this.previousAttributes().last_changed);t(i.getTime()+3e5<new Date(this.get("last_changed")).getTime()?{wasChanged:!0}:{wasChanged:!1})}else t({wasChanged:!1})},this)})},updateLastChanged:function(){this.set("last_changed",new Date)},changeParentPage:function(t,e,i){i=_.extend(i||{},{nosave:!0});var n=new Backbone.Collection;return _.each(t,function(t){var s=t.get("pid"),r=this.pages.get(s);s!=e.id&&(t.set("pid",e.id,{silent:!0}),t.collection=e.widgets,e.addWidget(t,i),r.removeWidgets([t.id],i),n.add(r))}.bind(this)),n.isEmpty()||n.add(e),n.models},removeGlobalWidgets:function(t){console.log("wids : ",t);var e=_.difference(this.get("gwids"),t);console.log("newWids : ",e),this.save({gwids:e})},initGlobalWidgets:function(){var t=this.pages.chain().reduce(function(t,e){return t.concat(e.widgets.models)},[]).filter(function(t){return t.isGlobal()}).uniq(function(t){return t.get("_id")}).value();this.globalWidgets.set(t)}})}(RM),function(t,e){"use strict";t.models.User=Backbone.Model.extend({userpic_sizes:[64,96,128,192,256],mergePermissionsList:["can_publish"],idAttribute:"uri",url:"/api/me/",initialize:function(t,e){_.bindAll(this)},store:function(t,e){t.name&&!/^\s$/.test(t.name)||(t.name=this.get("name")),t=this.changedAttributes(t),this.set(t),this.validate(t)||$.ajax({type:"PUT",url:this.url,data:t,success:e&&"function"==typeof e.success&&e.success,error:e&&"function"==typeof e.error&&e.error})},deletePic:function(){var t=this;$.ajax({type:"DELETE",url:"/api/me/userpic/",success:function(){t.set("pic","")}})},validate:function(t){if(t.name!==e&&_.isEmpty($.trim(t.name)))return"Name yourself"},getUserpic:function(e){var i,n=this.get("pic");if(Modernizr.retina&&(e=2*e),e=_.find(this.userpic_sizes,function(t){return t>=e}),n)return n=t.utils.addFilenameComponent(n,e),0==n.indexOf("https://")||t.common.isDownloadedSource?n:(n.indexOf("/api/upload/")==-1&&(n="/api/upload/"+n),n);i=this.get("name").match(/^[a-z0-9]{1}/i);var s=t.common.isDownloadedSource?"":"/";return i?s+"img/stubs/avatar/"+i[0].toLowerCase()+".gif":s+"img/stubs/avatar/"+e+".gif"},getLink:function(){return t.common.customDomainProfile?"/":t.common.isDomainViewer?t.constants.readymag_host+"/"+this.get("uri"):"/"+this.get("uri")},getWebsiteButified:function(){var e,i={link:"",label:""};return this.get("website")&&(e=t.utils.URLParts(this.get("website")),e.protocol=e.protocol||"http://",i.link=e.protocol+e.hostname+e.path,i.label=e.hostname),i},getTwitterButified:function(){var e,i={link:"",nick:""};return this.get("twitter")&&(e=t.utils.URLParts(this.get("twitter")),e.protocol||e.path?(e.protocol=e.protocol||"http://",i.nick=e.path.split("/")[1]):(e.protocol="http://",i.nick=e.hostname,e.path="/"+i.nick,e.hostname="twitter.com"),i.link=e.protocol+e.hostname+e.path),i},getFacebookButified:function(){var e,i={link:"",nick:""};if(this.get("fb")){e=t.utils.URLParts(this.get("fb"));try{e.path.indexOf("profile.php")!=-1?i.nick="facebook":"pages"==e.path.split("/")[1]?i.nick=decodeURIComponent(e.path.split("/")[2])||"":e.protocol||e.path?i.nick=e.path.split("/")[1].split("?")[0]||"":(i.nick=e.hostname,
e.hostname="facebook.com",e.path="/"+i.nick),e.protocol=e.protocol||"http://",i.link=e.protocol+e.hostname+e.path}catch(t){console.log("Error parsing FB URL: ",t)}}return i},mergePermissions:function(t){var e=_.clone(this.get("permissions"));this.set("permissions",t),_.each(this.mergePermissionsList,function(t){this.attributes.permissions[t]=this.attributes.permissions[t]&&e[t]},this)},resendConfirmationEmail:function(){$.get("/api/user/confirm/resend")},isPublisher:function(){return this.get("permissions").can_publish},checkDomain:function(t,e){return $.ajax({type:"POST",url:"/api/checkdomain",data:{type:"user",domain:t},success:_.bind(function(i){this.set({last_checked_domain:t},{silent:!0}),e&&e(i)},this),error:_.bind(function(){console.error(arguments),e&&e(null)},this)})},mapDomain:function(t,e){return e=e||{},$.ajax({type:"POST",url:"/api/user/domain/",data:{domain:t,status:"on"},success:_.bind(function(i){this.set({domain:t},{silent:!0}),e.success&&e.success(i)},this),error:_.bind(function(t){return t&&t.status>=500?e.error(null):e.error&&e.error({badDNSSettings:!0})},this)})},unmapDomain:function(t){return $.ajax({type:"POST",url:"/api/user/domain/",data:{status:"off"},success:_.bind(function(e){this.unset("domain",{silent:!0}),t&&t(e)},this),error:_.bind(function(){console.error(arguments),t&&t(null)},this)})}}),t.collections.Users=Backbone.Collection.extend({model:t.models.User}),t.models.UsersLoader=function(){this.allUsers=new t.collections.Users,this.userMags={},this.userFolders={},_.bindAll(this)},t.models.UsersLoader.prototype={LOAD_URL:"/api/readymags/user/",loadByUsername:function(e){var i,n;if(t.common.customDomainProfile&&this.allUsers.at(0)){var i=this.allUsers.at(0),n=this.userMags[this.allUsers.at(0).get("uri")];return i.folders=this.userFolders[this.allUsers.at(0).get("uri")],e.success&&e.success({user:i,mags:n})}var s=this.allUsers.find(function(t){return t.get("uri").toLowerCase()==e.user_uri.toLowerCase()}),r=_.bind(function(t){var i,n;return t.user?(this.load(t,e.is_me),i=this.allUsers.get(t.user.uri),n=this.userMags[t.user.uri],i.folders=this.userFolders[t.user.uri],void(e.success&&e.success({user:i,mags:n}))):e.success({user:t})},this);s&&!e.force?(n=this.userMags[s.get("uri")],s.folders=this.userFolders[s.get("uri")],e.success({user:s,mags:n})):this.request(e.user_uri,{success:r,error:e.error})},load:function(e,i){var n;if(!_.isEmpty(e)){var s=e.user||e,r=e.mags,a=s.folders||[];if(s){n=s.uri,t.collections.FolderList&&(this.userFolders[n]=new t.collections.FolderList(a,{parse:!0}),delete s.folders),this.allUsers.remove(n),this.allUsers.add(s),i&&s.contributors&&_.each(s.contributors,function(e){e.member&&(e.member=new t.models.User(e.member))});var o=_.pick(s,"_id","uri","desc","pic");i&&(o.isMe=i),_.each(r,function(t){t.user=_.clone(o)}),t.collections.MagList&&(this.userMags[n]=new t.collections.MagList(r,{parse:!0}),i&&!_.isEmpty(r)&&this.userMags[n].each(function(t){t.user.set("isMe",!0)}))}}},loadShared:function(e){_.isEmpty(e)||(this.sharedMags={},_.each(e,function(e){var i=_.pick(e.user,"_id","uri","desc","pic");_.each(e.mags,function(t){t.user=_.clone(i)}),this.sharedMags[e.user.uri.toLowerCase()]={user:new t.models.User(e.user),mags:new t.collections.MagList(e.mags,{parse:!0})}},this))},request:function(e,i){t.common.customDomainProfile&&(this.LOAD_URL="/api/domain/readymags/user/",e=""),i=i||{},this.abortLoading();i.success||$.noop;this.loadingXHR=$.ajax(_.extend(i,{type:"GET",url:this.LOAD_URL+e}))},abortLoading:function(){this.loadingXHR&&this.loadingXHR.abort&&this.loadingXHR.abort()}},$(function(){t.data.usersLoader=new t.models.UsersLoader;var e=window.ServerData.me;t.data.usersLoader.load(e,!0),e?(e=e.user||e,e.uri&&(t.data.usersLoader.me=t.data.usersLoader.allUsers.get(e.uri))):t.data.usersLoader.me=!1,window.ServerData.mags&&window.ServerData.mags.user&&window.ServerData.mags.mags&&(!t.data.usersLoader.me||t.data.usersLoader.me.get("uri")!=window.ServerData.mags.user.uri)&&t.data.usersLoader.load(window.ServerData.mags),window.ServerData.shared&&t.data.usersLoader.loadShared(window.ServerData.shared),_.isEmpty(ServerData.sharedError)||(t.data.usersLoader.sharedError=ServerData.sharedError)})}(RM),function(t,e){"use strict";t.models.UserMag=Backbone.Model.extend({idAttribute:"_id",url:function(){if(this.get("user")&&this.get("uri")){var t=this.get("user");_.isObject(t)&&(t=t.get("uri"));var e=t+"/"+this.get("uri")}else var e=this.getId();return"/api/readymag/"+e},PAGES_URL:"/api/magpages/",PUBLISH_URL:"/api/publish/",UNPUBLISH_URL:"/api/unpublish/",parse:function(e){return e.user&&(this.user=new t.models.User(e.user),delete e.user),e.title||(e.emptyTitle=!0),e.title=e.title||"Project",_.isEmpty(e.recentMags)||(this.recentMags=new t.collections.MagList(e.recentMags,{parse:!0})),e},getPageNumId:function(t){if(!this.get("pages"))return"";var e=_.find(this.get("pages"),function(e){return e.num==t});return e?e.num_id:""},getPageId:function(t){if(!this.get("pages"))return"";var e=_.find(this.get("pages"),function(e){return e.num==t});return e?e._id:""},getPageScreenshot:function(e,i){if(e=t.utils.screenshotSize(e),i.cover)return!this.get("cover")&&this.get("pages")?this.getPageScreenshot(e,{_id:this.get("coverPid")}):this.get("cover")?t.utils.addFilenameComponent(this.get("cover"),e):["/screenshot/renew",this.get("num_id"),this.get("coverPid"),(this.get("is_published")?"ready":"")+"?redirect=true&size="+e].join("/");if(this.get("pages")){var n=_.findWhere(this.get("pages"),i),s=n&&n.screenshot;return!s&&n?["/screenshot/renew",this.get("num_id"),n._id,(this.get("is_published")?"ready":"")+"?redirect=true&size="+e].join("/"):t.utils.addFilenameComponent(s,e)}console.error("cannot find page screenshot: ",this,i)},getLink:function(){if(!window.isdesktop)return this.getUnpublishedViewerLink();var e=this.get("is_published")&&this.get("uri")||this.getId();return t.common.customDomainProfile?"/"+e+"/":t.constants.readymag_host+"/"+this.user.get("uri")+"/"+e+"/"},getUnpublishedViewerLink:function(){return t.constants.readymag_auth_host+"/"+this.user.get("uri")+"/"+this.get("num_id")},getMagEditLink:function(){return t.constants.readymag_auth_host+"/edit/"+this.getId()+"/"},getMagEditContentsLink:function(){return window.isdesktop?this.getMagEditLink()+"contents/":this.getUnpublishedViewerLink()},getMagSettingsLink:function(){return this.getMagEditLink()+"settings/"},getId:function(){return this.get("num_id")},getPagesCount:function(){return this.get("pages_count")||this.get("pages")&&this.get("pages").length},deleteMag:function(e){this.deleteXHR&&this.deleteXHR.abort(),this.deleteXHR=$.ajax({type:"DELETE",url:"/api/mag/"+this.getId(),success:function(t){"function"==typeof e.success&&e.success(t)},error:function(e){console.log("Error deleting mag: "+e.responseText),this.onError("A problem occurred while deleting your project. Please, contact us: "+t.constants.SUPPORT_MAIL)},context:this}).always(function(){"function"==typeof e.always&&e.always()})},_changePublishState:function(e,i){var n=!e||"publish"!==e&&"republish"!==e?this.UNPUBLISH_URL:this.PUBLISH_URL;this.publishXHR&&this.publishXHR.abort(),this.publishXHR=$.ajax({type:"POST",url:n+this.getId(),success:function(t){this.set("is_published",e&&"unpublish"!==e),"publish"===e&&(this.set("published",t.published||(new Date).toISOString()),this.set("updated",t.updated||(new Date).toISOString()),this.set("major_update",t.major_update||(new Date).toISOString())),"republish"===e&&this.set(_.extend(_.omit(t,"user"),{updated:this.get("last_changed")})),this.set("coverPid",t.coverPid||this.get("coverPid")),this.set("cover",t.cover||this.get("cover")),"function"==typeof i.success&&i.success()},error:function(i){console.log("Error changing puplish state: "+i.responseText),this.onError("A problem occurred while "+e+"ing your project. Please, contact us: "+t.constants.SUPPORT_MAIL)},context:this}).always(function(){"function"==typeof i.always&&i.always()})},publishMag:function(t){this._changePublishState("publish",t)},unpublishMag:function(t){this._changePublishState("unpublish",t)},republishMag:function(t){this._changePublishState("republish",t)},duplicateMag:function(t){var e,i="/api/mag/"+this.get("num_id")+"/duplicate";e={type:"POST",url:i,context:this},_.extend(e,t),this.duplicateXHR&&this.duplicateXHR.abort(),this.duplicateXHR=$.ajax(e)},hasUnsavedChanges:function(){return this.get("is_published")&&this.get("changed")},onError:function(t){alert(t)}})}(RM),function(t,e){"use strict";t.collections.MagList=Backbone.Collection.extend({model:t.models.UserMag,load:function(t){t=t||{};var e=t.success||$.noop;this.loaded;var i=this;return t.success=function(t){e(i),i.loaded=!0},this.fetch(t)},comparator:function(t){return-new Date(t.get("major_update")).getTime()}})}(RM),function(t,e){"use strict";t.classes.Alert=Backbone.View.extend({template:t.templates["template-common-alert"],events:{"click .button":"onButtonClick",click:"hideOnBgClick","click .button.upgrade":"upgrade","click .button.cancel":"hide","click .button.close":"hide","click .button.ok":"hide","click .contact-link":"hide","click .button.resend":"resendConfirmationEmail"},initialize:function(e){_.bindAll(this),_.extend(this,e),this.opts=this.opts||{},this.router=this.router||t.homepageRouter||t.collectorRouter||t.constructorRouter,this.router&&this.router.analytics&&this.router.analytics.sendEvent("Alert Show",{label:this.alert_source,_alert_source:this.alert_source})},render:function(){this.setElement($(this.template({opts:this.opts}))),this.$parent&&this.$parent.append(this.$el).addClass("visible"),_.delay(_.bind(function(){this.$el.addClass("show")},this),50),$("body").on("keyup",this.onBodyKeyUp),t.common.disableShortcuts.alert=!0},hide:function(){delete t.common.disableShortcuts.alert,$("body").off("keyup",this.onBodyKeyUp),this.$el.removeClass("show").addClass("hide"),_.delay(_.bind(function(){this.remove(),this.$parent&&this.$parent.removeClass("visible")},this),400),this.trigger("hide",{lastButtonClicked:this.lastButtonClicked})},upgrade:function(e){Modernizr.sessionstorage&&window.sessionStorage.setItem("rm.accountUpgradeReturnUrl",window.location.pathname),this.router&&this.router.analytics&&this.router.analytics.sendEvent("Alert Upgrade",{label:this.alert_source,_alert_source:this.alert_source}),2==e.which||e.metaKey||e.ctrlKey||this.router&&this.router==t.collectorRouter&&(this.hide(),this.router.navigate("/settings/subscription/update",{trigger:!0}),e.preventDefault())},onBodyKeyUp:function(t){27==t.keyCode&&(t.stopPropagation(),t.preventDefault(),this.hide())},hideOnBgClick:function(t){$(t.target).closest(".panel").length||this.hide()},resendConfirmationEmail:function(){$.get("/api/user/confirm/resend"),this.hide()},onButtonClick:function(t){var e=$(t.currentTarget),i=e.attr("data-type");this.lastButtonClicked=i}})}(RM),function(t,e){"use strict";t.classes.MagPassword=Backbone.View.extend({className:"magpassword",events:{"click .access":"onAccessClick","keydown #magpassword-input":"onPasswordKeydown","input #magpassword-input":"onPasswordInput"},initialize:function(e){_.bindAll(this),_.extend(this,e),this.router=e.router,this.template=t.templates["template-viewer-mag-password"]},render:function(e){var i,n,s=this;_.extend(this,e),n=new t.models.User(this.mag.user),i=$(new Image).load(function(){s.$el.html(s.template({user:n})),s.$parent&&(s.$parent.find(s.className).remove(),s.$parent.append(s.$el)),s.delegateEvents(),$("#magpassword-input").focus(),_.delay(function(){s.$(".back, .center-content").removeClass("invisible"),_.delay(function(){s.$(".author, .powered").removeClass("invisible")},700)},200)}),i.prop("src","/img/viewer/mag-password/bg.jpg")},onAccessClick:function(){var t=$.trim($("#magpassword-input").val());return t?(this.xhr&&this.xhr.abort(),void(this.xhr=$.ajax({url:"/api/readymag/authorize",method:"POST",data:{pass:t,num_id:this.mag.num_id},success:function(t){this.proceed()},error:function(t){$("#magpassword-input").focus().select(),this.shake()},context:this}))):void this.shake()},proceed:function(){$("body").removeClass("black"),this.remove(),this.mag.has_code_injection||this.mag.opts&&this.mag.opts.gtm_id?window.location.reload():Backbone.history.loadUrl(Backbone.history.fragment)},onPasswordKeydown:function(t){13==t.keyCode&&this.onAccessClick()},onPasswordInput:function(t){this.$(".access").toggleClass("disabled",!this.$(".password-input").val())},shake:function(){var t=this;this.$(".password-wrapper").addClass("shake"),_.delay(function(){t.$(".password-wrapper").removeClass("shake")},500)}})}(RM),function(t,e){"use strict";var i;t.classes.CreateMag=i=function(e){if(_.bindAll(this),_.extend(this,e),!t.common.magCreationInProgress){if(this.analytics=this.router&&this.router.analytics,this.router?this.router==t.viewerRouter?this.routerName="viewer":this.router==t.collectorRouter?this.routerName="collector":this.router==t.homepageRouter?this.routerName="homepage":this.router==t.constructorRouter?this.routerName="constructor":this.routerName="unknown":this.routerName="error",this.analytics&&!this.noCreateRequestTracking&&this.analytics.sendEvent("Create Mag Request",{_tp:this.tp+"_"+(this.templateID?"template":"blank")+"_"+this.routerName+"_"+(this.me?"has-me":"no-me"),_template_id:this.templateID}),!Modernizr.isdesktop)return void this.showMobilePopupWarning();if(Modernizr.msie||Modernizr.msie11)return void this.showIEPopupWarning();if(!this.me)return void this.showJoinForm();var i="function"==typeof this.me.get?this.me.get("permissions"):this.me.permissions;i&&i.can_create_mag?this.innerCreateMag():this.showCreatePopupWarning()}},i.prototype.innerCreateMag=function(){var e={};this.analytics&&this.analytics.sendEvent("Create Mag",{_tp:this.tp+"_"+(this.templateID?"template":"blank")+"_"+this.routerName,_template_id:this.templateID}),this.currentFolderId&&(e.folder=this.currentFolderId),this.sharedUser&&(e.user=this.sharedUser),t.common.magCreationInProgress=!0,$.ajax({url:t.constants.readymag_auth_host+(this.templateID?"/api/magFromTemplate/"+this.templateID:"/api/mag/"),type:"POST",data:e,success:_.bind(function(e){"function"==typeof this.success&&this.success(),t.common.magCreationInProgress=!1,window.location.href=t.constants.readymag_auth_host+"/edit/"+e.num_id+"/contents/"},this),error:_.bind(function(){if("function"==typeof this.error&&this.error(),t.common.magCreationInProgress=!1,console.log(arguments),alert("Creating project problem. Contact tech support, please: "+t.constants.SUPPORT_MAIL),this.me){var e="function"==typeof this.me.get?this.me.get("uri"):this.me.uri;e&&(window.location.href=t.constants.readymag_auth_host+"/"+e)}},this)})},i.prototype.showCreatePopupWarning=function(){if(t.classes.Alert){var e=new t.classes.Alert({$parent:$("body > .popups"),router:this.router,opts:{type:"type-create"},alert_source:"create mag"});e.render()}},i.prototype.showMobilePopupWarning=function(){if(t.classes.Alert){var e=new t.classes.Alert({$parent:$("body > .popups"),router:this.router,opts:{type:"type-switch-desktop-create"},alert_source:"create mag mobile"});e.render()}},i.prototype.showIEPopupWarning=function(){if(t.classes.Alert){var e=new t.classes.Alert({$parent:$("body > .popups"),router:this.router,opts:{type:"type-browsers"}});e.render()}},i.prototype.showJoinForm=function(){var e=new t.classes.Login({router:this.router,useNavigate:!1,$container:$("body")});e.render(),e.$el.css("z-index",9999),e.createMagParams={templateID:this.templateID,tp:this.tp,noCreateRequestTracking:!0},_.delay(_.bind(function(){e.switchTo("join"),e.show()},this),100)}}(RM);/*  Copyright (C) 2012-2014  Kurt Milam - http://xioup.com | Source: https://gist.github.com/1868955
 *  
 *  This mixin now has its own github repository: https://github.com/kurtmilam/underscoreDeepExtend
 *  It's also available through npm and bower
 *  
 *  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
**/